"use strict";(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[706],{62014:function(t,e,i){i.d(e,{y:function(){return n}});class n{constructor(t,e="currency"){this.setType(e),this.setInput(t),this.processConvert()}setInput(t){"string"!=typeof t&&(t=String(t)),this.input=t}setValue(t){"string"!=typeof t&&(t=String(t)),this.input=t,this.processConvert()}setType(t){this.type=t}processConvert(){let t,e,i=this.input.split(",").join("");if(i.indexOf(".")!=i.lastIndexOf(".")&&(i=i.slice(0,i.lastIndexOf("."))),-1!=i.indexOf(".")){e=i.indexOf(".");let n=i.split(".");i=n[0],"float"===this.type&&(t=n[1].substring(0,2))}else e=i.length;let n=new Array,o=1;for(var s=-3;Math.abs(s)<e;s-=3)n.push(i.slice(s,e+s+3)),o++;let r=i.slice(0,e-3*(o-1));r.length>0&&n.push(r),n.reverse();let a=i.replace(/,/gi,""),l="";this.fakeView=n.join(),"float"===this.type&&null!=t&&(this.fakeView=this.fakeView+"."+t,l=t),this.realValue=parseFloat(a+"."+l)}}},20706:function(t,e,i){i.d(e,{b:function(){return T}});var n=i(16738),o=i(62014),s=i(27887),r=i(19228),a=i(37716),l=i(84465),c=i(81780),u=i(47063),h=i(38583),d=i(90665);function g(t,e){1&t&&a._UZ(0,"ion-progress-bar",10)}function p(t,e){if(1&t&&(a.TgZ(0,"span"),a._uU(1),a.qZA()),2&t){const t=a.oxw().$implicit;a.xp6(1),a.hij("(",t.pond_name,")")}}function m(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"ion-item"),a.TgZ(1,"ion-checkbox",17),a.NdJ("ngModelChange",function(e){const i=a.CHM(t).index;return a.oxw(2).checkList[i].status=e})("ionChange",function(){const e=a.CHM(t).index;return a.oxw(2).setTotalMoneyDebt(e)}),a.qZA(),a.TgZ(2,"ion-label"),a.TgZ(3,"p"),a._uU(4),a.ALo(5,"date"),a.qZA(),a.TgZ(6,"h3"),a._uU(7),a.YNc(8,p,2,1,"span",9),a.qZA(),a.qZA(),a.TgZ(9,"ion-label",3),a.TgZ(10,"p",18),a.TgZ(11,"ion-text",19),a._uU(12),a.ALo(13,"number"),a.qZA(),a.qZA(),a.TgZ(14,"p",18),a.TgZ(15,"ion-text",19),a._uU(16),a.ALo(17,"translate"),a.ALo(18,"number"),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&t){const t=e.$implicit,i=e.index,n=a.oxw(2);a.xp6(1),a.Q6J("ngModel",n.checkList[i].status),a.xp6(3),a.hij(" ",a.xi3(5,7,1e3*t.add_time,"d-MM-Y")," "),a.xp6(3),a.hij(" ",t.title," "),a.xp6(1),a.Q6J("ngIf",t.pond_name),a.xp6(4),a.hij(" ",a.lcZ(13,10,t.amounts),"\u0111 "),a.xp6(4),a.AsE(" ",a.lcZ(17,12,"MONEY_MOD.DEBT")," ",a.lcZ(18,14,t.debt_payed),"\u0111 ")}}function A(t,e){1&t&&(a.TgZ(0,"p"),a.TgZ(1,"ion-text",19),a._uU(2),a.ALo(3,"translate"),a.qZA(),a.qZA()),2&t&&(a.xp6(2),a.hij(" ",a.lcZ(3,1,"MONEY_MOD.WARNING_MAX_DEBT")," "))}function f(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"div"),a.TgZ(1,"ion-list"),a.YNc(2,m,19,16,"ion-item",11),a.qZA(),a.TgZ(3,"div",12),a.TgZ(4,"ion-item",13),a.TgZ(5,"ion-label"),a._uU(6),a.ALo(7,"translate"),a.qZA(),a.TgZ(8,"ion-datetime",14),a.NdJ("ngModelChange",function(e){return a.CHM(t),a.oxw().date=e}),a.ALo(9,"translate"),a.qZA(),a.qZA(),a.TgZ(10,"ion-item",13),a.TgZ(11,"ion-label",15),a._uU(12),a.ALo(13,"translate"),a.qZA(),a.TgZ(14,"ion-input",16),a.NdJ("ionChange",function(e){return a.CHM(t),a.oxw().numberFormat.setValue(e.detail.value)}),a.qZA(),a.qZA(),a.YNc(15,A,4,3,"p",9),a.qZA(),a.qZA()}if(2&t){const t=a.oxw();a.xp6(2),a.Q6J("ngForOf",t.list),a.xp6(4),a.Oqu(a.lcZ(7,9,"FARM_MOD.DATE")),a.xp6(2),a.Q6J("displayFormat",a.lcZ(9,11,"FORMAT_DATE_MOMENT"))("ngModel",t.date)("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD")),a.xp6(4),a.hij(" ",a.lcZ(13,13,"MONEY_MOD.AMOUNT")," "),a.xp6(2),a.Q6J("value",t.numberFormat.fakeView),a.xp6(1),a.Q6J("ngIf",t.numberFormat.realValue>t.maxAmounts)}}function Z(t,e){if(1&t&&(a.TgZ(0,"span"),a._uU(1),a.qZA()),2&t){const t=a.oxw().$implicit;a.xp6(1),a.hij("(",t.pond_name,")")}}function x(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"ion-item"),a.TgZ(1,"ion-checkbox",17),a.NdJ("ngModelChange",function(e){const i=a.CHM(t).index;return a.oxw(2).checkList[i].status=e})("ionChange",function(){const e=a.CHM(t).index;return a.oxw(2).setTotalMoneyDebt(e)}),a.qZA(),a.TgZ(2,"ion-label"),a.TgZ(3,"p"),a._uU(4),a.ALo(5,"date"),a.qZA(),a.TgZ(6,"h3"),a._uU(7),a.YNc(8,Z,2,1,"span",9),a.qZA(),a.qZA(),a.TgZ(9,"ion-label",3),a.TgZ(10,"p",18),a.TgZ(11,"ion-text",19),a._uU(12),a.ALo(13,"number"),a.qZA(),a.qZA(),a.TgZ(14,"p",18),a.TgZ(15,"ion-text",19),a._uU(16),a.ALo(17,"translate"),a.ALo(18,"number"),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&t){const t=e.$implicit,i=e.index,n=a.oxw(2);a.xp6(1),a.Q6J("ngModel",n.checkList[i].status),a.xp6(3),a.hij(" ",a.xi3(5,7,1e3*t.add_time,"d-MM-Y")," "),a.xp6(3),a.hij(" ",t.title," "),a.xp6(1),a.Q6J("ngIf",t.pond_name),a.xp6(4),a.hij(" ",a.lcZ(13,10,t.amounts),"\u0111 "),a.xp6(4),a.AsE(" ",a.lcZ(17,12,"MONEY_MOD.DEBT")," ",a.lcZ(18,14,t.debt_payed),"\u0111 ")}}function q(t,e){1&t&&(a.TgZ(0,"p"),a.TgZ(1,"ion-text",19),a._uU(2),a.ALo(3,"translate"),a.qZA(),a.qZA()),2&t&&(a.xp6(2),a.hij(" ",a.lcZ(3,1,"MONEY_MOD.WARNING_MAX_DEBT")," "))}function M(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"div"),a.TgZ(1,"ion-list"),a.YNc(2,x,19,16,"ion-item",11),a.qZA(),a.TgZ(3,"div",12),a.TgZ(4,"ion-item",13),a.TgZ(5,"ion-label"),a._uU(6),a.ALo(7,"translate"),a.qZA(),a.TgZ(8,"ion-datetime",14),a.NdJ("ngModelChange",function(e){return a.CHM(t),a.oxw().date=e}),a.ALo(9,"translate"),a.qZA(),a.qZA(),a.TgZ(10,"ion-item",13),a.TgZ(11,"ion-label",15),a._uU(12),a.ALo(13,"translate"),a.qZA(),a.TgZ(14,"ion-input",16),a.NdJ("ionChange",function(e){return a.CHM(t),a.oxw().numberFormat.setValue(e.detail.value)}),a.qZA(),a.qZA(),a.YNc(15,q,4,3,"p",9),a.qZA(),a.qZA()}if(2&t){const t=a.oxw();a.xp6(2),a.Q6J("ngForOf",t.list),a.xp6(4),a.Oqu(a.lcZ(7,9,"FARM_MOD.DATE")),a.xp6(2),a.Q6J("displayFormat",a.lcZ(9,11,"FORMAT_DATE_MOMENT"))("ngModel",t.date)("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD")),a.xp6(4),a.hij(" ",a.lcZ(13,13,"MONEY_MOD.AMOUNT")," "),a.xp6(2),a.Q6J("value",t.numberFormat.fakeView),a.xp6(1),a.Q6J("ngIf",t.numberFormat.realValue>t.maxAmounts)}}let T=(()=>{class t{constructor(t,e,i,r){this.moneyService=t,this.toastService=e,this.translate=i,this.modalController=r,this.list=[],this.checkList=[],this.loadingFlag=new s.E,this.numberFormat=new o.y(""),this.maxAmounts=0,this.amounts=0,this.date=n().format("YYYY-MM-DD"),this.maxDate=n(),this.minDate=n().subtract(180,"days"),this.type="out"}ngOnInit(){this.getListBill()}getListBill(){this.moneyService.getDebtCustomer(this.item.customer_slug,this.type).subscribe(t=>{0==t.status?this.toastService.warning(t.error):(this.list=t.data,this.checkList=this.list.map(t=>({bill_id:t.id,add_time:t.add_time,value:+t.debt_payed,status:!0,customer:t.customer_name})),this.maxAmounts=this.checkList.reduce((t,e)=>t+e.value,0),console.log(this.maxAmounts),this.numberFormat.setValue(this.maxAmounts),this.minDate=n(Math.max.apply(null,this.checkList.map(function(t){return t.status?1e3*t.add_time:0})))),this.loadingFlag.setResult(!0)},()=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}save(){let t=this.numberFormat.realValue,e=[];this.checkList.forEach(i=>{i.status&&i.value>0&&t>0&&(e.push({bill_id:i.bill_id,value:i.value<t?i.value:t,title:this.translate.instant("MONEY_MOD.PAY")+" bill #"+i.bill_id,customer:i.customer}),t=i.value<t?t-i.value:0)}),this.loadingFlag.setPending(!0),this.moneyService.addMultiDebtRecord({type:this.type,date:n(this.date).valueOf()/1e3,rows:e}).subscribe(t=>{0==t.status?this.toastService.warning(t.error):(this.toastService.success(this.translate.instant("SHOP.CART.ADDRESS.UPDATE_SUCCESS")),this.modalController.dismiss()),this.loadingFlag.setResult(!0)},()=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}setTotalMoneyDebt(t){this.numberFormat.setValue(this.checkList[t].status?this.checkList[t].value+this.numberFormat.realValue>this.maxAmounts?this.maxAmounts:this.checkList[t].value+this.numberFormat.realValue:this.numberFormat.realValue-this.checkList[t].value<=0?0:this.numberFormat.realValue-this.checkList[t].value),this.minDate=n(Math.max.apply(null,this.checkList.map(function(t){return t.status?1e3*t.add_time:0}))),n(this.date)<n(this.minDate)&&(this.date=n(this.minDate).format("YYYY-MM-DD"))}segmentChanged(t){this.getListBill()}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(r.r),a.Y36(l.k),a.Y36(c.sK),a.Y36(u.IN))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-money-debt"]],inputs:{item:"item"},decls:25,vars:17,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],["mode","ios",3,"ngModel","ngModelChange","ionChange"],["value","out"],["value","in"],[4,"ngIf"],["type","indeterminate"],[4,"ngFor","ngForOf"],[1,"ion-padding"],["lines","inset"],[3,"displayFormat","ngModel","min","max","ngModelChange"],["position","floating"],["type","tel","inputmode","decimal",3,"value","ionChange"],["slot","start",3,"ngModel","ngModelChange","ionChange"],[1,"ion-text-end"],["color","danger"]],template:function(t,e){1&t&&(a.TgZ(0,"ion-header"),a.TgZ(1,"ion-toolbar"),a.TgZ(2,"ion-buttons",0),a.TgZ(3,"ion-button",1),a.NdJ("click",function(){return e.modalController.dismiss(!1)}),a._UZ(4,"ion-icon",2),a.qZA(),a.qZA(),a.TgZ(5,"ion-title"),a._uU(6),a.ALo(7,"translate"),a.qZA(),a.TgZ(8,"ion-buttons",3),a.TgZ(9,"ion-button",4),a.NdJ("click",function(){return e.save()}),a._uU(10),a.ALo(11,"translate"),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.TgZ(12,"ion-content"),a.YNc(13,g,1,0,"ion-progress-bar",5),a.TgZ(14,"ion-segment",6),a.NdJ("ngModelChange",function(t){return e.type=t})("ionChange",function(t){return e.segmentChanged(t)}),a.TgZ(15,"ion-segment-button",7),a.TgZ(16,"ion-label"),a._uU(17),a.ALo(18,"translate"),a.qZA(),a.qZA(),a.TgZ(19,"ion-segment-button",8),a.TgZ(20,"ion-label"),a._uU(21),a.ALo(22,"translate"),a.qZA(),a.qZA(),a.qZA(),a.YNc(23,f,16,15,"div",9),a.YNc(24,M,16,15,"div",9),a.qZA()),2&t&&(a.xp6(6),a.Oqu(a.lcZ(7,9,"MONEY_MOD.PAY")),a.xp6(3),a.Q6J("disabled",e.numberFormat.realValue<=0||e.numberFormat.realValue>e.maxAmounts||0==e.list.length),a.xp6(1),a.hij(" ",a.lcZ(11,11,"FARM_MOD.SAVE")," "),a.xp6(3),a.Q6J("ngIf",e.loadingFlag.pending),a.xp6(1),a.Q6J("ngModel",e.type),a.xp6(3),a.Oqu(a.lcZ(18,13,"MONEY_MOD.NEED_PAY")),a.xp6(4),a.Oqu(a.lcZ(22,15,"MONEY_MOD.NEED_COLLECT")),a.xp6(2),a.Q6J("ngIf","out"==e.type),a.xp6(1),a.Q6J("ngIf","in"==e.type))},directives:[u.Gu,u.sr,u.Sm,u.YG,u.gu,u.wd,u.W2,h.O5,u.cJ,u.QI,d.JJ,d.On,u.GO,u.Q$,u.X7,u.q_,h.sg,u.Ie,u.x4,u.pK,u.j9,u.nz,u.w,u.yW],pipes:[c.X$,h.uU,h.JJ],styles:[""]}),t})()},19228:function(t,e,i){i.d(e,{r:function(){return r}});var n=i(15189),o=i(88002),s=i(37716);let r=(()=>{class t{constructor(t){this.reqAPIService=t,this.urlApi="/manager/money-api-mobie",this.urlApiNew="/manager/finance-api"}setCode(t){this.fcode=t,console.log(this.fcode)}loadMoney(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=list&page="+t).pipe((0,o.U)(t=>t))}search(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=search&keyword="+t.keyword+"&type="+t.type+"&timeFrom="+t.timeFrom+"&timeTo="+t.timeTo+"&page=0&numRow=20").pipe((0,o.U)(t=>t))}quickSearch(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=quick-search&type="+t.type+"&keyword="+t.keyword).pipe((0,o.U)(t=>t))}add(t){return this.reqAPIService.postApiWithFile("add",t,"&fcode="+this.fcode,this.urlApiNew)}edit(t){return this.reqAPIService.postApiWithFile("edit",t,"&fcode="+this.fcode+"&item="+t.get("id")+"&cr="+t.get("type"),this.urlApiNew)}editGroup(t){return this.reqAPIService.postApiWithFile("editTypeAll",t,"&fcode="+this.fcode+"&item="+t.get("id")+"&cr="+t.get("type"),this.urlApiNew)}delete(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=detele&item="+t.item+"&cr="+t.cr)}getAnalyst(t){return this.reqAPIService.post(this.urlApiNew+"?fcode="+this.fcode+"&action=analyst",t)}getGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=getItemByCode&code="+t+"&cr="+e)}getCategories(){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=listCategory")}confirmMoney(t,e,i,n){return this.reqAPIService.get(this.urlApiNew+"?action=confirm&ccode="+i+"&cr="+e+"&id="+t+"&confirm="+n)}updateFund(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=updateFund&fcode="+t+"&value="+e)}addCategory(t){return this.reqAPIService.post(this.urlApiNew+"?action=addCategory&fcode="+this.fcode,t)}searchCustomer(t,e){return this.reqAPIService.post(this.urlApiNew+"?action=searchCustomer&fcode="+this.fcode,{name:t,type:e})}getBill(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=get&fcode="+this.fcode+"&type="+e+"&id="+t)}getCustomers(){return this.reqAPIService.get(this.urlApiNew+"?action=getCustomers&fcode="+this.fcode)}getACustomer(t){return this.reqAPIService.get(this.urlApiNew+"?action=getACustomer&fcode="+this.fcode+"&customer_slug="+t)}getDebtCustomer(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtCustomer&type="+e+"&fcode="+this.fcode+"&customer_slug="+t)}addMultiDebtRecord(t){return this.reqAPIService.post(this.urlApiNew+"?action=addMultiDebt&fcode="+this.fcode,t)}getBillByAlias(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getByAlias&fcode="+this.fcode+"&alias="+t+"&type="+e)}getListMoneyByGroup(){return this.reqAPIService.get(this.urlApiNew+"?action=getListMoneyByGroup&fcode="+this.fcode)}getDetailByGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDetailByGroup&fcode="+this.fcode+"&group="+t+"&type="+e)}getDebtByGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtByGroup&type="+e+"&fcode="+this.fcode+"&group="+t)}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(n.$))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);