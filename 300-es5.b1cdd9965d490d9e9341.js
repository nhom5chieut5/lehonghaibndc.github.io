!function(){"use strict";function e(n,t){return(e=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(n,t)}function n(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var o,r=i(e);if(n){var s=i(this).constructor;o=Reflect.construct(r,arguments,s)}else o=r.apply(this,arguments);return t(this,o)}}function t(e,n){if(n&&("object"==typeof n||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[300],{54395:function(t,i,r){r.d(i,{b:function(){return l}});var a=r(77393),u=r(33637);function l(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.P;return function(t){return t.lift(new c(e,n))}}var c=function(){function e(n,t){o(this,e),this.dueTime=n,this.scheduler=t}return s(e,[{key:"call",value:function(e,n){return n.subscribe(new f(e,this.dueTime,this.scheduler))}}]),e}(),f=function(t){!function(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),t&&e(n,t)}(r,t);var i=n(r);function r(e,n,t){var s;return o(this,r),(s=i.call(this,e)).dueTime=n,s.scheduler=t,s.debouncedSubscription=null,s.lastValue=null,s.hasValue=!1,s}return s(r,[{key:"_next",value:function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(d,this.dueTime,this))}},{key:"_complete",value:function(){this.debouncedNext(),this.destination.complete()}},{key:"debouncedNext",value:function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}}},{key:"clearDebounce",value:function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)}}]),r}(a.L);function d(e){e.debouncedNext()}},40300:function(e,n,t){t.d(n,{_:function(){return E}});var i=t(64762),r=t(27887),a=t(79765),u=t(25917),l=t(54395),c=t(87519),f=t(43190),d=t(88002),p=t(87498),h=t(16738),g=t(37716),m=t(47063),Z=t(84465),v=t(81780),O=t(71239),q=t(38583);function b(e,n){if(1&e){var t=g.EpF();g.TgZ(0,"ion-item"),g._UZ(1,"ion-icon",7),g.TgZ(2,"ion-label"),g.TgZ(3,"h3"),g._uU(4),g.qZA(),g.TgZ(5,"p"),g._uU(6),g.qZA(),g.TgZ(7,"p"),g._uU(8),g.qZA(),g.qZA(),g.TgZ(9,"ion-button",8),g.NdJ("click",function(){g.CHM(t);var e=g.oxw();return e.selectedFarm=null,e.keyword=""}),g._uU(10),g.ALo(11,"translate"),g.qZA(),g.qZA()}if(2&e){var i=g.oxw();g.xp6(4),g.Oqu(i.selectedFarm.name),g.xp6(2),g.Oqu(i.selectedFarm.company_name),g.xp6(2),g.Oqu(i.selectedFarm.address),g.xp6(2),g.hij(" ",g.lcZ(11,4,"FOLLOW_MOD.DELETE")," ")}}function _(e,n){1&e&&(g.TgZ(0,"ion-list-header"),g.TgZ(1,"ion-label"),g._uU(2),g.ALo(3,"translate"),g.qZA(),g.qZA()),2&e&&(g.xp6(2),g.Oqu(g.lcZ(3,1,"FOLLOW_MOD.RESULT")))}function y(e,n){if(1&e){var t=g.EpF();g.TgZ(0,"ion-item"),g._UZ(1,"ion-icon",7),g.TgZ(2,"ion-label"),g.TgZ(3,"h3"),g._uU(4),g.qZA(),g.TgZ(5,"p"),g._uU(6),g.qZA(),g.TgZ(7,"p"),g._uU(8),g.qZA(),g.qZA(),g.TgZ(9,"ion-button",11),g.NdJ("click",function(){var e=g.CHM(t).$implicit;return g.oxw(2).selectFarm(e)}),g._uU(10),g.ALo(11,"translate"),g.qZA(),g.qZA()}if(2&e){var i=n.$implicit;g.xp6(4),g.Oqu(i.name),g.xp6(2),g.Oqu(i.company_name),g.xp6(2),g.Oqu(i.address),g.xp6(2),g.hij(" ",g.lcZ(11,4,"FOLLOW_MOD.SEE")," ")}}function x(e,n){if(1&e&&(g.TgZ(0,"ion-item",12),g.TgZ(1,"ion-label"),g.TgZ(2,"p"),g._uU(3),g.qZA(),g.qZA(),g.qZA()),2&e){var t=g.oxw(2);g.xp6(3),g.Oqu(t.searchMessage)}}function w(e,n){if(1&e&&(g.TgZ(0,"ion-list"),g.YNc(1,_,4,3,"ion-list-header",5),g.YNc(2,y,12,6,"ion-item",9),g.ALo(3,"async"),g.YNc(4,x,4,1,"ion-item",10),g.qZA()),2&e){var t=g.oxw();g.xp6(1),g.Q6J("ngIf",""!=t.keyword),g.xp6(1),g.Q6J("ngForOf",g.lcZ(3,3,t.farms)),g.xp6(2),g.Q6J("ngIf",t.searchMessage)}}function F(e,n){if(1&e&&(g.TgZ(0,"p"),g._uU(1),g.ALo(2,"number"),g.qZA()),2&e){var t=g.oxw().$implicit;g.xp6(1),g.AsE("Th\u1ea3 ",g.xi3(2,2,t.seed_quantity,"0.0-0")," con gi\u1ed1ng ",t.moment.fromNow(),"")}}function T(e,n){1&e&&(g.TgZ(0,"p"),g._uU(1),g.ALo(2,"translate"),g.qZA()),2&e&&(g.xp6(1),g.Oqu(g.lcZ(2,1,"FOLLOW_MOD.NULL")))}function A(e,n){1&e&&g._UZ(0,"ion-icon",20)}function L(e,n){1&e&&g._UZ(0,"ion-icon",21)}function k(e,n){if(1&e){var t=g.EpF();g.TgZ(0,"ion-item"),g._UZ(1,"ion-icon",13),g.TgZ(2,"ion-label",14),g.TgZ(3,"ion-text",15),g.TgZ(4,"h3"),g._uU(5),g.qZA(),g.qZA(),g.YNc(6,F,3,5,"p",5),g.YNc(7,T,3,3,"p",5),g.TgZ(8,"ion-text",16),g.TgZ(9,"small"),g._uU(10),g.TgZ(11,"sup"),g._uU(12,"2"),g.qZA(),g._uU(13),g.qZA(),g.qZA(),g.qZA(),g.TgZ(14,"ion-button",17),g.NdJ("click",function(){var e=g.CHM(t),n=e.$implicit,i=e.index;return g.oxw(2).presentFollowConfirm(n,i)}),g.YNc(15,A,1,0,"ion-icon",18),g.YNc(16,L,1,0,"ion-icon",19),g.qZA(),g.qZA()}if(2&e){var i=n.$implicit;g.xp6(5),g.Oqu(i.name),g.xp6(1),g.Q6J("ngIf","0"!=i.existSeason&&i.seed_quantity>0),g.xp6(1),g.Q6J("ngIf","0"==i.existSeason),g.xp6(3),g.hij("",i.area,"m"),g.xp6(3),g.hij(" X ",i.deep,"m"),g.xp6(2),g.Q6J("ngIf",!i.marked),g.xp6(1),g.Q6J("ngIf",i.marked)}}function N(e,n){1&e&&(g.TgZ(0,"ion-item"),g.TgZ(1,"ion-label",14),g.TgZ(2,"p"),g._uU(3),g.ALo(4,"translate"),g.qZA(),g.qZA(),g.qZA()),2&e&&(g.xp6(3),g.Oqu(g.lcZ(4,1,"FOLLOW_MOD.PERMIT")))}function I(e,n){if(1&e&&(g.TgZ(0,"ion-list"),g.TgZ(1,"ion-list-header"),g.TgZ(2,"ion-label"),g._uU(3),g.ALo(4,"translate"),g.qZA(),g.qZA(),g.YNc(5,k,17,7,"ion-item",9),g.YNc(6,N,5,3,"ion-item",5),g.qZA()),2&e){var t=g.oxw();g.xp6(3),g.Oqu(g.lcZ(4,3,"FOLLOW_MOD.POND_LIST")),g.xp6(2),g.Q6J("ngForOf",t.ponds),g.xp6(1),g.Q6J("ngIf",0==t.ponds.length)}}function R(e,n){if(1&e&&(g.TgZ(0,"p"),g._uU(1),g.qZA()),2&e){var t=g.oxw();g.xp6(1),g.Oqu(t.searchMessage)}}function S(e,n){1&e&&(g.TgZ(0,"p"),g._uU(1),g.ALo(2,"translate"),g.qZA()),2&e&&(g.xp6(1),g.Oqu(g.lcZ(2,1,"FOLLOW_MOD.ENTER_FARM_FOLLOW")))}function U(e,n){1&e&&(g.TgZ(0,"div"),g._UZ(1,"ion-spinner",22),g.qZA())}var M,E=((M=function(){function e(n,t,i,s,u,l){o(this,e),this.modalController=n,this.followService=t,this.toastService=i,this.alertController=s,this.translate=u,this.dbLocalSerive=l,this.searchTerms=new a.xQ,this.loadingFlag=new r.E,this.ponds=[],this.pondsLoading=new r.E,this.keyword=""}return s(e,[{key:"ngOnInit",value:function(){var e=this,n=this.searchTerms.pipe((0,l.b)(300),(0,c.x)(),(0,f.w)(function(n){return e.getFarmList(n)}));this.farms=n,this.farms.subscribe(function(n){n?(0==n.length&&(e.searchMessage=e.translate.instant("FOLLOW_MOD.NOT_FIND")),e.loadingFlag.setResult(!0),console.log(n)):(e.loadingFlag.setResult(!1),e.searchMessage=e.translate.instant("FOLLOW_MOD.NOT_FIND_FARM"))})}},{key:"search",value:function(e){this.loadingFlag.setPending(!0),this.keyword=e.target.value,this.searchTerms.next(this.keyword),this.searchMessage=""}},{key:"getFarmList",value:function(e){return""!=e.trim()?this.followService.searchFarm({keyword:e}).pipe((0,d.U)(function(e){return e.data})):(0,u.of)([])}},{key:"selectFarm",value:function(e){this.selectedFarm=e,this.getPondsByFarmCode(e.code)}},{key:"getPondsByFarmCode",value:function(e){var n=this;this.pondsLoading.setPending(!0),this.followService.getPondsByFarmCode(e).pipe().subscribe(function(e){e.error||1!=e.status?n.toastService.warning(e.error):n.ponds=e.data.map(function(e){var n={};return(n=e).moment=h(1e3*e.seed_date),n.marked=!1,n}),n.pondsLoading.setResult(!0)},function(){n.pondsLoading.setResult(!1),n.toastService.danger(n.translate.instant("ERROR_CONNECT"))})}},{key:"removeFarm",value:function(){this.selectedFarm=null,this.ponds=null}},{key:"presentFollowConfirm",value:function(e,n){return(0,i.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.alertController.create({header:this.translate.instant("FOLLOW_MOD.CONFIRM")+"!",message:this.translate.instant("FOLLOW_MOD.CONFIRM_FOLLOW")+" <strong>"+e.name+"</strong>?",buttons:[{text:this.translate.instant("FOLLOW_MOD.NO"),role:"cancel",cssClass:"secondary"},{text:this.translate.instant("FOLLOW_MOD.YES"),handler:function(){i.submitFollowerRequest(e.code,n)}}]});case 2:return t.next=4,t.sent.present();case 4:case"end":return t.stop()}},t,this)}))}},{key:"submitFollowerRequest",value:function(e,n){var t=this;this.followService.submitFollowerRequest(e).pipe().subscribe(function(e){if(e.error||1!=e.status)t.toastService.warning(e.error);else{t.toastService.success(e.message),t.ponds[n].marked=!0;var i=t.ponds[n];i.permission="pond_follow",t.dbLocalSerive.addItem("ponds",{infor:i})}},function(){t.toastService.danger(t.translate.instant("ERROR_CONNECT"))})}}]),e}()).\u0275fac=function(e){return new(e||M)(g.Y36(m.IN),g.Y36(p.R),g.Y36(Z.k),g.Y36(m.Br),g.Y36(v.sK),g.Y36(O.T))},M.\u0275cmp=g.Xpm({type:M,selectors:[["app-follow-search"]],decls:20,vars:13,consts:[["mode","ios"],["slot","start"],[3,"click"],["slot","icon-only","name","close"],[3,"placeholder","value","ionChange"],[4,"ngIf"],[1,"ion-text-center"],["slot","start","src","/assets/icon/001-flooded-house.svg"],["shape","round","fill","outline","slot","end","color","danger",3,"click"],[4,"ngFor","ngForOf"],["lines","none",4,"ngIf"],["slot","end","shape","round","fill","outline",3,"click"],["lines","none"],["slot","start","src","/assets/icon/pond.svg"],[1,"ion-text-wrap"],["color","primary"],["color","medium"],["slot","end","fill","clear",3,"click"],["name","bookmark-outline",4,"ngIf"],["name","bookmark",4,"ngIf"],["name","bookmark-outline"],["name","bookmark"],["name","dots"]],template:function(e,n){var t;1&e&&(g.TgZ(0,"ion-header",0),g.TgZ(1,"ion-toolbar"),g.TgZ(2,"ion-buttons",1),g.TgZ(3,"ion-button",2),g.NdJ("click",function(){return n.modalController.dismiss()}),g._UZ(4,"ion-icon",3),g.qZA(),g.qZA(),g.TgZ(5,"ion-title"),g._uU(6),g.ALo(7,"translate"),g.qZA(),g.qZA(),g.TgZ(8,"ion-toolbar"),g.TgZ(9,"ion-searchbar",4),g.NdJ("ionChange",function(e){return n.search(e)}),g.qZA(),g.qZA(),g.qZA(),g.TgZ(10,"ion-content"),g.TgZ(11,"ion-list"),g.YNc(12,b,12,6,"ion-item",5),g.qZA(),g.YNc(13,w,5,5,"ion-list",5),g.YNc(14,I,7,5,"ion-list",5),g.TgZ(15,"div",6),g.YNc(16,R,2,1,"p",5),g.ALo(17,"async"),g.YNc(18,S,3,3,"p",5),g.YNc(19,U,2,0,"div",5),g.qZA(),g.qZA()),2&e&&(g.xp6(6),g.Oqu(g.lcZ(7,9,"FOLLOW_MOD.FIND")),g.xp6(3),g.Q6J("placeholder",n.translate.instant("FOLLOW_MOD.ENTER_FARM"))("value",n.keyword),g.xp6(3),g.Q6J("ngIf",n.selectedFarm),g.xp6(1),g.Q6J("ngIf",!n.selectedFarm),g.xp6(1),g.Q6J("ngIf",n.selectedFarm),g.xp6(2),g.Q6J("ngIf",n.loadingFlag.result&&0==(null==(t=g.lcZ(17,11,n.farms))?null:t.length)&&""!=n.keyword),g.xp6(2),g.Q6J("ngIf",""==n.keyword),g.xp6(1),g.Q6J("ngIf",n.loadingFlag.pending||n.pondsLoading.pending))},directives:[m.Gu,m.sr,m.Sm,m.YG,m.gu,m.wd,m.VI,m.j9,m.W2,m.q_,q.O5,m.Ie,m.Q$,q.sg,m.yh,m.yW,m.PQ],pipes:[v.X$,q.Ov,q.JJ],styles:[""]}),M)},87498:function(e,n,t){t.d(n,{R:function(){return u}});var i,r=t(15189),a=t(37716),u=((i=function(){function e(n){o(this,e),this.reqAPIService=n}return s(e,[{key:"getFollowingList",value:function(){return this.reqAPIService.get("/follow/follow-api?action=list")}},{key:"searchFarm",value:function(e){return this.reqAPIService.post("/follow/follow-api?action=search",e)}},{key:"getPondsByFarmCode",value:function(e){return this.reqAPIService.get("/follow/follow-api?action=pondlist&fcode="+e)}},{key:"submitFollowerRequest",value:function(e){return this.reqAPIService.get("/manager/follow-api?action=request&pcode="+e)}},{key:"unFollow",value:function(e){return this.reqAPIService.post("/follow/follow-api?action=unfollow",{item_code:e})}}]),e}()).\u0275fac=function(e){return new(e||i)(a.LFG(r.$))},i.\u0275prov=a.Yz7({token:i,factory:i.\u0275fac}),i)},27887:function(e,n,t){t.d(n,{E:function(){return i}});var i=function(){function e(){o(this,e),this.start=null,this.end=null,this.pending=null,this.result=null,this.count=0}return s(e,[{key:"setStart",value:function(e){this.start=e,!0===e&&(this.pending=!0,this.end=!1),this.result=null,this.count++}},{key:"setPending",value:function(e){this.pending=e,!1===e?this.start=!1:this.end=!0}},{key:"setResult",value:function(e){this.result=e,this.pending=!1,this.start=!1,this.end=!0}}]),e}()}}])}();