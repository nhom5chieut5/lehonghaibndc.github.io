"use strict";(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[8587],{98587:function(t,e,n){n.d(e,{s:function(){return y}});var i=n(16738),a=n(27887),o=n(80272),s=n(37716),l=n(47063),g=n(81780),c=n(84465),d=n(38583),r=n(90665);function p(t,e){1&t&&(s.TgZ(0,"div",6),s._UZ(1,"ion-spinner",16),s.qZA())}function h(t,e){if(1&t&&(s.TgZ(0,"ion-segment-button",17),s.TgZ(1,"ion-label"),s._uU(2),s.qZA(),s.qZA()),2&t){const t=e.$implicit;s.Q6J("value",t.key),s.xp6(2),s.Oqu(t.value.label)}}function u(t,e){if(1&t&&(s.TgZ(0,"ion-select-option",17),s._uU(1),s.qZA()),2&t){const t=e.$implicit;s.Q6J("value",t.disease_id),s.xp6(1),s.Oqu(t.name)}}function Z(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"ion-col",28),s.TgZ(1,"ion-item"),s.TgZ(2,"ion-label",25),s._uU(3),s.ALo(4,"translate"),s.qZA(),s.TgZ(5,"ion-input",29),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw().$implicit.value=e})("ionChange",function(){return s.CHM(t),s.oxw(3).checkEmpty()}),s.qZA(),s.qZA(),s.qZA()}if(2&t){const t=s.oxw().$implicit;s.xp6(3),s.Oqu(s.lcZ(4,2,"VALUE")),s.xp6(2),s.Q6J("ngModel",t.value)}}function m(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"ion-row",21),s.TgZ(1,"ion-col",7),s.TgZ(2,"ion-button",22),s.NdJ("click",function(){const e=s.CHM(t).index;return s.oxw(2).removeRow(e)}),s._UZ(3,"ion-icon",23),s.qZA(),s.qZA(),s.TgZ(4,"ion-col",24),s.TgZ(5,"ion-item"),s.TgZ(6,"ion-label",25),s._uU(7),s.qZA(),s.TgZ(8,"ion-select",26),s.NdJ("ngModelChange",function(t){return e.$implicit.key=t})("ionChange",function(){return s.CHM(t),s.oxw(2).checkEmpty()}),s.YNc(9,u,2,2,"ion-select-option",14),s.qZA(),s.qZA(),s.qZA(),s.YNc(10,Z,6,4,"ion-col",27),s.qZA()}if(2&t){const t=e.$implicit,n=s.oxw(2);s.xp6(7),s.Oqu(n.segmentType[n.typeInputing].label),s.xp6(1),s.Q6J("ngModel",t.key),s.xp6(1),s.Q6J("ngForOf",n.segmentType[n.typeInputing].options),s.xp6(1),s.Q6J("ngIf","antibiotic"==n.typeInputing||"bacteria"==n.typeInputing)}}function T(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"div"),s.YNc(1,m,11,4,"ion-row",18),s.TgZ(2,"ion-row"),s.TgZ(3,"ion-col",6),s.TgZ(4,"ion-button",19),s.NdJ("click",function(){return s.CHM(t),s.oxw().addRow()}),s._UZ(5,"ion-icon",20),s._uU(6),s.ALo(7,"translate"),s.qZA(),s.qZA(),s.qZA(),s.qZA()}if(2&t){const t=s.oxw();s.xp6(1),s.Q6J("ngForOf",t.segmentType[t.typeInputing].data),s.xp6(5),s.hij(" ",s.lcZ(7,2,"ADD")," ")}}function A(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"div"),s.TgZ(1,"ion-grid"),s.TgZ(2,"ion-row"),s.TgZ(3,"ion-col",30),s.TgZ(4,"ion-item"),s.TgZ(5,"ion-label",25),s._uU(6),s.ALo(7,"translate"),s.ALo(8,"translate"),s.qZA(),s.TgZ(9,"ion-input",31),s.NdJ("ngModelChange",function(e){s.CHM(t);const n=s.oxw();return n.segmentType[n.typeInputing].data.weight=e}),s.qZA(),s.qZA(),s.qZA(),s.TgZ(10,"ion-col",30),s.TgZ(11,"ion-item"),s.TgZ(12,"ion-label",25),s._uU(13),s.ALo(14,"translate"),s.ALo(15,"translate"),s.qZA(),s.TgZ(16,"ion-input",31),s.NdJ("ngModelChange",function(e){s.CHM(t);const n=s.oxw();return n.segmentType[n.typeInputing].data.loss=e}),s.qZA(),s.qZA(),s.qZA(),s.TgZ(17,"ion-col",30),s.TgZ(18,"ion-item"),s.TgZ(19,"ion-label",25),s._uU(20),s.ALo(21,"translate"),s.ALo(22,"translate"),s.qZA(),s.TgZ(23,"ion-input",31),s.NdJ("ngModelChange",function(e){s.CHM(t);const n=s.oxw();return n.segmentType[n.typeInputing].data.vaccinated=e}),s.qZA(),s.qZA(),s.qZA(),s.TgZ(24,"ion-col",30),s.TgZ(25,"ion-item"),s.TgZ(26,"ion-label",25),s._uU(27),s.ALo(28,"translate"),s.qZA(),s.TgZ(29,"ion-textarea",32),s.NdJ("ngModelChange",function(e){s.CHM(t);const n=s.oxw();return n.segmentType[n.typeInputing].data.note=e}),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA()}if(2&t){const t=s.oxw();s.xp6(6),s.AsE(" ",s.lcZ(7,11,"WEIGHT")," (g/",s.lcZ(8,13,"POND_MOD.ANIMAL"),")"),s.xp6(3),s.Q6J("ngModel",t.segmentType[t.typeInputing].data.weight),s.xp6(4),s.AsE("",s.lcZ(14,15,"POND_MOD.LOSS")," (",s.lcZ(15,17,"POND_MOD.ANIMAL"),")"),s.xp6(3),s.Q6J("ngModel",t.segmentType[t.typeInputing].data.loss),s.xp6(4),s.AsE(" ",s.lcZ(21,19,"LAB_MOD.VACCINATED")," (",s.lcZ(22,21,"POND_MOD.ANIMAL"),")"),s.xp6(3),s.Q6J("ngModel",t.segmentType[t.typeInputing].data.vaccinated),s.xp6(4),s.Oqu(s.lcZ(28,23,"POND_MOD.HEALTH_STATUS")),s.xp6(2),s.Q6J("ngModel",t.segmentType[t.typeInputing].data.note)}}let y=(()=>{class t{constructor(t,e,n,o,s){this.modalCtrl=t,this.translate=e,this.toastService=n,this.pondService=o,this.cd=s,this.segmentType={antibiotic:{label:this.translate.instant("LAB_MOD.ANTIBIOTIC"),data:[],options:[]},bacteria:{label:this.translate.instant("LAB_MOD.BACTERIA"),data:[],options:[]},parasites:{label:this.translate.instant("LAB_MOD.PARASITES"),data:[],options:[]},disease:{label:this.translate.instant("LAB_MOD.DISEASE"),data:[],options:[]},health:{label:this.translate.instant("POND_MOD.HEALTH"),data:{loss:"",weight:"",note:""},options:[]}},this.loadingFlag=new a.E,this.savingFlag=new a.E,this.dateRangeSelected=i().format("YYYY-MM-DD"),this.maxDate=i(),this.minDate=i().subtract(180,"days"),this.isEmpty=!0}ngOnInit(){this.dateRangeSelected=this.time.format("YYYY-MM-DD"),this.typeInputing=this.tab,this.getListOptions(),this.getData()}save(){const t={date:this.dateRangeSelected,antibiotic:this.segmentType.antibiotic.data,bacteria:this.segmentType.bacteria.data,parasites:this.segmentType.parasites.data,disease:this.segmentType.disease.data,health:this.segmentType.health.data};this.savingFlag.setPending(!0),this.pondService.addDailyLab(t).subscribe(e=>{this.savingFlag.setResult(!0),1==+e.status?(this.processOption(e.data),this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS")),this.modalCtrl.dismiss(t)):this.toastService.warning(e.warning)},()=>{this.savingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}getListOptions(){this.pondService.loadLabOptions().subscribe(t=>{1==+t.status?this.processOption(t.data):this.toastService.warning(t.warning)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}processOption(t){for(let e in t)this.segmentType[e]&&(this.segmentType[e].options=t[e])}changeDate(t){let e=i(this.dateRangeSelected).add(t,"days");this.dateRangeSelected=e.format("YYYY-MM-DD")}onChangeDate(t){this.dateRangeSelected=t.detail.value,console.log(this.dateRangeSelected),this.getData()}closeModal(){this.modalCtrl.dismiss()}getData(){this.loadingFlag.setPending(!0),this.pondService.loadDailyLab(this.dateRangeSelected).subscribe(t=>{1==+t.status?(this.processData(t.data.record),this.cd.detectChanges()):this.toastService.warning(t.warning),this.loadingFlag.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loadingFlag.setResult(!1)})}processData(t){this.resetData();for(let e in t)"health"!=e&&this.segmentType[e]?this.segmentType[e].data=t[e]:"health"==e&&(this.segmentType[e].data={loss:t[e]?this.filterHealth(t[e],"loss"):"",weight:t[e]?this.filterHealth(t[e],"weight"):"",note:t[e]?this.filterHealth(t[e],"note"):"",vaccinated:t[e]?this.filterHealth(t[e],"vaccinated"):""});this.checkEmpty()}resetData(){["antibiotic","bacteria","parasites","disease"].forEach(t=>{this.segmentType[t].data=[]}),this.segmentType.health.data={loss:"",weight:"",note:"",vaccinated:""}}removeRow(t){this.segmentType[this.typeInputing].data.splice(t,1),this.checkEmpty()}addRow(){this.segmentType[this.typeInputing].data.push({key:"",value:"antibiotic"==this.typeInputing?"":1}),this.checkEmpty()}filterHealth(t,e){let n=t.find(t=>t.key==e);return n?n.value:""}checkEmpty(){this.isEmpty=!1;for(let t in this.segmentType)"health"!=t&&this.segmentType[t].data.forEach(e=>{if(this.segmentType[t].data.filter(t=>t.key==e.key).length>1)return console.log(e),void(this.isEmpty=!0);e.value&&e.key||(this.isEmpty=!0)});console.log(this.isEmpty)}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(l.IN),s.Y36(g.sK),s.Y36(c.k),s.Y36(o.p),s.Y36(s.sBO))},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-daily-lab-update"]],inputs:{tab:"tab",time:"time",data:"data"},decls:32,vars:22,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],["class","ion-text-center",4,"ngIf"],[1,"ion-text-center"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back"],["size","8"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","icon-only","name","arrow-forward"],["mode","ios",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["name","dots"],[3,"value"],["class","align-items-center ion-justify-content-center",4,"ngFor","ngForOf"],["shape","round","fill","outline","size","small","color","primary",3,"click"],["name","add","slot","start"],[1,"align-items-center","ion-justify-content-center"],["fill","clear","color","medium",3,"click"],["name","remove-circle-outline","slot","icon-only"],["size","6"],["position","floating"],["okText","Okay","cancelText","Dismiss",3,"ngModel","ngModelChange","ionChange"],["size","4",4,"ngIf"],["size","4"],["type","tel","inputmode","decimal",3,"ngModel","ngModelChange","ionChange"],["size","12"],["type","tel","inputmode","decimal",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(s.TgZ(0,"ion-header"),s.TgZ(1,"ion-toolbar"),s.TgZ(2,"ion-buttons",0),s.TgZ(3,"ion-button",1),s.NdJ("click",function(){return e.closeModal()}),s._UZ(4,"ion-icon",2),s.qZA(),s.qZA(),s.TgZ(5,"ion-title"),s._uU(6),s.ALo(7,"translate"),s.qZA(),s.TgZ(8,"ion-buttons",3),s.TgZ(9,"ion-button",4),s.NdJ("click",function(){return e.save()}),s._uU(10),s.ALo(11,"translate"),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(12,"ion-content"),s.YNc(13,p,2,0,"div",5),s.TgZ(14,"div",6),s.TgZ(15,"ion-grid"),s.TgZ(16,"ion-row"),s.TgZ(17,"ion-col",7),s.TgZ(18,"ion-button",8),s.NdJ("click",function(){return e.changeDate(-1)}),s._UZ(19,"ion-icon",9),s.qZA(),s.qZA(),s.TgZ(20,"ion-col",10),s.TgZ(21,"ion-item",6),s.TgZ(22,"ion-datetime",11),s.NdJ("ionChange",function(t){return e.onChangeDate(t)}),s.ALo(23,"translate"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(24,"ion-col",7),s.TgZ(25,"ion-button",8),s.NdJ("click",function(){return e.changeDate(1)}),s._UZ(26,"ion-icon",12),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(27,"ion-segment",13),s.NdJ("ngModelChange",function(t){return e.typeInputing=t}),s.YNc(28,h,3,2,"ion-segment-button",14),s.ALo(29,"keyvalue"),s.qZA(),s.YNc(30,T,8,4,"div",15),s.YNc(31,A,30,25,"div",15),s.qZA()),2&t&&(s.xp6(6),s.hij(" ",s.lcZ(7,14,"POND_MOD.LAB_DAILY_RECORD"),""),s.xp6(3),s.Q6J("disabled",e.savingFlag.pending||e.isEmpty),s.xp6(1),s.hij(" ",s.lcZ(11,16,"SAVE")," "),s.xp6(3),s.Q6J("ngIf",e.loadingFlag.pending),s.xp6(5),s.Q6J("disabled",e.dateRangeSelected<=e.minDate.format("YYYY-MM-DD")),s.xp6(4),s.Q6J("displayFormat",s.lcZ(23,18,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeSelected),s.xp6(3),s.Q6J("disabled",e.dateRangeSelected>=e.maxDate.format("YYYY-MM-DD")),s.xp6(2),s.Q6J("ngModel",e.typeInputing),s.xp6(1),s.Q6J("ngForOf",s.lcZ(29,20,e.segmentType)),s.xp6(2),s.Q6J("ngIf","health"!=e.typeInputing),s.xp6(1),s.Q6J("ngIf","health"==e.typeInputing))},directives:[l.Gu,l.sr,l.Sm,l.YG,l.gu,l.wd,l.W2,d.O5,l.jY,l.Nd,l.wI,l.Ie,l.x4,l.QI,l.cJ,r.JJ,r.On,d.sg,l.PQ,l.GO,l.Q$,l.t9,l.n0,l.pK,l.j9,l.g2],pipes:[g.X$,d.Nd],styles:[""]}),t})()}}]);