"use strict";(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[4397],{62014:function(t,e,i){i.d(e,{y:function(){return s}});class s{constructor(t,e="currency"){this.setType(e),this.setInput(t),this.processConvert()}setInput(t){"string"!=typeof t&&(t=String(t)),this.input=t}setValue(t){"string"!=typeof t&&(t=String(t)),this.input=t,this.processConvert()}setType(t){this.type=t}processConvert(){let t,e,i=this.input.split(",").join("");if(i.indexOf(".")!=i.lastIndexOf(".")&&(i=i.slice(0,i.lastIndexOf("."))),-1!=i.indexOf(".")){e=i.indexOf(".");let s=i.split(".");i=s[0],"float"===this.type&&(t=s[1].substring(0,2))}else e=i.length;let s=new Array,n=1;for(var r=-3;Math.abs(r)<e;r-=3)s.push(i.slice(r,e+r+3)),n++;let o=i.slice(0,e-3*(n-1));o.length>0&&s.push(o),s.reverse();let a=i.replace(/,/gi,""),c="";this.fakeView=s.join(),"float"===this.type&&null!=t&&(this.fakeView=this.fakeView+"."+t,c=t),this.realValue=parseFloat(a+"."+c)}}},27887:function(t,e,i){i.d(e,{E:function(){return s}});class s{constructor(){this.start=null,this.end=null,this.pending=null,this.result=null,this.count=0}setStart(t){this.start=t,!0===t&&(this.pending=!0,this.end=!1),this.result=null,this.count++}setPending(t){this.pending=t,!1===t?this.start=!1:this.end=!0}setResult(t){this.result=t,this.pending=!1,this.start=!1,this.end=!0}}},14397:function(t,e,i){i.r(e),i.d(e,{MoneyGroupDebtPageModule:function(){return h}});var s=i(38583),n=i(90665),r=i(47063),o=i(13619),a=i(73385),c=i(37716);const l=[{path:"",component:a.H}];let u=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[o.Bz.forChild(l)],o.Bz]}),t})(),h=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[s.ez,n.u5,r.Pc,u]]}),t})()},73385:function(t,e,i){i.d(e,{H:function(){return f}});var s=i(16738),n=i(62014),r=i(27887),o=i(19228),a=i(37716),c=i(84465),l=i(81780),u=i(47063),h=i(38583),d=i(90665);function p(t,e){1&t&&a._UZ(0,"ion-progress-bar",13)}function g(t,e){if(1&t&&(a.TgZ(0,"span"),a._uU(1),a.qZA()),2&t){const t=a.oxw().$implicit;a.xp6(1),a.hij("(",t.pond_name,")")}}function m(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"ion-item"),a.TgZ(1,"ion-checkbox",14),a.NdJ("ngModelChange",function(e){const i=a.CHM(t).index;return a.oxw().checkList[i].status=e})("ionChange",function(){const e=a.CHM(t).index;return a.oxw().setTotalMoneyDebt(e)}),a.qZA(),a.TgZ(2,"ion-label"),a.TgZ(3,"p"),a._uU(4),a.ALo(5,"date"),a.qZA(),a.TgZ(6,"h3"),a._uU(7),a.YNc(8,g,2,1,"span",12),a.qZA(),a.qZA(),a.TgZ(9,"ion-label",3),a.TgZ(10,"p",15),a.TgZ(11,"ion-text",16),a._uU(12),a.ALo(13,"number"),a.qZA(),a.qZA(),a.TgZ(14,"p",15),a.TgZ(15,"ion-text",16),a._uU(16),a.ALo(17,"translate"),a.ALo(18,"number"),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&t){const t=e.$implicit,i=e.index,s=a.oxw();a.xp6(1),a.Q6J("ngModel",s.checkList[i].status),a.xp6(3),a.hij(" ",a.xi3(5,7,1e3*t.add_time,"d-MM-Y")," "),a.xp6(3),a.hij(" ",t.title," "),a.xp6(1),a.Q6J("ngIf",t.pond_name),a.xp6(4),a.hij(" ",a.lcZ(13,10,t.amounts),"\u0111 "),a.xp6(4),a.AsE(" ",a.lcZ(17,12,"MONEY_MOD.DEBT")," ",a.lcZ(18,14,t.debt_payed),"\u0111 ")}}function A(t,e){1&t&&(a.TgZ(0,"p"),a.TgZ(1,"ion-text",16),a._uU(2),a.ALo(3,"translate"),a.qZA(),a.qZA()),2&t&&(a.xp6(2),a.hij(" ",a.lcZ(3,1,"MONEY_MOD.WARNING_MAX_DEBT")," "))}let f=(()=>{class t{constructor(t,e,i,o){this.moneyService=t,this.toastService=e,this.translate=i,this.modalController=o,this.list=[],this.checkList=[],this.loadingFlag=new r.E,this.numberFormat=new n.y(""),this.maxAmounts=0,this.amounts=0,this.date=s().format("YYYY-MM-DD"),this.maxDate=s(),this.minDate=s().subtract(180,"days")}ngOnInit(){this.getListBill()}getListBill(){this.moneyService.getDebtByGroup(this.item.group_id,this.item.cr).subscribe(t=>{0==t.status?this.toastService.warning(t.error):(this.list=t.data,this.checkList=this.list.map(t=>({bill_id:t.id,add_time:t.add_time,value:+t.debt_payed,status:!0,customer:t.customer_name})),this.maxAmounts=this.checkList.reduce((t,e)=>t+e.value,0),console.log(this.maxAmounts),this.numberFormat.setValue(this.maxAmounts),this.minDate=s(Math.max.apply(null,this.checkList.map(function(t){return t.status?1e3*t.add_time:0})))),this.loadingFlag.setResult(!0)},()=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}save(){let t=this.numberFormat.realValue,e=[];this.checkList.forEach(i=>{i.status&&i.value>0&&t>0&&(e.push({bill_id:i.bill_id,value:i.value<t?i.value:t,title:this.translate.instant("MONEY_MOD.PAY")+" bill #"+i.bill_id,customer:i.customer}),t=i.value<t?t-i.value:0)}),this.loadingFlag.setPending(!0),this.moneyService.addMultiDebtRecord({type:this.item.cr,date:s(this.date).valueOf()/1e3,rows:e}).subscribe(t=>{0==t.status?this.toastService.warning(t.error):(this.toastService.success(this.translate.instant("SHOP.CART.ADDRESS.UPDATE_SUCCESS")),this.modalController.dismiss()),this.loadingFlag.setResult(!0)},()=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}setTotalMoneyDebt(t){this.numberFormat.setValue(this.checkList[t].status?this.checkList[t].value+this.numberFormat.realValue>this.maxAmounts?this.maxAmounts:this.checkList[t].value+this.numberFormat.realValue:this.numberFormat.realValue-this.checkList[t].value<=0?0:this.numberFormat.realValue-this.checkList[t].value),this.minDate=s(Math.max.apply(null,this.checkList.map(function(t){return t.status?1e3*t.add_time:0}))),s(this.date)<s(this.minDate)&&(this.date=s(this.minDate).format("YYYY-MM-DD"))}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(o.r),a.Y36(c.k),a.Y36(l.sK),a.Y36(u.IN))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-money-group-debt"]],inputs:{item:"item",type:"type"},decls:30,vars:23,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"ion-padding"],["lines","inset"],[3,"displayFormat","ngModel","min","max","ngModelChange"],["position","floating"],["type","tel","inputmode","decimal",3,"value","ionChange"],[4,"ngIf"],["type","indeterminate"],["slot","start",3,"ngModel","ngModelChange","ionChange"],[1,"ion-text-end"],["color","danger"]],template:function(t,e){1&t&&(a.TgZ(0,"ion-header"),a.TgZ(1,"ion-toolbar"),a.TgZ(2,"ion-buttons",0),a.TgZ(3,"ion-button",1),a.NdJ("click",function(){return e.modalController.dismiss(!1)}),a._UZ(4,"ion-icon",2),a.qZA(),a.qZA(),a.TgZ(5,"ion-title"),a._uU(6),a.ALo(7,"translate"),a.qZA(),a.TgZ(8,"ion-buttons",3),a.TgZ(9,"ion-button",4),a.NdJ("click",function(){return e.save()}),a._uU(10),a.ALo(11,"translate"),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.TgZ(12,"ion-content"),a.YNc(13,p,1,0,"ion-progress-bar",5),a.TgZ(14,"div"),a.TgZ(15,"ion-list"),a.YNc(16,m,19,16,"ion-item",6),a.qZA(),a.TgZ(17,"div",7),a.TgZ(18,"ion-item",8),a.TgZ(19,"ion-label"),a._uU(20),a.ALo(21,"translate"),a.qZA(),a.TgZ(22,"ion-datetime",9),a.NdJ("ngModelChange",function(t){return e.date=t}),a.ALo(23,"translate"),a.qZA(),a.qZA(),a.TgZ(24,"ion-item",8),a.TgZ(25,"ion-label",10),a._uU(26),a.ALo(27,"translate"),a.qZA(),a.TgZ(28,"ion-input",11),a.NdJ("ionChange",function(t){return e.numberFormat.setValue(t.detail.value)}),a.qZA(),a.qZA(),a.YNc(29,A,4,3,"p",12),a.qZA(),a.qZA(),a.qZA()),2&t&&(a.xp6(6),a.Oqu(a.lcZ(7,13,"MONEY_MOD.PAY")),a.xp6(3),a.Q6J("disabled",e.numberFormat.realValue<=0||e.numberFormat.realValue>e.maxAmounts||0==e.list.length),a.xp6(1),a.hij(" ",a.lcZ(11,15,"FARM_MOD.SAVE")," "),a.xp6(3),a.Q6J("ngIf",e.loadingFlag.pending),a.xp6(3),a.Q6J("ngForOf",e.list),a.xp6(4),a.Oqu(a.lcZ(21,17,"FARM_MOD.DATE")),a.xp6(2),a.Q6J("displayFormat",a.lcZ(23,19,"FORMAT_DATE_MOMENT"))("ngModel",e.date)("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD")),a.xp6(4),a.hij(" ",a.lcZ(27,21,"MONEY_MOD.AMOUNT")," "),a.xp6(2),a.Q6J("value",e.numberFormat.fakeView),a.xp6(1),a.Q6J("ngIf",e.numberFormat.realValue>e.maxAmounts))},directives:[u.Gu,u.sr,u.Sm,u.YG,u.gu,u.wd,u.W2,h.O5,u.q_,h.sg,u.Ie,u.Q$,u.x4,u.QI,d.JJ,d.On,u.pK,u.j9,u.X7,u.nz,u.w,u.yW],pipes:[l.X$,h.uU,h.JJ],styles:[""]}),t})()},19228:function(t,e,i){i.d(e,{r:function(){return o}});var s=i(15189),n=i(88002),r=i(37716);let o=(()=>{class t{constructor(t){this.reqAPIService=t,this.urlApi="/manager/money-api-mobie",this.urlApiNew="/manager/finance-api"}setCode(t){this.fcode=t,console.log(this.fcode)}loadMoney(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=list&page="+t).pipe((0,n.U)(t=>t))}search(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=search&keyword="+t.keyword+"&type="+t.type+"&timeFrom="+t.timeFrom+"&timeTo="+t.timeTo+"&page=0&numRow=20").pipe((0,n.U)(t=>t))}quickSearch(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=quick-search&type="+t.type+"&keyword="+t.keyword).pipe((0,n.U)(t=>t))}add(t){return this.reqAPIService.postApiWithFile("add",t,"&fcode="+this.fcode,this.urlApiNew)}edit(t){return this.reqAPIService.postApiWithFile("edit",t,"&fcode="+this.fcode+"&item="+t.get("id")+"&cr="+t.get("type"),this.urlApiNew)}editGroup(t){return this.reqAPIService.postApiWithFile("editTypeAll",t,"&fcode="+this.fcode+"&item="+t.get("id")+"&cr="+t.get("type"),this.urlApiNew)}delete(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=detele&item="+t.item+"&cr="+t.cr)}getAnalyst(t){return this.reqAPIService.post(this.urlApiNew+"?fcode="+this.fcode+"&action=analyst",t)}getGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=getItemByCode&code="+t+"&cr="+e)}getCategories(){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=listCategory")}confirmMoney(t,e,i,s){return this.reqAPIService.get(this.urlApiNew+"?action=confirm&ccode="+i+"&cr="+e+"&id="+t+"&confirm="+s)}updateFund(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=updateFund&fcode="+t+"&value="+e)}addCategory(t){return this.reqAPIService.post(this.urlApiNew+"?action=addCategory&fcode="+this.fcode,t)}searchCustomer(t,e){return this.reqAPIService.post(this.urlApiNew+"?action=searchCustomer&fcode="+this.fcode,{name:t,type:e})}getBill(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=get&fcode="+this.fcode+"&type="+e+"&id="+t)}getCustomers(){return this.reqAPIService.get(this.urlApiNew+"?action=getCustomers&fcode="+this.fcode)}getACustomer(t){return this.reqAPIService.get(this.urlApiNew+"?action=getACustomer&fcode="+this.fcode+"&customer_slug="+t)}getDebtCustomer(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtCustomer&type="+e+"&fcode="+this.fcode+"&customer_slug="+t)}addMultiDebtRecord(t){return this.reqAPIService.post(this.urlApiNew+"?action=addMultiDebt&fcode="+this.fcode,t)}getBillByAlias(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getByAlias&fcode="+this.fcode+"&alias="+t+"&type="+e)}getListMoneyByGroup(){return this.reqAPIService.get(this.urlApiNew+"?action=getListMoneyByGroup&fcode="+this.fcode)}getDetailByGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDetailByGroup&fcode="+this.fcode+"&group="+t+"&type="+e)}getDebtByGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtByGroup&type="+e+"&fcode="+this.fcode+"&group="+t)}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(s.$))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);