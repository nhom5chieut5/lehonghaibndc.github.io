"use strict";(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[9419],{63783:function(t,a,i){i.d(a,{g:function(){return O}});var e=i(16738),n=i(27887),s=i(80272),o=i(37716),l=i(47063),r=i(81780),c=i(84465),d=i(38583),g=i(56209);function h(t,a){if(1&t&&o._UZ(0,"div",14),2&t){const t=o.oxw();o.Q6J("options",t.optionBacteria)}}function p(t,a){if(1&t&&(o.TgZ(0,"ion-item"),o.TgZ(1,"ion-text"),o._uU(2),o.qZA(),o.TgZ(3,"ion-text",16),o._uU(4),o.qZA(),o.qZA()),2&t){const t=a.$implicit;o.xp6(2),o.Oqu(t.name),o.xp6(2),o.Oqu(t.value)}}function u(t,a){if(1&t&&(o.TgZ(0,"div"),o.TgZ(1,"ion-list-header"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.YNc(4,p,5,2,"ion-item",15),o.qZA()),2&t){const t=o.oxw();o.xp6(2),o.hij(" ",o.lcZ(3,2,"LAB_MOD.BACTERIA")," "),o.xp6(2),o.Q6J("ngForOf",t.data.bacteria)}}function Z(t,a){if(1&t&&o._UZ(0,"div",14),2&t){const t=o.oxw();o.Q6J("options",t.optionDisease)}}function m(t,a){1&t&&(o.TgZ(0,"span"),o._uU(1,","),o.qZA())}function f(t,a){if(1&t&&(o.TgZ(0,"ion-text",17),o._uU(1),o.YNc(2,m,2,0,"span",12),o.qZA()),2&t){const t=a.$implicit,i=a.index,e=o.oxw();o.xp6(1),o.hij(" ",t.name," "),o.xp6(1),o.Q6J("ngIf",i<e.data.parasites.length-1)}}function A(t,a){1&t&&(o.TgZ(0,"span"),o._uU(1,","),o.qZA())}function T(t,a){if(1&t&&(o.TgZ(0,"ion-text",17),o._uU(1),o.YNc(2,A,2,0,"span",12),o.qZA()),2&t){const t=a.$implicit,i=a.index,e=o.oxw(2);o.xp6(1),o.hij(" ",t.name," "),o.xp6(1),o.Q6J("ngIf",i<e.data.disease.length-1)}}function x(t,a){if(1&t&&(o.TgZ(0,"div"),o.TgZ(1,"ion-list-header"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"ion-item"),o.YNc(5,T,3,2,"ion-text",13),o.qZA(),o.qZA()),2&t){const t=o.oxw();o.xp6(2),o.hij(" ",o.lcZ(3,2,"LAB_MOD.DISEASE")," "),o.xp6(3),o.Q6J("ngForOf",t.data.disease)}}function q(t,a){if(1&t&&(o.TgZ(0,"ion-item"),o.TgZ(1,"ion-text"),o._uU(2),o.qZA(),o.TgZ(3,"ion-text",16),o._uU(4),o.qZA(),o.qZA()),2&t){const t=a.$implicit;o.xp6(2),o.Oqu(t.name),o.xp6(2),o.Oqu(t.value)}}function b(t,a){if(1&t&&(o.TgZ(0,"div"),o.TgZ(1,"ion-list-header"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.YNc(4,q,5,2,"ion-item",15),o.qZA()),2&t){const t=o.oxw();o.xp6(2),o.hij(" ",o.lcZ(3,2,"LAB_MOD.ANTIBIOTIC")," "),o.xp6(2),o.Q6J("ngForOf",t.data.antibiotic)}}function D(t,a){if(1&t&&(o.TgZ(0,"ion-item"),o.TgZ(1,"ion-text"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"ion-text",18),o._uU(5),o.qZA(),o.qZA()),2&t){const t=o.oxw(2);o.xp6(2),o.Oqu(o.lcZ(3,2,"LAB_MOD.ACTUAL_LOSS")),o.xp6(3),o.Oqu(t.data.health.loss)}}function v(t,a){if(1&t&&(o.TgZ(0,"ion-item"),o.TgZ(1,"ion-text"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"ion-text",18),o._uU(5),o.qZA(),o.qZA()),2&t){const t=o.oxw(2);o.xp6(2),o.Oqu(o.lcZ(3,2,"WEIGHT")),o.xp6(3),o.Oqu(t.data.health.weight)}}function y(t,a){if(1&t&&(o.TgZ(0,"ion-item"),o.TgZ(1,"ion-text"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"ion-text",18),o._uU(5),o.qZA(),o.qZA()),2&t){const t=o.oxw(2);o.xp6(2),o.Oqu(o.lcZ(3,2,"LAB_MOD.VACCINATED")),o.xp6(3),o.Oqu(t.data.health.vaccinated)}}function Y(t,a){if(1&t&&(o.TgZ(0,"ion-item"),o.TgZ(1,"ion-text"),o._uU(2),o.qZA(),o.qZA()),2&t){const t=o.oxw(2);o.xp6(2),o.Oqu(t.data.health.note)}}function _(t,a){if(1&t&&(o.TgZ(0,"div"),o.TgZ(1,"ion-list-header"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.YNc(4,D,6,4,"ion-item",12),o.YNc(5,v,6,4,"ion-item",12),o.YNc(6,y,6,4,"ion-item",12),o.YNc(7,Y,3,1,"ion-item",12),o.qZA()),2&t){const t=o.oxw();o.xp6(2),o.hij(" ",o.lcZ(3,5,"NOTE")," "),o.xp6(2),o.Q6J("ngIf",t.data.health.loss),o.xp6(1),o.Q6J("ngIf",t.data.health.weight),o.xp6(1),o.Q6J("ngIf",t.data.health.vaccinated),o.xp6(1),o.Q6J("ngIf",t.data.health.note)}}let O=(()=>{class t{constructor(t,a,i,s){this.modalCtrl=t,this.translate=a,this.pondService=i,this.toastService=s,this.dateRangeSelected=e().format("YYYY-MM-DD"),this.maxDate=e(),this.loadingFlag=new n.E,this.minDate=e().subtract(180,"days"),this.optionBacteria={},this.optionDisease={}}ngOnInit(){this.dateRangeSelected=this.date.format("YYYY-MM-DD"),this.getData()}changeDate(t){let a=e(this.dateRangeSelected).add(t,"days");if(a<this.minDate||a>this.maxDate)return!1;this.dateRangeSelected=a.format("YYYY-MM-DD")}onChangeDate(t){this.dateRangeSelected=e(t.detail.value).format("YYYY-MM-DD"),this.dataPaging&&this.dataPaging[this.dateRangeSelected]?(this.data={},["antibiotic","bacteria","parasites","disease"].forEach(t=>{this.data[t]=this.dataPaging[this.dateRangeSelected][t]?this.dataPaging[this.dateRangeSelected][t]:[]}),this.data.health={},this.dataPaging[this.dateRangeSelected].health.forEach(t=>{this.data.health[t.key]=t.value})):this.getData()}getData(){this.data={},this.loadingFlag.setPending(!0),this.pondService.loadDailyLabInPond(e(this.dateRangeSelected).format("YYYY-MM-DD")).subscribe(t=>{this.dataPaging=t.paging,["antibiotic","bacteria","parasites","disease"].forEach(a=>{this.data[a]=t.data[a]?t.data[a]:[]}),this.data.health={},console.log(t.data.health),t.data.health&&t.data.health.forEach(t=>{this.data.health[t.key]=t.value}),this.initChart(),this.loadingFlag.setResult(!0)},()=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}initChart(){if(0!=Object.keys(this.dataPaging).length){var t={},a={},i=[],e=[],n=[];for(let e in this.dataPaging)["parasites","disease"].forEach(a=>{this.dataPaging[e][a]&&this.dataPaging[e][a].forEach(a=>{t[a.key]=a})}),i.push(e),this.dataPaging[e].bacteria&&this.dataPaging[e].bacteria.forEach(t=>{a[t.key]=t});for(let a in t)if("disease"==t[a].group){var s=[];i.forEach(i=>{var e=this.dataPaging[i].disease?this.dataPaging[i].disease.find(i=>i.key===t[a].key):null;s.push(e?1:"-")}),e.push({name:t[a].name,type:"bar",stack:"disease",label:{show:!1},emphasis:{focus:"series"},data:s})}else s=[],i.forEach(i=>{var e=this.dataPaging[i].parasites?this.dataPaging[i].parasites.find(i=>i.key===t[a].key):null;s.push(e?1:"-")}),n.push({name:t[a].name,type:"bar",stack:"parasites",label:{show:!1},emphasis:{focus:"series"},data:s});this.optionDisease={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},yAxis:{type:"value",show:!1},xAxis:{type:"category",data:i},series:e.concat(n)};var o=[];for(let t in a){s=[],i.forEach(i=>{var e=this.dataPaging[i].bacteria?this.dataPaging[i].bacteria.find(i=>i.key===a[t].key):null;console.log(e),s.push(e?e.value:"-")});let e=this;o.push({data:s,type:"scatter",name:a[t].name,symbolSize:function(i){return e.getSizeBac(a[t].calculator,i)}})}this.optionBacteria={legend:{show:!0,bottom:0},grid:{bottom:100},tooltip:{trigger:"axis",axisPointer:{animation:!0}},xAxis:{type:"category",data:i},yAxis:{},series:o}}}getJson(t){var a;try{a=JSON.parse(t)}catch(i){a={min:1e3,max:3e3}}return a}getSizeBac(t,a){var i=this.getJson(t);return a<=i.min?5:a>=i.max?50:20}}return t.\u0275fac=function(a){return new(a||t)(o.Y36(l.IN),o.Y36(r.sK),o.Y36(s.p),o.Y36(c.k))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-pond-lab-daily"]],inputs:{date:"date"},decls:35,vars:21,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-text-center"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back"],["size","8"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","icon-only","name","arrow-forward"],["lines","none",1,"ion-padding"],["echarts","","class","demo-chart",3,"options",4,"ngIf"],[4,"ngIf"],["color","danger",4,"ngFor","ngForOf"],["echarts","",1,"demo-chart",3,"options"],[4,"ngFor","ngForOf"],["slot","end","color","danger"],["color","danger"],["color","danger","slot","end"]],template:function(t,a){1&t&&(o.TgZ(0,"ion-header"),o.TgZ(1,"ion-toolbar"),o.TgZ(2,"ion-buttons",0),o.TgZ(3,"ion-button",1),o.NdJ("click",function(){return a.modalCtrl.dismiss()}),o._UZ(4,"ion-icon",2),o.qZA(),o.qZA(),o.TgZ(5,"ion-title"),o._uU(6),o.ALo(7,"translate"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(8,"ion-content"),o.TgZ(9,"div",3),o.TgZ(10,"ion-grid"),o.TgZ(11,"ion-row"),o.TgZ(12,"ion-col",4),o.TgZ(13,"ion-button",5),o.NdJ("click",function(){return a.changeDate(-1)}),o._UZ(14,"ion-icon",6),o.qZA(),o.qZA(),o.TgZ(15,"ion-col",7),o.TgZ(16,"ion-item",3),o.TgZ(17,"ion-datetime",8),o.NdJ("ionChange",function(t){return a.onChangeDate(t)}),o.ALo(18,"translate"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(19,"ion-col",4),o.TgZ(20,"ion-button",5),o.NdJ("click",function(){return a.changeDate(1)}),o._UZ(21,"ion-icon",9),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(22,"ion-list",10),o.YNc(23,h,1,1,"div",11),o.YNc(24,u,5,4,"div",12),o.YNc(25,Z,1,1,"div",11),o.TgZ(26,"div"),o.TgZ(27,"ion-list-header"),o._uU(28),o.ALo(29,"translate"),o.qZA(),o.TgZ(30,"ion-item"),o.YNc(31,f,3,2,"ion-text",13),o.qZA(),o.qZA(),o.YNc(32,x,6,4,"div",12),o.YNc(33,b,5,4,"div",12),o.YNc(34,_,8,7,"div",12),o.qZA(),o.qZA()),2&t&&(o.xp6(6),o.Oqu(o.lcZ(7,15,"LAB")),o.xp6(7),o.Q6J("disabled",a.dateRangeSelected<=a.minDate.format("YYYY-MM-DD")),o.xp6(4),o.Q6J("displayFormat",o.lcZ(18,17,"FORMAT_DATE_MOMENT"))("min",a.minDate.format("YYYY-MM-DD"))("max",a.maxDate.format("YYYY-MM-DD"))("value",a.dateRangeSelected),o.xp6(3),o.Q6J("disabled",a.dateRangeSelected>=a.maxDate.format("YYYY-MM-DD")),o.xp6(3),o.Q6J("ngIf",a.data&&a.data.bacteria),o.xp6(1),o.Q6J("ngIf",a.data&&a.data.bacteria),o.xp6(1),o.Q6J("ngIf",a.data&&(a.data.parasites||a.data.disease)),o.xp6(3),o.hij(" ",o.lcZ(29,19,"LAB_MOD.PARASITES")," "),o.xp6(3),o.Q6J("ngForOf",a.data.parasites),o.xp6(1),o.Q6J("ngIf",a.data&&a.data.disease),o.xp6(1),o.Q6J("ngIf",a.data&&a.data.antibiotic),o.xp6(1),o.Q6J("ngIf",a.data&&a.data.health))},directives:[l.Gu,l.sr,l.Sm,l.YG,l.gu,l.wd,l.W2,l.jY,l.Nd,l.wI,l.Ie,l.x4,l.QI,l.q_,d.O5,l.yh,d.sg,g._w,l.yW],pipes:[r.X$],styles:[""]}),t})()},59419:function(t,a,i){i.d(a,{r:function(){return x}});var e=i(64762),n=i(16738),s=i(27887),o=i(98587),l=i(80272),r=i(63783),c=i(37716),d=i(47063),g=i(84465),h=i(81780),p=i(38583);function u(t,a){1&t&&(c.TgZ(0,"div"),c._UZ(1,"ion-spinner",8),c.qZA())}function Z(t,a){if(1&t){const t=c.EpF();c.TgZ(0,"ion-item"),c.TgZ(1,"ion-label"),c.TgZ(2,"p"),c.TgZ(3,"small"),c._uU(4),c.qZA(),c.qZA(),c.TgZ(5,"h3",9),c._uU(6),c.qZA(),c.qZA(),c.TgZ(7,"ion-button",10),c.NdJ("click",function(){const a=c.CHM(t).$implicit;return c.oxw(2).presentDailyLabUpdate(a.tab)}),c._UZ(8,"ion-icon",11),c.qZA(),c.qZA()}if(2&t){const t=a.$implicit,i=c.oxw(2);c.xp6(4),c.Oqu(t.label),c.xp6(2),c.AsE("",i.getResultDaily(t)," ",t.unit,"")}}function m(t,a){if(1&t&&(c.TgZ(0,"ion-card",1),c.TgZ(1,"ion-card-header",2),c.TgZ(2,"ion-card-subtitle"),c._UZ(3,"ion-icon",3),c._uU(4),c.ALo(5,"translate"),c.qZA(),c.qZA(),c.TgZ(6,"div",4),c.YNc(7,u,2,0,"div",5),c.qZA(),c.TgZ(8,"ion-list",6),c.TgZ(9,"ion-item"),c.TgZ(10,"ion-label"),c.TgZ(11,"p"),c._uU(12),c.qZA(),c.qZA(),c.qZA(),c.YNc(13,Z,9,3,"ion-item",7),c.qZA(),c.qZA()),2&t){const t=c.oxw();c.xp6(4),c.hij(" ",c.lcZ(5,4,"LAB")," "),c.xp6(3),c.Q6J("ngIf",t.loadingFlag.pending),c.xp6(5),c.Oqu(t.time.format("DD-MM-YYYY")),c.xp6(1),c.Q6J("ngForOf",t.segmentType)}}function f(t,a){1&t&&(c.TgZ(0,"div"),c._UZ(1,"ion-spinner",8),c.qZA())}function A(t,a){if(1&t&&(c.TgZ(0,"ion-item"),c.TgZ(1,"ion-label"),c.TgZ(2,"p"),c.TgZ(3,"small"),c._uU(4),c.qZA(),c.qZA(),c.TgZ(5,"h3",9),c._uU(6),c.qZA(),c.qZA(),c.qZA()),2&t){const t=a.$implicit,i=c.oxw(2);c.xp6(4),c.Oqu(t.label),c.xp6(2),c.AsE("",i.getResultDaily(t)," ",t.unit,"")}}function T(t,a){if(1&t){const t=c.EpF();c.TgZ(0,"ion-card",1),c.TgZ(1,"ion-card-header",12),c.NdJ("click",function(){return c.CHM(t),c.oxw().presentLabDaily()}),c.TgZ(2,"ion-card-subtitle"),c._UZ(3,"ion-icon",3),c._uU(4),c.ALo(5,"translate"),c._UZ(6,"ion-icon",13),c.qZA(),c.qZA(),c.TgZ(7,"div",4),c.YNc(8,f,2,0,"div",5),c.qZA(),c.TgZ(9,"ion-list",6),c.TgZ(10,"ion-item"),c.TgZ(11,"ion-label"),c.TgZ(12,"p"),c._uU(13),c.qZA(),c.qZA(),c.qZA(),c.YNc(14,A,7,3,"ion-item",7),c.qZA(),c.qZA()}if(2&t){const t=c.oxw();c.xp6(4),c.hij(" ",c.lcZ(5,4,"LAB")," "),c.xp6(4),c.Q6J("ngIf",t.loadingFlag.pending),c.xp6(5),c.Oqu(t.time.format("DD-MM-YYYY")),c.xp6(1),c.Q6J("ngForOf",t.segmentType)}}let x=(()=>{class t{constructor(t,a,i,e){this.modalController=t,this.pondService=a,this.toastService=i,this.translate=e,this.time=n(),this.loadingFlag=new s.E,this.segmentType=[{label:this.translate.instant("LAB_MOD.ANTIBIOTIC"),unit:this.translate.instant("LAB_MOD.UNIT"),tab:"antibiotic",value:0},{label:this.translate.instant("LAB_MOD.BACTERIA"),unit:this.translate.instant("LAB_MOD.UNIT"),tab:"bacteria",value:0},{label:this.translate.instant("LAB_MOD.PARASITES"),unit:this.translate.instant("LAB_MOD.UNIT"),tab:"parasites",value:0},{label:this.translate.instant("LAB_MOD.DISEASE"),unit:this.translate.instant("LAB_MOD.UNIT"),tab:"disease",value:0},{label:this.translate.instant("POND_MOD.HEALTH"),unit:"",tab:"health",value:""}]}ngOnInit(){this.pondService.reloadSeason$.subscribe(t=>{1==+t&&this.getData()}),this.getData()}getData(){this.pondService.labPermission?this.loadLabDaily():!this.pondService.labPermission&&this.pondService.pondInLab&&this.loadDaily()}loadDaily(){this.loadingFlag.setPending(!0),this.pondService.loadDailyLabInPond("").subscribe(t=>{if(1==+t.status){this.data=t.data;for(var a=0;a<this.segmentType.length;a++)this.segmentType[a].value=this.getResultDaily(this.segmentType[a]);this.time=t.data.time?n(1e3*t.data.time):n(),console.log(this.data)}this.loadingFlag.setResult(!0)},()=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}loadLabDaily(){this.loadingFlag.setPending(!0),this.pondService.loadDailyLab("").subscribe(t=>{if(1==+t.status){this.data=t.data.record;for(var a=0;a<this.segmentType.length;a++)this.segmentType[a].value=this.getResultDaily(this.segmentType[a]);this.time=t.data.time?n(1e3*t.data.time):n()}this.loadingFlag.setResult(!0)},()=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}presentDailyLabUpdate(t){return(0,e.mG)(this,void 0,void 0,function*(){const a=yield this.modalController.create({component:o.s,cssClass:"my-custom-class",componentProps:{tab:t,data:this.data,time:this.time}});return a.onDidDismiss().then(t=>{if(t.data){["antibiotic","bacteria","parasites","disease"].forEach(a=>{this.data[a]=t.data[a]?t.data[a]:[]}),this.data.health=[],["weight","note","loss","vaccinated"].forEach(a=>{t.data.health&&t.data.health[a]&&this.data.health.push({key:a,value:t.data.health[a]})}),this.time=n(t.data.date);for(var a=0;a<this.segmentType.length;a++)this.segmentType[a].value=this.getResultDaily(this.segmentType[a])}}),yield a.present()})}getResultDaily(t){return this.data&&this.data[t.tab]?"health"==t.tab?this.data[t.tab].map(t=>this.translate.instant("POND_MOD."+t.key.toUpperCase())+" "+t.value).join(", "):this.data[t.tab].length:""}presentLabDaily(){return(0,e.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:r.g,componentProps:{date:this.time}})).present()})}}return t.\u0275fac=function(a){return new(a||t)(c.Y36(d.IN),c.Y36(l.p),c.Y36(g.k),c.Y36(h.sK))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-pond-lab"]],decls:2,vars:2,consts:[["mode","ios",4,"ngIf"],["mode","ios"],["color","tertiary"],["name","logo-vercel",1,"icon-f"],[1,"ion-text-center"],[4,"ngIf"],["lines","none","mode","ios"],[4,"ngFor","ngForOf"],["name","dots"],[1,"text-wrap"],["slot","end","shape","round","fill","clear","size","default",1,"ion-float-right",3,"click"],["name","add-circle-outline","slot","icon-only"],["color","tertiary",3,"click"],["color","primary","name","chevron-forward-outline",1,"icon-detail"]],template:function(t,a){1&t&&(c.YNc(0,m,14,6,"ion-card",0),c.YNc(1,T,15,6,"ion-card",0)),2&t&&(c.Q6J("ngIf",a.pondService.labPermission),c.xp6(1),c.Q6J("ngIf",!a.pondService.labPermission&&a.pondService.pondInLab))},directives:[p.O5,d.PM,d.Zi,d.tO,d.gu,d.q_,d.Ie,d.Q$,p.sg,d.PQ,d.YG],pipes:[h.X$],styles:[".text-wrap[_ngcontent-%COMP%]{word-break:break-all;white-space:normal}.icon-detail[_ngcontent-%COMP%]{float:right;opacity:.6;font-size:1.4em;color:#fff}"]}),t})()}}]);