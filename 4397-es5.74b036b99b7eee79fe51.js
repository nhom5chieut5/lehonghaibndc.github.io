!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[4397],{62014:function(t,n,r){r.d(n,{y:function(){return o}});var o=function(){function t(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"currency";e(this,t),this.setType(n),this.setInput(i),this.processConvert()}return i(t,[{key:"setInput",value:function(e){"string"!=typeof e&&(e=String(e)),this.input=e}},{key:"setValue",value:function(e){"string"!=typeof e&&(e=String(e)),this.input=e,this.processConvert()}},{key:"setType",value:function(e){this.type=e}},{key:"processConvert",value:function(){var e,t,i=this.input.split(",").join("");if(i.indexOf(".")!=i.lastIndexOf(".")&&(i=i.slice(0,i.lastIndexOf("."))),-1!=i.indexOf(".")){t=i.indexOf(".");var n=i.split(".");i=n[0],"float"===this.type&&(e=n[1].substring(0,2))}else t=i.length;for(var r=new Array,o=1,s=-3;Math.abs(s)<t;s-=3)r.push(i.slice(s,t+s+3)),o++;var a=i.slice(0,t-3*(o-1));a.length>0&&r.push(a),r.reverse();var u=i.replace(/,/gi,""),c="";this.fakeView=r.join(),"float"===this.type&&null!=e&&(this.fakeView=this.fakeView+"."+e,c=e),this.realValue=parseFloat(u+"."+c)}}]),t}()},27887:function(t,n,r){r.d(n,{E:function(){return o}});var o=function(){function t(){e(this,t),this.start=null,this.end=null,this.pending=null,this.result=null,this.count=0}return i(t,[{key:"setStart",value:function(e){this.start=e,!0===e&&(this.pending=!0,this.end=!1),this.result=null,this.count++}},{key:"setPending",value:function(e){this.pending=e,!1===e?this.start=!1:this.end=!0}},{key:"setResult",value:function(e){this.result=e,this.pending=!1,this.start=!1,this.end=!0}}]),t}()},14397:function(t,i,n){n.r(i),n.d(i,{MoneyGroupDebtPageModule:function(){return f}});var r,o=n(38583),s=n(90665),a=n(47063),u=n(13619),c=n(73385),l=n(37716),h=[{path:"",component:c.H}],d=((r=function t(){e(this,t)}).\u0275fac=function(e){return new(e||r)},r.\u0275mod=l.oAB({type:r}),r.\u0275inj=l.cJS({imports:[[u.Bz.forChild(h)],u.Bz]}),r),f=function(){var t=function t(){e(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[o.ez,s.u5,a.Pc,d]]}),t}()},73385:function(t,n,r){r.d(n,{H:function(){return Z}});var o=r(16738),s=r(62014),a=r(27887),u=r(19228),c=r(37716),l=r(84465),h=r(81780),d=r(47063),f=r(38583),p=r(90665);function g(e,t){1&e&&c._UZ(0,"ion-progress-bar",13)}function m(e,t){if(1&e&&(c.TgZ(0,"span"),c._uU(1),c.qZA()),2&e){var i=c.oxw().$implicit;c.xp6(1),c.hij("(",i.pond_name,")")}}function A(e,t){if(1&e){var i=c.EpF();c.TgZ(0,"ion-item"),c.TgZ(1,"ion-checkbox",14),c.NdJ("ngModelChange",function(e){var t=c.CHM(i).index;return c.oxw().checkList[t].status=e})("ionChange",function(){var e=c.CHM(i).index;return c.oxw().setTotalMoneyDebt(e)}),c.qZA(),c.TgZ(2,"ion-label"),c.TgZ(3,"p"),c._uU(4),c.ALo(5,"date"),c.qZA(),c.TgZ(6,"h3"),c._uU(7),c.YNc(8,m,2,1,"span",12),c.qZA(),c.qZA(),c.TgZ(9,"ion-label",3),c.TgZ(10,"p",15),c.TgZ(11,"ion-text",16),c._uU(12),c.ALo(13,"number"),c.qZA(),c.qZA(),c.TgZ(14,"p",15),c.TgZ(15,"ion-text",16),c._uU(16),c.ALo(17,"translate"),c.ALo(18,"number"),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&e){var n=t.$implicit,r=t.index,o=c.oxw();c.xp6(1),c.Q6J("ngModel",o.checkList[r].status),c.xp6(3),c.hij(" ",c.xi3(5,7,1e3*n.add_time,"d-MM-Y")," "),c.xp6(3),c.hij(" ",n.title," "),c.xp6(1),c.Q6J("ngIf",n.pond_name),c.xp6(4),c.hij(" ",c.lcZ(13,10,n.amounts),"\u0111 "),c.xp6(4),c.AsE(" ",c.lcZ(17,12,"MONEY_MOD.DEBT")," ",c.lcZ(18,14,n.debt_payed),"\u0111 ")}}function v(e,t){1&e&&(c.TgZ(0,"p"),c.TgZ(1,"ion-text",16),c._uU(2),c.ALo(3,"translate"),c.qZA(),c.qZA()),2&e&&(c.xp6(2),c.hij(" ",c.lcZ(3,1,"MONEY_MOD.WARNING_MAX_DEBT")," "))}var y,Z=((y=function(){function t(i,n,r,u){e(this,t),this.moneyService=i,this.toastService=n,this.translate=r,this.modalController=u,this.list=[],this.checkList=[],this.loadingFlag=new a.E,this.numberFormat=new s.y(""),this.maxAmounts=0,this.amounts=0,this.date=o().format("YYYY-MM-DD"),this.maxDate=o(),this.minDate=o().subtract(180,"days")}return i(t,[{key:"ngOnInit",value:function(){this.getListBill()}},{key:"getListBill",value:function(){var e=this;this.moneyService.getDebtByGroup(this.item.group_id,this.item.cr).subscribe(function(t){0==t.status?e.toastService.warning(t.error):(e.list=t.data,e.checkList=e.list.map(function(e){return{bill_id:e.id,add_time:e.add_time,value:+e.debt_payed,status:!0,customer:e.customer_name}}),e.maxAmounts=e.checkList.reduce(function(e,t){return e+t.value},0),console.log(e.maxAmounts),e.numberFormat.setValue(e.maxAmounts),e.minDate=o(Math.max.apply(null,e.checkList.map(function(e){return e.status?1e3*e.add_time:0})))),e.loadingFlag.setResult(!0)},function(){e.loadingFlag.setResult(!1),e.toastService.danger(e.translate.instant("ERROR_CONNECT"))})}},{key:"save",value:function(){var e=this,t=this.numberFormat.realValue,i=[];this.checkList.forEach(function(n){n.status&&n.value>0&&t>0&&(i.push({bill_id:n.bill_id,value:n.value<t?n.value:t,title:e.translate.instant("MONEY_MOD.PAY")+" bill #"+n.bill_id,customer:n.customer}),t=n.value<t?t-n.value:0)}),this.loadingFlag.setPending(!0),this.moneyService.addMultiDebtRecord({type:this.item.cr,date:o(this.date).valueOf()/1e3,rows:i}).subscribe(function(t){0==t.status?e.toastService.warning(t.error):(e.toastService.success(e.translate.instant("SHOP.CART.ADDRESS.UPDATE_SUCCESS")),e.modalController.dismiss()),e.loadingFlag.setResult(!0)},function(){e.loadingFlag.setResult(!1),e.toastService.danger(e.translate.instant("ERROR_CONNECT"))})}},{key:"setTotalMoneyDebt",value:function(e){this.numberFormat.setValue(this.checkList[e].status?this.checkList[e].value+this.numberFormat.realValue>this.maxAmounts?this.maxAmounts:this.checkList[e].value+this.numberFormat.realValue:this.numberFormat.realValue-this.checkList[e].value<=0?0:this.numberFormat.realValue-this.checkList[e].value),this.minDate=o(Math.max.apply(null,this.checkList.map(function(e){return e.status?1e3*e.add_time:0}))),o(this.date)<o(this.minDate)&&(this.date=o(this.minDate).format("YYYY-MM-DD"))}}]),t}()).\u0275fac=function(e){return new(e||y)(c.Y36(u.r),c.Y36(l.k),c.Y36(h.sK),c.Y36(d.IN))},y.\u0275cmp=c.Xpm({type:y,selectors:[["app-money-group-debt"]],inputs:{item:"item",type:"type"},decls:30,vars:23,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"ion-padding"],["lines","inset"],[3,"displayFormat","ngModel","min","max","ngModelChange"],["position","floating"],["type","tel","inputmode","decimal",3,"value","ionChange"],[4,"ngIf"],["type","indeterminate"],["slot","start",3,"ngModel","ngModelChange","ionChange"],[1,"ion-text-end"],["color","danger"]],template:function(e,t){1&e&&(c.TgZ(0,"ion-header"),c.TgZ(1,"ion-toolbar"),c.TgZ(2,"ion-buttons",0),c.TgZ(3,"ion-button",1),c.NdJ("click",function(){return t.modalController.dismiss(!1)}),c._UZ(4,"ion-icon",2),c.qZA(),c.qZA(),c.TgZ(5,"ion-title"),c._uU(6),c.ALo(7,"translate"),c.qZA(),c.TgZ(8,"ion-buttons",3),c.TgZ(9,"ion-button",4),c.NdJ("click",function(){return t.save()}),c._uU(10),c.ALo(11,"translate"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(12,"ion-content"),c.YNc(13,g,1,0,"ion-progress-bar",5),c.TgZ(14,"div"),c.TgZ(15,"ion-list"),c.YNc(16,A,19,16,"ion-item",6),c.qZA(),c.TgZ(17,"div",7),c.TgZ(18,"ion-item",8),c.TgZ(19,"ion-label"),c._uU(20),c.ALo(21,"translate"),c.qZA(),c.TgZ(22,"ion-datetime",9),c.NdJ("ngModelChange",function(e){return t.date=e}),c.ALo(23,"translate"),c.qZA(),c.qZA(),c.TgZ(24,"ion-item",8),c.TgZ(25,"ion-label",10),c._uU(26),c.ALo(27,"translate"),c.qZA(),c.TgZ(28,"ion-input",11),c.NdJ("ionChange",function(e){return t.numberFormat.setValue(e.detail.value)}),c.qZA(),c.qZA(),c.YNc(29,v,4,3,"p",12),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(6),c.Oqu(c.lcZ(7,13,"MONEY_MOD.PAY")),c.xp6(3),c.Q6J("disabled",t.numberFormat.realValue<=0||t.numberFormat.realValue>t.maxAmounts||0==t.list.length),c.xp6(1),c.hij(" ",c.lcZ(11,15,"FARM_MOD.SAVE")," "),c.xp6(3),c.Q6J("ngIf",t.loadingFlag.pending),c.xp6(3),c.Q6J("ngForOf",t.list),c.xp6(4),c.Oqu(c.lcZ(21,17,"FARM_MOD.DATE")),c.xp6(2),c.Q6J("displayFormat",c.lcZ(23,19,"FORMAT_DATE_MOMENT"))("ngModel",t.date)("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD")),c.xp6(4),c.hij(" ",c.lcZ(27,21,"MONEY_MOD.AMOUNT")," "),c.xp6(2),c.Q6J("value",t.numberFormat.fakeView),c.xp6(1),c.Q6J("ngIf",t.numberFormat.realValue>t.maxAmounts))},directives:[d.Gu,d.sr,d.Sm,d.YG,d.gu,d.wd,d.W2,f.O5,d.q_,f.sg,d.Ie,d.Q$,d.x4,d.QI,p.JJ,p.On,d.pK,d.j9,d.X7,d.nz,d.w,d.yW],pipes:[h.X$,f.uU,f.JJ],styles:[""]}),y)},19228:function(t,n,r){r.d(n,{r:function(){return c}});var o,s=r(15189),a=r(88002),u=r(37716),c=((o=function(){function t(i){e(this,t),this.reqAPIService=i,this.urlApi="/manager/money-api-mobie",this.urlApiNew="/manager/finance-api"}return i(t,[{key:"setCode",value:function(e){this.fcode=e,console.log(this.fcode)}},{key:"loadMoney",value:function(e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=list&page="+e).pipe((0,a.U)(function(e){return e}))}},{key:"search",value:function(e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=search&keyword="+e.keyword+"&type="+e.type+"&timeFrom="+e.timeFrom+"&timeTo="+e.timeTo+"&page=0&numRow=20").pipe((0,a.U)(function(e){return e}))}},{key:"quickSearch",value:function(e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=quick-search&type="+e.type+"&keyword="+e.keyword).pipe((0,a.U)(function(e){return e}))}},{key:"add",value:function(e){return this.reqAPIService.postApiWithFile("add",e,"&fcode="+this.fcode,this.urlApiNew)}},{key:"edit",value:function(e){return this.reqAPIService.postApiWithFile("edit",e,"&fcode="+this.fcode+"&item="+e.get("id")+"&cr="+e.get("type"),this.urlApiNew)}},{key:"editGroup",value:function(e){return this.reqAPIService.postApiWithFile("editTypeAll",e,"&fcode="+this.fcode+"&item="+e.get("id")+"&cr="+e.get("type"),this.urlApiNew)}},{key:"delete",value:function(e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=detele&item="+e.item+"&cr="+e.cr)}},{key:"getAnalyst",value:function(e){return this.reqAPIService.post(this.urlApiNew+"?fcode="+this.fcode+"&action=analyst",e)}},{key:"getGroup",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=getItemByCode&code="+e+"&cr="+t)}},{key:"getCategories",value:function(){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=listCategory")}},{key:"confirmMoney",value:function(e,t,i,n){return this.reqAPIService.get(this.urlApiNew+"?action=confirm&ccode="+i+"&cr="+t+"&id="+e+"&confirm="+n)}},{key:"updateFund",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=updateFund&fcode="+e+"&value="+t)}},{key:"addCategory",value:function(e){return this.reqAPIService.post(this.urlApiNew+"?action=addCategory&fcode="+this.fcode,e)}},{key:"searchCustomer",value:function(e,t){return this.reqAPIService.post(this.urlApiNew+"?action=searchCustomer&fcode="+this.fcode,{name:e,type:t})}},{key:"getBill",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=get&fcode="+this.fcode+"&type="+t+"&id="+e)}},{key:"getCustomers",value:function(){return this.reqAPIService.get(this.urlApiNew+"?action=getCustomers&fcode="+this.fcode)}},{key:"getACustomer",value:function(e){return this.reqAPIService.get(this.urlApiNew+"?action=getACustomer&fcode="+this.fcode+"&customer_slug="+e)}},{key:"getDebtCustomer",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtCustomer&type="+t+"&fcode="+this.fcode+"&customer_slug="+e)}},{key:"addMultiDebtRecord",value:function(e){return this.reqAPIService.post(this.urlApiNew+"?action=addMultiDebt&fcode="+this.fcode,e)}},{key:"getBillByAlias",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=getByAlias&fcode="+this.fcode+"&alias="+e+"&type="+t)}},{key:"getListMoneyByGroup",value:function(){return this.reqAPIService.get(this.urlApiNew+"?action=getListMoneyByGroup&fcode="+this.fcode)}},{key:"getDetailByGroup",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=getDetailByGroup&fcode="+this.fcode+"&group="+e+"&type="+t)}},{key:"getDebtByGroup",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtByGroup&type="+t+"&fcode="+this.fcode+"&group="+e)}}]),t}()).\u0275fac=function(e){return new(e||o)(u.LFG(s.$))},o.\u0275prov=u.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o)}}])}();