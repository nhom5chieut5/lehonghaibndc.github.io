"use strict";(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[5396],{97905:function(t,e,i){i.d(e,{K:function(){return o}});var a=i(64762),n=i(38739),s=i(37716),o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.FileTransferErrorCode={FILE_NOT_FOUND_ERR:1,INVALID_URL_ERR:2,CONNECTION_ERR:3,ABORT_ERR:4,NOT_MODIFIED_ERR:5},e}return(0,a.ZT)(e,t),e.prototype.create=function(){return new r},e.pluginName="FileTransfer",e.plugin="cordova-plugin-file-transfer",e.pluginRef="FileTransfer",e.repo="https://github.com/apache/cordova-plugin-file-transfer",e.platforms=["Amazon Fire OS","Android","Browser","iOS","Ubuntu","Windows","Windows Phone"],e.\u0275fac=function(){var t;return function(i){return(t||(t=s.n5z(e)))(i||e)}}(),e.\u0275prov=s.Yz7({token:e,factory:function(t){return e.\u0275fac(t)}}),e}(n.KY),r=function(){function t(){!0===(0,n.gR)(o.getPluginRef(),null,o.getPluginName())&&(this._objectInstance=new(o.getPlugin()))}return t.prototype.upload=function(t,e,i,a){return(0,n.e4)(this,"upload",{successIndex:2,errorIndex:3},arguments)},t.prototype.download=function(t,e,i,a){return(0,n.e4)(this,"download",{successIndex:2,errorIndex:3},arguments)},t.prototype.onProgress=function(t){!0===(0,n.G5)(this)&&(this._objectInstance.onprogress=t)},t.prototype.abort=function(){return(0,n.e4)(this,"abort",{sync:!0},arguments)},t.plugin="cordova-plugin-file-transfer",t.pluginName="FileTransfer",t}()},10740:function(t,e,i){i.d(e,{B:function(){return r}});var a=i(76329),n=i(15189),s=i(50384),o=i(37716);let r=(()=>{class t{constructor(t,e){this.reqAPIService=t,this.auth=e,this.API_URL="",this.reload$=new a.BehaviorSubject(0),this.user=this.auth.user}getUserInformation(){return this.API_URL="/user/api-account-mobie?action=get",this.reqAPIService.get(this.API_URL)}getFilePath(){return this.reqAPIService.FILE_PATH}getSitePath(){return this.reqAPIService.SITE_PATH}getToken(){return this.reqAPIService.getToken()}updateAccount(t){return this.API_URL="/user/api-account-mobie?action=edit",this.reqAPIService.post(this.API_URL,t)}resetPassword(t){return this.API_URL="/user/api-account-mobie?action=changepass",this.reqAPIService.post(this.API_URL,t)}actionExpert(t="register",e){return this.API_URL="/user/expert-account-api?action="+t,this.reqAPIService.post(this.API_URL,e)}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(n.$),o.LFG(s.e))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac}),t})()},55396:function(t,e,i){i.d(e,{a:function(){return D}});var a=i(64762),n=i(27887),s=i(80272),o=i(92340),r=i(16738),c=i(90665),h=i(59865),l=i(97905),d=i(84267),u=i(10740),g=i(37716),p=i(47063),m=i(84465),f=i(81780),A=i(39075),T=i(38583);function R(t,e){1&t&&g._UZ(0,"ion-progress-bar",18)}function P(t,e){if(1&t&&g._UZ(0,"img",19),2&t){const t=g.oxw();g.Q6J("src",t.baseImage+t.pathPhoto,g.LSH)}}let D=(()=>{class t{constructor(t,e,i,a,s,h,l,d,u,g){this.modalCtrl=t,this.pondService=e,this.toastService=i,this.translate=a,this.accountService=s,this.actionSheetController=h,this.camera=l,this.platform=d,this.filePath=u,this.DomSanitizer=g,this.URL_SAVE=o.bl.SITE_PATH+"/manager/upload-image-daily-api",this.form=new c.cw({date:new c.NI(""),description:new c.NI("",[c.kI.maxLength(255)])}),this.loadingFlag=new n.E,this.saveLoadingFlag=new n.E,this.baseImage="",this.isUpload=!1,this.dataRaw=[],this.dateRangeSelected=r().format("YYYY-MM-DD"),this.maxDate=r(),this.minDate=r().subtract(180,"days")}ngOnInit(){this.URL_SAVE+="?pcode="+this.pondService.pcode,this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.getData()}setData(t){void 0!==t&&(this.pathPhoto=t.image?o.bl.FILE_PATH+"/upload/season/"+this.scode+"/thumb_image/"+t.image:"",this.form.patchValue({description:t.description}))}getData(){this.loadingFlag.setStart(!0),this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},r(this.dateRangeSelected).format("YYYY-MM-DD")).subscribe(t=>{t.data?(this.dataRaw=t.data,console.log(this.dateRangeSelected),this.dataRaw[0].date==r(this.dateRangeSelected).format("YYYY-MM-DD")&&(this.itemSelected=this.dataRaw[0]),this.setData(this.itemSelected),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},t=>{this.loadingFlag.setResult(!1),console.log(t)})}onChangeDate(t){this.dateRangeSelected=t.detail.value;let e=r(this.dateRangeSelected);this.itemSelected=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e.format("YYYY-MM-DD"))],this.isUpload=!1,this.pathPhoto="",this.baseImage="",this.form.patchValue({date:e.format("YYYY-MM-DD")}),!this.itemSelected||e<r(this.dataRaw[this.dataRaw.length-1].date)||e>r(this.dataRaw[0].date)?this.getData():this.setData(this.itemSelected)}changeDate(t){let e=r(this.dateRangeSelected).add(t,"days");if(e<this.minDate||e>this.maxDate)return!1;this.dateRangeSelected=e.format("YYYY-MM-DD")}processData(){this.itemSelected=this.dataRaw.filter(t=>t.date==r(this.dateRangeSelected).format("YYYY-MM-DD"))}uploadPhoto(){return(0,a.mG)(this,void 0,void 0,function*(){yield(yield this.actionSheetController.create({header:this.translate.instant("ACCOUNT_MOD.CHANGE_AVATAR"),buttons:[{text:this.translate.instant("ACCOUNT_MOD.NEW_PHOTO"),icon:"camera-outline",handler:()=>{this.takePicture(this.camera.PictureSourceType.CAMERA)}},{text:this.translate.instant("ACCOUNT_MOD.LIBRARY"),icon:"albums-outline",handler:()=>{this.pickerImage(this.camera.PictureSourceType.PHOTOLIBRARY)}},{text:this.translate.instant("OPTION.CANCEL"),icon:"close-outline",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]})).present()})}takePicture(t){this.camera.getPicture({quality:100,sourceType:t,destinationType:this.camera.DestinationType.DATA_URL,encodingType:this.camera.EncodingType.JPEG,mediaType:this.camera.MediaType.PICTURE,saveToPhotoAlbum:!1,correctOrientation:!0,targetHeight:500,targetWidth:500}).then(t=>{this.namePhoto=t.substr(t.lastIndexOf("/")+1),this.baseImage="data:image/jpeg;base64,",this.pathPhoto=t,this.isUpload=!0},t=>{this.toastService.warning(this.translate.instant("ACCOUNT_MOD.ERROR_LIBRARY"))})}pickerImage(t){this.camera.getPicture({quality:100,sourceType:t,saveToPhotoAlbum:!1,destinationType:this.camera.DestinationType.DATA_URL,encodingType:this.camera.EncodingType.JPEG,mediaType:this.camera.MediaType.PICTURE,targetHeight:500,targetWidth:500}).then(e=>{this.platform.is("android")&&t===this.camera.PictureSourceType.PHOTOLIBRARY?this.filePath.resolveNativePath(e="file://"+e).then(t=>{this.namePhoto=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("?")),this.baseImage="data:image/jpeg;base64,",this.pathPhoto=t.replace("file://",""),this.isUpload=!0}).catch(t=>{this.toastService.warning(this.translate.instant("ACCOUNT_MOD.ERROR")+" "+t)}):(this.baseImage="data:image/jpeg;base64,",this.pathPhoto=e,this.namePhoto=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("?")))},t=>{this.toastService.warning(this.translate.instant("ACCOUNT_MOD.ERROR_LIBRARY"))})}onSaveNonePhoto(){this.saveLoadingFlag.setPending(!0),this.pondService.savePhotoDaily(this.form.value).subscribe(t=>{1==t.status?this.modalCtrl.dismiss(this.form.value):this.toastService.warning(t.error),this.saveLoadingFlag.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.saveLoadingFlag.setResult(!1)})}onSaveWithPhoto(){return(0,a.mG)(this,void 0,void 0,function*(){const t=(new Date).valueOf()+".jpeg",e=this.dataURItoBlob(this.pathPhoto);console.log(e);let i=new FormData;i.append("image",e),i.append("date",this.form.value.date),i.append("description",this.form.value.description),this.loadingFlag.setPending(!0),this.pondService.uploadPhoto(i,t).pipe().subscribe(t=>{1==t.status?(this.toastService.success(this.translate.instant("POND_MOD.NOTI_UPDATE")),this.modalCtrl.dismiss({image:t.data,description:this.form.value.description,date:r(this.form.value.date).format("YYYY-MM-DD")})):this.toastService.warning(t.error),this.saveLoadingFlag.setResult(!0)},t=>{this.saveLoadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})})}onSave(){this.isUpload?this.onSaveWithPhoto():this.onSaveNonePhoto()}dataURItoBlob(t){const e=window.atob(t),i=new ArrayBuffer(e.length),a=new Uint8Array(i);for(let n=0;n<e.length;n++)a[n]=e.charCodeAt(n);return new Blob([a],{type:"image/jpeg"})}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(p.IN),g.Y36(s.p),g.Y36(m.k),g.Y36(f.sK),g.Y36(u.B),g.Y36(p.BX),g.Y36(d.V1),g.Y36(p.t4),g.Y36(h.y),g.Y36(A.H7))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-daily-photo-update"]],inputs:{inforDaily:"inforDaily",scode:"scode"},features:[g._Bn([l.K])],decls:40,vars:24,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],["type","indeterminate",4,"ngIf"],[1,"ion-text-center"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back-outline"],["size","8"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","icon-only","name","arrow-forward-outline"],["width","240px",3,"src",4,"ngIf"],[2,"max-width","240px","margin","0 auto",3,"formGroup"],["size","small",3,"click"],["position","floating"],["rows","6","cols","20","formControlName","description"],["type","indeterminate"],["width","240px",3,"src"]],template:function(t,e){1&t&&(g.TgZ(0,"ion-header"),g.TgZ(1,"ion-toolbar"),g.TgZ(2,"ion-buttons",0),g.TgZ(3,"ion-button",1),g.NdJ("click",function(){return e.modalCtrl.dismiss()}),g._UZ(4,"ion-icon",2),g.qZA(),g.qZA(),g.TgZ(5,"ion-title"),g._uU(6),g.ALo(7,"translate"),g.qZA(),g.TgZ(8,"ion-buttons",3),g.TgZ(9,"ion-button",4),g.NdJ("click",function(){return e.onSave()}),g._uU(10),g.ALo(11,"translate"),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(12,"ion-content"),g.YNc(13,R,1,0,"ion-progress-bar",5),g.TgZ(14,"div",6),g.TgZ(15,"ion-grid"),g.TgZ(16,"ion-row"),g.TgZ(17,"ion-col",7),g.TgZ(18,"ion-button",8),g.NdJ("click",function(){return e.changeDate(-1)}),g._UZ(19,"ion-icon",9),g.qZA(),g.qZA(),g.TgZ(20,"ion-col",10),g.TgZ(21,"ion-item"),g.TgZ(22,"ion-datetime",11),g.NdJ("ionChange",function(t){return e.onChangeDate(t)}),g.ALo(23,"translate"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(24,"ion-col",7),g.TgZ(25,"ion-button",8),g.NdJ("click",function(){return e.changeDate(1)}),g._UZ(26,"ion-icon",12),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(27,"div",6),g.YNc(28,P,1,1,"img",13),g.qZA(),g.TgZ(29,"div"),g.TgZ(30,"ion-list",14),g.TgZ(31,"ion-item"),g.TgZ(32,"ion-button",15),g.NdJ("click",function(){return e.uploadPhoto()}),g._uU(33),g.ALo(34,"translate"),g.qZA(),g.qZA(),g.TgZ(35,"ion-item"),g.TgZ(36,"ion-label",16),g._uU(37),g.ALo(38,"translate"),g.qZA(),g._UZ(39,"ion-textarea",17),g.qZA(),g.qZA(),g.qZA(),g.qZA()),2&t&&(g.xp6(6),g.Oqu(g.lcZ(7,14,"PHOTO_MOD.DAILY_PHOTO_UPDATE")),g.xp6(3),g.Q6J("disabled",e.form.invalid),g.xp6(1),g.hij(" ",g.lcZ(11,16,"POND_MOD.SAVE")," "),g.xp6(3),g.Q6J("ngIf",e.saveLoadingFlag.pending),g.xp6(5),g.Q6J("disabled",e.dateRangeSelected<=e.minDate.format("YYYY-MM-DD")),g.xp6(4),g.Q6J("displayFormat",g.lcZ(23,18,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeSelected),g.xp6(3),g.Q6J("disabled",e.dateRangeSelected>=e.maxDate.format("YYYY-MM-DD")),g.xp6(3),g.Q6J("ngIf",e.pathPhoto),g.xp6(2),g.Q6J("formGroup",e.form),g.xp6(3),g.Oqu(g.lcZ(34,20,"PHOTO_MOD.CHOOSE_IMAGE")),g.xp6(4),g.Oqu(g.lcZ(38,22,"PHOTO_MOD.DESCRIPTION")))},directives:[p.Gu,p.sr,p.Sm,p.YG,p.gu,p.wd,p.W2,T.O5,p.jY,p.Nd,p.wI,p.Ie,p.x4,p.QI,p.q_,c.JL,c.sg,p.Q$,p.g2,p.j9,c.JJ,c.u,p.X7],pipes:[f.X$],styles:[""]}),t})()}}]);