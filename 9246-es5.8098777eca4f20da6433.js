!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[9246],{49246:function(t,i,o){o.d(i,{C:function(){return U}});var a=o(64762),r=o(16738),s=o(27887),c=o(82629),u=o(3520),l=o(31435),d=o(37716),f=o(47063),p=o(81780),h=o(88459),m=o(84465),g=o(38583),v=o(56209);function _(e,t){1&e&&d._UZ(0,"ion-progress-bar",13)}function Z(e,t){if(1&e&&d._UZ(0,"div",14),2&e){var n=d.oxw();d.Q6J("options",n.optionAnalyzeCharts)("merge",n.stateData.analyze)}}function T(e,t){if(1&e&&(d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label"),d._uU(2),d.qZA(),d.TgZ(3,"ion-text",9),d._uU(4),d.qZA(),d.qZA()),2&e){var n=t.$implicit;d.xp6(2),d.hij(" ",n.time," "),d.xp6(2),d.hij(" ",n.value," kg ")}}var D,A=((D=function(){function t(n,i,o,a,r,c,u){e(this,t),this.modalController=n,this.translate=i,this.afs=o,this.popoverController=a,this.iotService=r,this.toastService=c,this.alertController=u,this.loading=new s.E,this.optionDataCharts={},this.optionAnalyzeCharts={},this.stateData={data:[],analyze:[]},this.day=7,this.totalFeed=0,this.show=!1,this.listData=[]}return n(t,[{key:"ngOnInit",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadData();case 2:case"end":return e.stop()}},e,this)}))}},{key:"presentSetting",value:function(){}},{key:"loadData",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return new Date(r(new Date).subtract(this.day,"days").toDate()),this.initChart(),e.next=4,this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("data",function(e){return e.orderBy("time","desc").limit(1e3)}).get();case 4:return e.next=6,e.sent.forEach(function(e){return(0,a.mG)(t,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.forEach(function(e){return(0,a.mG)(n,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=r(e.data().time.toMillis()).format("HH:mm YYYY-MM-DD"),this.listData.push({time:n,value:e.data().value});case 2:case"end":return t.stop()}},t,this)}))});case 2:case"end":return t.stop()}},t)}))});case 6:return this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("data",function(e){return e.orderBy("time","desc").limit(1)}).stateChanges(["added"]).subscribe(function(e){e.map(function(e){var n=r(e.payload.doc.data().time.toMillis()).format("HH:mm YYYY-MM-DD");n!==t.listData[0].time&&t.listData[0].value!==e.payload.doc.data().value&&t.listData.unshift({time:n,value:e.payload.doc.data().value}),console.log(t.listData[0])})}),e.next=9,this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("analyze",function(e){return e.orderBy("label","desc")}).get();case 9:return e.next=11,e.sent.forEach(function(e){return(0,a.mG)(t,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.forEach(function(e){return(0,a.mG)(n,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.optionAnalyzeCharts.xAxis.data.unshift(e.data().label),["value","abstract","plus"].forEach(function(t,i){n.optionAnalyzeCharts.series[i].data.unshift(e.data()[t]?e.data()[t]:0)}),this.optionAnalyzeCharts.series[3].data.unshift(e.data().value-(e.data().abstract?e.data().abstract:0)+(e.data().plus?e.data().plus:0));case 1:case"end":return t.stop()}},t,this)}))});case 2:case"end":return t.stop()}},t)}))});case 11:this.stateData.analyze={series:this.optionAnalyzeCharts.series,xAxis:this.optionAnalyzeCharts.xAxis},this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("analyze").stateChanges(["modified"]).subscribe(function(e){e.map(function(e){var n=t.optionAnalyzeCharts.xAxis.data.findIndex(function(t){return t===e.payload.doc.data().label});n>=0&&(["value","abstract","plus"].forEach(function(i,o){t.optionAnalyzeCharts.series[o].data[n]=e.payload.doc.data()[i]?e.payload.doc.data()[i]:0}),t.optionAnalyzeCharts.series[3].data[n]=e.payload.doc.data().value-(e.payload.doc.data().abstract?e.payload.doc.data().abstract:0)+(e.payload.doc.data().plus?e.payload.doc.data().plus:0)),console.log(n),t.stateData.analyze={series:t.optionAnalyzeCharts.series,xAxis:t.optionAnalyzeCharts.xAxis}})}),this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).valueChanges().subscribe(function(e){t.totalFeed=e.value});case 14:case"end":return e.stop()}},e,this)}))}},{key:"initChart",value:function(){this.optionDataCharts={tooltip:{trigger:"axis",formatter:function(e){var t={};e.forEach(function(e){e.seriesName in t||(t[e.seriesName]='<p><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:'+e.color+'"></span>'+e.seriesName+" : "+e.data.value[1]+"<br/></p>")});var n="<p>"+r(e[0].value[0]).format("HH:mm YYYY-MM-DD")+"</p>";for(var i in t)n+=t[i];return n}},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},saveAsImage:{pixelRatio:2}}},color:["#000000"],title:{text:this.translate.instant("DEVICE_MOD.ALBUM"),padding:0,left:"center",textStyle:{fontFamily:"averta",fontSize:17,fontWeight:600}},grid:{left:"0%",right:"12px",bottom:"12%",containLabel:!0},xAxis:{type:"time"},yAxis:{type:"value",boundaryGap:[0,"100%"],splitLine:{show:!1},show:!0,position:"left",offset:0},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:10,type:"inside",handleIcon:"M512 512m-208 0a6.5 6.5 0 1 0 416 0 6.5 6.5 0 1 0-416 0Z M512 192C335.264 192 192 335.264 192 512c0 176.736 143.264 320 320 320s320-143.264 320-320C832 335.264 688.736 192 512 192zM512 800c-159.072 0-288-128.928-288-288 0-159.072 128.928-288 288-288s288 128.928 288 288C800 671.072 671.072 800 512 800z",handleSize:"100%",handleStyle:{color:"#fff",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2}}],series:[{name:this.translate.instant("FARM_MOD.TOTAL_FEED"),type:"line",smooth:!0,symbol:"none",data:[],areaStyle:{},itemStyle:{color:1==this.isColor(this.infor.ui.color.substring(1))?this.infor.ui.color:"#244988"}}]},this.stateData.data=this.optionDataCharts,this.optionAnalyzeCharts={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},toolbox:{feature:{dataZoom:{yAxisIndex:"none"}}},dataZoom:[{type:"inside",start:0,end:10},{start:0,end:10}],grid:{bottom:"20%"},title:{text:this.translate.instant("ANALYTICS"),padding:0,left:"center",textStyle:{fontFamily:"averta",fontSize:17,fontWeight:600}},legend:{bottom:"10%"},yAxis:[{type:"value"},{type:"value",show:!1}],xAxis:{type:"category",data:[]},series:[{name:this.translate.instant("DEVICE_MOD.INPUT"),type:"bar",stack:"total",emphasis:{focus:"series"},data:[]},{name:this.translate.instant("DEVICE_MOD.CLEAR"),type:"bar",stack:"total",emphasis:{focus:"series"},data:[]},{name:this.translate.instant("DEVICE_MOD.ADD"),type:"bar",stack:"total",emphasis:{focus:"series"},data:[]},{name:this.translate.instant("WAREHOUSE_MOD.TOTAL"),type:"line",label:{show:!0},yAxisIndex:1,data:[]}]},this.stateData.analyze=this.optionAnalyzeCharts}},{key:"isColor",value:function(e){return"string"==typeof e&&6===e.length&&!isNaN(Number("0x"+e))}},{key:"ionViewDidEnter",value:function(){this.show=!0}},{key:"close",value:function(){this.modalController.dismiss()}},{key:"presentPopoverMenu",value:function(e){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.popoverController.create({component:x,cssClass:"my-custom-class",event:e,translucent:!0});case 2:return n=t.sent,t.next=5,n.present();case 5:return t.next=7,n.onDidDismiss();case 7:i=t.sent,null!=(o=i.data)&&("remove"==o&&this.presentRemoveData(),"update"==o&&this.presentUpdateData());case 10:case"end":return t.stop()}},t,this)}))}},{key:"presentUpdateData",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:l.N,componentProps:{infor:this.infor,deviceId:this.id}});case 2:return(t=e.sent).onDidDismiss().then(function(e){}),e.next=6,t.present();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}))}},{key:"asyncData",value:function(e){var t=this;this.loading.setPending(!0),this.iotService.asyncData(this.infor.peripheral_id,this.id,e).subscribe(function(e){e.status?t.toastService.success("\u0110\xe3 \u0111\u1ed3ng b\u1ed9"):t.toastService.warning("\u0110\u1ed3ng b\u1ed9 th\u1ea5t b\u1ea1i"),t.loading.setResult(!0)},function(){t.toastService.danger(t.translate.instant("ERROR_CONNECT")),t.loading.setResult(!1)})}},{key:"presentRemoveData",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({header:this.translate.instant("POND_MOD.CAREFUL"),message:this.translate.instant("POND_MOD.CONFIRM_DELETE"),inputs:[{name:"confirmInput",type:"text",placeholder:this.translate.instant("POND_MOD.ENTER")+' "OK"'}],buttons:[{text:this.translate.instant("NO"),role:"cancel",cssClass:"secondary"},{text:this.translate.instant("POND_MOD.DELETE"),cssClass:"secondary",handler:function(e){"OK"===e.confirmInput&&t.removeData()}}]});case 2:return e.next=4,e.sent.present();case 4:case"end":return e.stop()}},e,this)}))}},{key:"removeData",value:function(){var e=this;this.loading.setPending(!0),this.iotService.removeDataFeed(this.infor.peripheral_id,this.id,{mode:2}).subscribe(function(t){t.status?(e.toastService.success("\u0110\xe3 x\xf3a d\u1eef li\u1ec7u"),e.modalController.dismiss()):e.toastService.warning("X\xf3a th\u1ea5t b\u1ea1i"),e.loading.setResult(!0)},function(){e.toastService.danger(e.translate.instant("ERROR_CONNECT")),e.loading.setResult(!1)})}},{key:"presentAlertAsync",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.CHOOSE_TIME"),inputs:[{name:"day",type:"date",value:r().format("YYYY-MM-DD")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(e){t.asyncData({mode:1,date:e.day})}}]});case 2:return e.next=4,e.sent.present();case 4:case"end":return e.stop()}},e,this)}))}}]),t}()).\u0275fac=function(e){return new(e||D)(d.Y36(f.IN),d.Y36(p.sK),d.Y36(h.ST),d.Y36(f.Dh),d.Y36(c.d),d.Y36(m.k),d.Y36(f.Br))},D.\u0275cmp=d.Xpm({type:D,selectors:[["app-feed-peripherals"]],inputs:{infor:"infor",id:"id"},decls:26,vars:12,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["slot","icon-only","name","refresh-outline"],["slot","icon-only","ios","ellipsis-vertical","md","ellipsis-vertical"],["type","indeterminate",4,"ngIf"],[1,"ion-padding"],["lines","none"],["slot","end","color","success"],["style","margin-top: 12px;","echarts","",3,"options","merge",4,"ngIf"],[1,"ion-margin-top"],[4,"ngFor","ngForOf"],["type","indeterminate"],["echarts","",2,"margin-top","12px",3,"options","merge"]],template:function(e,t){1&e&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-title"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"ion-buttons",0),d.TgZ(6,"ion-button",1),d.NdJ("click",function(){return t.close()}),d._UZ(7,"ion-icon",2),d.qZA(),d.qZA(),d.TgZ(8,"ion-buttons",3),d.TgZ(9,"ion-button",1),d.NdJ("click",function(){return t.presentAlertAsync()}),d._UZ(10,"ion-icon",4),d.qZA(),d.qZA(),d.TgZ(11,"ion-buttons",3),d.TgZ(12,"ion-button",1),d.NdJ("click",function(e){return t.presentPopoverMenu(e)}),d._UZ(13,"ion-icon",5),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.YNc(14,_,1,0,"ion-progress-bar",6),d.TgZ(15,"ion-content",7),d.TgZ(16,"ion-item",8),d.TgZ(17,"ion-text"),d._uU(18),d.ALo(19,"translate"),d.qZA(),d.TgZ(20,"ion-text",9),d._uU(21),d.ALo(22,"number"),d.qZA(),d.qZA(),d.YNc(23,Z,1,2,"div",10),d.TgZ(24,"ion-list",11),d.YNc(25,T,5,2,"ion-item",12),d.qZA(),d.qZA()),2&e&&(d.xp6(3),d.Oqu(d.lcZ(4,6,"DEVICE_MOD.SETTING_FEED")),d.xp6(11),d.Q6J("ngIf",t.loading.pending),d.xp6(4),d.Oqu(d.lcZ(19,8,"FARM_MOD.TOTAL_FEED")),d.xp6(3),d.hij("",d.lcZ(22,10,t.totalFeed)," kg"),d.xp6(2),d.Q6J("ngIf",t.show),d.xp6(2),d.Q6J("ngForOf",t.listData))},directives:[f.Gu,f.sr,f.wd,f.Sm,f.YG,f.gu,g.O5,f.W2,f.Ie,f.yW,f.q_,g.sg,f.X7,v._w,f.Q$],pipes:[p.X$,g.JJ],styles:[""]}),D),x=function(){var t=function(){function t(n,i){e(this,t),this.popoverCtrl=n,this.translate=i}return n(t,[{key:"ngOnInit",value:function(){}},{key:"chooseMod",value:function(e){this.popoverCtrl.dismiss(e)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(d.Y36(f.Dh),d.Y36(p.sK))},t.\u0275cmp=d.Xpm({type:t,selectors:[["feed-menu"]],decls:9,vars:6,consts:[["lines","none"],["button","",3,"click"],["color","danger"]],template:function(e,t){1&e&&(d.TgZ(0,"ion-list",0),d.TgZ(1,"ion-item",1),d.NdJ("click",function(){return t.chooseMod("remove")}),d.TgZ(2,"ion-text",2),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA(),d.TgZ(5,"ion-item",1),d.NdJ("click",function(){return t.chooseMod("update")}),d.TgZ(6,"ion-text"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d.qZA(),d.qZA()),2&e&&(d.xp6(3),d.hij(" ",d.lcZ(4,2,"DEVICE_MOD.REMOVE_DATA")," "),d.xp6(4),d.hij(" ",d.lcZ(8,4,"DEVICE_MOD.ADDORREMOVE")," "))},directives:[f.q_,f.Ie,f.yW],pipes:[p.X$],styles:[""]}),t}(),C=o(67066),E=o(92640),y=o(53423),k=o(58578),q=o(13619);function O(e,t){1&e&&d._UZ(0,"ion-progress-bar",32)}function b(e,t){1&e&&(d.TgZ(0,"span"),d._uU(1),d.ALo(2,"translate"),d.qZA()),2&e&&(d.xp6(1),d.hij(" ",d.lcZ(2,1,"DEVICE_MOD.IT_OVER")," "))}function I(e,t){if(1&e&&(d.TgZ(0,"span"),d._uU(1),d.ALo(2,"date"),d.qZA()),2&e){var n=d.oxw();d.xp6(1),d.hij(" ",d.xi3(2,1,null==n.stateDevice||null==n.stateDevice.infor?null:n.stateDevice.infor.finish,"HH:mm")," ")}}function S(e,t){1&e&&d._UZ(0,"ion-spinner",33)}function w(e,t){1&e&&d._UZ(0,"ion-spinner",33)}function M(e,t){if(1&e){var n=d.EpF();d.TgZ(0,"ion-item-sliding"),d.TgZ(1,"ion-item"),d.TgZ(2,"ion-label",45),d.TgZ(3,"p"),d.TgZ(4,"b"),d.TgZ(5,"small"),d._uU(6),d.ALo(7,"translate"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(8,"ion-text",46),d._uU(9),d.ALo(10,"translate"),d.ALo(11,"translate"),d.qZA(),d.qZA(),d.TgZ(12,"ion-button",43),d.NdJ("click",function(){var e=d.CHM(n).index;return d.oxw(4).changeStatusTimer(e)}),d._UZ(13,"ion-icon",47),d.qZA(),d.qZA(),d.TgZ(14,"ion-item-options",48),d.TgZ(15,"ion-item-option",34),d.NdJ("click",function(){var e=d.CHM(n),t=e.index,i=e.$implicit,o=d.oxw(3).$implicit;return d.oxw().editTimer(t,i,o.value)}),d._UZ(16,"ion-icon",49),d.qZA(),d.TgZ(17,"ion-item-option",50),d.NdJ("click",function(){var e=d.CHM(n),t=e.index,i=e.$implicit;return d.oxw(4).presentRemoveTimer(t,i)}),d._UZ(18,"ion-icon",51),d.qZA(),d.qZA(),d.qZA()}if(2&e){var i=t.$implicit,o=t.index;d.xp6(6),d.AsE("",d.lcZ(7,8,"POND_MOD.REPAST")," ",o+1,""),d.xp6(2),d.Q6J("color",0==i.enable?"dark":"success"),d.xp6(1),d.HOy(" ",d.lcZ(10,10,"DEVICE_MOD.FROM")," ",i.start," ",d.lcZ(11,12,"DEVICE_MOD.TO")," ",i.end," "),d.xp6(4),d.Q6J("color",0==i.enable?"dark":"success")}}function N(e,t){if(1&e){var n=d.EpF();d.TgZ(0,"div"),d.YNc(1,M,19,14,"ion-item-sliding",41),d.TgZ(2,"ion-item",13),d.TgZ(3,"ion-button",42),d.NdJ("click",function(){return d.CHM(n),d.oxw(3).presentQuickAdd()}),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.TgZ(6,"ion-button",43),d.NdJ("click",function(){d.CHM(n);var e=d.oxw(2).$implicit;return d.oxw().addTimer(e.value)}),d._UZ(7,"ion-icon",44),d.qZA(),d.qZA(),d.qZA()}if(2&e){var i=d.oxw(3);d.xp6(1),d.Q6J("ngForOf",i.listTimer),d.xp6(3),d.hij(" ",d.lcZ(5,2,"DEVICE_MOD.QUICK_ADD")," ")}}function R(e,t){if(1&e){var n=d.EpF();d.TgZ(0,"div"),d.TgZ(1,"ion-card-header",34),d.NdJ("click",function(){d.CHM(n);var e=d.oxw().$implicit;return d.oxw().presentFeedPeripherals(e.value)}),d.TgZ(2,"ion-card-subtitle"),d._UZ(3,"ion-icon",35),d._uU(4),d._UZ(5,"ion-icon",36),d.qZA(),d.qZA(),d.TgZ(6,"ion-card-content",37),d.TgZ(7,"div",38),d.NdJ("click",function(){d.CHM(n);var e=d.oxw().$implicit;return d.oxw().presentFeedPeripherals(e.value)}),d._UZ(8,"div",12),d.YNc(9,w,1,0,"ion-spinner",30),d.qZA(),d.TgZ(10,"ion-list",39),d.TgZ(11,"ion-item"),d.TgZ(12,"ion-label",39),d.TgZ(13,"h3"),d._uU(14),d.ALo(15,"translate"),d.qZA(),d.qZA(),d.TgZ(16,"ion-toggle",40),d.NdJ("click",function(e){return d.CHM(n),d.oxw(2).updateAutomatic(e)}),d.qZA(),d.qZA(),d.YNc(17,N,8,4,"div",18),d.qZA(),d.qZA(),d.qZA()}if(2&e){var i=d.oxw().$implicit,o=d.oxw();d.xp6(4),d.hij(" ",i.value.ui.label," "),d.xp6(4),d.Q6J("options",o.optionTotalFeed),d.xp6(1),d.Q6J("ngIf",o.loadingTimer.pending),d.xp6(5),d.AsE("",d.lcZ(15,7,"DEVICE_MOD.AUTOMATIC")," ",null==o.stateDevice||null==o.stateDevice.config?null:o.stateDevice.config.run_mode,""),d.xp6(2),d.Q6J("checked",1==o.stateDevice.config.run_mode),d.xp6(1),d.Q6J("ngIf",1==o.stateDevice.config.run_mode)}}function Y(e,t){if(1&e&&(d.TgZ(0,"ion-card",7),d.YNc(1,R,18,9,"div",18),d.qZA()),2&e){var n=t.$implicit;d.xp6(1),d.Q6J("ngIf","feed"==n.value.type)}}var U=function(){var t=function(){function t(n,i,o,a,r,c,u,l){e(this,t),this.translate=n,this.route=i,this.iotService=o,this.toastService=a,this.afs=r,this.alertController=c,this.modalController=u,this.pickerCtroller=l,this.loading=new s.E,this.loadingTimer=new s.E,this.loadingDashboard=new s.E,this.stateDevice={status:!1,infor:null,config:null,feedToday:0},this.listTimer=[]}return n(t,[{key:"ngOnInit",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.id=this.route.snapshot.paramMap.get("device_id"),e.next=3,this.getDevice();case 3:case"end":return e.stop()}},e,this)}))}},{key:"loadMoreLogs",value:function(e){}},{key:"presentSetting",value:function(){}},{key:"getDevice",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading.setPending(!0),e.next=3,this.iotService.getInforDevice(this.id).catch(function(){i.loading.setResult(!1),i.toastService.danger(i.translate.instant("ERROR_CONNECT"))});case 3:return(t=e.sent)&&t.status?this.device=t.data:t&&!t.status&&this.toastService.warning(t.errors.description),e.next=7,this.iotService.get(this.id).catch(function(e){i.toastService.danger(i.translate.instant("ERROR_CONNECT"))});case 7:(n=e.sent)&&1==n.status?(this.device.infor=n.data,this.loadState(),this.loadTimer(),this.getFeedToday()):n&&0==n.status&&this.toastService.warning(n.error),console.log(this.device),this.loading.setResult(!1);case 9:case"end":return e.stop()}},e,this)}))}},{key:"loadState",value:function(){var e=this;this.afs.collection("feeding").doc(this.id).valueChanges().subscribe(function(t){var n,i,o,a;e.stateDevice.status=t.online,e.stateDevice.infor=t.info,e.stateDevice.config=t.config,e.stateDevice.infor.finish=new Date((new Date).getTime()+ +t.info.rem_rotation_time/+(null===(n=t.config)||void 0===n?void 0:n.time_on)*Math.pow(60,+t.config.unit_time_on)*(+t.config.time_on*Math.pow(60,+(null===(i=t.config)||void 0===i?void 0:i.unit_time_on))+t.config.time_off*Math.pow(60,+t.config.unit_time_off))*1e3).getTime(),console.log(t.info.rem_rotation_time/((+(null===(o=t.config)||void 0===o?void 0:o.unit_rotation_time)+10)/10)),e.setChartFeed((t.info.rem_rotation_time/((+(null===(a=t.config)||void 0===a?void 0:a.unit_rotation_time)+10)/10)).toFixed(0),50)}),this.stateDevice.peripherals={},this.afs.collection("feeding").doc(this.id).collection("peripherals").get().subscribe(function(t){t.forEach(function(t){e.stateDevice.peripherals[t.data().type]=t.data(),e.stateDevice.peripherals[t.data().type].id=t.id,e.afs.collection("feeding").doc(e.id).collection("peripherals").doc(t.id).valueChanges().subscribe(function(n){e.stateDevice.peripherals[t.data().type].value=n.value,"feed"==t.data().type?e.setChartFeedTotal(n.value,n.ui.max):e.setMotor(t.data().type,n.value,n.ui.max)})})})}},{key:"actionCommand",value:function(e){var t=this,n={command:13!=+this.stateDevice.infor.lcd_page_number&&30!=+this.stateDevice.infor.lcd_page_number&&"PAGE_STOP"!=this.stateDevice.infor.lcd_page_number?"feed_stop":"feed_start"};this.loading.setPending(!0),this.iotService.commandFeeding(this.id,n).subscribe(function(n){n.status?t.toastService.success(t.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")):(t.toastService.warning(t.translate.instant("WAREHOUSE_MOD.ERROR_HANDLE")),e.target.checked=13==t.stateDevice.infor.lcd_page_number),t.loading.setResult(!0)},function(){t.toastService.danger(t.translate.instant("ERROR_CONNECT")),t.loading.setResult(!1)})}},{key:"presentAlertCommand",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("CONFIRM"),message:this.translate.instant("DEVICE_MOD.CONFIRM_COMMAND_FEED")+this.translate.instant(13!=this.stateDevice.infor.lcd_page_number&&30!=this.stateDevice.infor.lcd_page_number?"DEVICE_MOD.OFF":"DEVICE_MOD.ON"),buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(e){console.log("Confirm Cancel: blah")}},{text:"Ok",handler:function(){}}]});case 2:return e.next=4,e.sent.present();case 4:case"end":return e.stop()}},e,this)}))}},{key:"setMotor",value:function(e,t,n){this.stateDevice.peripherals[e].value=t,this.stateDevice.peripherals[e].ui.max=n}},{key:"setChartFeedTotal",value:function(e,t){this.optionTotalFeed={grid:{left:0,top:0,right:0,bottom:0},series:[{type:"gauge",startAngle:180,endAngle:0,min:0,max:t,radius:"100%",splitNumber:12,itemStyle:{color:"#fcba03",shadowColor:"rgb(252 186 3 / 34%)",shadowBlur:10,shadowOffsetX:2,shadowOffsetY:2},progress:{show:!0,roundCap:!0,width:10},pointer:{icon:"path://M2090.36389,615.30999 L2090.36389,615.30999 C2091.48372,615.30999 2092.40383,616.194028 2092.44859,617.312956 L2096.90698,728.755929 C2097.05155,732.369577 2094.2393,735.416212 2090.62566,735.56078 C2090.53845,735.564269 2090.45117,735.566014 2090.36389,735.566014 L2090.36389,735.566014 C2086.74736,735.566014 2083.81557,732.63423 2083.81557,729.017692 C2083.81557,728.930412 2083.81732,728.84314 2083.82081,728.755929 L2088.2792,617.312956 C2088.32396,616.194028 2089.24407,615.30999 2090.36389,615.30999 Z",length:"65%",width:12,offsetCenter:[0,"5%"]},axisLine:{roundCap:!0,lineStyle:{width:10}},axisTick:{splitNumber:5,lineStyle:{width:1,color:"#999"}},splitLine:{length:12,lineStyle:{width:3,color:"#999"}},axisLabel:{distance:30,color:"#999",fontSize:20,show:!1},title:{show:!1},detail:{width:"60%",lineHeight:40,height:40,borderRadius:8,offsetCenter:[0,"35%"],valueAnimation:!0,formatter:function(e){return"{value|"+e.toFixed(0)+"}{unit|kg}"},rich:{value:{fontSize:50,fontWeight:"bolder",color:"#fcba03"},unit:{fontSize:20,color:"#fcba03",padding:[0,0,-20,10]}}},data:[{value:e}]}]}}},{key:"setChartFeed",value:function(e,t){var n=["path://M.54.5l267,3465.35.93,12,.17.23,796.48,1110.65H2636.26l755.49-1110.65,5.29-7.77.37-4.5L3681.35.5ZM3322.9,3407.65h-8.25l-39.59,58.2-8.35,12.27-669,983.49H1123.07L417.78,3478.12l-8.8-12.27-41.74-58.2h-4L109.7,117.1H3592.52Z","path://M3483.36.5,3348.55,1645.78,3213.74,3291.05h-8.25l-19.8,29.1-19.79,29.1-4.18,6.14-4.17,6.13-334.5,491.75L2488.55,4345H1013.91L661.26,3853.27,308.62,3361.52l-4.4-6.13-4.4-6.14L279,3320.15l-20.87-29.1h-4L127.31,1645.78.54.5H3483.36Z"];this.optionFeed={tooltip:{show:!1},legend:{data:["typeA"],selectedMode:"single"},xAxis:{data:["C\xf2n"],axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!1}},yAxis:{max:t,show:!1,offset:0,splitLine:{show:!1}},grid:{top:"5%",bottom:"10%"},markLine:{z:-100},series:[{name:"C\xf2n l\u1ea1i",type:"pictorialBar",symbolClip:!0,symbolBoundingData:t,label:{show:!0,position:"top",offset:[0,50],formatter:function(e){return e.value.toFixed(0)+"kg"},fontSize:25,textBorderColor:"#fff"},data:[{value:+e,symbol:n[1]}],z:0,itemStyle:{color:"#f1d506"}},{name:"T\u1ed5ng",type:"pictorialBar",symbolBoundingData:t,animationDuration:0,itemStyle:{color:"#3b4da1"},data:[{value:1,symbol:n[0]}],z:1}]}}},{key:"calculateColor",value:function(e){return{color:e}}},{key:"loadTimer",value:function(){var e=this.device.peripherals.findIndex(function(e){return"feed"===e.peripheral_type});e<0||(this.listTimer=this.device.peripherals[e].timers)}},{key:"changeMotor",value:function(e,t){var n=this,i=this.device.peripherals.findIndex(function(t){return t.firestore_id===n.stateDevice.peripherals[e].id});if(!(i<0)){var o=this.device.peripherals[i].id,a={value:t.detail.value};this.loading.setPending(!0),this.iotService.changeStatusContactor(a,o,this.id).subscribe(function(e){e.status?n.toastService.success(n.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")):n.toastService.warning(n.translate.instant("WAREHOUSE_MOD.ERROR_HANDLE")),n.loading.setResult(!0)},function(){n.toastService.danger(n.translate.instant("ERROR_CONNECT")),n.loading.setResult(!1)})}}},{key:"presentAlertSetting",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:"C\xe0i \u0111\u1eb7t",inputs:[{name:"name",type:"text",placeholder:"T\xean m\xe1y",value:this.device.infor.name?this.device.infor.name:""}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(){console.log("Confirm Ok")}}]});case 2:return e.next=4,e.sent.present();case 4:case"end":return e.stop()}},e,this)}))}},{key:"openPickerTime",value:function(e,t){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,o=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=Object.keys(Array.from({length:99},function(e,t){return t+1})).map(function(e){return{text:parseInt(e)+1,value:parseInt(e)+1}}),n.next=3,this.pickerCtroller.create({buttons:[{text:"Ok",handler:function(t){var n=o.stateDevice.config;"on"==e?n.time_on=t.times.value:n.time_off=t.times.value,o.updateSetting(n)}}],cssClass:"pickerModal",columns:[{name:"times",selectedIndex:t-1,options:i}]});case 3:return n.next=5,n.sent.present();case 5:case"end":return n.stop()}},n,this)}))}},{key:"updateSetting",value:function(e){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadingDashboard.setPending(!0),t.next=3,this.iotService.updateSetting(this.id,e).catch(function(){i.toastService.danger(i.translate.instant("ERROR_CONNECT")),i.loadingDashboard.setResult(!1)});case 3:(n=t.sent)&&1==n.status?(this.toastService.success("C\u1eadp nh\u1eadt th\xe0nh c\xf4ng"),this.loadingDashboard.setResult(!0)):this.loadingDashboard.setResult(!1);case 5:case"end":return t.stop()}},t,this)}))}},{key:"changeStatusTimer",value:function(e){var t=this,n=this.device.peripherals.find(function(e){return"feed"===e.peripheral_type});if(n){var i={start:this.listTimer[e].start,end:this.listTimer[e].end,date_start:this.listTimer[e].date_start,date_end:this.listTimer[e].date_end,enable:0==this.listTimer[e].enable?1:0};this.loadingTimer.setPending(!0),this.iotService.updateTimerFeed(this.listTimer[e].id,n.id,this.id,i).subscribe(function(n){n.status?(t.loadingTimer.setResult(!0),t.listTimer[e].enable=i.enable,t.toastService.success(t.translate.instant("DEVICE_MOD.UPDATE_SUCCESS"))):(t.loadingTimer.setResult(!0),t.toastService.warning(t.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")))},function(){t.loadingTimer.setResult(!1),t.toastService.danger(t.translate.instant("ERROR_CONNECT"))})}}},{key:"editTimer",value:function(e,t,n){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function i(){var o,a,r=this;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!((o=this.device.peripherals.findIndex(function(e){return e.firestore_id===n.id}))<0)){i.next=3;break}return i.abrupt("return");case 3:return n.peripheral_id=this.device.peripherals[o].id,i.next=6,this.modalController.create({component:k.J,componentProps:{id:this.id,infor:n,data:t}});case 6:return(a=i.sent).onDidDismiss().then(function(t){t.data&&(r.listTimer[e]=t.data)}),i.next=10,a.present();case 10:return i.abrupt("return",i.sent);case 11:case"end":return i.stop()}},i,this)}))}},{key:"addTimer",value:function(e){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!((n=this.device.peripherals.findIndex(function(t){return t.firestore_id===e.id}))<0)){t.next=3;break}return t.abrupt("return");case 3:return e.peripheral_id=this.device.peripherals[n].id,t.next=6,this.modalController.create({component:y.g,componentProps:{id:this.id,infor:e}});case 6:return(i=t.sent).onDidDismiss().then(function(e){e.data&&o.listTimer.push(e.data)}),t.next=10,i.present();case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}},t,this)}))}},{key:"removeTimer",value:function(e,t){var n=this,i=this.device.peripherals.findIndex(function(e){return"feed"===e.peripheral_type});i<0||(this.loadingTimer.setPending(!0),this.iotService.removeTimer(t.id,this.device.peripherals[i].id,this.id).subscribe(function(t){t.status?(n.toastService.success("X\xf3a th\xe0nh c\xf4ng"),n.listTimer.splice(e,1)):n.toastService.warning("X\xf3a kh\xf4ng th\xe0nh c\xf4ng"),n.loadingTimer.setResult(!0)},function(){n.toastService.danger(n.translate.instant("ERROR_CONNECT")),n.loadingTimer.setResult(!1)}))}},{key:"presentRemoveTimer",value:function(e,t){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("CONFIRM"),message:"X\xf3a l\u1ecbch h\u1eb9n gi\u1edd n\xe0y?",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(e){console.log("Confirm Cancel: blah")}},{text:"Okay",handler:function(){i.removeTimer(e,t)}}]});case 2:return n.next=4,n.sent.present();case 4:case"end":return n.stop()}},n,this)}))}},{key:"presentFeedPeripherals",value:function(e){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!((n=this.device.peripherals.findIndex(function(t){return t.firestore_id===e.id}))<0)){t.next=5;break}t.t0=void 0,t.next=12;break;case 5:return e.peripheral_id=this.device.peripherals[n].id,e.name=this.device.name,t.next=9,this.modalController.create({component:A,componentProps:{id:this.id,infor:e}});case 9:return t.next=11,t.sent.present();case 11:t.t0=t.sent;case 12:return t.abrupt("return",t.t0);case 13:case"end":return t.stop()}},t,this)}))}},{key:"presentFeedSetting",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this.device.peripherals.findIndex(function(e){return"feed"===e.peripheral_type}))<0)){e.next=5;break}e.t0=void 0,e.next=12;break;case 5:return this.stateDevice.config.name=this.device.name,this.stateDevice.config.peripheral_id=this.device.peripherals[t].id,e.next=9,this.modalController.create({component:C.o,componentProps:{id:this.id,infor:this.stateDevice.config}});case 9:return e.next=11,e.sent.present();case 11:e.t0=e.sent;case 12:return e.abrupt("return",e.t0);case 13:case"end":return e.stop()}},e,this)}))}},{key:"presentWifiSetting",value:function(){var e,t;return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.modalController.create({component:u.i,componentProps:{id:this.id,type:"feeding",name:null===(t=null===(e=this.device)||void 0===e?void 0:e.infor)||void 0===t?void 0:t.name}});case 2:return n.next=4,n.sent.present();case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},n,this)}))}},{key:"presentSuggest",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:E.V,componentProps:{stateDevice:this.stateDevice,id:this.id}});case 2:return e.next=4,e.sent.present();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}))}},{key:"getTimerValue",value:function(e,t,n){var i=5,o=Math.abs(e-t),a=(this.stateDevice.config.unit_rotation_time+10)/10,r=n*a*i*60,s=60*o-n*a;0==s&&(s=1);for(var c=parseInt((r/s).toFixed(0));c>99;)r=n*a*(i-=parseInt((c/99).toFixed(0)))*60,c=parseInt((r/s).toFixed(0));return 1==parseInt(this.stateDevice.config.unit_time_on)&&(c*=60),0==parseInt(this.stateDevice.config.unit_time_off)&&(i=parseInt((i/60).toFixed(0))),c+"_"+i+"_"+this.stateDevice.config.unit_time_on+"_"+this.stateDevice.config.unit_time_off}},{key:"getFeedToday",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.device.peripherals.find(function(e){return"feed"===e.peripheral_type}),e.t0=t,!e.t0){e.next=8;break}return console.log(t),e.next=6,this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(t.firestore_id).collection("analyze",function(e){return e.where("label","==",r().format("YYYY-MM-DD")).limit(1)}).get();case 6:return e.next=8,e.sent.forEach(function(e){return(0,a.mG)(n,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.forEach(function(e){return(0,a.mG)(n,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.stateDevice.feedToday=e.data().value-(e.data().abstract?e.data().abstract:0)+(e.data().plus?e.data().plus:0);case 1:case"end":return t.stop()}},t,this)}))});case 2:case"end":return t.stop()}},t)}))});case 8:case"end":return e.stop()}},e,this)}))}},{key:"getSpeechRound",value:function(){var e,t,n,i,o,a,r,s,c,u,l,d,f,p;return(3600/((null===(t=null===(e=this.stateDevice)||void 0===e?void 0:e.config)||void 0===t?void 0:t.time_on)*Math.pow(60,null===(i=null===(n=this.stateDevice)||void 0===n?void 0:n.config)||void 0===i?void 0:i.unit_time_on)+(null===(a=null===(o=this.stateDevice)||void 0===o?void 0:o.config)||void 0===a?void 0:a.time_off)*Math.pow(60,null===(s=null===(r=this.stateDevice)||void 0===r?void 0:r.config)||void 0===s?void 0:s.unit_time_off))*((null===(u=null===(c=this.stateDevice)||void 0===c?void 0:c.config)||void 0===u?void 0:u.time_on)*Math.pow(60,null===(d=null===(l=this.stateDevice)||void 0===l?void 0:l.config)||void 0===d?void 0:d.unit_time_on)/((+(null===(p=null===(f=this.stateDevice)||void 0===f?void 0:f.config)||void 0===p?void 0:p.unit_rotation_time)+10)/10))).toFixed(2)}},{key:"presentQuickAdd",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(+r().format("H")<8)){e.next=2;break}return e.abrupt("return");case 2:if(t=this.device.peripherals.find(function(e){return"feed"===e.peripheral_type}),e.t0=t,!e.t0){e.next=9;break}return e.next=7,this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.QUICK_ADD"),inputs:[{name:"value",type:"number",placeholder:this.translate.instant("DEVICE_MOD.FEED_VALUE"),value:""}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(e){n.loadingTimer.setPending(!0),n.iotService.quickAddRepast(t.id,n.id,{value:e.value}).subscribe(function(e){e.status?(n.listTimer=e.data,n.toastService.success(n.translate.instant("WALL.UPDATE_SUCCESS"))):n.toastService.warning(n.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")),n.loadingTimer.setResult(!0)},function(){n.toastService.danger(n.translate.instant("ERROR_CONNECT")),n.loadingTimer.setResult(!1)})}}]});case 7:return e.next=9,e.sent.present();case 9:case"end":return e.stop()}},e,this)}))}},{key:"incrementTime",value:function(e){var t=this;this.stateDevice.config[e]=+this.stateDevice.config[e]+1;var n=+this.stateDevice.config[e];setTimeout(function(){t.stateDevice.config[e]==n&&t.updateSetting(t.stateDevice.config)},700)}},{key:"decrementTime",value:function(e){var t=this;this.stateDevice.config[e]=+this.stateDevice.config[e]-1;var n=+this.stateDevice.config[e];setTimeout(function(){t.stateDevice.config[e]==n&&t.updateSetting(t.stateDevice.config)},700)}},{key:"updateAutomatic",value:function(e){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.stateDevice.config,console.log(n.run_mode),n.run_mode=1==+n.run_mode?0:1,this.loadingTimer.setPending(!0),t.next=4,this.iotService.updateSetting(this.id,n).catch(function(){o.toastService.danger(o.translate.instant("ERROR_CONNECT")),o.stateDevice.config.run_mode=1==+n.run_mode?0:1,o.loadingTimer.setResult(!1)});case 4:(i=t.sent)&&i.status?(this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS")),this.stateDevice.config.run_mode=+n.run_mode,this.loading.setResult(!0)):(this.stateDevice.config.run_mode=1==+n.run_mode?0:1,this.loading.setResult(!1)),this.loadingTimer.setResult(!0),e.target.checked=1==n.run_mode;case 6:case"end":return t.stop()}},t,this)}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(d.Y36(p.sK),d.Y36(q.gz),d.Y36(c.d),d.Y36(m.k),d.Y36(h.ST),d.Y36(f.Br),d.Y36(f.IN),d.Y36(f.up))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-feed-device"]],decls:84,vars:30,consts:[["slot","start"],["defaultHref","tabs/management"],["slot","end"],["color","tb",3,"click"],["slot","icon-only","name","wifi-outline"],["slot","icon-only","name","settings"],["type","indeterminate",4,"ngIf"],["mode","ios"],[2,"display","flex","align-items","center"],["name","ellipse",3,"color"],[3,"innerHTML"],[2,"position","relative","text-align","center"],["echarts","",1,"blockChart",3,"options"],["lines","none"],["slot","start",3,"innerHTML"],["slot","end","mode","ios","color","success",3,"checked","click"],["size","4"],[1,"f-value"],[4,"ngIf"],["size","6",1,"text-center"],["color","danger",1,"ion-justify-content-center","ion-align-items-center",2,"display","flex"],[1,"ion-padding-start","ion-padding-top","ion-padding-end","box-quantity"],[1,"group-input-product"],["aria-label","decrease",3,"disabled","click"],["width","20","height","20","alt","decrease","src","../../../assets/img/icons-remove.svg"],["readonly","","type","number","id","quantity",3,"value"],["aria-label","increase",3,"click"],["width","20","height","20","alt","increase","src","../../../assets/img/icons-add.svg"],["color","success",1,"ion-justify-content-center","ion-align-items-center",2,"display","flex"],[1,"ion-text-center",3,"click"],["mode","ios","class","loadingTimer",4,"ngIf"],["mode","ios",4,"ngFor","ngForOf"],["type","indeterminate"],["mode","ios",1,"loadingTimer"],[3,"click"],["name","cog"],["name","chevron-forward-outline",1,"ion-float-end"],[1,"ion-text-center"],[2,"position","relative",3,"click"],["lines","inset"],["mode","ios","slot","end",3,"checked","click"],[4,"ngFor","ngForOf"],["slot","start","fill","outline",3,"click"],["slot","end","fill","clear",3,"click"],["name","add"],[1,"ion-text-wrap"],["slot","start",3,"color"],["name","power-outline",3,"color"],["side","end"],["name","create"],["color","danger",3,"click"],["name","trash-outline"]],template:function(e,t){1&e&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-buttons",0),d._UZ(3,"ion-back-button",1),d.qZA(),d.TgZ(4,"ion-title"),d._uU(5),d.qZA(),d.TgZ(6,"ion-buttons",2),d.TgZ(7,"ion-button",3),d.NdJ("click",function(){return t.presentWifiSetting()}),d._UZ(8,"ion-icon",4),d.qZA(),d.TgZ(9,"ion-button",3),d.NdJ("click",function(){return t.presentFeedSetting()}),d._UZ(10,"ion-icon",5),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(11,"ion-content"),d.YNc(12,O,1,0,"ion-progress-bar",6),d.TgZ(13,"ion-card",7),d.TgZ(14,"ion-card-content"),d.TgZ(15,"div",8),d.TgZ(16,"ion-buttons"),d.TgZ(17,"ion-button"),d._UZ(18,"ion-icon",9),d.qZA(),d.qZA(),d._UZ(19,"ion-text",10),d.qZA(),d.TgZ(20,"div",11),d._UZ(21,"div",12),d.TgZ(22,"div"),d.TgZ(23,"ion-item",13),d._UZ(24,"ion-text",14),d.TgZ(25,"ion-toggle",15),d.NdJ("click",function(e){return t.actionCommand(e)}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(26,"ion-grid"),d.TgZ(27,"ion-row"),d.TgZ(28,"ion-col",16),d.TgZ(29,"ion-text"),d.TgZ(30,"small"),d._uU(31),d.ALo(32,"translate"),d.qZA(),d.qZA(),d.TgZ(33,"div",17),d._uU(34),d.qZA(),d.qZA(),d.TgZ(35,"ion-col",16),d.TgZ(36,"ion-text"),d.TgZ(37,"small"),d._uU(38),d.ALo(39,"translate"),d.qZA(),d.qZA(),d.TgZ(40,"div",17),d.YNc(41,b,3,3,"span",18),d.YNc(42,I,3,4,"span",18),d.qZA(),d.qZA(),d.TgZ(43,"ion-col",16),d.TgZ(44,"ion-text"),d.TgZ(45,"small"),d._uU(46),d.ALo(47,"translate"),d.qZA(),d.qZA(),d.TgZ(48,"div",17),d._uU(49),d.qZA(),d.qZA(),d.qZA(),d.TgZ(50,"ion-row"),d.TgZ(51,"ion-col",19),d.TgZ(52,"ion-text",20),d._uU(53," OFF ("),d.TgZ(54,"small"),d._uU(55),d.qZA(),d._uU(56,") "),d.qZA(),d.TgZ(57,"div",21),d.TgZ(58,"div",22),d.TgZ(59,"button",23),d.NdJ("click",function(){return t.decrementTime("time_off")}),d._UZ(60,"img",24),d.qZA(),d._UZ(61,"input",25),d.TgZ(62,"button",26),d.NdJ("click",function(){return t.incrementTime("time_off")}),d._UZ(63,"img",27),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(64,"ion-col",19),d.TgZ(65,"ion-text",28),d._uU(66," ON ("),d.TgZ(67,"small"),d._uU(68),d.qZA(),d._uU(69,") "),d.qZA(),d.TgZ(70,"div",21),d.TgZ(71,"div",22),d.TgZ(72,"button",23),d.NdJ("click",function(){return t.decrementTime("time_on")}),d._UZ(73,"img",24),d.qZA(),d._UZ(74,"input",25),d.TgZ(75,"button",26),d.NdJ("click",function(){return t.incrementTime("time_on")}),d._UZ(76,"img",27),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(77,"div",29),d.NdJ("click",function(){return t.presentSuggest()}),d.TgZ(78,"small"),d._uU(79,"G\u1ee3i \xfd th\xf4ng s\u1ed1"),d.qZA(),d.qZA(),d.YNc(80,S,1,0,"ion-spinner",30),d.qZA(),d.qZA(),d.qZA(),d.YNc(81,Y,2,1,"ion-card",31),d.ALo(82,"keyvalue"),d._UZ(83,"ion-card",7),d.qZA()),2&e&&(d.xp6(5),d.Oqu(null==t.device||null==t.device.infor?null:t.device.infor.name),d.xp6(7),d.Q6J("ngIf",t.loading.pending),d.xp6(6),d.Q6J("color",t.stateDevice.status?"success":"medium"),d.xp6(1),d.Q6J("innerHTML",t.stateDevice.status?"Online":"Offline",d.oJD),d.xp6(2),d.Q6J("options",t.optionFeed),d.xp6(3),d.Q6J("innerHTML",t.translate.instant(13!=+(null==t.stateDevice||null==t.stateDevice.infor?null:t.stateDevice.infor.lcd_page_number)&&30!=+(null==t.stateDevice||null==t.stateDevice.infor?null:t.stateDevice.infor.lcd_page_number)&&"PAGE_STOP"!=(null==t.stateDevice||null==t.stateDevice.infor?null:t.stateDevice.infor.lcd_page_number)?"DEVICE_MOD.RUN":"DEVICE_MOD.STOP"),d.oJD),d.xp6(1),d.Q6J("checked",13!=+(null==t.stateDevice||null==t.stateDevice.infor?null:t.stateDevice.infor.lcd_page_number)&&30!=+(null==t.stateDevice||null==t.stateDevice.infor?null:t.stateDevice.infor.lcd_page_number)&&"PAGE_STOP"!=(null==t.stateDevice||null==t.stateDevice.infor?null:t.stateDevice.infor.lcd_page_number)),d.xp6(6),d.hij("",d.lcZ(32,22,"POND_MOD.TODAY"),"(kg)"),d.xp6(3),d.Oqu(t.stateDevice.feedToday),d.xp6(4),d.Oqu(d.lcZ(39,24,"DEVICE_MOD.TIMES_UP")),d.xp6(3),d.Q6J("ngIf",0==(null==t.stateDevice||null==t.stateDevice.infor?null:t.stateDevice.infor.rem_rotation_time)),d.xp6(1),d.Q6J("ngIf",0!=(null==t.stateDevice||null==t.stateDevice.infor?null:t.stateDevice.infor.rem_rotation_time)),d.xp6(4),d.hij("",d.lcZ(47,26,"DEVICE_MOD.SPEED_ROUND"),"(kg/h)"),d.xp6(3),d.hij(" ",t.getSpeechRound()," "),d.xp6(6),d.hij(" ",t.translate.instant(0==(null==t.stateDevice||null==t.stateDevice.config?null:t.stateDevice.config.unit_time_off)?"DEVICE_MOD.SECOND":1==(null==t.stateDevice||null==t.stateDevice.config?null:t.stateDevice.config.unit_time_off)?"FARM_MOD.MINUTE":"POND_MOD.HOUR")," "),d.xp6(4),d.Q6J("disabled",+(null==t.stateDevice||null==t.stateDevice.config?null:t.stateDevice.config.time_off)<=0),d.xp6(2),d.s9C("value",null==t.stateDevice||null==t.stateDevice.config?null:t.stateDevice.config.time_off),d.xp6(7),d.hij(" ",t.translate.instant(0==(null==t.stateDevice||null==t.stateDevice.config?null:t.stateDevice.config.unit_time_on)?"DEVICE_MOD.SECOND":1==(null==t.stateDevice||null==t.stateDevice.config?null:t.stateDevice.config.unit_time_on)?"FARM_MOD.MINUTE":"POND_MOD.HOUR")," "),d.xp6(4),d.Q6J("disabled",+(null==t.stateDevice||null==t.stateDevice.config?null:t.stateDevice.config.time_on)<=0),d.xp6(2),d.s9C("value",null==t.stateDevice||null==t.stateDevice.config?null:t.stateDevice.config.time_on),d.xp6(6),d.Q6J("ngIf",t.loadingDashboard.pending),d.xp6(1),d.Q6J("ngForOf",d.lcZ(82,28,null==t.stateDevice?null:t.stateDevice.peripherals)))},directives:[f.Gu,f.sr,f.Sm,f.oU,f.cs,f.wd,f.YG,f.gu,f.W2,g.O5,f.PM,f.FN,f.yW,v._w,f.Ie,f.ho,f.w,f.jY,f.Nd,f.wI,g.sg,f.X7,f.PQ,f.Zi,f.tO,f.q_,f.Q$,f.td,f.IK,f.u8],pipes:[p.X$,g.Nd,g.uU],styles:[".btnAction[_ngcontent-%COMP%]{--padding-start: 1.5em;--padding-end: 1.5em}.startIcon[_ngcontent-%COMP%]{margin-right:5px}.f-value[_ngcontent-%COMP%]{font-size:2em}.blockAction[_ngcontent-%COMP%]{border-radius:12px;text-align:center;padding:5px}.turnOn[_ngcontent-%COMP%]{color:#3dcb2e;border-color:#3dcb2e}.turnOff[_ngcontent-%COMP%]{color:#f04141;border-color:#f04141}.suggestAi[_ngcontent-%COMP%]{color:#3dc2ff;border-color:#3dc2ff}.iconLarge[_ngcontent-%COMP%]{font-size:50px}.loadingTimer[_ngcontent-%COMP%]{position:absolute;z-index:1;bottom:20px;margin:0 auto}ion-ripple-effect[_ngcontent-%COMP%]{border-radius:12px;text-align:center;margin:6px}.blockChart[_ngcontent-%COMP%]{max-height:230px}.f-value[_ngcontent-%COMP%]{font-size:1em;font-family:Atomic}.group-input-product[_ngcontent-%COMP%]{display:flex;align-items:center}.group-input-product[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{border-right:none;border-radius:4px 0 0 4px;padding:4px}.group-input-product[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .group-input-product[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:30px;color:#242424;font-size:14px;text-align:center;outline:none;transition:border-color .15s ease-in-out 0s,box-shadow .15s ease-in-out 0s}.group-input-product[_ngcontent-%COMP%]   .group-input-product[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer;width:30px;background-color:#fff;border:1px solid #ececec}.group-input-product[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:40px;border:1px solid #ececec}.group-input-product[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{border-left:none;border-radius:0 4px 4px 0;padding:4px}.box-quantity[_ngcontent-%COMP%]{display:flex;justify-content:space-between}"]}),t}()},67066:function(t,i,o){o.d(i,{o:function(){return D}});var a=o(64762),r=o(90665),s=o(16738),c=o(27887),u=o(82629),l=o(37716),d=o(47063),f=o(84465),p=o(81780),h=o(38583);function m(e,t){1&e&&l._UZ(0,"ion-progress-bar",10)}function g(e,t){if(1&e&&(l.TgZ(0,"ion-select-option",18),l._uU(1),l.qZA()),2&e){var n=t.$implicit;l.Q6J("value",t.index),l.xp6(1),l.AsE("",n.time," - ",n.value,"kg")}}function v(e,t){if(1&e){var n=l.EpF();l.TgZ(0,"div",19),l.TgZ(1,"ion-button",20),l.NdJ("click",function(){return l.CHM(n),l.oxw(2).presentAlertCalibSuggest()}),l._uU(2),l.qZA(),l.qZA()}if(2&e){var i=l.oxw(2);l.xp6(2),l.Oqu(i.unit_rotation_time)}}function _(e,t){if(1&e){var n=l.EpF();l.TgZ(0,"div",19),l.TgZ(1,"ion-button",21),l.NdJ("click",function(){return l.CHM(n),l.oxw(2).getSuggest()}),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.qZA()}2&e&&(l.xp6(2),l.Oqu(l.lcZ(3,1,"SUGGEST")))}function Z(e,t){if(1&e){var n=l.EpF();l.TgZ(0,"ion-card-content",11),l.TgZ(1,"ion-card-subtitle"),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-item",12),l.TgZ(5,"ion-label",13),l._uU(6),l.ALo(7,"translate"),l.qZA(),l.TgZ(8,"ion-select",14),l.NdJ("ionChange",function(){return l.CHM(n),l.oxw().unit_rotation_time=0}),l.YNc(9,g,2,3,"ion-select-option",15),l.qZA(),l.qZA(),l.TgZ(10,"ion-item",12),l.TgZ(11,"ion-label",13),l._uU(12),l.ALo(13,"translate"),l.qZA(),l.TgZ(14,"ion-datetime",16),l.NdJ("ionChange",function(){return l.CHM(n),l.oxw().unit_rotation_time=0}),l.qZA(),l.qZA(),l.YNc(15,v,3,1,"div",17),l.YNc(16,_,4,3,"div",17),l.qZA()}if(2&e){var i=l.oxw();l.Q6J("formGroup",i.formSuggest),l.xp6(2),l.hij("G\u1ee3i \xfd ",l.lcZ(3,7,"DEVICE_MOD.CORRECTION"),""),l.xp6(4),l.Oqu(l.lcZ(7,9,"TRACEABILITY_MOD.START_TIME")),l.xp6(3),l.Q6J("ngForOf",i.listRepast),l.xp6(3),l.Oqu(l.lcZ(13,11,"DEVICE_MOD.END_TIME")),l.xp6(3),l.Q6J("ngIf",i.unit_rotation_time>0),l.xp6(1),l.Q6J("ngIf",0==i.unit_rotation_time)}}var T,D=((T=function(){function t(n,i,o,a,u){e(this,t),this.modalController=n,this.iotService=i,this.toastService=o,this.translate=a,this.alertController=u,this.loading=new c.E,this.form=new r.cw({run_mode:new r.NI("",r.kI.required),unit_time_on:new r.NI("",r.kI.required),unit_time_off:new r.NI("",r.kI.required),unit_rotation_time:new r.NI("",r.kI.required)}),this.formSuggest=new r.cw({repast:new r.NI("0",r.kI.required),end:new r.NI(s().toISOString(),r.kI.required)}),this.listRepast=[],this.unit_rotation_time=0,this.show=!1}return n(t,[{key:"ngOnInit",value:function(){console.log(espSmartconfig),this.form.setValue({run_mode:this.infor.run_mode,unit_time_on:this.infor.unit_time_on,unit_time_off:this.infor.unit_time_off,unit_rotation_time:this.infor.unit_rotation_time}),this.getListRepast()}},{key:"save",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={run_mode:this.form.value.run_mode,unit_time_off:this.form.value.unit_time_off,unit_time_on:this.form.value.unit_time_on,unit_rotation_time:this.form.value.unit_rotation_time,time_off:this.infor.time_off,time_on:this.infor.time_on},this.loading.setPending(!0),e.next=4,this.iotService.updateSetting(this.id,t).catch(function(){i.toastService.danger(i.translate.instant("ERROR_CONNECT")),i.loading.setResult(!1)});case 4:(n=e.sent)&&n.status?(this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS")),this.modalController.dismiss(!0),this.loading.setResult(!0)):this.loading.setResult(!1);case 6:case"end":return e.stop()}},e,this)}))}},{key:"presentAlertName",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:"C\xe0i \u0111\u1eb7t",inputs:[{name:"name",type:"text",placeholder:"T\xean m\xe1y",value:this.infor.name?this.infor.name:""}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(e){t.updateName(e.name)}}]});case 2:return e.next=4,e.sent.present();case 4:case"end":return e.stop()}},e,this)}))}},{key:"updateName",value:function(e){var t=this;this.loading.setPending(!0),this.iotService.updateCommonSetting(this.id,{name:e}).subscribe(function(n){n.status?(t.toastService.success(t.translate.instant("WALL.UPDATE_SUCCESS")),t.infor.name=e):t.toastService.warning(t.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")),t.loading.setResult(!0)},function(){t.loading.setResult(!1),t.toastService.danger(t.translate.instant("ERROR_CONNECT"))})}},{key:"updateSetting",value:function(e,t){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,o,a=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(i=this.infor)[t]=e,"run_mode"==t&&(i.run_mode=1==+i.run_mode?0:1),this.loading.setPending(!0),n.next=4,this.iotService.updateSetting(this.id,i).catch(function(){a.toastService.danger(a.translate.instant("ERROR_CONNECT")),a.loading.setResult(!1)});case 4:(o=n.sent)&&o.status?(this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS")),this.loading.setResult(!0)):this.loading.setResult(!1);case 6:case"end":return n.stop()}},n,this)}))}},{key:"presentAlertUnit",value:function(e){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.SETTING_UNIT"),inputs:[{name:this.translate.instant("DEVICE_MOD.SECOND"),type:"radio",label:this.translate.instant("DEVICE_MOD.SECOND"),value:0,handler:function(){console.log("Radio 1 selected")},checked:0==this.infor[e]},{name:this.translate.instant("FARM_MOD.MINUTE"),type:"radio",label:this.translate.instant("FARM_MOD.MINUTE"),value:1,handler:function(){console.log("Radio 2 selected")},checked:1==this.infor[e]},{name:this.translate.instant("POND_MOD.HOUR"),type:"radio",label:this.translate.instant("POND_MOD.HOUR"),value:2,handler:function(){console.log("Radio 3 selected")},checked:2==this.infor[e]}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(t){n.updateSetting(t,e)}}]});case 2:return t.next=4,t.sent.present();case 4:case"end":return t.stop()}},t,this)}))}},{key:"presentAlertCalib",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.CORRECTION"),inputs:[{name:"value",type:"number",value:this.infor.unit_rotation_time}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(e){t.updateSetting(e.value,"unit_rotation_time")}}]});case 2:return e.next=4,e.sent.present();case 4:case"end":return e.stop()}},e,this)}))}},{key:"getListRepast",value:function(){var e=this;this.iotService.getListRepast(this.infor.peripheral_id,this.id).subscribe(function(t){t.status&&(e.listRepast=t.data,e.formSuggest.patchValue({repast:0}),e.show=!0),e.loading.setResult(!0)},function(){e.loading.setResult(!1),e.toastService.danger(e.translate.instant("ERROR_CONNECT"))})}},{key:"getSuggest",value:function(){var e=this;this.iotService.getSuggestCalib(this.listRepast[this.formSuggest.value.repast].time,s(this.listRepast[this.formSuggest.value.repast].time).format("YYYY-MM-DD")+" "+s(this.formSuggest.value.end).format("HH:mm:ss"),this.listRepast[this.formSuggest.value.repast].value,this.id).subscribe(function(t){t.status&&(e.unit_rotation_time=t.data.unit_rotation_time),e.loading.setResult(!0)},function(){e.loading.setResult(!1),e.toastService.danger(e.translate.instant("ERROR_CONNECT"))})}},{key:"presentAlertCalibSuggest",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.ADD_SUGGEST"),buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(e){t.updateSetting(t.unit_rotation_time,"unit_rotation_time")}}]});case 2:return e.next=4,e.sent.present();case 4:case"end":return e.stop()}},e,this)}))}},{key:"runSmartConfig",value:function(){espSmartconfig.getNetworklist({numLevels:!1},function(e){console.log(e)},function(e){console.log(e)}),espSmartconfig.startConfig("Tepbac.com","00:00:00:00","unicorn2024","NO",1,function(e){console.log(e)},function(e){console.log(e)})}}]),t}()).\u0275fac=function(e){return new(e||T)(l.Y36(d.IN),l.Y36(u.d),l.Y36(f.k),l.Y36(p.sK),l.Y36(d.Br))},T.\u0275cmp=l.Xpm({type:T,selectors:[["app-feed-setting"]],inputs:{id:"id",infor:"infor"},decls:50,vars:21,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["type","indeterminate",4,"ngIf"],[1,"ion-padding"],["slot","end","mode","ios","fill","clear",3,"click"],["name","create"],["lines","inset"],[3,"innerHTML"],[3,"formGroup",4,"ngIf"],["type","indeterminate"],[3,"formGroup"],["lines","none"],["position","floating"],["mode","ios","formControlName","repast","okText","Okay","cancelText","Dismiss","clearInput","",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["mode","ios","formControlName","end","displayFormat","HH:mm:ss",3,"ionChange"],["class","ion-text-center",4,"ngIf"],[3,"value"],[1,"ion-text-center"],["shape","round","fill","outline","color","success","size","small",3,"click"],["shape","round","size","small",3,"click"]],template:function(e,t){1&e&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.TgZ(5,"ion-buttons",0),l.TgZ(6,"ion-button",1),l.NdJ("click",function(){return t.modalController.dismiss()}),l._UZ(7,"ion-icon",2),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.YNc(8,m,1,0,"ion-progress-bar",3),l.TgZ(9,"ion-content",4),l.TgZ(10,"ion-list"),l.TgZ(11,"ion-item"),l.TgZ(12,"ion-label"),l.TgZ(13,"h3"),l._uU(14),l.ALo(15,"translate"),l.qZA(),l.TgZ(16,"p"),l._uU(17),l.qZA(),l.qZA(),l.TgZ(18,"ion-button",5),l.NdJ("click",function(){return t.presentAlertName()}),l._UZ(19,"ion-icon",6),l.qZA(),l.qZA(),l.TgZ(20,"ion-item",7),l.TgZ(21,"ion-label"),l.TgZ(22,"p"),l.TgZ(23,"small"),l._uU(24),l.ALo(25,"translate"),l.qZA(),l.qZA(),l._UZ(26,"ion-text",8),l.qZA(),l.TgZ(27,"ion-button",5),l.NdJ("click",function(){return t.presentAlertUnit("unit_time_on")}),l._UZ(28,"ion-icon",6),l.qZA(),l.qZA(),l.TgZ(29,"ion-item",7),l.TgZ(30,"ion-label"),l.TgZ(31,"p"),l.TgZ(32,"small"),l._uU(33),l.ALo(34,"translate"),l.qZA(),l.qZA(),l._UZ(35,"ion-text",8),l.qZA(),l.TgZ(36,"ion-button",5),l.NdJ("click",function(){return t.presentAlertUnit("unit_time_off")}),l._UZ(37,"ion-icon",6),l.qZA(),l.qZA(),l.TgZ(38,"ion-item",7),l.TgZ(39,"ion-label"),l.TgZ(40,"p"),l.TgZ(41,"small"),l._uU(42),l.ALo(43,"translate"),l.qZA(),l.qZA(),l.TgZ(44,"ion-text"),l._uU(45),l.qZA(),l.qZA(),l.TgZ(46,"ion-button",5),l.NdJ("click",function(){return t.presentAlertCalib()}),l._UZ(47,"ion-icon",6),l.qZA(),l.qZA(),l.qZA(),l.TgZ(48,"ion-card"),l.YNc(49,Z,17,13,"ion-card-content",9),l.qZA(),l.qZA()),2&e&&(l.xp6(3),l.Oqu(l.lcZ(4,11,"DEVICE_MOD.SETTING_FEED")),l.xp6(5),l.Q6J("ngIf",t.loading.pending),l.xp6(6),l.Oqu(l.lcZ(15,13,"DEVICE_MOD.NAME")),l.xp6(3),l.Oqu(t.infor.name),l.xp6(7),l.Oqu(l.lcZ(25,15,"DEVICE_MOD.UNITON")),l.xp6(2),l.Q6J("innerHTML",t.translate.instant(0==t.infor.unit_time_on?"DEVICE_MOD.SECOND":1==t.infor.unit_time_on?"FARM_MOD.MINUTE":"POND_MOD.HOUR"),l.oJD),l.xp6(7),l.Oqu(l.lcZ(34,17,"DEVICE_MOD.UNITOFF")),l.xp6(2),l.Q6J("innerHTML",t.translate.instant(0==t.infor.unit_time_off?"DEVICE_MOD.SECOND":1==t.infor.unit_time_off?"FARM_MOD.MINUTE":"POND_MOD.HOUR"),l.oJD),l.xp6(7),l.Oqu(l.lcZ(43,19,"DEVICE_MOD.CORRECTION")),l.xp6(3),l.Oqu(t.infor.unit_rotation_time),l.xp6(4),l.Q6J("ngIf",t.show))},directives:[d.Gu,d.sr,d.wd,d.Sm,d.YG,d.gu,h.O5,d.W2,d.q_,d.Ie,d.Q$,d.yW,d.PM,d.X7,d.FN,r.JL,r.sg,d.tO,d.t9,d.QI,r.JJ,r.u,h.sg,d.x4,d.n0],pipes:[p.X$],styles:[""]}),T)},92640:function(t,i,o){o.d(i,{V:function(){return _}});var a=o(64762),r=o(90665),s=o(16738),c=o(27887),u=o(82629),l=o(37716),d=o(47063),f=o(84465),p=o(81780),h=o(38583);function m(e,t){1&e&&l._UZ(0,"ion-progress-bar",16)}function g(e,t){if(1&e&&(l.TgZ(0,"div",13),l.TgZ(1,"ion-button",17),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-button",18),l._uU(5),l.ALo(6,"translate"),l.qZA(),l.qZA()),2&e){var n=l.oxw();l.xp6(2),l.lnq("",l.lcZ(3,6,"DEVICE_MOD.ON")," ",n.result.on," ",n.translate.instant("DEVICE_MOD.SECOND"),""),l.xp6(3),l.lnq("",l.lcZ(6,8,"DEVICE_MOD.OFF")," ",n.result.off," ",n.translate.instant("FARM_MOD.MINUTE"),"")}}var v,_=((v=function(){function t(n,i,o,a){e(this,t),this.modelController=n,this.toastService=i,this.iotService=o,this.translate=a,this.form=new r.cw({value_kg:new r.NI("",r.kI.required),start:new r.NI(s().format(),r.kI.required),end:new r.NI(s().format(),r.kI.required)}),this.loading=new c.E}return n(t,[{key:"ngOnInit",value:function(){var e;this.form.patchValue({value_kg:(this.stateDevice.infor.rem_rotation_time/((+(null===(e=this.stateDevice.config)||void 0===e?void 0:e.unit_rotation_time)+10)/10)).toFixed(2)}),console.log(this.stateDevice)}},{key:"getResult",value:function(){var e=this.getTimerValue(this.form.value.start,this.form.value.end,this.form.value.value_kg);e.on<=0||e.off<=0?this.toastService.success(this.translate.instant("DEVICE_MOD.INVALID_NUMBER")):this.result=e}},{key:"getTimerValue",value:function(e,t,n){var i=5,o=s.duration(s(t).diff(s(e))).asMinutes();if(!(+o<10)){console.log("minutes: ",o);var a=(+this.stateDevice.config.unit_rotation_time+10)/10;console.log("calibValue: ",a);var r=n*a*i*60,c=60*o-n*a;console.log("numerator: ",r),0==c&&(c=1);var u=parseInt((r/c).toFixed(0));for(console.log("timeOn: ",u);u>99;)r=n*a*(i-=1)*60,u=parseInt((r/c).toFixed(0));for(;u<1;)r=n*a*(i+=1)*60,u=parseInt((r/c).toFixed(0));return{on:u,off:i}}this.toastService.warning(this.translate.instant("DEVICE_MOD.INVALID_NUMBER"))}},{key:"save",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this.stateDevice.config).time_on=this.result.on/Math.pow(60,+this.stateDevice.config.unit_time_on),t.time_off=60*this.result.off/Math.pow(60,+this.stateDevice.config.unit_time_off),this.loading.setPending(!0),e.next=4,this.iotService.updateSetting(this.id,t).catch(function(){i.toastService.danger(i.translate.instant("ERROR_CONNECT"))});case 4:(n=e.sent)&&1==n.status?(this.toastService.success(this.translate.instant("DEVICE_MOD.SAVE_SUCCESS")),this.modelController.dismiss()):this.toastService.warning(this.translate.instant("DEVICE_MOD.SAVE_UNSUCCESS")),this.loading.setResult(!0);case 6:case"end":return e.stop()}},e,this)}))}}]),t}()).\u0275fac=function(e){return new(e||v)(l.Y36(d.IN),l.Y36(f.k),l.Y36(u.d),l.Y36(p.sK))},v.\u0275cmp=l.Xpm({type:v,selectors:[["app-feed-suggest"]],inputs:{stateDevice:"stateDevice",id:"id"},decls:37,vars:22,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],[1,"ion-padding"],[3,"formGroup"],["lines","inset"],["position","floating"],["type","number","formControlName","value_kg",3,"ionChange"],["formControlName","start","displayFormat","HH:mm"],["formControlName","end","displayFormat","HH:mm"],[1,"ion-text-center","ion-margin-top"],["shape","round",3,"click"],["class","ion-text-center ion-margin-top",4,"ngIf"],["type","indeterminate"],["shape","round","color","success","fill","outline"],["shape","round","color","danger","fill","outline"]],template:function(e,t){1&e&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.TgZ(5,"ion-buttons",0),l.TgZ(6,"ion-button",1),l.NdJ("click",function(){return t.modelController.dismiss()}),l._UZ(7,"ion-icon",2),l.qZA(),l.qZA(),l.TgZ(8,"ion-buttons",3),l.TgZ(9,"ion-button",4),l.NdJ("click",function(){return t.save()}),l._uU(10),l.ALo(11,"translate"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.YNc(12,m,1,0,"ion-progress-bar",5),l.TgZ(13,"ion-content",6),l.TgZ(14,"div",7),l.TgZ(15,"ion-item",8),l.TgZ(16,"ion-label",9),l._uU(17),l.ALo(18,"translate"),l.qZA(),l.TgZ(19,"ion-input",10),l.NdJ("ionChange",function(){return t.result=null}),l.qZA(),l.qZA(),l.TgZ(20,"ion-item",8),l.TgZ(21,"ion-text",9),l._uU(22),l.ALo(23,"translate"),l.qZA(),l.TgZ(24,"ion-text",3),l._UZ(25,"ion-datetime",11),l.qZA(),l.qZA(),l.TgZ(26,"ion-item",8),l.TgZ(27,"ion-text",9),l._uU(28),l.ALo(29,"translate"),l.qZA(),l.TgZ(30,"ion-text",3),l._UZ(31,"ion-datetime",12),l.qZA(),l.qZA(),l.qZA(),l.TgZ(32,"div",13),l.TgZ(33,"ion-button",14),l.NdJ("click",function(){return t.getResult()}),l._uU(34),l.ALo(35,"translate"),l.qZA(),l.qZA(),l.YNc(36,g,7,10,"div",15),l.qZA()),2&e&&(l.xp6(3),l.Oqu(l.lcZ(4,10,"SUGGEST")),l.xp6(6),l.Q6J("disabled",!t.result),l.xp6(1),l.hij(" ",l.lcZ(11,12,"SAVE")," "),l.xp6(2),l.Q6J("ngIf",t.loading.pending),l.xp6(2),l.Q6J("formGroup",t.form),l.xp6(3),l.hij("",l.lcZ(18,14,"DEVICE_MOD.WEIGHT"),"(kg)"),l.xp6(5),l.Oqu(l.lcZ(23,16,"TRACEABILITY_MOD.START_TIME")),l.xp6(6),l.Oqu(l.lcZ(29,18,"DEVICE_MOD.END_TIME")),l.xp6(6),l.Oqu(l.lcZ(35,20,"DEVICE_MOD.GET_REULT")),l.xp6(2),l.Q6J("ngIf",t.result))},directives:[d.Gu,d.sr,d.wd,d.Sm,d.YG,d.gu,h.O5,d.W2,r.JL,r.sg,d.Ie,d.Q$,d.pK,d.as,r.JJ,r.u,d.yW,d.x4,d.QI,d.X7],pipes:[p.X$],styles:[""]}),v)},53423:function(t,i,o){o.d(i,{g:function(){return D}});var a=o(64762),r=o(90665),s=o(16738),c=o(27887),u=o(82629),l=o(37716),d=o(81780),f=o(47063),p=o(88459),h=o(84465),m=o(38583);function g(e,t){1&e&&l._UZ(0,"ion-progress-bar",7)}function v(e,t){if(1&e&&(l.TgZ(0,"ion-item",10),l.TgZ(1,"ion-text",11),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-text",3),l._UZ(5,"ion-datetime",22),l.qZA(),l.qZA()),2&e){var n=l.oxw(2);l.xp6(2),l.Oqu(l.lcZ(3,3,"DEVICE_MOD.DAY_START")),l.xp6(3),l.Q6J("min",n.minDate.format("YYYY-MM-DD"))("max",n.maxDate.format("YYYY-MM-DD"))}}function _(e,t){if(1&e&&(l.TgZ(0,"ion-item",10),l.TgZ(1,"ion-text",11),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-text",3),l._UZ(5,"ion-datetime",23),l.qZA(),l.qZA()),2&e){var n=l.oxw(2);l.xp6(2),l.Oqu(l.lcZ(3,3,"DEVICE_MOD.DAY_END")),l.xp6(3),l.Q6J("min",n.minDate.format("YYYY-MM-DD"))("max",n.maxDate.format("YYYY-MM-DD"))}}function Z(e,t){if(1&e){var n=l.EpF();l.TgZ(0,"ion-content",8),l.TgZ(1,"div",9),l.TgZ(2,"ion-item",10),l.TgZ(3,"ion-label",11),l._uU(4),l.ALo(5,"translate"),l.qZA(),l.TgZ(6,"ion-input",12),l.NdJ("ionChange",function(){return l.CHM(n),l.oxw().setValidatorValue()}),l.qZA(),l.qZA(),l.TgZ(7,"ion-grid"),l.TgZ(8,"ion-row"),l.TgZ(9,"ion-col",13),l.TgZ(10,"ion-item",10),l.TgZ(11,"ion-label",11),l._uU(12),l.ALo(13,"translate"),l.qZA(),l.TgZ(14,"ion-input",14),l.NdJ("ionFocus",function(){l.CHM(n);var e=l.oxw();return e.focusState.quantity=!0,e.focusState.ratio=!1})("ionChange",function(e){return l.CHM(n),l.oxw().quantityChange(e)}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(15,"ion-col",13),l.TgZ(16,"ion-item",10),l.TgZ(17,"ion-label",11),l._uU(18),l.ALo(19,"translate"),l.qZA(),l.TgZ(20,"ion-input",15),l.NdJ("ionFocus",function(){l.CHM(n);var e=l.oxw();return e.focusState.ratio=!0,e.focusState.quantity=!1})("ionChange",function(e){return l.CHM(n),l.oxw().ratioChange(e)}),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(21,"ion-item",10),l.TgZ(22,"ion-label",11),l._uU(23),l.ALo(24,"translate"),l.qZA(),l.TgZ(25,"ion-select",16),l.TgZ(26,"ion-select-option",17),l._uU(27),l.ALo(28,"translate"),l.qZA(),l.TgZ(29,"ion-select-option",18),l._uU(30),l.ALo(31,"translate"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(32,"ion-item",10),l.TgZ(33,"ion-text",11),l._uU(34),l.ALo(35,"translate"),l.qZA(),l.TgZ(36,"ion-text",3),l._UZ(37,"ion-datetime",19),l.qZA(),l.qZA(),l.TgZ(38,"ion-item",10),l.TgZ(39,"ion-text",11),l._uU(40),l.ALo(41,"translate"),l.qZA(),l.TgZ(42,"ion-text",3),l._UZ(43,"ion-datetime",20),l.qZA(),l.qZA(),l.YNc(44,v,6,5,"ion-item",21),l.YNc(45,_,6,5,"ion-item",21),l.qZA(),l.qZA()}if(2&e){var i=l.oxw();l.xp6(1),l.Q6J("formGroup",i.form),l.xp6(3),l.hij("",l.lcZ(5,11,"FARM_MOD.TOTAL_FEED")," (kg)"),l.xp6(8),l.hij("",l.lcZ(13,13,"WEIGHT"),"(kg)"),l.xp6(6),l.hij("",l.lcZ(19,15,"WEIGHT"),"(%)"),l.xp6(5),l.Oqu(l.lcZ(24,17,"DEVICE_MOD.RUN_MODE")),l.xp6(4),l.Oqu(l.lcZ(28,19,"DEVICE_MOD.SCHEDULE")),l.xp6(3),l.Oqu(l.lcZ(31,21,"DEVICE_MOD.REPEAT")),l.xp6(4),l.Oqu(l.lcZ(35,23,"TRACEABILITY_MOD.START_TIME")),l.xp6(6),l.Oqu(l.lcZ(41,25,"DEVICE_MOD.END_TIME")),l.xp6(4),l.Q6J("ngIf","schedule"==i.form.value.mode),l.xp6(1),l.Q6J("ngIf","schedule"==i.form.value.mode)}}var T,D=((T=function(){function t(n,i,o,a,u,l){e(this,t),this.translate=n,this.modalController=i,this.afs=o,this.pickerController=a,this.toastService=u,this.iotService=l,this.loading=new c.E,this.form=new r.cw({value_kg:new r.NI("",r.kI.required),value_ratio:new r.NI("",r.kI.required),start:new r.NI(s().format("HH:mm"),r.kI.required),end:new r.NI(s().format("HH:mm"),r.kI.required),start_date:new r.NI(s().format("YYYY-MM-DD")),end_date:new r.NI(s().format("YYYY-MM-DD")),mode:new r.NI("repeat",r.kI.required),totalFeed:new r.NI("repeat",r.kI.required)}),this.totalFeed=0,this.day=7,this.focusState={ratio:!1,quantity:!1},this.show=!1,this.minDate=s(),this.maxDate=s().add(180,"days")}return n(t,[{key:"ngOnInit",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.estimateTotalFeed();case 2:case"end":return e.stop()}},e,this)}))}},{key:"close",value:function(){this.modalController.dismiss()}},{key:"save",value:function(){var e=this;if(this.checkTime()){var t={start:this.form.value.start+":00",end:this.form.value.end+":00",date_start:s(this.form.value.start_date).format("YYYY-MM-DD"),date_end:s(this.form.value.end_date).format("YYYY-MM-DD"),enable:1,value:this.form.value.value_kg};this.loading.setPending(!0),this.iotService.addTimer(this.infor.peripheral_id,this.id,t).subscribe(function(t){t.status?(e.toastService.success(e.translate.instant("SHOP.CART.ADDRESS.ADD_SUCCESS")),e.modalController.dismiss(t.data)):e.toastService.warning(e.translate.instant("DEVICE_MOD.ADD_UNSUCCESFUL")),e.loading.setResult(!0)},function(){e.toastService.danger(e.translate.instant("ERROR_CONNECT")),e.loading.setResult(!1)})}else this.toastService.warning(this.translate.instant("DEVICE_MOD.INVALID_TIME"))}},{key:"checkTime",value:function(){return!("schedule"==this.form.value.mode&&s(this.form.value.start_date).valueOf()>=s(this.form.value.end_date).valueOf()||s(this.form.value.start).valueOf()>=s(this.form.value.end).valueOf())}},{key:"estimateTotalFeed",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("analyze",function(e){return e.orderBy("label","asc").limit(t.day)}).get();case 2:return e.next=4,e.sent.forEach(function(e){return(0,a.mG)(t,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.forEach(function(e){return(0,a.mG)(n,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.totalFeed+=e.data().value-(e.data().abstract?e.data().abstract:0)+(e.data().plus?e.data().plus:0);case 1:case"end":return t.stop()}},t,this)}))});case 2:this.form.patchValue({totalFeed:this.totalFeed}),this.setValidatorValue();case 4:case"end":return t.stop()}},t,this)}))});case 4:case"end":return e.stop()}},e,this)}))}},{key:"quantityChange",value:function(e){var t=e.target.value/this.form.value.totalFeed*100;t>0&&1==this.focusState.quantity&&this.form.patchValue({value_ratio:t.toFixed(0)})}},{key:"ratioChange",value:function(e){var t=this.form.value.totalFeed*e.target.value/100;t>0&&1==this.focusState.ratio&&this.form.patchValue({value_kg:t.toFixed(0)})}},{key:"setValidatorValue",value:function(){this.form.controls.value_ratio.setValue(""),this.form.controls.value_kg.setValue("")}},{key:"ionViewDidEnter",value:function(){this.show=!0}}]),t}()).\u0275fac=function(e){return new(e||T)(l.Y36(d.sK),l.Y36(f.IN),l.Y36(p.ST),l.Y36(f.up),l.Y36(h.k),l.Y36(u.d))},T.\u0275cmp=l.Xpm({type:T,selectors:[["app-feed-timer-add"]],inputs:{id:"id",infor:"infor"},decls:14,vars:9,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],["class","ion-padding",4,"ngIf"],["type","indeterminate"],[1,"ion-padding"],[3,"formGroup"],["lines","inset"],["position","floating"],["type","number","formControlName","totalFeed",3,"ionChange"],["size","6"],["type","number","formControlName","value_kg",3,"ionFocus","ionChange"],["type","number","formControlName","value_ratio",3,"ionFocus","ionChange"],["formControlName","mode","okText","Okay","cancelText","Dismiss"],["value","schedule"],["value","repeat"],["formControlName","start","displayFormat","HH:mm"],["formControlName","end","displayFormat","HH:mm"],["lines","inset",4,"ngIf"],["formControlName","start_date","displayFormat","YYYY-MM-DD",3,"min","max"],["formControlName","end_date","displayFormat","YYYY-MM-DD",3,"min","max"]],template:function(e,t){1&e&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.TgZ(5,"ion-buttons",0),l.TgZ(6,"ion-button",1),l.NdJ("click",function(){return t.close()}),l._UZ(7,"ion-icon",2),l.qZA(),l.qZA(),l.TgZ(8,"ion-buttons",3),l.TgZ(9,"ion-button",4),l.NdJ("click",function(){return t.save()}),l._uU(10),l.ALo(11,"translate"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.YNc(12,g,1,0,"ion-progress-bar",5),l.YNc(13,Z,46,27,"ion-content",6)),2&e&&(l.xp6(3),l.Oqu(l.lcZ(4,5,"DEVICE_MOD.ADD_REPASS")),l.xp6(6),l.Q6J("disabled",t.form.invalid),l.xp6(1),l.hij(" ",l.lcZ(11,7,"SAVE")," "),l.xp6(2),l.Q6J("ngIf",t.loading.pending),l.xp6(1),l.Q6J("ngIf",t.show))},directives:[f.Gu,f.sr,f.wd,f.Sm,f.YG,f.gu,m.O5,f.X7,f.W2,r.JL,r.sg,f.Ie,f.Q$,f.pK,f.as,r.JJ,r.u,f.jY,f.Nd,f.wI,f.t9,f.QI,f.n0,f.yW,f.x4],pipes:[d.X$],styles:[""]}),T)},58578:function(t,i,o){o.d(i,{J:function(){return D}});var a=o(64762),r=o(90665),s=o(16738),c=o(27887),u=o(82629),l=o(37716),d=o(81780),f=o(47063),p=o(88459),h=o(84465),m=o(38583);function g(e,t){1&e&&l._UZ(0,"ion-progress-bar",7)}function v(e,t){if(1&e&&(l.TgZ(0,"ion-item",10),l.TgZ(1,"ion-text",11),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-text",3),l._UZ(5,"ion-datetime",22),l.qZA(),l.qZA()),2&e){var n=l.oxw(2);l.xp6(2),l.Oqu(l.lcZ(3,3,"DEVICE_MOD.DAY_START")),l.xp6(3),l.Q6J("min",n.minDate.format("YYYY-MM-DD"))("max",n.maxDate.format("YYYY-MM-DD"))}}function _(e,t){if(1&e&&(l.TgZ(0,"ion-item",10),l.TgZ(1,"ion-text",11),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-text",3),l._UZ(5,"ion-datetime",23),l.qZA(),l.qZA()),2&e){var n=l.oxw(2);l.xp6(2),l.Oqu(l.lcZ(3,3,"DEVICE_MOD.DAY_END")),l.xp6(3),l.Q6J("min",n.minDate.format("YYYY-MM-DD"))("max",n.maxDate.format("YYYY-MM-DD"))}}function Z(e,t){if(1&e){var n=l.EpF();l.TgZ(0,"ion-content",8),l.TgZ(1,"div",9),l.TgZ(2,"ion-item",10),l.TgZ(3,"ion-label",11),l._uU(4),l.ALo(5,"translate"),l.qZA(),l.TgZ(6,"ion-input",12),l.NdJ("ionChange",function(){return l.CHM(n),l.oxw().setValidatorValue()}),l.qZA(),l.qZA(),l.TgZ(7,"ion-grid"),l.TgZ(8,"ion-row"),l.TgZ(9,"ion-col",13),l.TgZ(10,"ion-item",10),l.TgZ(11,"ion-label",11),l._uU(12),l.ALo(13,"translate"),l.qZA(),l.TgZ(14,"ion-input",14),l.NdJ("ionFocus",function(){l.CHM(n);var e=l.oxw();return e.focusState.quantity=!0,e.focusState.ratio=!1})("ionChange",function(e){return l.CHM(n),l.oxw().quantityChange(e)}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(15,"ion-col",13),l.TgZ(16,"ion-item",10),l.TgZ(17,"ion-label",11),l._uU(18),l.ALo(19,"translate"),l.qZA(),l.TgZ(20,"ion-input",15),l.NdJ("ionFocus",function(){l.CHM(n);var e=l.oxw();return e.focusState.ratio=!0,e.focusState.quantity=!1})("ionChange",function(e){return l.CHM(n),l.oxw().ratioChange(e)}),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(21,"ion-item",10),l.TgZ(22,"ion-label",11),l._uU(23),l.ALo(24,"translate"),l.qZA(),l.TgZ(25,"ion-select",16),l.TgZ(26,"ion-select-option",17),l._uU(27),l.ALo(28,"translate"),l.qZA(),l.TgZ(29,"ion-select-option",18),l._uU(30),l.ALo(31,"translate"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(32,"ion-item",10),l.TgZ(33,"ion-text",11),l._uU(34),l.ALo(35,"translate"),l.qZA(),l.TgZ(36,"ion-text",3),l._UZ(37,"ion-datetime",19),l.qZA(),l.qZA(),l.TgZ(38,"ion-item",10),l.TgZ(39,"ion-text",11),l._uU(40),l.ALo(41,"translate"),l.qZA(),l.TgZ(42,"ion-text",3),l._UZ(43,"ion-datetime",20),l.qZA(),l.qZA(),l.YNc(44,v,6,5,"ion-item",21),l.YNc(45,_,6,5,"ion-item",21),l.qZA(),l.qZA()}if(2&e){var i=l.oxw();l.xp6(1),l.Q6J("formGroup",i.form),l.xp6(3),l.hij("",l.lcZ(5,11,"FARM_MOD.TOTAL_FEED")," (kg)"),l.xp6(8),l.hij("",l.lcZ(13,13,"WEIGHT"),"(kg)"),l.xp6(6),l.hij("",l.lcZ(19,15,"WEIGHT"),"(%)"),l.xp6(5),l.Oqu(l.lcZ(24,17,"DEVICE_MOD.RUN_MODE")),l.xp6(4),l.Oqu(l.lcZ(28,19,"DEVICE_MOD.SCHEDULE")),l.xp6(3),l.Oqu(l.lcZ(31,21,"DEVICE_MOD.REPEAT")),l.xp6(4),l.Oqu(l.lcZ(35,23,"TRACEABILITY_MOD.START_TIME")),l.xp6(6),l.Oqu(l.lcZ(41,25,"DEVICE_MOD.END_TIME")),l.xp6(4),l.Q6J("ngIf","schedule"==i.form.value.mode),l.xp6(1),l.Q6J("ngIf","schedule"==i.form.value.mode)}}var T,D=((T=function(){function t(n,i,o,a,u,l){e(this,t),this.translate=n,this.modalController=i,this.afs=o,this.pickerController=a,this.toastService=u,this.iotService=l,this.loading=new c.E,this.form=new r.cw({value_kg:new r.NI("",r.kI.required),value_ratio:new r.NI("",r.kI.required),start:new r.NI(s().format("HH:mm"),r.kI.required),end:new r.NI(s().format("HH:mm"),r.kI.required),start_date:new r.NI(s().format("YYYY-MM-DD")),end_date:new r.NI(s().format("YYYY-MM-DD")),mode:new r.NI("repeat",r.kI.required),totalFeed:new r.NI("repeat",r.kI.required)}),this.totalFeed=0,this.day=7,this.focusState={ratio:!1,quantity:!1},this.show=!1,this.minDate=s(),this.maxDate=s().add(180,"days")}return n(t,[{key:"ngOnInit",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.estimateTotalFeed();case 2:this.form.setValue({value_kg:this.data.value,value_ratio:(100*this.data.value/this.totalFeed).toFixed(0),start:this.data.start.substring(0,this.data.start.length-3),end:this.data.end.substring(0,this.data.end.length-3),start_date:s(this.data.date_start).format("YYYY-MM-DD"),end_date:s(this.data.date_end).format("YYYY-MM-DD"),mode:this.data.mode,totalFeed:this.totalFeed});case 3:case"end":return e.stop()}},e,this)}))}},{key:"close",value:function(){this.modalController.dismiss()}},{key:"save",value:function(){var e=this;if(this.checkTime()){var t={start:this.form.value.start+":00",end:this.form.value.end+":00",date_start:s(this.form.value.start_date).format("YYYY-MM-DD"),date_end:s(this.form.value.end_date).format("YYYY-MM-DD"),enable:1,value:this.form.value.value_kg};this.loading.setPending(!0),this.iotService.updateTimerFeed(this.data.id,this.infor.peripheral_id,this.id,t).subscribe(function(t){t.status?(e.toastService.success("C\u1eadp nh\u1eadt th\xe0nh c\xf4ng"),e.modalController.dismiss(t.data)):e.toastService.warning("C\u1eadp nh\u1eadt kh\xf4ng th\xe0nh c\xf4ng"),e.loading.setResult(!0)},function(){e.toastService.danger(e.translate.instant("ERROR_CONNECT")),e.loading.setResult(!1)})}else this.toastService.warning("Th\u1eddi gian kh\xf4ng h\u1ee3p l\u1ec7")}},{key:"checkTime",value:function(){return!("schedule"==this.form.value.mode&&s(this.form.value.start_date).valueOf()>=s(this.form.value.end_date).valueOf()||s(this.form.value.start).valueOf()>=s(this.form.value.end).valueOf())}},{key:"estimateTotalFeed",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("analyze",function(e){return e.orderBy("label","asc").limit(t.day)}).get();case 2:return e.next=4,e.sent.forEach(function(e){return(0,a.mG)(t,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.forEach(function(e){return(0,a.mG)(n,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.totalFeed+=e.data().value-(e.data().abstract?e.data().abstract:0)+(e.data().plus?e.data().plus:0);case 1:case"end":return t.stop()}},t,this)}))});case 2:this.form.patchValue({totalFeed:this.totalFeed}),this.setValidatorValue();case 4:case"end":return t.stop()}},t,this)}))});case 4:case"end":return e.stop()}},e,this)}))}},{key:"quantityChange",value:function(e){var t=e.target.value/this.form.value.totalFeed*100;t>0&&1==this.focusState.quantity&&this.form.patchValue({value_ratio:t.toFixed(0)})}},{key:"ratioChange",value:function(e){var t=this.form.value.totalFeed*e.target.value/100;t>0&&1==this.focusState.ratio&&this.form.patchValue({value_kg:t.toFixed(0)})}},{key:"setValidatorValue",value:function(){this.form.controls.value_kg.setValue("");var e=this.form.value.totalFeed*this.form.value.value_ratio/100;e>0&&this.form.patchValue({value_kg:e.toFixed(0)})}},{key:"ionViewDidEnter",value:function(){this.show=!0}}]),t}()).\u0275fac=function(e){return new(e||T)(l.Y36(d.sK),l.Y36(f.IN),l.Y36(p.ST),l.Y36(f.up),l.Y36(h.k),l.Y36(u.d))},T.\u0275cmp=l.Xpm({type:T,selectors:[["app-feed-timer-edit"]],inputs:{id:"id",infor:"infor",data:"data"},decls:14,vars:9,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],["class","ion-padding",4,"ngIf"],["type","indeterminate"],[1,"ion-padding"],[3,"formGroup"],["lines","inset"],["position","floating"],["type","number","formControlName","totalFeed",3,"ionChange"],["size","6"],["type","number","formControlName","value_kg",3,"ionFocus","ionChange"],["type","number","formControlName","value_ratio",3,"ionFocus","ionChange"],["formControlName","mode","okText","Okay","cancelText","Dismiss"],["value","schedule"],["value","repeat"],["formControlName","start","displayFormat","HH:mm"],["formControlName","end","displayFormat","HH:mm"],["lines","inset",4,"ngIf"],["formControlName","start_date","displayFormat","YYYY-MM-DD",3,"min","max"],["formControlName","end_date","displayFormat","YYYY-MM-DD",3,"min","max"]],template:function(e,t){1&e&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.TgZ(5,"ion-buttons",0),l.TgZ(6,"ion-button",1),l.NdJ("click",function(){return t.close()}),l._UZ(7,"ion-icon",2),l.qZA(),l.qZA(),l.TgZ(8,"ion-buttons",3),l.TgZ(9,"ion-button",4),l.NdJ("click",function(){return t.save()}),l._uU(10),l.ALo(11,"translate"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.YNc(12,g,1,0,"ion-progress-bar",5),l.YNc(13,Z,46,27,"ion-content",6)),2&e&&(l.xp6(3),l.hij(" ",l.lcZ(4,5,"DEVICE_MOD.UPDATE_FEED"),""),l.xp6(6),l.Q6J("disabled",t.form.invalid),l.xp6(1),l.hij(" ",l.lcZ(11,7,"SAVE")," "),l.xp6(2),l.Q6J("ngIf",t.loading.pending),l.xp6(1),l.Q6J("ngIf",t.show))},directives:[f.Gu,f.sr,f.wd,f.Sm,f.YG,f.gu,m.O5,f.X7,f.W2,r.JL,r.sg,f.Ie,f.Q$,f.pK,f.as,r.JJ,r.u,f.jY,f.Nd,f.wI,f.t9,f.QI,f.n0,f.yW,f.x4],pipes:[d.X$],styles:[""]}),T)},31435:function(t,i,o){o.d(i,{N:function(){return v}});var a=o(90665),r=o(16738),s=o(27887),c=o(82629),u=o(37716),l=o(47063),d=o(84465),f=o(81780),p=o(38583);function h(e,t){1&e&&u._UZ(0,"ion-progress-bar",7)}function m(e,t){if(1&e&&(u.TgZ(0,"ion-content",8),u.TgZ(1,"div",9),u.TgZ(2,"ion-item",10),u.TgZ(3,"ion-label",11),u._uU(4),u.ALo(5,"translate"),u.qZA(),u.TgZ(6,"ion-select",12),u.TgZ(7,"ion-select-option",13),u._uU(8),u.ALo(9,"translate"),u.qZA(),u.TgZ(10,"ion-select-option",14),u._uU(11),u.ALo(12,"translate"),u.qZA(),u.qZA(),u.qZA(),u.TgZ(13,"ion-item",10),u.TgZ(14,"ion-text",11),u._uU(15),u.ALo(16,"translate"),u.qZA(),u.TgZ(17,"ion-text",3),u._UZ(18,"ion-datetime",15),u.qZA(),u.qZA(),u.TgZ(19,"ion-item",10),u.TgZ(20,"ion-label",11),u._uU(21),u.ALo(22,"translate"),u.qZA(),u._UZ(23,"ion-input",16),u.qZA(),u.qZA(),u.qZA()),2&e){var n=u.oxw();u.xp6(1),u.Q6J("formGroup",n.form),u.xp6(3),u.Oqu(u.lcZ(5,8,"DEVICE_MOD.ADDORREMOVE")),u.xp6(4),u.Oqu(u.lcZ(9,10,"DEVICE_MOD.ADD")),u.xp6(3),u.Oqu(u.lcZ(12,12,"DEVICE_MOD.CLEAR")),u.xp6(4),u.Oqu(u.lcZ(16,14,"DEVICE_MOD.DAY")),u.xp6(3),u.Q6J("min",n.minDate.format("YYYY-MM-DD"))("max",n.maxDate.format("YYYY-MM-DD")),u.xp6(3),u.hij("",u.lcZ(22,16,"DEVICE_MOD.VALUE")," (kg)")}}var g,v=((g=function(){function t(n,i,o,c){e(this,t),this.modalController=n,this.toastService=i,this.iotService=o,this.translate=c,this.loading=new s.E,this.form=new a.cw({type:new a.NI("plus_analyze",a.kI.required),date:new a.NI(r().format("YYYY-MM-DD"),a.kI.required),value:new a.NI("",a.kI.required)}),this.show=!1,this.minDate=r().subtract(180,"days"),this.maxDate=r().add(180,"days")}return n(t,[{key:"ngOnInit",value:function(){}},{key:"save",value:function(){var e=this;this.loading.setPending(!0),this.iotService[this.form.value.type](this.infor.peripheral_id,this.deviceId,{date:r(this.form.value.date).format("YYYY-MM-DD"),value:this.form.value.value}).subscribe(function(t){t.status?(e.toastService.success(e.translate.instant("WALL.UPDATE_SUCCESS")),e.modalController.dismiss()):e.toastService.warning(e.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")),e.loading.setResult(!0)},function(){e.toastService.danger(e.translate.instant("ERROR_CONNECT")),e.loading.setResult(!1)})}},{key:"ionViewDidEnter",value:function(){this.show=!0}}]),t}()).\u0275fac=function(e){return new(e||g)(u.Y36(l.IN),u.Y36(d.k),u.Y36(c.d),u.Y36(f.sK))},g.\u0275cmp=u.Xpm({type:g,selectors:[["app-feed-update-data"]],inputs:{deviceId:"deviceId",infor:"infor"},decls:13,vars:6,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],["class","ion-padding",4,"ngIf"],["type","indeterminate"],[1,"ion-padding"],[3,"formGroup"],["lines","inset"],["position","floating"],["formControlName","type","okText","Okay","cancelText","Dismiss"],["value","plus_analyze"],["value","abstract_analyze"],["formControlName","date","displayFormat","YYYY-MM-DD",3,"min","max"],["type","number","formControlName","value"]],template:function(e,t){1&e&&(u.TgZ(0,"ion-header"),u.TgZ(1,"ion-toolbar"),u.TgZ(2,"ion-title"),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"ion-buttons",0),u.TgZ(6,"ion-button",1),u.NdJ("click",function(){return t.modalController.dismiss()}),u._UZ(7,"ion-icon",2),u.qZA(),u.qZA(),u.TgZ(8,"ion-buttons",3),u.TgZ(9,"ion-button",4),u.NdJ("click",function(){return t.save()}),u._uU(10," L\u01b0u "),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.YNc(11,h,1,0,"ion-progress-bar",5),u.YNc(12,m,24,18,"ion-content",6)),2&e&&(u.xp6(3),u.Oqu(u.lcZ(4,4,"DEVICE_MOD.SETTING_FEED")),u.xp6(6),u.Q6J("disabled",t.form.invalid),u.xp6(2),u.Q6J("ngIf",t.loading.pending),u.xp6(1),u.Q6J("ngIf",t.show))},directives:[l.Gu,l.sr,l.wd,l.Sm,l.YG,l.gu,p.O5,l.X7,l.W2,a.JL,a.sg,l.Ie,l.Q$,l.t9,l.QI,a.JJ,a.u,l.n0,l.yW,l.x4,l.pK,l.as],pipes:[f.X$],styles:[""]}),g)},3520:function(t,i,o){o.d(i,{i:function(){return Z}});var a=o(64762),r=o(77203),s=o(99758),c=o(53760),u=o(90665),l=o(37716),d=o(47063),f=o(84465),p=o(81780),h=o(38583);function m(e,t){1&e&&l._UZ(0,"img",11)}function g(e,t){1&e&&l._UZ(0,"img",12)}function v(e,t){1&e&&l._UZ(0,"img",13)}var _,Z=((_=function(){function t(n,i,o,a,r,s,c,l,d){e(this,t),this.modalController=n,this.openNativeSettings=i,this.wifiWizard2=o,this.toastService=a,this.iab=r,this.translate=s,this.loadingScanCtrl=c,this.loadingConfigCtrl=l,this.cd=d,this.form=new u.cw({wifi:new u.NI("",u.kI.required),password:new u.NI("",u.kI.required)}),this.second=30,this.listWifi=[]}return n(t,[{key:"ngOnInit",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadingScan();case 2:this.wifiWizard2.getConnectedSSID().then(function(e){t.form.patchValue({wifi:e}),t.loadingScanCtrl.dismiss(),t.cd.detectChanges()}).catch(function(e){console.log(e),t.loadingScanCtrl.dismiss(),t.cd.detectChanges()});case 3:case"end":return e.stop()}},e,this)}))}},{key:"save",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadingConfig();case 2:this.wifiWizard2.getConnectedBSSID().then(function(e){t.startConfig(t.form.value.wifi,e,t.form.value.password,"NO",1)}).catch(function(e){t.toastService.warning(t.translate.instant("DEVICE_MOD.OPEN_CONFIG_FAILED")),t.loadingConfigCtrl.dismiss()}),this.interval=setInterval(function(){t.second-=1,console.log(t.second),0===t.second&&(t.second=30,t.loadingConfigCtrl.dismiss(),t.stopConfig(),clearInterval(t.interval))},1e3);case 4:case"end":return e.stop()}},e,this)}))}},{key:"startConfig",value:function(e,t,n,i,o){var a=this;espSmartconfig.startConfig(e,t,n,i,o,function(e){a.loadingConfigCtrl.dismiss(),a.toastService.success(a.translate.instant("DEVICE_MOD.SAVED_CONFIG")),this.modalController.dismiss()},function(e){a.loadingConfigCtrl.dismiss(),a.toastService.warning(a.translate.instant("DEVICE_MOD.CONFIG_FAILED"))})}},{key:"stopConfig",value:function(){espSmartconfig.stopConfig(function(e){console.log(e)},function(e){console.log(e)})}},{key:"loadingScan",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadingScanCtrl.create({message:this.translate.instant("DEVICE_MOD.SCAN_WIFI"),spinner:"circles",keyboardClose:!0});case 2:(t=e.sent).onDidDismiss().then(function(e){console.log("cancel scan")}),t.present().then(function(e){console.log("dang loading")});case 4:case"end":return e.stop()}},e,this)}))}},{key:"loadingConfig",value:function(){return(0,a.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadingConfigCtrl.create({message:this.translate.instant("DEVICE_MOD.CONFIGURING"),duration:3e4,spinner:"circles",backdropDismiss:!0});case 2:(t=e.sent).onDidDismiss().then(function(e){n.stopConfig(),n.second=30,clearInterval(n.interval)}),t.present();case 4:case"end":return e.stop()}},e,this)}))}},{key:"close",value:function(){this.modalController.dismiss()}},{key:"openSetting",value:function(){var e=this;this.openNativeSettings.open("wifi").then(function(e){console.log("ok")}).catch(function(t){e.toastService.warning(e.translate.instant("DEVICE_MOD.OPEN_SETTING_FAILED"))})}},{key:"openConfig",value:function(){var e=this;this.wifiWizard2.getConnectedSSID().then(function(t){JSON.stringify(t)==e.id?e.iab.create("http://192.168.1.4","_blank"):e.toastService.warning(e.translate.instant("DEVICE_MOD.WIFI_CORRECT"))}).catch(function(t){e.toastService.warning(e.translate.instant("DEVICE_MOD.OPEN_CONFIG_FAILED"))})}}]),t}()).\u0275fac=function(e){return new(e||_)(l.Y36(d.IN),l.Y36(r.Q),l.Y36(s.a),l.Y36(f.k),l.Y36(c.i),l.Y36(p.sK),l.Y36(d.HT),l.Y36(d.HT),l.Y36(l.sBO))},_.\u0275cmp=l.Xpm({type:_,selectors:[["app-config-wifi"]],inputs:{id:"id",type:"type",name:"name"},decls:35,vars:19,consts:[["slot","end"],[3,"click"],["name","close"],[3,"formGroup"],["src","../../../assets/img/cabinext.png",4,"ngIf"],["src","../../../assets/img/envisor.png",4,"ngIf"],["src","../../../assets/img/feeding.png",4,"ngIf"],["lines","inset",2,"text-align","center"],["slot","end","formControlName","password"],[1,"ion-text-center"],["shape","round",3,"disabled","click"],["src","../../../assets/img/cabinext.png"],["src","../../../assets/img/envisor.png"],["src","../../../assets/img/feeding.png"]],template:function(e,t){1&e&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.TgZ(5,"ion-buttons",0),l.TgZ(6,"ion-button",1),l.NdJ("click",function(){return t.close()}),l._UZ(7,"ion-icon",2),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(8,"ion-content"),l.TgZ(9,"ion-card",3),l.YNc(10,m,1,0,"img",4),l.YNc(11,g,1,0,"img",5),l.YNc(12,v,1,0,"img",6),l.TgZ(13,"ion-card-content"),l.TgZ(14,"ion-list",7),l.TgZ(15,"ion-item"),l.TgZ(16,"ion-label"),l._uU(17),l.ALo(18,"translate"),l.qZA(),l.TgZ(19,"ion-text",0),l._uU(20),l.qZA(),l.qZA(),l.TgZ(21,"ion-item"),l.TgZ(22,"ion-label"),l._uU(23,"Wifi"),l.qZA(),l.TgZ(24,"ion-text",0),l._uU(25),l.qZA(),l.qZA(),l.TgZ(26,"ion-item"),l.TgZ(27,"ion-label"),l._uU(28),l.ALo(29,"translate"),l.qZA(),l._UZ(30,"ion-input",8),l.qZA(),l.qZA(),l.TgZ(31,"div",9),l.TgZ(32,"ion-button",10),l.NdJ("click",function(){return t.save()}),l._uU(33),l.ALo(34,"translate"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&e&&(l.xp6(3),l.hij("",l.lcZ(4,11,"DEVICE_MOD.CONFIG")," wifi"),l.xp6(6),l.Q6J("formGroup",t.form),l.xp6(1),l.Q6J("ngIf","cabinet"==t.type),l.xp6(1),l.Q6J("ngIf","envisor"==t.type),l.xp6(1),l.Q6J("ngIf","feeding"==t.type),l.xp6(5),l.Oqu(l.lcZ(18,13,"DEVICE_MOD.NAME")),l.xp6(3),l.Oqu(t.name),l.xp6(5),l.Oqu(t.form.value.wifi),l.xp6(3),l.Oqu(l.lcZ(29,15,"AUTH.PASSWORD")),l.xp6(4),l.Q6J("disabled",t.form.invalid),l.xp6(1),l.Oqu(l.lcZ(34,17,"DEVICE_MOD.CONFIG")))},directives:[d.Gu,d.sr,d.wd,d.Sm,d.YG,d.gu,d.W2,d.PM,u.JL,u.sg,h.O5,d.FN,d.q_,d.Ie,d.Q$,d.yW,d.pK,d.j9,u.JJ,u.u],pipes:[p.X$],styles:[""]}),_)},82629:function(t,i,o){o.d(i,{d:function(){return c}});var a,r=o(15189),s=o(37716),c=((a=function(){function t(n){e(this,t),this.reqApiService=n,this.PATH_FT="http://35.240.204.122:8882/farmext",this.PATH_DEVICE="/manager/device-api",this.PATH_ADD_DEVICE="/manager/add-device-api",this.SITE_PATH_API="http://35.240.204.122:8882/api",this.listPermision=["company_manager","farm_manager","pond_manager"]}return n(t,[{key:"checkPermission",value:function(e){return!!this.listPermision.includes(e)}},{key:"setPondCode",value:function(e){this.pcode=e}},{key:"list",value:function(){return this.reqApiService.get(this.PATH_DEVICE+"?action=list&pcode="+this.pcode).toPromise()}},{key:"get",value:function(e){return this.reqApiService.get(this.PATH_DEVICE+"?action=get&device_id_fb="+e+"&pcode="+this.pcode).toPromise()}},{key:"update",value:function(e,t){return this.reqApiService.post(this.PATH_DEVICE+"?action=update&id="+t+"&pcode="+this.pcode,{name:e,pond_code:this.pcode}).toPromise()}},{key:"add",value:function(e){return this.reqApiService.post(this.PATH_ADD_DEVICE,e).toPromise()}},{key:"move",value:function(e,t,n){return this.reqApiService.post(this.PATH_DEVICE+"?action=update&id="+n+"&pcode="+this.pcode,{name:e,pond_code:t}).toPromise()}},{key:"remove",value:function(e){return this.reqApiService.get(this.PATH_DEVICE+"?action=remove&id="+e+"&pcode="+this.pcode).toPromise()}},{key:"check",value:function(e){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/qr/"+e).toPromise()}},{key:"active",value:function(e){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/qr/"+e,{}).toPromise()}},{key:"changeStatusContactor",value:function(e,t,n){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+n+"/peripherals/"+t+"/control",e)}},{key:"getInforDevice",value:function(e){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+e).toPromise()}},{key:"getListCondition",value:function(e,t){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/subscribes")}},{key:"removeCondition",value:function(e,t,n){return this.reqApiService.deleteTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/subscribes/"+n)}},{key:"addCondition",value:function(e,t,n){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/subscribes",n)}},{key:"updateNameContactor",value:function(e,t,n){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e,n)}},{key:"updateTimer",value:function(e,t,n){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/timer",n)}},{key:"updateSetting",value:function(e,t){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/setting",t).toPromise()}},{key:"addConditonPub",value:function(e,t,n){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/conditions",n)}},{key:"updateConditonPub",value:function(e,t,n,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/conditions/"+n,i)}},{key:"removeConditionPub",value:function(e,t,n){return this.reqApiService.deleteTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/conditions/"+n)}},{key:"saveAutoRecord",value:function(e,t){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/third-setting",t)}},{key:"commandFeeding",value:function(e,t){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+e+"/command",t)}},{key:"removeTimer",value:function(e,t,n){return this.reqApiService.deleteTokenFt(this.PATH_FT+"/v2/devices/"+n+"/peripherals/"+t+"/timer/"+e)}},{key:"addTimer",value:function(e,t,n){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/timer",n)}},{key:"updateTimerFeed",value:function(e,t,n,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+n+"/peripherals/"+t+"/timer/"+e,i)}},{key:"plus_analyze",value:function(e,t,n){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/plus_analyze",n)}},{key:"abstract_analyze",value:function(e,t,n){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/abstract_analyze",n)}},{key:"asyncData",value:function(e,t,n){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/sync",n)}},{key:"removeDataFeed",value:function(e,t,n){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/clear",n)}},{key:"updateCommonSetting",value:function(e,t){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e,t)}},{key:"getListRepast",value:function(e,t){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/data")}},{key:"getSuggestCalib",value:function(e,t,n,i){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+i+"/get-suggest-calib?feed="+n+"&start="+e+"&end="+t)}},{key:"quickAddRepast",value:function(e,t,n){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/timer/feed",n)}}]),t}()).\u0275fac=function(e){return new(e||a)(s.LFG(r.$))},a.\u0275prov=s.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a)}}])}();