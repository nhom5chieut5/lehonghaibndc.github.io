"use strict";(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[9246],{49246:function(t,e,i){i.d(e,{C:function(){return U}});var n=i(64762),o=i(16738),s=i(27887),a=i(82629),r=i(3520),l=i(31435),c=i(37716),d=i(47063),u=i(81780),h=i(88459),g=i(84465),p=i(38583),m=i(56209);function f(t,e){1&t&&c._UZ(0,"ion-progress-bar",13)}function v(t,e){if(1&t&&c._UZ(0,"div",14),2&t){const t=c.oxw();c.Q6J("options",t.optionAnalyzeCharts)("merge",t.stateData.analyze)}}function _(t,e){if(1&t&&(c.TgZ(0,"ion-item"),c.TgZ(1,"ion-label"),c._uU(2),c.qZA(),c.TgZ(3,"ion-text",9),c._uU(4),c.qZA(),c.qZA()),2&t){const t=e.$implicit;c.xp6(2),c.hij(" ",t.time," "),c.xp6(2),c.hij(" ",t.value," kg ")}}let Z=(()=>{class t{constructor(t,e,i,n,o,a,r){this.modalController=t,this.translate=e,this.afs=i,this.popoverController=n,this.iotService=o,this.toastService=a,this.alertController=r,this.loading=new s.E,this.optionDataCharts={},this.optionAnalyzeCharts={},this.stateData={data:[],analyze:[]},this.day=7,this.totalFeed=0,this.show=!1,this.listData=[]}ngOnInit(){return(0,n.mG)(this,void 0,void 0,function*(){yield this.loadData()})}presentSetting(){}loadData(){return(0,n.mG)(this,void 0,void 0,function*(){new Date(o(new Date).subtract(this.day,"days").toDate()),this.initChart(),yield(yield this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("data",t=>t.orderBy("time","desc").limit(1e3)).get()).forEach(t=>(0,n.mG)(this,void 0,void 0,function*(){yield t.forEach(t=>(0,n.mG)(this,void 0,void 0,function*(){let e=o(t.data().time.toMillis()).format("HH:mm YYYY-MM-DD");this.listData.push({time:e,value:t.data().value})}))})),this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("data",t=>t.orderBy("time","desc").limit(1)).stateChanges(["added"]).subscribe(t=>{t.map(t=>{let e=o(t.payload.doc.data().time.toMillis()).format("HH:mm YYYY-MM-DD");e!==this.listData[0].time&&this.listData[0].value!==t.payload.doc.data().value&&this.listData.unshift({time:e,value:t.payload.doc.data().value}),console.log(this.listData[0])})}),yield(yield this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("analyze",t=>t.orderBy("label","desc")).get()).forEach(t=>(0,n.mG)(this,void 0,void 0,function*(){yield t.forEach(t=>(0,n.mG)(this,void 0,void 0,function*(){this.optionAnalyzeCharts.xAxis.data.unshift(t.data().label),["value","abstract","plus"].forEach((e,i)=>{this.optionAnalyzeCharts.series[i].data.unshift(t.data()[e]?t.data()[e]:0)}),this.optionAnalyzeCharts.series[3].data.unshift(t.data().value-(t.data().abstract?t.data().abstract:0)+(t.data().plus?t.data().plus:0))}))})),this.stateData.analyze={series:this.optionAnalyzeCharts.series,xAxis:this.optionAnalyzeCharts.xAxis},this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("analyze").stateChanges(["modified"]).subscribe(t=>{t.map(t=>{let e=this.optionAnalyzeCharts.xAxis.data.findIndex(e=>e===t.payload.doc.data().label);e>=0&&(["value","abstract","plus"].forEach((i,n)=>{this.optionAnalyzeCharts.series[n].data[e]=t.payload.doc.data()[i]?t.payload.doc.data()[i]:0}),this.optionAnalyzeCharts.series[3].data[e]=t.payload.doc.data().value-(t.payload.doc.data().abstract?t.payload.doc.data().abstract:0)+(t.payload.doc.data().plus?t.payload.doc.data().plus:0)),console.log(e),this.stateData.analyze={series:this.optionAnalyzeCharts.series,xAxis:this.optionAnalyzeCharts.xAxis}})}),this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).valueChanges().subscribe(t=>{this.totalFeed=t.value})})}initChart(){this.optionDataCharts={tooltip:{trigger:"axis",formatter:function(t){let e={};t.forEach(t=>{t.seriesName in e||(e[t.seriesName]='<p><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:'+t.color+'"></span>'+t.seriesName+" : "+t.data.value[1]+"<br/></p>")});let i="<p>"+o(t[0].value[0]).format("HH:mm YYYY-MM-DD")+"</p>";for(let n in e)i+=e[n];return i}},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},saveAsImage:{pixelRatio:2}}},color:["#000000"],title:{text:this.translate.instant("DEVICE_MOD.ALBUM"),padding:0,left:"center",textStyle:{fontFamily:"averta",fontSize:17,fontWeight:600}},grid:{left:"0%",right:"12px",bottom:"12%",containLabel:!0},xAxis:{type:"time"},yAxis:{type:"value",boundaryGap:[0,"100%"],splitLine:{show:!1},show:!0,position:"left",offset:0},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:10,type:"inside",handleIcon:"M512 512m-208 0a6.5 6.5 0 1 0 416 0 6.5 6.5 0 1 0-416 0Z M512 192C335.264 192 192 335.264 192 512c0 176.736 143.264 320 320 320s320-143.264 320-320C832 335.264 688.736 192 512 192zM512 800c-159.072 0-288-128.928-288-288 0-159.072 128.928-288 288-288s288 128.928 288 288C800 671.072 671.072 800 512 800z",handleSize:"100%",handleStyle:{color:"#fff",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2}}],series:[{name:this.translate.instant("FARM_MOD.TOTAL_FEED"),type:"line",smooth:!0,symbol:"none",data:[],areaStyle:{},itemStyle:{color:1==this.isColor(this.infor.ui.color.substring(1))?this.infor.ui.color:"#244988"}}]},this.stateData.data=this.optionDataCharts,this.optionAnalyzeCharts={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},toolbox:{feature:{dataZoom:{yAxisIndex:"none"}}},dataZoom:[{type:"inside",start:0,end:10},{start:0,end:10}],grid:{bottom:"20%"},title:{text:this.translate.instant("ANALYTICS"),padding:0,left:"center",textStyle:{fontFamily:"averta",fontSize:17,fontWeight:600}},legend:{bottom:"10%"},yAxis:[{type:"value"},{type:"value",show:!1}],xAxis:{type:"category",data:[]},series:[{name:this.translate.instant("DEVICE_MOD.INPUT"),type:"bar",stack:"total",emphasis:{focus:"series"},data:[]},{name:this.translate.instant("DEVICE_MOD.CLEAR"),type:"bar",stack:"total",emphasis:{focus:"series"},data:[]},{name:this.translate.instant("DEVICE_MOD.ADD"),type:"bar",stack:"total",emphasis:{focus:"series"},data:[]},{name:this.translate.instant("WAREHOUSE_MOD.TOTAL"),type:"line",label:{show:!0},yAxisIndex:1,data:[]}]},this.stateData.analyze=this.optionAnalyzeCharts}isColor(t){return"string"==typeof t&&6===t.length&&!isNaN(Number("0x"+t))}ionViewDidEnter(){this.show=!0}close(){this.modalController.dismiss()}presentPopoverMenu(t){return(0,n.mG)(this,void 0,void 0,function*(){const e=yield this.popoverController.create({component:T,cssClass:"my-custom-class",event:t,translucent:!0});yield e.present();const{data:i}=yield e.onDidDismiss();null!=i&&("remove"==i&&this.presentRemoveData(),"update"==i&&this.presentUpdateData())})}presentUpdateData(){return(0,n.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:l.N,componentProps:{infor:this.infor,deviceId:this.id}});return t.onDidDismiss().then(t=>{}),yield t.present()})}asyncData(t){this.loading.setPending(!0),this.iotService.asyncData(this.infor.peripheral_id,this.id,t).subscribe(t=>{t.status?this.toastService.success("\u0110\xe3 \u0111\u1ed3ng b\u1ed9"):this.toastService.warning("\u0110\u1ed3ng b\u1ed9 th\u1ea5t b\u1ea1i"),this.loading.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loading.setResult(!1)})}presentRemoveData(){return(0,n.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("POND_MOD.CAREFUL"),message:this.translate.instant("POND_MOD.CONFIRM_DELETE"),inputs:[{name:"confirmInput",type:"text",placeholder:this.translate.instant("POND_MOD.ENTER")+' "OK"'}],buttons:[{text:this.translate.instant("NO"),role:"cancel",cssClass:"secondary"},{text:this.translate.instant("POND_MOD.DELETE"),cssClass:"secondary",handler:t=>{"OK"===t.confirmInput&&this.removeData()}}]})).present()})}removeData(){this.loading.setPending(!0),this.iotService.removeDataFeed(this.infor.peripheral_id,this.id,{mode:2}).subscribe(t=>{t.status?(this.toastService.success("\u0110\xe3 x\xf3a d\u1eef li\u1ec7u"),this.modalController.dismiss()):this.toastService.warning("X\xf3a th\u1ea5t b\u1ea1i"),this.loading.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loading.setResult(!1)})}presentAlertAsync(){return(0,n.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.CHOOSE_TIME"),inputs:[{name:"day",type:"date",value:o().format("YYYY-MM-DD")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.asyncData({mode:1,date:t.day})}}]})).present()})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(d.IN),c.Y36(u.sK),c.Y36(h.ST),c.Y36(d.Dh),c.Y36(a.d),c.Y36(g.k),c.Y36(d.Br))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-feed-peripherals"]],inputs:{infor:"infor",id:"id"},decls:26,vars:12,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["slot","icon-only","name","refresh-outline"],["slot","icon-only","ios","ellipsis-vertical","md","ellipsis-vertical"],["type","indeterminate",4,"ngIf"],[1,"ion-padding"],["lines","none"],["slot","end","color","success"],["style","margin-top: 12px;","echarts","",3,"options","merge",4,"ngIf"],[1,"ion-margin-top"],[4,"ngFor","ngForOf"],["type","indeterminate"],["echarts","",2,"margin-top","12px",3,"options","merge"]],template:function(t,e){1&t&&(c.TgZ(0,"ion-header"),c.TgZ(1,"ion-toolbar"),c.TgZ(2,"ion-title"),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.TgZ(5,"ion-buttons",0),c.TgZ(6,"ion-button",1),c.NdJ("click",function(){return e.close()}),c._UZ(7,"ion-icon",2),c.qZA(),c.qZA(),c.TgZ(8,"ion-buttons",3),c.TgZ(9,"ion-button",1),c.NdJ("click",function(){return e.presentAlertAsync()}),c._UZ(10,"ion-icon",4),c.qZA(),c.qZA(),c.TgZ(11,"ion-buttons",3),c.TgZ(12,"ion-button",1),c.NdJ("click",function(t){return e.presentPopoverMenu(t)}),c._UZ(13,"ion-icon",5),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.YNc(14,f,1,0,"ion-progress-bar",6),c.TgZ(15,"ion-content",7),c.TgZ(16,"ion-item",8),c.TgZ(17,"ion-text"),c._uU(18),c.ALo(19,"translate"),c.qZA(),c.TgZ(20,"ion-text",9),c._uU(21),c.ALo(22,"number"),c.qZA(),c.qZA(),c.YNc(23,v,1,2,"div",10),c.TgZ(24,"ion-list",11),c.YNc(25,_,5,2,"ion-item",12),c.qZA(),c.qZA()),2&t&&(c.xp6(3),c.Oqu(c.lcZ(4,6,"DEVICE_MOD.SETTING_FEED")),c.xp6(11),c.Q6J("ngIf",e.loading.pending),c.xp6(4),c.Oqu(c.lcZ(19,8,"FARM_MOD.TOTAL_FEED")),c.xp6(3),c.hij("",c.lcZ(22,10,e.totalFeed)," kg"),c.xp6(2),c.Q6J("ngIf",e.show),c.xp6(2),c.Q6J("ngForOf",e.listData))},directives:[d.Gu,d.sr,d.wd,d.Sm,d.YG,d.gu,p.O5,d.W2,d.Ie,d.yW,d.q_,p.sg,d.X7,m._w,d.Q$],pipes:[u.X$,p.JJ],styles:[""]}),t})(),T=(()=>{class t{constructor(t,e){this.popoverCtrl=t,this.translate=e}ngOnInit(){}chooseMod(t){this.popoverCtrl.dismiss(t)}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(d.Dh),c.Y36(u.sK))},t.\u0275cmp=c.Xpm({type:t,selectors:[["feed-menu"]],decls:9,vars:6,consts:[["lines","none"],["button","",3,"click"],["color","danger"]],template:function(t,e){1&t&&(c.TgZ(0,"ion-list",0),c.TgZ(1,"ion-item",1),c.NdJ("click",function(){return e.chooseMod("remove")}),c.TgZ(2,"ion-text",2),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.qZA(),c.TgZ(5,"ion-item",1),c.NdJ("click",function(){return e.chooseMod("update")}),c.TgZ(6,"ion-text"),c._uU(7),c.ALo(8,"translate"),c.qZA(),c.qZA(),c.qZA()),2&t&&(c.xp6(3),c.hij(" ",c.lcZ(4,2,"DEVICE_MOD.REMOVE_DATA")," "),c.xp6(4),c.hij(" ",c.lcZ(8,4,"DEVICE_MOD.ADDORREMOVE")," "))},directives:[d.q_,d.Ie,d.yW],pipes:[u.X$],styles:[""]}),t})();var D=i(67066),A=i(92640),C=i(53423),E=i(58578),x=i(13619);function q(t,e){1&t&&c._UZ(0,"ion-progress-bar",32)}function O(t,e){1&t&&(c.TgZ(0,"span"),c._uU(1),c.ALo(2,"translate"),c.qZA()),2&t&&(c.xp6(1),c.hij(" ",c.lcZ(2,1,"DEVICE_MOD.IT_OVER")," "))}function I(t,e){if(1&t&&(c.TgZ(0,"span"),c._uU(1),c.ALo(2,"date"),c.qZA()),2&t){const t=c.oxw();c.xp6(1),c.hij(" ",c.xi3(2,1,null==t.stateDevice||null==t.stateDevice.infor?null:t.stateDevice.infor.finish,"HH:mm")," ")}}function y(t,e){1&t&&c._UZ(0,"ion-spinner",33)}function S(t,e){1&t&&c._UZ(0,"ion-spinner",33)}function b(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"ion-item-sliding"),c.TgZ(1,"ion-item"),c.TgZ(2,"ion-label",45),c.TgZ(3,"p"),c.TgZ(4,"b"),c.TgZ(5,"small"),c._uU(6),c.ALo(7,"translate"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(8,"ion-text",46),c._uU(9),c.ALo(10,"translate"),c.ALo(11,"translate"),c.qZA(),c.qZA(),c.TgZ(12,"ion-button",43),c.NdJ("click",function(){const e=c.CHM(t).index;return c.oxw(4).changeStatusTimer(e)}),c._UZ(13,"ion-icon",47),c.qZA(),c.qZA(),c.TgZ(14,"ion-item-options",48),c.TgZ(15,"ion-item-option",34),c.NdJ("click",function(){const e=c.CHM(t),i=e.index,n=e.$implicit,o=c.oxw(3).$implicit;return c.oxw().editTimer(i,n,o.value)}),c._UZ(16,"ion-icon",49),c.qZA(),c.TgZ(17,"ion-item-option",50),c.NdJ("click",function(){const e=c.CHM(t),i=e.index,n=e.$implicit;return c.oxw(4).presentRemoveTimer(i,n)}),c._UZ(18,"ion-icon",51),c.qZA(),c.qZA(),c.qZA()}if(2&t){const t=e.$implicit,i=e.index;c.xp6(6),c.AsE("",c.lcZ(7,8,"POND_MOD.REPAST")," ",i+1,""),c.xp6(2),c.Q6J("color",0==t.enable?"dark":"success"),c.xp6(1),c.HOy(" ",c.lcZ(10,10,"DEVICE_MOD.FROM")," ",t.start," ",c.lcZ(11,12,"DEVICE_MOD.TO")," ",t.end," "),c.xp6(4),c.Q6J("color",0==t.enable?"dark":"success")}}function M(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"div"),c.YNc(1,b,19,14,"ion-item-sliding",41),c.TgZ(2,"ion-item",13),c.TgZ(3,"ion-button",42),c.NdJ("click",function(){return c.CHM(t),c.oxw(3).presentQuickAdd()}),c._uU(4),c.ALo(5,"translate"),c.qZA(),c.TgZ(6,"ion-button",43),c.NdJ("click",function(){c.CHM(t);const e=c.oxw(2).$implicit;return c.oxw().addTimer(e.value)}),c._UZ(7,"ion-icon",44),c.qZA(),c.qZA(),c.qZA()}if(2&t){const t=c.oxw(3);c.xp6(1),c.Q6J("ngForOf",t.listTimer),c.xp6(3),c.hij(" ",c.lcZ(5,2,"DEVICE_MOD.QUICK_ADD")," ")}}function N(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"div"),c.TgZ(1,"ion-card-header",34),c.NdJ("click",function(){c.CHM(t);const e=c.oxw().$implicit;return c.oxw().presentFeedPeripherals(e.value)}),c.TgZ(2,"ion-card-subtitle"),c._UZ(3,"ion-icon",35),c._uU(4),c._UZ(5,"ion-icon",36),c.qZA(),c.qZA(),c.TgZ(6,"ion-card-content",37),c.TgZ(7,"div",38),c.NdJ("click",function(){c.CHM(t);const e=c.oxw().$implicit;return c.oxw().presentFeedPeripherals(e.value)}),c._UZ(8,"div",12),c.YNc(9,S,1,0,"ion-spinner",30),c.qZA(),c.TgZ(10,"ion-list",39),c.TgZ(11,"ion-item"),c.TgZ(12,"ion-label",39),c.TgZ(13,"h3"),c._uU(14),c.ALo(15,"translate"),c.qZA(),c.qZA(),c.TgZ(16,"ion-toggle",40),c.NdJ("click",function(e){return c.CHM(t),c.oxw(2).updateAutomatic(e)}),c.qZA(),c.qZA(),c.YNc(17,M,8,4,"div",18),c.qZA(),c.qZA(),c.qZA()}if(2&t){const t=c.oxw().$implicit,e=c.oxw();c.xp6(4),c.hij(" ",t.value.ui.label," "),c.xp6(4),c.Q6J("options",e.optionTotalFeed),c.xp6(1),c.Q6J("ngIf",e.loadingTimer.pending),c.xp6(5),c.AsE("",c.lcZ(15,7,"DEVICE_MOD.AUTOMATIC")," ",null==e.stateDevice||null==e.stateDevice.config?null:e.stateDevice.config.run_mode,""),c.xp6(2),c.Q6J("checked",1==e.stateDevice.config.run_mode),c.xp6(1),c.Q6J("ngIf",1==e.stateDevice.config.run_mode)}}function Y(t,e){if(1&t&&(c.TgZ(0,"ion-card",7),c.YNc(1,N,18,9,"div",18),c.qZA()),2&t){const t=e.$implicit;c.xp6(1),c.Q6J("ngIf","feed"==t.value.type)}}let U=(()=>{class t{constructor(t,e,i,n,o,a,r,l){this.translate=t,this.route=e,this.iotService=i,this.toastService=n,this.afs=o,this.alertController=a,this.modalController=r,this.pickerCtroller=l,this.loading=new s.E,this.loadingTimer=new s.E,this.loadingDashboard=new s.E,this.stateDevice={status:!1,infor:null,config:null,feedToday:0},this.listTimer=[]}ngOnInit(){return(0,n.mG)(this,void 0,void 0,function*(){this.id=this.route.snapshot.paramMap.get("device_id"),yield this.getDevice()})}loadMoreLogs(t){}presentSetting(){}getDevice(){return(0,n.mG)(this,void 0,void 0,function*(){this.loading.setPending(!0);const t=yield this.iotService.getInforDevice(this.id).catch(()=>{this.loading.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});t&&t.status?this.device=t.data:t&&!t.status&&this.toastService.warning(t.errors.description);const e=yield this.iotService.get(this.id).catch(t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});e&&1==e.status?(this.device.infor=e.data,this.loadState(),this.loadTimer(),this.getFeedToday()):e&&0==e.status&&this.toastService.warning(e.error),console.log(this.device),this.loading.setResult(!1)})}loadState(){this.afs.collection("feeding").doc(this.id).valueChanges().subscribe(t=>{var e,i,n,o;this.stateDevice.status=t.online,this.stateDevice.infor=t.info,this.stateDevice.config=t.config,this.stateDevice.infor.finish=new Date((new Date).getTime()+ +t.info.rem_rotation_time/+(null===(e=t.config)||void 0===e?void 0:e.time_on)*Math.pow(60,+t.config.unit_time_on)*(+t.config.time_on*Math.pow(60,+(null===(i=t.config)||void 0===i?void 0:i.unit_time_on))+t.config.time_off*Math.pow(60,+t.config.unit_time_off))*1e3).getTime(),console.log(t.info.rem_rotation_time/((+(null===(n=t.config)||void 0===n?void 0:n.unit_rotation_time)+10)/10)),this.setChartFeed((t.info.rem_rotation_time/((+(null===(o=t.config)||void 0===o?void 0:o.unit_rotation_time)+10)/10)).toFixed(0),50)}),this.stateDevice.peripherals={},this.afs.collection("feeding").doc(this.id).collection("peripherals").get().subscribe(t=>{t.forEach(t=>{this.stateDevice.peripherals[t.data().type]=t.data(),this.stateDevice.peripherals[t.data().type].id=t.id,this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(t.id).valueChanges().subscribe(e=>{this.stateDevice.peripherals[t.data().type].value=e.value,"feed"==t.data().type?this.setChartFeedTotal(e.value,e.ui.max):this.setMotor(t.data().type,e.value,e.ui.max)})})})}actionCommand(t){let e={command:13!=+this.stateDevice.infor.lcd_page_number&&30!=+this.stateDevice.infor.lcd_page_number&&"PAGE_STOP"!=this.stateDevice.infor.lcd_page_number?"feed_stop":"feed_start"};this.loading.setPending(!0),this.iotService.commandFeeding(this.id,e).subscribe(e=>{e.status?this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")):(this.toastService.warning(this.translate.instant("WAREHOUSE_MOD.ERROR_HANDLE")),t.target.checked=13==this.stateDevice.infor.lcd_page_number),this.loading.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loading.setResult(!1)})}presentAlertCommand(){return(0,n.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("CONFIRM"),message:this.translate.instant("DEVICE_MOD.CONFIRM_COMMAND_FEED")+this.translate.instant(13!=this.stateDevice.infor.lcd_page_number&&30!=this.stateDevice.infor.lcd_page_number?"DEVICE_MOD.OFF":"DEVICE_MOD.ON"),buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"Ok",handler:()=>{}}]})).present()})}setMotor(t,e,i){this.stateDevice.peripherals[t].value=e,this.stateDevice.peripherals[t].ui.max=i}setChartFeedTotal(t,e){this.optionTotalFeed={grid:{left:0,top:0,right:0,bottom:0},series:[{type:"gauge",startAngle:180,endAngle:0,min:0,max:e,radius:"100%",splitNumber:12,itemStyle:{color:"#fcba03",shadowColor:"rgb(252 186 3 / 34%)",shadowBlur:10,shadowOffsetX:2,shadowOffsetY:2},progress:{show:!0,roundCap:!0,width:10},pointer:{icon:"path://M2090.36389,615.30999 L2090.36389,615.30999 C2091.48372,615.30999 2092.40383,616.194028 2092.44859,617.312956 L2096.90698,728.755929 C2097.05155,732.369577 2094.2393,735.416212 2090.62566,735.56078 C2090.53845,735.564269 2090.45117,735.566014 2090.36389,735.566014 L2090.36389,735.566014 C2086.74736,735.566014 2083.81557,732.63423 2083.81557,729.017692 C2083.81557,728.930412 2083.81732,728.84314 2083.82081,728.755929 L2088.2792,617.312956 C2088.32396,616.194028 2089.24407,615.30999 2090.36389,615.30999 Z",length:"65%",width:12,offsetCenter:[0,"5%"]},axisLine:{roundCap:!0,lineStyle:{width:10}},axisTick:{splitNumber:5,lineStyle:{width:1,color:"#999"}},splitLine:{length:12,lineStyle:{width:3,color:"#999"}},axisLabel:{distance:30,color:"#999",fontSize:20,show:!1},title:{show:!1},detail:{width:"60%",lineHeight:40,height:40,borderRadius:8,offsetCenter:[0,"35%"],valueAnimation:!0,formatter:function(t){return"{value|"+t.toFixed(0)+"}{unit|kg}"},rich:{value:{fontSize:50,fontWeight:"bolder",color:"#fcba03"},unit:{fontSize:20,color:"#fcba03",padding:[0,0,-20,10]}}},data:[{value:t}]}]}}setChartFeed(t,e){const i=["path://M.54.5l267,3465.35.93,12,.17.23,796.48,1110.65H2636.26l755.49-1110.65,5.29-7.77.37-4.5L3681.35.5ZM3322.9,3407.65h-8.25l-39.59,58.2-8.35,12.27-669,983.49H1123.07L417.78,3478.12l-8.8-12.27-41.74-58.2h-4L109.7,117.1H3592.52Z","path://M3483.36.5,3348.55,1645.78,3213.74,3291.05h-8.25l-19.8,29.1-19.79,29.1-4.18,6.14-4.17,6.13-334.5,491.75L2488.55,4345H1013.91L661.26,3853.27,308.62,3361.52l-4.4-6.13-4.4-6.14L279,3320.15l-20.87-29.1h-4L127.31,1645.78.54.5H3483.36Z"];this.optionFeed={tooltip:{show:!1},legend:{data:["typeA"],selectedMode:"single"},xAxis:{data:["C\xf2n"],axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!1}},yAxis:{max:e,show:!1,offset:0,splitLine:{show:!1}},grid:{top:"5%",bottom:"10%"},markLine:{z:-100},series:[{name:"C\xf2n l\u1ea1i",type:"pictorialBar",symbolClip:!0,symbolBoundingData:e,label:{show:!0,position:"top",offset:[0,50],formatter:function(t){return t.value.toFixed(0)+"kg"},fontSize:25,textBorderColor:"#fff"},data:[{value:+t,symbol:i[1]}],z:0,itemStyle:{color:"#f1d506"}},{name:"T\u1ed5ng",type:"pictorialBar",symbolBoundingData:e,animationDuration:0,itemStyle:{color:"#3b4da1"},data:[{value:1,symbol:i[0]}],z:1}]}}calculateColor(t){return{color:t}}loadTimer(){let t=this.device.peripherals.findIndex(t=>"feed"===t.peripheral_type);t<0||(this.listTimer=this.device.peripherals[t].timers)}changeMotor(t,e){let i=this.device.peripherals.findIndex(e=>e.firestore_id===this.stateDevice.peripherals[t].id);if(i<0)return;let n=this.device.peripherals[i].id,o={value:e.detail.value};this.loading.setPending(!0),this.iotService.changeStatusContactor(o,n,this.id).subscribe(t=>{t.status?this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")):this.toastService.warning(this.translate.instant("WAREHOUSE_MOD.ERROR_HANDLE")),this.loading.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loading.setResult(!1)})}presentAlertSetting(){return(0,n.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"C\xe0i \u0111\u1eb7t",inputs:[{name:"name",type:"text",placeholder:"T\xean m\xe1y",value:this.device.infor.name?this.device.infor.name:""}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:()=>{console.log("Confirm Ok")}}]})).present()})}openPickerTime(t,e){return(0,n.mG)(this,void 0,void 0,function*(){let i=Object.keys(Array.from({length:99},(t,e)=>e+1)).map(t=>({text:parseInt(t)+1,value:parseInt(t)+1}));yield(yield this.pickerCtroller.create({buttons:[{text:"Ok",handler:e=>{let i=this.stateDevice.config;"on"==t?i.time_on=e.times.value:i.time_off=e.times.value,this.updateSetting(i)}}],cssClass:"pickerModal",columns:[{name:"times",selectedIndex:e-1,options:i}]})).present()})}updateSetting(t){return(0,n.mG)(this,void 0,void 0,function*(){this.loadingDashboard.setPending(!0);const e=yield this.iotService.updateSetting(this.id,t).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loadingDashboard.setResult(!1)});e&&1==e.status?(this.toastService.success("C\u1eadp nh\u1eadt th\xe0nh c\xf4ng"),this.loadingDashboard.setResult(!0)):this.loadingDashboard.setResult(!1)})}changeStatusTimer(t){let e=this.device.peripherals.find(t=>"feed"===t.peripheral_type);if(!e)return;let i={start:this.listTimer[t].start,end:this.listTimer[t].end,date_start:this.listTimer[t].date_start,date_end:this.listTimer[t].date_end,enable:0==this.listTimer[t].enable?1:0};this.loadingTimer.setPending(!0),this.iotService.updateTimerFeed(this.listTimer[t].id,e.id,this.id,i).subscribe(e=>{e.status?(this.loadingTimer.setResult(!0),this.listTimer[t].enable=i.enable,this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS"))):(this.loadingTimer.setResult(!0),this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")))},()=>{this.loadingTimer.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}editTimer(t,e,i){return(0,n.mG)(this,void 0,void 0,function*(){let n=this.device.peripherals.findIndex(t=>t.firestore_id===i.id);if(n<0)return;i.peripheral_id=this.device.peripherals[n].id;const o=yield this.modalController.create({component:E.J,componentProps:{id:this.id,infor:i,data:e}});return o.onDidDismiss().then(e=>{e.data&&(this.listTimer[t]=e.data)}),yield o.present()})}addTimer(t){return(0,n.mG)(this,void 0,void 0,function*(){let e=this.device.peripherals.findIndex(e=>e.firestore_id===t.id);if(e<0)return;t.peripheral_id=this.device.peripherals[e].id;const i=yield this.modalController.create({component:C.g,componentProps:{id:this.id,infor:t}});return i.onDidDismiss().then(t=>{t.data&&this.listTimer.push(t.data)}),yield i.present()})}removeTimer(t,e){let i=this.device.peripherals.findIndex(t=>"feed"===t.peripheral_type);i<0||(this.loadingTimer.setPending(!0),this.iotService.removeTimer(e.id,this.device.peripherals[i].id,this.id).subscribe(e=>{e.status?(this.toastService.success("X\xf3a th\xe0nh c\xf4ng"),this.listTimer.splice(t,1)):this.toastService.warning("X\xf3a kh\xf4ng th\xe0nh c\xf4ng"),this.loadingTimer.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loadingTimer.setResult(!1)}))}presentRemoveTimer(t,e){return(0,n.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("CONFIRM"),message:"X\xf3a l\u1ecbch h\u1eb9n gi\u1edd n\xe0y?",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"Okay",handler:()=>{this.removeTimer(t,e)}}]})).present()})}presentFeedPeripherals(t){return(0,n.mG)(this,void 0,void 0,function*(){let e=this.device.peripherals.findIndex(e=>e.firestore_id===t.id);return e<0?void 0:(t.peripheral_id=this.device.peripherals[e].id,t.name=this.device.name,yield(yield this.modalController.create({component:Z,componentProps:{id:this.id,infor:t}})).present())})}presentFeedSetting(){return(0,n.mG)(this,void 0,void 0,function*(){let t=this.device.peripherals.findIndex(t=>"feed"===t.peripheral_type);return t<0?void 0:(this.stateDevice.config.name=this.device.name,this.stateDevice.config.peripheral_id=this.device.peripherals[t].id,yield(yield this.modalController.create({component:D.o,componentProps:{id:this.id,infor:this.stateDevice.config}})).present())})}presentWifiSetting(){var t,e;return(0,n.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:r.i,componentProps:{id:this.id,type:"feeding",name:null===(e=null===(t=this.device)||void 0===t?void 0:t.infor)||void 0===e?void 0:e.name}})).present()})}presentSuggest(){return(0,n.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:A.V,componentProps:{stateDevice:this.stateDevice,id:this.id}})).present()})}getTimerValue(t,e,i){let n=5,o=Math.abs(t-e),s=(this.stateDevice.config.unit_rotation_time+10)/10,a=i*s*n*60,r=60*o-i*s;0==r&&(r=1);let l=parseInt((a/r).toFixed(0));for(;l>99;)n-=parseInt((l/99).toFixed(0)),a=i*s*n*60,l=parseInt((a/r).toFixed(0));return 1==parseInt(this.stateDevice.config.unit_time_on)&&(l*=60),0==parseInt(this.stateDevice.config.unit_time_off)&&(n=parseInt((n/60).toFixed(0))),l+"_"+n+"_"+this.stateDevice.config.unit_time_on+"_"+this.stateDevice.config.unit_time_off}getFeedToday(){return(0,n.mG)(this,void 0,void 0,function*(){let t=this.device.peripherals.find(t=>"feed"===t.peripheral_type);t&&(console.log(t),yield(yield this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(t.firestore_id).collection("analyze",t=>t.where("label","==",o().format("YYYY-MM-DD")).limit(1)).get()).forEach(t=>(0,n.mG)(this,void 0,void 0,function*(){yield t.forEach(t=>(0,n.mG)(this,void 0,void 0,function*(){this.stateDevice.feedToday=t.data().value-(t.data().abstract?t.data().abstract:0)+(t.data().plus?t.data().plus:0)}))})))})}getSpeechRound(){var t,e,i,n,o,s,a,r,l,c,d,u,h,g;return(3600/((null===(e=null===(t=this.stateDevice)||void 0===t?void 0:t.config)||void 0===e?void 0:e.time_on)*Math.pow(60,null===(n=null===(i=this.stateDevice)||void 0===i?void 0:i.config)||void 0===n?void 0:n.unit_time_on)+(null===(s=null===(o=this.stateDevice)||void 0===o?void 0:o.config)||void 0===s?void 0:s.time_off)*Math.pow(60,null===(r=null===(a=this.stateDevice)||void 0===a?void 0:a.config)||void 0===r?void 0:r.unit_time_off))*((null===(c=null===(l=this.stateDevice)||void 0===l?void 0:l.config)||void 0===c?void 0:c.time_on)*Math.pow(60,null===(u=null===(d=this.stateDevice)||void 0===d?void 0:d.config)||void 0===u?void 0:u.unit_time_on)/((+(null===(g=null===(h=this.stateDevice)||void 0===h?void 0:h.config)||void 0===g?void 0:g.unit_rotation_time)+10)/10))).toFixed(2)}presentQuickAdd(){return(0,n.mG)(this,void 0,void 0,function*(){if(+o().format("H")<8)return;let t=this.device.peripherals.find(t=>"feed"===t.peripheral_type);t&&(yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.QUICK_ADD"),inputs:[{name:"value",type:"number",placeholder:this.translate.instant("DEVICE_MOD.FEED_VALUE"),value:""}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:e=>{this.loadingTimer.setPending(!0),this.iotService.quickAddRepast(t.id,this.id,{value:e.value}).subscribe(t=>{t.status?(this.listTimer=t.data,this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS"))):this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")),this.loadingTimer.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loadingTimer.setResult(!1)})}}]})).present())})}incrementTime(t){this.stateDevice.config[t]=+this.stateDevice.config[t]+1;let e=+this.stateDevice.config[t];setTimeout(()=>{this.stateDevice.config[t]==e&&this.updateSetting(this.stateDevice.config)},700)}decrementTime(t){this.stateDevice.config[t]=+this.stateDevice.config[t]-1;let e=+this.stateDevice.config[t];setTimeout(()=>{this.stateDevice.config[t]==e&&this.updateSetting(this.stateDevice.config)},700)}updateAutomatic(t){return(0,n.mG)(this,void 0,void 0,function*(){let e=this.stateDevice.config;console.log(e.run_mode),e.run_mode=1==+e.run_mode?0:1,this.loadingTimer.setPending(!0);const i=yield this.iotService.updateSetting(this.id,e).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.stateDevice.config.run_mode=1==+e.run_mode?0:1,this.loadingTimer.setResult(!1)});i&&i.status?(this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS")),this.stateDevice.config.run_mode=+e.run_mode,this.loading.setResult(!0)):(this.stateDevice.config.run_mode=1==+e.run_mode?0:1,this.loading.setResult(!1)),this.loadingTimer.setResult(!0),t.target.checked=1==e.run_mode})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(u.sK),c.Y36(x.gz),c.Y36(a.d),c.Y36(g.k),c.Y36(h.ST),c.Y36(d.Br),c.Y36(d.IN),c.Y36(d.up))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-feed-device"]],decls:84,vars:30,consts:[["slot","start"],["defaultHref","tabs/management"],["slot","end"],["color","tb",3,"click"],["slot","icon-only","name","wifi-outline"],["slot","icon-only","name","settings"],["type","indeterminate",4,"ngIf"],["mode","ios"],[2,"display","flex","align-items","center"],["name","ellipse",3,"color"],[3,"innerHTML"],[2,"position","relative","text-align","center"],["echarts","",1,"blockChart",3,"options"],["lines","none"],["slot","start",3,"innerHTML"],["slot","end","mode","ios","color","success",3,"checked","click"],["size","4"],[1,"f-value"],[4,"ngIf"],["size","6",1,"text-center"],["color","danger",1,"ion-justify-content-center","ion-align-items-center",2,"display","flex"],[1,"ion-padding-start","ion-padding-top","ion-padding-end","box-quantity"],[1,"group-input-product"],["aria-label","decrease",3,"disabled","click"],["width","20","height","20","alt","decrease","src","../../../assets/img/icons-remove.svg"],["readonly","","type","number","id","quantity",3,"value"],["aria-label","increase",3,"click"],["width","20","height","20","alt","increase","src","../../../assets/img/icons-add.svg"],["color","success",1,"ion-justify-content-center","ion-align-items-center",2,"display","flex"],[1,"ion-text-center",3,"click"],["mode","ios","class","loadingTimer",4,"ngIf"],["mode","ios",4,"ngFor","ngForOf"],["type","indeterminate"],["mode","ios",1,"loadingTimer"],[3,"click"],["name","cog"],["name","chevron-forward-outline",1,"ion-float-end"],[1,"ion-text-center"],[2,"position","relative",3,"click"],["lines","inset"],["mode","ios","slot","end",3,"checked","click"],[4,"ngFor","ngForOf"],["slot","start","fill","outline",3,"click"],["slot","end","fill","clear",3,"click"],["name","add"],[1,"ion-text-wrap"],["slot","start",3,"color"],["name","power-outline",3,"color"],["side","end"],["name","create"],["color","danger",3,"click"],["name","trash-outline"]],template:function(t,e){1&t&&(c.TgZ(0,"ion-header"),c.TgZ(1,"ion-toolbar"),c.TgZ(2,"ion-buttons",0),c._UZ(3,"ion-back-button",1),c.qZA(),c.TgZ(4,"ion-title"),c._uU(5),c.qZA(),c.TgZ(6,"ion-buttons",2),c.TgZ(7,"ion-button",3),c.NdJ("click",function(){return e.presentWifiSetting()}),c._UZ(8,"ion-icon",4),c.qZA(),c.TgZ(9,"ion-button",3),c.NdJ("click",function(){return e.presentFeedSetting()}),c._UZ(10,"ion-icon",5),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(11,"ion-content"),c.YNc(12,q,1,0,"ion-progress-bar",6),c.TgZ(13,"ion-card",7),c.TgZ(14,"ion-card-content"),c.TgZ(15,"div",8),c.TgZ(16,"ion-buttons"),c.TgZ(17,"ion-button"),c._UZ(18,"ion-icon",9),c.qZA(),c.qZA(),c._UZ(19,"ion-text",10),c.qZA(),c.TgZ(20,"div",11),c._UZ(21,"div",12),c.TgZ(22,"div"),c.TgZ(23,"ion-item",13),c._UZ(24,"ion-text",14),c.TgZ(25,"ion-toggle",15),c.NdJ("click",function(t){return e.actionCommand(t)}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(26,"ion-grid"),c.TgZ(27,"ion-row"),c.TgZ(28,"ion-col",16),c.TgZ(29,"ion-text"),c.TgZ(30,"small"),c._uU(31),c.ALo(32,"translate"),c.qZA(),c.qZA(),c.TgZ(33,"div",17),c._uU(34),c.qZA(),c.qZA(),c.TgZ(35,"ion-col",16),c.TgZ(36,"ion-text"),c.TgZ(37,"small"),c._uU(38),c.ALo(39,"translate"),c.qZA(),c.qZA(),c.TgZ(40,"div",17),c.YNc(41,O,3,3,"span",18),c.YNc(42,I,3,4,"span",18),c.qZA(),c.qZA(),c.TgZ(43,"ion-col",16),c.TgZ(44,"ion-text"),c.TgZ(45,"small"),c._uU(46),c.ALo(47,"translate"),c.qZA(),c.qZA(),c.TgZ(48,"div",17),c._uU(49),c.qZA(),c.qZA(),c.qZA(),c.TgZ(50,"ion-row"),c.TgZ(51,"ion-col",19),c.TgZ(52,"ion-text",20),c._uU(53," OFF ("),c.TgZ(54,"small"),c._uU(55),c.qZA(),c._uU(56,") "),c.qZA(),c.TgZ(57,"div",21),c.TgZ(58,"div",22),c.TgZ(59,"button",23),c.NdJ("click",function(){return e.decrementTime("time_off")}),c._UZ(60,"img",24),c.qZA(),c._UZ(61,"input",25),c.TgZ(62,"button",26),c.NdJ("click",function(){return e.incrementTime("time_off")}),c._UZ(63,"img",27),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(64,"ion-col",19),c.TgZ(65,"ion-text",28),c._uU(66," ON ("),c.TgZ(67,"small"),c._uU(68),c.qZA(),c._uU(69,") "),c.qZA(),c.TgZ(70,"div",21),c.TgZ(71,"div",22),c.TgZ(72,"button",23),c.NdJ("click",function(){return e.decrementTime("time_on")}),c._UZ(73,"img",24),c.qZA(),c._UZ(74,"input",25),c.TgZ(75,"button",26),c.NdJ("click",function(){return e.incrementTime("time_on")}),c._UZ(76,"img",27),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(77,"div",29),c.NdJ("click",function(){return e.presentSuggest()}),c.TgZ(78,"small"),c._uU(79,"G\u1ee3i \xfd th\xf4ng s\u1ed1"),c.qZA(),c.qZA(),c.YNc(80,y,1,0,"ion-spinner",30),c.qZA(),c.qZA(),c.qZA(),c.YNc(81,Y,2,1,"ion-card",31),c.ALo(82,"keyvalue"),c._UZ(83,"ion-card",7),c.qZA()),2&t&&(c.xp6(5),c.Oqu(null==e.device||null==e.device.infor?null:e.device.infor.name),c.xp6(7),c.Q6J("ngIf",e.loading.pending),c.xp6(6),c.Q6J("color",e.stateDevice.status?"success":"medium"),c.xp6(1),c.Q6J("innerHTML",e.stateDevice.status?"Online":"Offline",c.oJD),c.xp6(2),c.Q6J("options",e.optionFeed),c.xp6(3),c.Q6J("innerHTML",e.translate.instant(13!=+(null==e.stateDevice||null==e.stateDevice.infor?null:e.stateDevice.infor.lcd_page_number)&&30!=+(null==e.stateDevice||null==e.stateDevice.infor?null:e.stateDevice.infor.lcd_page_number)&&"PAGE_STOP"!=(null==e.stateDevice||null==e.stateDevice.infor?null:e.stateDevice.infor.lcd_page_number)?"DEVICE_MOD.RUN":"DEVICE_MOD.STOP"),c.oJD),c.xp6(1),c.Q6J("checked",13!=+(null==e.stateDevice||null==e.stateDevice.infor?null:e.stateDevice.infor.lcd_page_number)&&30!=+(null==e.stateDevice||null==e.stateDevice.infor?null:e.stateDevice.infor.lcd_page_number)&&"PAGE_STOP"!=(null==e.stateDevice||null==e.stateDevice.infor?null:e.stateDevice.infor.lcd_page_number)),c.xp6(6),c.hij("",c.lcZ(32,22,"POND_MOD.TODAY"),"(kg)"),c.xp6(3),c.Oqu(e.stateDevice.feedToday),c.xp6(4),c.Oqu(c.lcZ(39,24,"DEVICE_MOD.TIMES_UP")),c.xp6(3),c.Q6J("ngIf",0==(null==e.stateDevice||null==e.stateDevice.infor?null:e.stateDevice.infor.rem_rotation_time)),c.xp6(1),c.Q6J("ngIf",0!=(null==e.stateDevice||null==e.stateDevice.infor?null:e.stateDevice.infor.rem_rotation_time)),c.xp6(4),c.hij("",c.lcZ(47,26,"DEVICE_MOD.SPEED_ROUND"),"(kg/h)"),c.xp6(3),c.hij(" ",e.getSpeechRound()," "),c.xp6(6),c.hij(" ",e.translate.instant(0==(null==e.stateDevice||null==e.stateDevice.config?null:e.stateDevice.config.unit_time_off)?"DEVICE_MOD.SECOND":1==(null==e.stateDevice||null==e.stateDevice.config?null:e.stateDevice.config.unit_time_off)?"FARM_MOD.MINUTE":"POND_MOD.HOUR")," "),c.xp6(4),c.Q6J("disabled",+(null==e.stateDevice||null==e.stateDevice.config?null:e.stateDevice.config.time_off)<=0),c.xp6(2),c.s9C("value",null==e.stateDevice||null==e.stateDevice.config?null:e.stateDevice.config.time_off),c.xp6(7),c.hij(" ",e.translate.instant(0==(null==e.stateDevice||null==e.stateDevice.config?null:e.stateDevice.config.unit_time_on)?"DEVICE_MOD.SECOND":1==(null==e.stateDevice||null==e.stateDevice.config?null:e.stateDevice.config.unit_time_on)?"FARM_MOD.MINUTE":"POND_MOD.HOUR")," "),c.xp6(4),c.Q6J("disabled",+(null==e.stateDevice||null==e.stateDevice.config?null:e.stateDevice.config.time_on)<=0),c.xp6(2),c.s9C("value",null==e.stateDevice||null==e.stateDevice.config?null:e.stateDevice.config.time_on),c.xp6(6),c.Q6J("ngIf",e.loadingDashboard.pending),c.xp6(1),c.Q6J("ngForOf",c.lcZ(82,28,null==e.stateDevice?null:e.stateDevice.peripherals)))},directives:[d.Gu,d.sr,d.Sm,d.oU,d.cs,d.wd,d.YG,d.gu,d.W2,p.O5,d.PM,d.FN,d.yW,m._w,d.Ie,d.ho,d.w,d.jY,d.Nd,d.wI,p.sg,d.X7,d.PQ,d.Zi,d.tO,d.q_,d.Q$,d.td,d.IK,d.u8],pipes:[u.X$,p.Nd,p.uU],styles:[".btnAction[_ngcontent-%COMP%]{--padding-start: 1.5em;--padding-end: 1.5em}.startIcon[_ngcontent-%COMP%]{margin-right:5px}.f-value[_ngcontent-%COMP%]{font-size:2em}.blockAction[_ngcontent-%COMP%]{border-radius:12px;text-align:center;padding:5px}.turnOn[_ngcontent-%COMP%]{color:#3dcb2e;border-color:#3dcb2e}.turnOff[_ngcontent-%COMP%]{color:#f04141;border-color:#f04141}.suggestAi[_ngcontent-%COMP%]{color:#3dc2ff;border-color:#3dc2ff}.iconLarge[_ngcontent-%COMP%]{font-size:50px}.loadingTimer[_ngcontent-%COMP%]{position:absolute;z-index:1;bottom:20px;margin:0 auto}ion-ripple-effect[_ngcontent-%COMP%]{border-radius:12px;text-align:center;margin:6px}.blockChart[_ngcontent-%COMP%]{max-height:230px}.f-value[_ngcontent-%COMP%]{font-size:1em;font-family:Atomic}.group-input-product[_ngcontent-%COMP%]{display:flex;align-items:center}.group-input-product[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{border-right:none;border-radius:4px 0 0 4px;padding:4px}.group-input-product[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .group-input-product[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:30px;color:#242424;font-size:14px;text-align:center;outline:none;transition:border-color .15s ease-in-out 0s,box-shadow .15s ease-in-out 0s}.group-input-product[_ngcontent-%COMP%]   .group-input-product[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer;width:30px;background-color:#fff;border:1px solid #ececec}.group-input-product[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:40px;border:1px solid #ececec}.group-input-product[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{border-left:none;border-radius:0 4px 4px 0;padding:4px}.box-quantity[_ngcontent-%COMP%]{display:flex;justify-content:space-between}"]}),t})()},67066:function(t,e,i){i.d(e,{o:function(){return _}});var n=i(64762),o=i(90665),s=i(16738),a=i(27887),r=i(82629),l=i(37716),c=i(47063),d=i(84465),u=i(81780),h=i(38583);function g(t,e){1&t&&l._UZ(0,"ion-progress-bar",10)}function p(t,e){if(1&t&&(l.TgZ(0,"ion-select-option",18),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("value",e.index),l.xp6(1),l.AsE("",t.time," - ",t.value,"kg")}}function m(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",19),l.TgZ(1,"ion-button",20),l.NdJ("click",function(){return l.CHM(t),l.oxw(2).presentAlertCalibSuggest()}),l._uU(2),l.qZA(),l.qZA()}if(2&t){const t=l.oxw(2);l.xp6(2),l.Oqu(t.unit_rotation_time)}}function f(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",19),l.TgZ(1,"ion-button",21),l.NdJ("click",function(){return l.CHM(t),l.oxw(2).getSuggest()}),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.qZA()}2&t&&(l.xp6(2),l.Oqu(l.lcZ(3,1,"SUGGEST")))}function v(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-card-content",11),l.TgZ(1,"ion-card-subtitle"),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-item",12),l.TgZ(5,"ion-label",13),l._uU(6),l.ALo(7,"translate"),l.qZA(),l.TgZ(8,"ion-select",14),l.NdJ("ionChange",function(){return l.CHM(t),l.oxw().unit_rotation_time=0}),l.YNc(9,p,2,3,"ion-select-option",15),l.qZA(),l.qZA(),l.TgZ(10,"ion-item",12),l.TgZ(11,"ion-label",13),l._uU(12),l.ALo(13,"translate"),l.qZA(),l.TgZ(14,"ion-datetime",16),l.NdJ("ionChange",function(){return l.CHM(t),l.oxw().unit_rotation_time=0}),l.qZA(),l.qZA(),l.YNc(15,m,3,1,"div",17),l.YNc(16,f,4,3,"div",17),l.qZA()}if(2&t){const t=l.oxw();l.Q6J("formGroup",t.formSuggest),l.xp6(2),l.hij("G\u1ee3i \xfd ",l.lcZ(3,7,"DEVICE_MOD.CORRECTION"),""),l.xp6(4),l.Oqu(l.lcZ(7,9,"TRACEABILITY_MOD.START_TIME")),l.xp6(3),l.Q6J("ngForOf",t.listRepast),l.xp6(3),l.Oqu(l.lcZ(13,11,"DEVICE_MOD.END_TIME")),l.xp6(3),l.Q6J("ngIf",t.unit_rotation_time>0),l.xp6(1),l.Q6J("ngIf",0==t.unit_rotation_time)}}let _=(()=>{class t{constructor(t,e,i,n,r){this.modalController=t,this.iotService=e,this.toastService=i,this.translate=n,this.alertController=r,this.loading=new a.E,this.form=new o.cw({run_mode:new o.NI("",o.kI.required),unit_time_on:new o.NI("",o.kI.required),unit_time_off:new o.NI("",o.kI.required),unit_rotation_time:new o.NI("",o.kI.required)}),this.formSuggest=new o.cw({repast:new o.NI("0",o.kI.required),end:new o.NI(s().toISOString(),o.kI.required)}),this.listRepast=[],this.unit_rotation_time=0,this.show=!1}ngOnInit(){console.log(espSmartconfig),this.form.setValue({run_mode:this.infor.run_mode,unit_time_on:this.infor.unit_time_on,unit_time_off:this.infor.unit_time_off,unit_rotation_time:this.infor.unit_rotation_time}),this.getListRepast()}save(){return(0,n.mG)(this,void 0,void 0,function*(){const t={run_mode:this.form.value.run_mode,unit_time_off:this.form.value.unit_time_off,unit_time_on:this.form.value.unit_time_on,unit_rotation_time:this.form.value.unit_rotation_time,time_off:this.infor.time_off,time_on:this.infor.time_on};this.loading.setPending(!0);const e=yield this.iotService.updateSetting(this.id,t).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loading.setResult(!1)});e&&e.status?(this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS")),this.modalController.dismiss(!0),this.loading.setResult(!0)):this.loading.setResult(!1)})}presentAlertName(){return(0,n.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"C\xe0i \u0111\u1eb7t",inputs:[{name:"name",type:"text",placeholder:"T\xean m\xe1y",value:this.infor.name?this.infor.name:""}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.updateName(t.name)}}]})).present()})}updateName(t){this.loading.setPending(!0),this.iotService.updateCommonSetting(this.id,{name:t}).subscribe(e=>{e.status?(this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS")),this.infor.name=t):this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")),this.loading.setResult(!0)},()=>{this.loading.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}updateSetting(t,e){return(0,n.mG)(this,void 0,void 0,function*(){let i=this.infor;i[e]=t,"run_mode"==e&&(i.run_mode=1==+i.run_mode?0:1),this.loading.setPending(!0);const n=yield this.iotService.updateSetting(this.id,i).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loading.setResult(!1)});n&&n.status?(this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS")),this.loading.setResult(!0)):this.loading.setResult(!1)})}presentAlertUnit(t){return(0,n.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.SETTING_UNIT"),inputs:[{name:this.translate.instant("DEVICE_MOD.SECOND"),type:"radio",label:this.translate.instant("DEVICE_MOD.SECOND"),value:0,handler:()=>{console.log("Radio 1 selected")},checked:0==this.infor[t]},{name:this.translate.instant("FARM_MOD.MINUTE"),type:"radio",label:this.translate.instant("FARM_MOD.MINUTE"),value:1,handler:()=>{console.log("Radio 2 selected")},checked:1==this.infor[t]},{name:this.translate.instant("POND_MOD.HOUR"),type:"radio",label:this.translate.instant("POND_MOD.HOUR"),value:2,handler:()=>{console.log("Radio 3 selected")},checked:2==this.infor[t]}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:e=>{this.updateSetting(e,t)}}]})).present()})}presentAlertCalib(){return(0,n.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.CORRECTION"),inputs:[{name:"value",type:"number",value:this.infor.unit_rotation_time}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.updateSetting(t.value,"unit_rotation_time")}}]})).present()})}getListRepast(){this.iotService.getListRepast(this.infor.peripheral_id,this.id).subscribe(t=>{t.status&&(this.listRepast=t.data,this.formSuggest.patchValue({repast:0}),this.show=!0),this.loading.setResult(!0)},()=>{this.loading.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}getSuggest(){this.iotService.getSuggestCalib(this.listRepast[this.formSuggest.value.repast].time,s(this.listRepast[this.formSuggest.value.repast].time).format("YYYY-MM-DD")+" "+s(this.formSuggest.value.end).format("HH:mm:ss"),this.listRepast[this.formSuggest.value.repast].value,this.id).subscribe(t=>{t.status&&(this.unit_rotation_time=t.data.unit_rotation_time),this.loading.setResult(!0)},()=>{this.loading.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}presentAlertCalibSuggest(){return(0,n.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.ADD_SUGGEST"),buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.updateSetting(this.unit_rotation_time,"unit_rotation_time")}}]})).present()})}runSmartConfig(){espSmartconfig.getNetworklist({numLevels:!1},t=>{console.log(t)},t=>{console.log(t)}),espSmartconfig.startConfig("Tepbac.com","00:00:00:00","unicorn2024","NO",1,function(t){console.log(t)},function(t){console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(c.IN),l.Y36(r.d),l.Y36(d.k),l.Y36(u.sK),l.Y36(c.Br))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-feed-setting"]],inputs:{id:"id",infor:"infor"},decls:50,vars:21,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["type","indeterminate",4,"ngIf"],[1,"ion-padding"],["slot","end","mode","ios","fill","clear",3,"click"],["name","create"],["lines","inset"],[3,"innerHTML"],[3,"formGroup",4,"ngIf"],["type","indeterminate"],[3,"formGroup"],["lines","none"],["position","floating"],["mode","ios","formControlName","repast","okText","Okay","cancelText","Dismiss","clearInput","",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["mode","ios","formControlName","end","displayFormat","HH:mm:ss",3,"ionChange"],["class","ion-text-center",4,"ngIf"],[3,"value"],[1,"ion-text-center"],["shape","round","fill","outline","color","success","size","small",3,"click"],["shape","round","size","small",3,"click"]],template:function(t,e){1&t&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.TgZ(5,"ion-buttons",0),l.TgZ(6,"ion-button",1),l.NdJ("click",function(){return e.modalController.dismiss()}),l._UZ(7,"ion-icon",2),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.YNc(8,g,1,0,"ion-progress-bar",3),l.TgZ(9,"ion-content",4),l.TgZ(10,"ion-list"),l.TgZ(11,"ion-item"),l.TgZ(12,"ion-label"),l.TgZ(13,"h3"),l._uU(14),l.ALo(15,"translate"),l.qZA(),l.TgZ(16,"p"),l._uU(17),l.qZA(),l.qZA(),l.TgZ(18,"ion-button",5),l.NdJ("click",function(){return e.presentAlertName()}),l._UZ(19,"ion-icon",6),l.qZA(),l.qZA(),l.TgZ(20,"ion-item",7),l.TgZ(21,"ion-label"),l.TgZ(22,"p"),l.TgZ(23,"small"),l._uU(24),l.ALo(25,"translate"),l.qZA(),l.qZA(),l._UZ(26,"ion-text",8),l.qZA(),l.TgZ(27,"ion-button",5),l.NdJ("click",function(){return e.presentAlertUnit("unit_time_on")}),l._UZ(28,"ion-icon",6),l.qZA(),l.qZA(),l.TgZ(29,"ion-item",7),l.TgZ(30,"ion-label"),l.TgZ(31,"p"),l.TgZ(32,"small"),l._uU(33),l.ALo(34,"translate"),l.qZA(),l.qZA(),l._UZ(35,"ion-text",8),l.qZA(),l.TgZ(36,"ion-button",5),l.NdJ("click",function(){return e.presentAlertUnit("unit_time_off")}),l._UZ(37,"ion-icon",6),l.qZA(),l.qZA(),l.TgZ(38,"ion-item",7),l.TgZ(39,"ion-label"),l.TgZ(40,"p"),l.TgZ(41,"small"),l._uU(42),l.ALo(43,"translate"),l.qZA(),l.qZA(),l.TgZ(44,"ion-text"),l._uU(45),l.qZA(),l.qZA(),l.TgZ(46,"ion-button",5),l.NdJ("click",function(){return e.presentAlertCalib()}),l._UZ(47,"ion-icon",6),l.qZA(),l.qZA(),l.qZA(),l.TgZ(48,"ion-card"),l.YNc(49,v,17,13,"ion-card-content",9),l.qZA(),l.qZA()),2&t&&(l.xp6(3),l.Oqu(l.lcZ(4,11,"DEVICE_MOD.SETTING_FEED")),l.xp6(5),l.Q6J("ngIf",e.loading.pending),l.xp6(6),l.Oqu(l.lcZ(15,13,"DEVICE_MOD.NAME")),l.xp6(3),l.Oqu(e.infor.name),l.xp6(7),l.Oqu(l.lcZ(25,15,"DEVICE_MOD.UNITON")),l.xp6(2),l.Q6J("innerHTML",e.translate.instant(0==e.infor.unit_time_on?"DEVICE_MOD.SECOND":1==e.infor.unit_time_on?"FARM_MOD.MINUTE":"POND_MOD.HOUR"),l.oJD),l.xp6(7),l.Oqu(l.lcZ(34,17,"DEVICE_MOD.UNITOFF")),l.xp6(2),l.Q6J("innerHTML",e.translate.instant(0==e.infor.unit_time_off?"DEVICE_MOD.SECOND":1==e.infor.unit_time_off?"FARM_MOD.MINUTE":"POND_MOD.HOUR"),l.oJD),l.xp6(7),l.Oqu(l.lcZ(43,19,"DEVICE_MOD.CORRECTION")),l.xp6(3),l.Oqu(e.infor.unit_rotation_time),l.xp6(4),l.Q6J("ngIf",e.show))},directives:[c.Gu,c.sr,c.wd,c.Sm,c.YG,c.gu,h.O5,c.W2,c.q_,c.Ie,c.Q$,c.yW,c.PM,c.X7,c.FN,o.JL,o.sg,c.tO,c.t9,c.QI,o.JJ,o.u,h.sg,c.x4,c.n0],pipes:[u.X$],styles:[""]}),t})()},92640:function(t,e,i){i.d(e,{V:function(){return m}});var n=i(64762),o=i(90665),s=i(16738),a=i(27887),r=i(82629),l=i(37716),c=i(47063),d=i(84465),u=i(81780),h=i(38583);function g(t,e){1&t&&l._UZ(0,"ion-progress-bar",16)}function p(t,e){if(1&t&&(l.TgZ(0,"div",13),l.TgZ(1,"ion-button",17),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-button",18),l._uU(5),l.ALo(6,"translate"),l.qZA(),l.qZA()),2&t){const t=l.oxw();l.xp6(2),l.lnq("",l.lcZ(3,6,"DEVICE_MOD.ON")," ",t.result.on," ",t.translate.instant("DEVICE_MOD.SECOND"),""),l.xp6(3),l.lnq("",l.lcZ(6,8,"DEVICE_MOD.OFF")," ",t.result.off," ",t.translate.instant("FARM_MOD.MINUTE"),"")}}let m=(()=>{class t{constructor(t,e,i,n){this.modelController=t,this.toastService=e,this.iotService=i,this.translate=n,this.form=new o.cw({value_kg:new o.NI("",o.kI.required),start:new o.NI(s().format(),o.kI.required),end:new o.NI(s().format(),o.kI.required)}),this.loading=new a.E}ngOnInit(){var t;this.form.patchValue({value_kg:(this.stateDevice.infor.rem_rotation_time/((+(null===(t=this.stateDevice.config)||void 0===t?void 0:t.unit_rotation_time)+10)/10)).toFixed(2)}),console.log(this.stateDevice)}getResult(){let t=this.getTimerValue(this.form.value.start,this.form.value.end,this.form.value.value_kg);t.on<=0||t.off<=0?this.toastService.success(this.translate.instant("DEVICE_MOD.INVALID_NUMBER")):this.result=t}getTimerValue(t,e,i){let n=5,o=s.duration(s(e).diff(s(t))).asMinutes();if(+o<10)return void this.toastService.warning(this.translate.instant("DEVICE_MOD.INVALID_NUMBER"));console.log("minutes: ",o);let a=(+this.stateDevice.config.unit_rotation_time+10)/10;console.log("calibValue: ",a);let r=i*a*n*60,l=60*o-i*a;console.log("numerator: ",r),0==l&&(l=1);let c=parseInt((r/l).toFixed(0));for(console.log("timeOn: ",c);c>99;)n-=1,r=i*a*n*60,c=parseInt((r/l).toFixed(0));for(;c<1;)n+=1,r=i*a*n*60,c=parseInt((r/l).toFixed(0));return{on:c,off:n}}save(){return(0,n.mG)(this,void 0,void 0,function*(){let t=this.stateDevice.config;t.time_on=this.result.on/Math.pow(60,+this.stateDevice.config.unit_time_on),t.time_off=60*this.result.off/Math.pow(60,+this.stateDevice.config.unit_time_off),this.loading.setPending(!0);const e=yield this.iotService.updateSetting(this.id,t).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});e&&1==e.status?(this.toastService.success(this.translate.instant("DEVICE_MOD.SAVE_SUCCESS")),this.modelController.dismiss()):this.toastService.warning(this.translate.instant("DEVICE_MOD.SAVE_UNSUCCESS")),this.loading.setResult(!0)})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(c.IN),l.Y36(d.k),l.Y36(r.d),l.Y36(u.sK))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-feed-suggest"]],inputs:{stateDevice:"stateDevice",id:"id"},decls:37,vars:22,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],[1,"ion-padding"],[3,"formGroup"],["lines","inset"],["position","floating"],["type","number","formControlName","value_kg",3,"ionChange"],["formControlName","start","displayFormat","HH:mm"],["formControlName","end","displayFormat","HH:mm"],[1,"ion-text-center","ion-margin-top"],["shape","round",3,"click"],["class","ion-text-center ion-margin-top",4,"ngIf"],["type","indeterminate"],["shape","round","color","success","fill","outline"],["shape","round","color","danger","fill","outline"]],template:function(t,e){1&t&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.TgZ(5,"ion-buttons",0),l.TgZ(6,"ion-button",1),l.NdJ("click",function(){return e.modelController.dismiss()}),l._UZ(7,"ion-icon",2),l.qZA(),l.qZA(),l.TgZ(8,"ion-buttons",3),l.TgZ(9,"ion-button",4),l.NdJ("click",function(){return e.save()}),l._uU(10),l.ALo(11,"translate"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.YNc(12,g,1,0,"ion-progress-bar",5),l.TgZ(13,"ion-content",6),l.TgZ(14,"div",7),l.TgZ(15,"ion-item",8),l.TgZ(16,"ion-label",9),l._uU(17),l.ALo(18,"translate"),l.qZA(),l.TgZ(19,"ion-input",10),l.NdJ("ionChange",function(){return e.result=null}),l.qZA(),l.qZA(),l.TgZ(20,"ion-item",8),l.TgZ(21,"ion-text",9),l._uU(22),l.ALo(23,"translate"),l.qZA(),l.TgZ(24,"ion-text",3),l._UZ(25,"ion-datetime",11),l.qZA(),l.qZA(),l.TgZ(26,"ion-item",8),l.TgZ(27,"ion-text",9),l._uU(28),l.ALo(29,"translate"),l.qZA(),l.TgZ(30,"ion-text",3),l._UZ(31,"ion-datetime",12),l.qZA(),l.qZA(),l.qZA(),l.TgZ(32,"div",13),l.TgZ(33,"ion-button",14),l.NdJ("click",function(){return e.getResult()}),l._uU(34),l.ALo(35,"translate"),l.qZA(),l.qZA(),l.YNc(36,p,7,10,"div",15),l.qZA()),2&t&&(l.xp6(3),l.Oqu(l.lcZ(4,10,"SUGGEST")),l.xp6(6),l.Q6J("disabled",!e.result),l.xp6(1),l.hij(" ",l.lcZ(11,12,"SAVE")," "),l.xp6(2),l.Q6J("ngIf",e.loading.pending),l.xp6(2),l.Q6J("formGroup",e.form),l.xp6(3),l.hij("",l.lcZ(18,14,"DEVICE_MOD.WEIGHT"),"(kg)"),l.xp6(5),l.Oqu(l.lcZ(23,16,"TRACEABILITY_MOD.START_TIME")),l.xp6(6),l.Oqu(l.lcZ(29,18,"DEVICE_MOD.END_TIME")),l.xp6(6),l.Oqu(l.lcZ(35,20,"DEVICE_MOD.GET_REULT")),l.xp6(2),l.Q6J("ngIf",e.result))},directives:[c.Gu,c.sr,c.wd,c.Sm,c.YG,c.gu,h.O5,c.W2,o.JL,o.sg,c.Ie,c.Q$,c.pK,c.as,o.JJ,o.u,c.yW,c.x4,c.QI,c.X7],pipes:[u.X$],styles:[""]}),t})()},53423:function(t,e,i){i.d(e,{g:function(){return _}});var n=i(64762),o=i(90665),s=i(16738),a=i(27887),r=i(82629),l=i(37716),c=i(81780),d=i(47063),u=i(88459),h=i(84465),g=i(38583);function p(t,e){1&t&&l._UZ(0,"ion-progress-bar",7)}function m(t,e){if(1&t&&(l.TgZ(0,"ion-item",10),l.TgZ(1,"ion-text",11),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-text",3),l._UZ(5,"ion-datetime",22),l.qZA(),l.qZA()),2&t){const t=l.oxw(2);l.xp6(2),l.Oqu(l.lcZ(3,3,"DEVICE_MOD.DAY_START")),l.xp6(3),l.Q6J("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD"))}}function f(t,e){if(1&t&&(l.TgZ(0,"ion-item",10),l.TgZ(1,"ion-text",11),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-text",3),l._UZ(5,"ion-datetime",23),l.qZA(),l.qZA()),2&t){const t=l.oxw(2);l.xp6(2),l.Oqu(l.lcZ(3,3,"DEVICE_MOD.DAY_END")),l.xp6(3),l.Q6J("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD"))}}function v(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-content",8),l.TgZ(1,"div",9),l.TgZ(2,"ion-item",10),l.TgZ(3,"ion-label",11),l._uU(4),l.ALo(5,"translate"),l.qZA(),l.TgZ(6,"ion-input",12),l.NdJ("ionChange",function(){return l.CHM(t),l.oxw().setValidatorValue()}),l.qZA(),l.qZA(),l.TgZ(7,"ion-grid"),l.TgZ(8,"ion-row"),l.TgZ(9,"ion-col",13),l.TgZ(10,"ion-item",10),l.TgZ(11,"ion-label",11),l._uU(12),l.ALo(13,"translate"),l.qZA(),l.TgZ(14,"ion-input",14),l.NdJ("ionFocus",function(){l.CHM(t);const e=l.oxw();return e.focusState.quantity=!0,e.focusState.ratio=!1})("ionChange",function(e){return l.CHM(t),l.oxw().quantityChange(e)}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(15,"ion-col",13),l.TgZ(16,"ion-item",10),l.TgZ(17,"ion-label",11),l._uU(18),l.ALo(19,"translate"),l.qZA(),l.TgZ(20,"ion-input",15),l.NdJ("ionFocus",function(){l.CHM(t);const e=l.oxw();return e.focusState.ratio=!0,e.focusState.quantity=!1})("ionChange",function(e){return l.CHM(t),l.oxw().ratioChange(e)}),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(21,"ion-item",10),l.TgZ(22,"ion-label",11),l._uU(23),l.ALo(24,"translate"),l.qZA(),l.TgZ(25,"ion-select",16),l.TgZ(26,"ion-select-option",17),l._uU(27),l.ALo(28,"translate"),l.qZA(),l.TgZ(29,"ion-select-option",18),l._uU(30),l.ALo(31,"translate"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(32,"ion-item",10),l.TgZ(33,"ion-text",11),l._uU(34),l.ALo(35,"translate"),l.qZA(),l.TgZ(36,"ion-text",3),l._UZ(37,"ion-datetime",19),l.qZA(),l.qZA(),l.TgZ(38,"ion-item",10),l.TgZ(39,"ion-text",11),l._uU(40),l.ALo(41,"translate"),l.qZA(),l.TgZ(42,"ion-text",3),l._UZ(43,"ion-datetime",20),l.qZA(),l.qZA(),l.YNc(44,m,6,5,"ion-item",21),l.YNc(45,f,6,5,"ion-item",21),l.qZA(),l.qZA()}if(2&t){const t=l.oxw();l.xp6(1),l.Q6J("formGroup",t.form),l.xp6(3),l.hij("",l.lcZ(5,11,"FARM_MOD.TOTAL_FEED")," (kg)"),l.xp6(8),l.hij("",l.lcZ(13,13,"WEIGHT"),"(kg)"),l.xp6(6),l.hij("",l.lcZ(19,15,"WEIGHT"),"(%)"),l.xp6(5),l.Oqu(l.lcZ(24,17,"DEVICE_MOD.RUN_MODE")),l.xp6(4),l.Oqu(l.lcZ(28,19,"DEVICE_MOD.SCHEDULE")),l.xp6(3),l.Oqu(l.lcZ(31,21,"DEVICE_MOD.REPEAT")),l.xp6(4),l.Oqu(l.lcZ(35,23,"TRACEABILITY_MOD.START_TIME")),l.xp6(6),l.Oqu(l.lcZ(41,25,"DEVICE_MOD.END_TIME")),l.xp6(4),l.Q6J("ngIf","schedule"==t.form.value.mode),l.xp6(1),l.Q6J("ngIf","schedule"==t.form.value.mode)}}let _=(()=>{class t{constructor(t,e,i,n,r,l){this.translate=t,this.modalController=e,this.afs=i,this.pickerController=n,this.toastService=r,this.iotService=l,this.loading=new a.E,this.form=new o.cw({value_kg:new o.NI("",o.kI.required),value_ratio:new o.NI("",o.kI.required),start:new o.NI(s().format("HH:mm"),o.kI.required),end:new o.NI(s().format("HH:mm"),o.kI.required),start_date:new o.NI(s().format("YYYY-MM-DD")),end_date:new o.NI(s().format("YYYY-MM-DD")),mode:new o.NI("repeat",o.kI.required),totalFeed:new o.NI("repeat",o.kI.required)}),this.totalFeed=0,this.day=7,this.focusState={ratio:!1,quantity:!1},this.show=!1,this.minDate=s(),this.maxDate=s().add(180,"days")}ngOnInit(){return(0,n.mG)(this,void 0,void 0,function*(){yield this.estimateTotalFeed()})}close(){this.modalController.dismiss()}save(){if(!this.checkTime())return void this.toastService.warning(this.translate.instant("DEVICE_MOD.INVALID_TIME"));let t={start:this.form.value.start+":00",end:this.form.value.end+":00",date_start:s(this.form.value.start_date).format("YYYY-MM-DD"),date_end:s(this.form.value.end_date).format("YYYY-MM-DD"),enable:1,value:this.form.value.value_kg};this.loading.setPending(!0),this.iotService.addTimer(this.infor.peripheral_id,this.id,t).subscribe(t=>{t.status?(this.toastService.success(this.translate.instant("SHOP.CART.ADDRESS.ADD_SUCCESS")),this.modalController.dismiss(t.data)):this.toastService.warning(this.translate.instant("DEVICE_MOD.ADD_UNSUCCESFUL")),this.loading.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loading.setResult(!1)})}checkTime(){return!("schedule"==this.form.value.mode&&s(this.form.value.start_date).valueOf()>=s(this.form.value.end_date).valueOf()||s(this.form.value.start).valueOf()>=s(this.form.value.end).valueOf())}estimateTotalFeed(){return(0,n.mG)(this,void 0,void 0,function*(){yield(yield this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("analyze",t=>t.orderBy("label","asc").limit(this.day)).get()).forEach(t=>(0,n.mG)(this,void 0,void 0,function*(){yield t.forEach(t=>(0,n.mG)(this,void 0,void 0,function*(){this.totalFeed+=t.data().value-(t.data().abstract?t.data().abstract:0)+(t.data().plus?t.data().plus:0)})),this.form.patchValue({totalFeed:this.totalFeed}),this.setValidatorValue()}))})}quantityChange(t){let e=t.target.value/this.form.value.totalFeed*100;e>0&&1==this.focusState.quantity&&this.form.patchValue({value_ratio:e.toFixed(0)})}ratioChange(t){let e=this.form.value.totalFeed*t.target.value/100;e>0&&1==this.focusState.ratio&&this.form.patchValue({value_kg:e.toFixed(0)})}setValidatorValue(){this.form.controls.value_ratio.setValue(""),this.form.controls.value_kg.setValue("")}ionViewDidEnter(){this.show=!0}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(c.sK),l.Y36(d.IN),l.Y36(u.ST),l.Y36(d.up),l.Y36(h.k),l.Y36(r.d))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-feed-timer-add"]],inputs:{id:"id",infor:"infor"},decls:14,vars:9,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],["class","ion-padding",4,"ngIf"],["type","indeterminate"],[1,"ion-padding"],[3,"formGroup"],["lines","inset"],["position","floating"],["type","number","formControlName","totalFeed",3,"ionChange"],["size","6"],["type","number","formControlName","value_kg",3,"ionFocus","ionChange"],["type","number","formControlName","value_ratio",3,"ionFocus","ionChange"],["formControlName","mode","okText","Okay","cancelText","Dismiss"],["value","schedule"],["value","repeat"],["formControlName","start","displayFormat","HH:mm"],["formControlName","end","displayFormat","HH:mm"],["lines","inset",4,"ngIf"],["formControlName","start_date","displayFormat","YYYY-MM-DD",3,"min","max"],["formControlName","end_date","displayFormat","YYYY-MM-DD",3,"min","max"]],template:function(t,e){1&t&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.TgZ(5,"ion-buttons",0),l.TgZ(6,"ion-button",1),l.NdJ("click",function(){return e.close()}),l._UZ(7,"ion-icon",2),l.qZA(),l.qZA(),l.TgZ(8,"ion-buttons",3),l.TgZ(9,"ion-button",4),l.NdJ("click",function(){return e.save()}),l._uU(10),l.ALo(11,"translate"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.YNc(12,p,1,0,"ion-progress-bar",5),l.YNc(13,v,46,27,"ion-content",6)),2&t&&(l.xp6(3),l.Oqu(l.lcZ(4,5,"DEVICE_MOD.ADD_REPASS")),l.xp6(6),l.Q6J("disabled",e.form.invalid),l.xp6(1),l.hij(" ",l.lcZ(11,7,"SAVE")," "),l.xp6(2),l.Q6J("ngIf",e.loading.pending),l.xp6(1),l.Q6J("ngIf",e.show))},directives:[d.Gu,d.sr,d.wd,d.Sm,d.YG,d.gu,g.O5,d.X7,d.W2,o.JL,o.sg,d.Ie,d.Q$,d.pK,d.as,o.JJ,o.u,d.jY,d.Nd,d.wI,d.t9,d.QI,d.n0,d.yW,d.x4],pipes:[c.X$],styles:[""]}),t})()},58578:function(t,e,i){i.d(e,{J:function(){return _}});var n=i(64762),o=i(90665),s=i(16738),a=i(27887),r=i(82629),l=i(37716),c=i(81780),d=i(47063),u=i(88459),h=i(84465),g=i(38583);function p(t,e){1&t&&l._UZ(0,"ion-progress-bar",7)}function m(t,e){if(1&t&&(l.TgZ(0,"ion-item",10),l.TgZ(1,"ion-text",11),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-text",3),l._UZ(5,"ion-datetime",22),l.qZA(),l.qZA()),2&t){const t=l.oxw(2);l.xp6(2),l.Oqu(l.lcZ(3,3,"DEVICE_MOD.DAY_START")),l.xp6(3),l.Q6J("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD"))}}function f(t,e){if(1&t&&(l.TgZ(0,"ion-item",10),l.TgZ(1,"ion-text",11),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.TgZ(4,"ion-text",3),l._UZ(5,"ion-datetime",23),l.qZA(),l.qZA()),2&t){const t=l.oxw(2);l.xp6(2),l.Oqu(l.lcZ(3,3,"DEVICE_MOD.DAY_END")),l.xp6(3),l.Q6J("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD"))}}function v(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-content",8),l.TgZ(1,"div",9),l.TgZ(2,"ion-item",10),l.TgZ(3,"ion-label",11),l._uU(4),l.ALo(5,"translate"),l.qZA(),l.TgZ(6,"ion-input",12),l.NdJ("ionChange",function(){return l.CHM(t),l.oxw().setValidatorValue()}),l.qZA(),l.qZA(),l.TgZ(7,"ion-grid"),l.TgZ(8,"ion-row"),l.TgZ(9,"ion-col",13),l.TgZ(10,"ion-item",10),l.TgZ(11,"ion-label",11),l._uU(12),l.ALo(13,"translate"),l.qZA(),l.TgZ(14,"ion-input",14),l.NdJ("ionFocus",function(){l.CHM(t);const e=l.oxw();return e.focusState.quantity=!0,e.focusState.ratio=!1})("ionChange",function(e){return l.CHM(t),l.oxw().quantityChange(e)}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(15,"ion-col",13),l.TgZ(16,"ion-item",10),l.TgZ(17,"ion-label",11),l._uU(18),l.ALo(19,"translate"),l.qZA(),l.TgZ(20,"ion-input",15),l.NdJ("ionFocus",function(){l.CHM(t);const e=l.oxw();return e.focusState.ratio=!0,e.focusState.quantity=!1})("ionChange",function(e){return l.CHM(t),l.oxw().ratioChange(e)}),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(21,"ion-item",10),l.TgZ(22,"ion-label",11),l._uU(23),l.ALo(24,"translate"),l.qZA(),l.TgZ(25,"ion-select",16),l.TgZ(26,"ion-select-option",17),l._uU(27),l.ALo(28,"translate"),l.qZA(),l.TgZ(29,"ion-select-option",18),l._uU(30),l.ALo(31,"translate"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(32,"ion-item",10),l.TgZ(33,"ion-text",11),l._uU(34),l.ALo(35,"translate"),l.qZA(),l.TgZ(36,"ion-text",3),l._UZ(37,"ion-datetime",19),l.qZA(),l.qZA(),l.TgZ(38,"ion-item",10),l.TgZ(39,"ion-text",11),l._uU(40),l.ALo(41,"translate"),l.qZA(),l.TgZ(42,"ion-text",3),l._UZ(43,"ion-datetime",20),l.qZA(),l.qZA(),l.YNc(44,m,6,5,"ion-item",21),l.YNc(45,f,6,5,"ion-item",21),l.qZA(),l.qZA()}if(2&t){const t=l.oxw();l.xp6(1),l.Q6J("formGroup",t.form),l.xp6(3),l.hij("",l.lcZ(5,11,"FARM_MOD.TOTAL_FEED")," (kg)"),l.xp6(8),l.hij("",l.lcZ(13,13,"WEIGHT"),"(kg)"),l.xp6(6),l.hij("",l.lcZ(19,15,"WEIGHT"),"(%)"),l.xp6(5),l.Oqu(l.lcZ(24,17,"DEVICE_MOD.RUN_MODE")),l.xp6(4),l.Oqu(l.lcZ(28,19,"DEVICE_MOD.SCHEDULE")),l.xp6(3),l.Oqu(l.lcZ(31,21,"DEVICE_MOD.REPEAT")),l.xp6(4),l.Oqu(l.lcZ(35,23,"TRACEABILITY_MOD.START_TIME")),l.xp6(6),l.Oqu(l.lcZ(41,25,"DEVICE_MOD.END_TIME")),l.xp6(4),l.Q6J("ngIf","schedule"==t.form.value.mode),l.xp6(1),l.Q6J("ngIf","schedule"==t.form.value.mode)}}let _=(()=>{class t{constructor(t,e,i,n,r,l){this.translate=t,this.modalController=e,this.afs=i,this.pickerController=n,this.toastService=r,this.iotService=l,this.loading=new a.E,this.form=new o.cw({value_kg:new o.NI("",o.kI.required),value_ratio:new o.NI("",o.kI.required),start:new o.NI(s().format("HH:mm"),o.kI.required),end:new o.NI(s().format("HH:mm"),o.kI.required),start_date:new o.NI(s().format("YYYY-MM-DD")),end_date:new o.NI(s().format("YYYY-MM-DD")),mode:new o.NI("repeat",o.kI.required),totalFeed:new o.NI("repeat",o.kI.required)}),this.totalFeed=0,this.day=7,this.focusState={ratio:!1,quantity:!1},this.show=!1,this.minDate=s(),this.maxDate=s().add(180,"days")}ngOnInit(){return(0,n.mG)(this,void 0,void 0,function*(){yield this.estimateTotalFeed(),this.form.setValue({value_kg:this.data.value,value_ratio:(100*this.data.value/this.totalFeed).toFixed(0),start:this.data.start.substring(0,this.data.start.length-3),end:this.data.end.substring(0,this.data.end.length-3),start_date:s(this.data.date_start).format("YYYY-MM-DD"),end_date:s(this.data.date_end).format("YYYY-MM-DD"),mode:this.data.mode,totalFeed:this.totalFeed})})}close(){this.modalController.dismiss()}save(){if(!this.checkTime())return void this.toastService.warning("Th\u1eddi gian kh\xf4ng h\u1ee3p l\u1ec7");let t={start:this.form.value.start+":00",end:this.form.value.end+":00",date_start:s(this.form.value.start_date).format("YYYY-MM-DD"),date_end:s(this.form.value.end_date).format("YYYY-MM-DD"),enable:1,value:this.form.value.value_kg};this.loading.setPending(!0),this.iotService.updateTimerFeed(this.data.id,this.infor.peripheral_id,this.id,t).subscribe(t=>{t.status?(this.toastService.success("C\u1eadp nh\u1eadt th\xe0nh c\xf4ng"),this.modalController.dismiss(t.data)):this.toastService.warning("C\u1eadp nh\u1eadt kh\xf4ng th\xe0nh c\xf4ng"),this.loading.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loading.setResult(!1)})}checkTime(){return!("schedule"==this.form.value.mode&&s(this.form.value.start_date).valueOf()>=s(this.form.value.end_date).valueOf()||s(this.form.value.start).valueOf()>=s(this.form.value.end).valueOf())}estimateTotalFeed(){return(0,n.mG)(this,void 0,void 0,function*(){yield(yield this.afs.collection("feeding").doc(this.id).collection("peripherals").doc(this.infor.id).collection("analyze",t=>t.orderBy("label","asc").limit(this.day)).get()).forEach(t=>(0,n.mG)(this,void 0,void 0,function*(){yield t.forEach(t=>(0,n.mG)(this,void 0,void 0,function*(){this.totalFeed+=t.data().value-(t.data().abstract?t.data().abstract:0)+(t.data().plus?t.data().plus:0)})),this.form.patchValue({totalFeed:this.totalFeed}),this.setValidatorValue()}))})}quantityChange(t){let e=t.target.value/this.form.value.totalFeed*100;e>0&&1==this.focusState.quantity&&this.form.patchValue({value_ratio:e.toFixed(0)})}ratioChange(t){let e=this.form.value.totalFeed*t.target.value/100;e>0&&1==this.focusState.ratio&&this.form.patchValue({value_kg:e.toFixed(0)})}setValidatorValue(){this.form.controls.value_kg.setValue("");let t=this.form.value.totalFeed*this.form.value.value_ratio/100;t>0&&this.form.patchValue({value_kg:t.toFixed(0)})}ionViewDidEnter(){this.show=!0}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(c.sK),l.Y36(d.IN),l.Y36(u.ST),l.Y36(d.up),l.Y36(h.k),l.Y36(r.d))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-feed-timer-edit"]],inputs:{id:"id",infor:"infor",data:"data"},decls:14,vars:9,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],["class","ion-padding",4,"ngIf"],["type","indeterminate"],[1,"ion-padding"],[3,"formGroup"],["lines","inset"],["position","floating"],["type","number","formControlName","totalFeed",3,"ionChange"],["size","6"],["type","number","formControlName","value_kg",3,"ionFocus","ionChange"],["type","number","formControlName","value_ratio",3,"ionFocus","ionChange"],["formControlName","mode","okText","Okay","cancelText","Dismiss"],["value","schedule"],["value","repeat"],["formControlName","start","displayFormat","HH:mm"],["formControlName","end","displayFormat","HH:mm"],["lines","inset",4,"ngIf"],["formControlName","start_date","displayFormat","YYYY-MM-DD",3,"min","max"],["formControlName","end_date","displayFormat","YYYY-MM-DD",3,"min","max"]],template:function(t,e){1&t&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.TgZ(5,"ion-buttons",0),l.TgZ(6,"ion-button",1),l.NdJ("click",function(){return e.close()}),l._UZ(7,"ion-icon",2),l.qZA(),l.qZA(),l.TgZ(8,"ion-buttons",3),l.TgZ(9,"ion-button",4),l.NdJ("click",function(){return e.save()}),l._uU(10),l.ALo(11,"translate"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.YNc(12,p,1,0,"ion-progress-bar",5),l.YNc(13,v,46,27,"ion-content",6)),2&t&&(l.xp6(3),l.hij(" ",l.lcZ(4,5,"DEVICE_MOD.UPDATE_FEED"),""),l.xp6(6),l.Q6J("disabled",e.form.invalid),l.xp6(1),l.hij(" ",l.lcZ(11,7,"SAVE")," "),l.xp6(2),l.Q6J("ngIf",e.loading.pending),l.xp6(1),l.Q6J("ngIf",e.show))},directives:[d.Gu,d.sr,d.wd,d.Sm,d.YG,d.gu,g.O5,d.X7,d.W2,o.JL,o.sg,d.Ie,d.Q$,d.pK,d.as,o.JJ,o.u,d.jY,d.Nd,d.wI,d.t9,d.QI,d.n0,d.yW,d.x4],pipes:[c.X$],styles:[""]}),t})()},31435:function(t,e,i){i.d(e,{N:function(){return p}});var n=i(90665),o=i(16738),s=i(27887),a=i(82629),r=i(37716),l=i(47063),c=i(84465),d=i(81780),u=i(38583);function h(t,e){1&t&&r._UZ(0,"ion-progress-bar",7)}function g(t,e){if(1&t&&(r.TgZ(0,"ion-content",8),r.TgZ(1,"div",9),r.TgZ(2,"ion-item",10),r.TgZ(3,"ion-label",11),r._uU(4),r.ALo(5,"translate"),r.qZA(),r.TgZ(6,"ion-select",12),r.TgZ(7,"ion-select-option",13),r._uU(8),r.ALo(9,"translate"),r.qZA(),r.TgZ(10,"ion-select-option",14),r._uU(11),r.ALo(12,"translate"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(13,"ion-item",10),r.TgZ(14,"ion-text",11),r._uU(15),r.ALo(16,"translate"),r.qZA(),r.TgZ(17,"ion-text",3),r._UZ(18,"ion-datetime",15),r.qZA(),r.qZA(),r.TgZ(19,"ion-item",10),r.TgZ(20,"ion-label",11),r._uU(21),r.ALo(22,"translate"),r.qZA(),r._UZ(23,"ion-input",16),r.qZA(),r.qZA(),r.qZA()),2&t){const t=r.oxw();r.xp6(1),r.Q6J("formGroup",t.form),r.xp6(3),r.Oqu(r.lcZ(5,8,"DEVICE_MOD.ADDORREMOVE")),r.xp6(4),r.Oqu(r.lcZ(9,10,"DEVICE_MOD.ADD")),r.xp6(3),r.Oqu(r.lcZ(12,12,"DEVICE_MOD.CLEAR")),r.xp6(4),r.Oqu(r.lcZ(16,14,"DEVICE_MOD.DAY")),r.xp6(3),r.Q6J("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD")),r.xp6(3),r.hij("",r.lcZ(22,16,"DEVICE_MOD.VALUE")," (kg)")}}let p=(()=>{class t{constructor(t,e,i,a){this.modalController=t,this.toastService=e,this.iotService=i,this.translate=a,this.loading=new s.E,this.form=new n.cw({type:new n.NI("plus_analyze",n.kI.required),date:new n.NI(o().format("YYYY-MM-DD"),n.kI.required),value:new n.NI("",n.kI.required)}),this.show=!1,this.minDate=o().subtract(180,"days"),this.maxDate=o().add(180,"days")}ngOnInit(){}save(){this.loading.setPending(!0),this.iotService[this.form.value.type](this.infor.peripheral_id,this.deviceId,{date:o(this.form.value.date).format("YYYY-MM-DD"),value:this.form.value.value}).subscribe(t=>{t.status?(this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS")),this.modalController.dismiss()):this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")),this.loading.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loading.setResult(!1)})}ionViewDidEnter(){this.show=!0}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(l.IN),r.Y36(c.k),r.Y36(a.d),r.Y36(d.sK))},t.\u0275cmp=r.Xpm({type:t,selectors:[["app-feed-update-data"]],inputs:{deviceId:"deviceId",infor:"infor"},decls:13,vars:6,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],["class","ion-padding",4,"ngIf"],["type","indeterminate"],[1,"ion-padding"],[3,"formGroup"],["lines","inset"],["position","floating"],["formControlName","type","okText","Okay","cancelText","Dismiss"],["value","plus_analyze"],["value","abstract_analyze"],["formControlName","date","displayFormat","YYYY-MM-DD",3,"min","max"],["type","number","formControlName","value"]],template:function(t,e){1&t&&(r.TgZ(0,"ion-header"),r.TgZ(1,"ion-toolbar"),r.TgZ(2,"ion-title"),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"ion-buttons",0),r.TgZ(6,"ion-button",1),r.NdJ("click",function(){return e.modalController.dismiss()}),r._UZ(7,"ion-icon",2),r.qZA(),r.qZA(),r.TgZ(8,"ion-buttons",3),r.TgZ(9,"ion-button",4),r.NdJ("click",function(){return e.save()}),r._uU(10," L\u01b0u "),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.YNc(11,h,1,0,"ion-progress-bar",5),r.YNc(12,g,24,18,"ion-content",6)),2&t&&(r.xp6(3),r.Oqu(r.lcZ(4,4,"DEVICE_MOD.SETTING_FEED")),r.xp6(6),r.Q6J("disabled",e.form.invalid),r.xp6(2),r.Q6J("ngIf",e.loading.pending),r.xp6(1),r.Q6J("ngIf",e.show))},directives:[l.Gu,l.sr,l.wd,l.Sm,l.YG,l.gu,u.O5,l.X7,l.W2,n.JL,n.sg,l.Ie,l.Q$,l.t9,l.QI,n.JJ,n.u,l.n0,l.yW,l.x4,l.pK,l.as],pipes:[d.X$],styles:[""]}),t})()},3520:function(t,e,i){i.d(e,{i:function(){return f}});var n=i(64762),o=i(77203),s=i(99758),a=i(53760),r=i(90665),l=i(37716),c=i(47063),d=i(84465),u=i(81780),h=i(38583);function g(t,e){1&t&&l._UZ(0,"img",11)}function p(t,e){1&t&&l._UZ(0,"img",12)}function m(t,e){1&t&&l._UZ(0,"img",13)}let f=(()=>{class t{constructor(t,e,i,n,o,s,a,l,c){this.modalController=t,this.openNativeSettings=e,this.wifiWizard2=i,this.toastService=n,this.iab=o,this.translate=s,this.loadingScanCtrl=a,this.loadingConfigCtrl=l,this.cd=c,this.form=new r.cw({wifi:new r.NI("",r.kI.required),password:new r.NI("",r.kI.required)}),this.second=30,this.listWifi=[]}ngOnInit(){return(0,n.mG)(this,void 0,void 0,function*(){yield this.loadingScan(),this.wifiWizard2.getConnectedSSID().then(t=>{this.form.patchValue({wifi:t}),this.loadingScanCtrl.dismiss(),this.cd.detectChanges()}).catch(t=>{console.log(t),this.loadingScanCtrl.dismiss(),this.cd.detectChanges()})})}save(){return(0,n.mG)(this,void 0,void 0,function*(){yield this.loadingConfig(),this.wifiWizard2.getConnectedBSSID().then(t=>{this.startConfig(this.form.value.wifi,t,this.form.value.password,"NO",1)}).catch(t=>{this.toastService.warning(this.translate.instant("DEVICE_MOD.OPEN_CONFIG_FAILED")),this.loadingConfigCtrl.dismiss()}),this.interval=setInterval(()=>{this.second-=1,console.log(this.second),0===this.second&&(this.second=30,this.loadingConfigCtrl.dismiss(),this.stopConfig(),clearInterval(this.interval))},1e3)})}startConfig(t,e,i,n,o){let s=this;espSmartconfig.startConfig(t,e,i,n,o,function(t){s.loadingConfigCtrl.dismiss(),s.toastService.success(s.translate.instant("DEVICE_MOD.SAVED_CONFIG")),this.modalController.dismiss()},function(t){s.loadingConfigCtrl.dismiss(),s.toastService.warning(s.translate.instant("DEVICE_MOD.CONFIG_FAILED"))})}stopConfig(){espSmartconfig.stopConfig(function(t){console.log(t)},function(t){console.log(t)})}loadingScan(){return(0,n.mG)(this,void 0,void 0,function*(){const t=yield this.loadingScanCtrl.create({message:this.translate.instant("DEVICE_MOD.SCAN_WIFI"),spinner:"circles",keyboardClose:!0});t.onDidDismiss().then(t=>{console.log("cancel scan")}),t.present().then(t=>{console.log("dang loading")})})}loadingConfig(){return(0,n.mG)(this,void 0,void 0,function*(){const t=yield this.loadingConfigCtrl.create({message:this.translate.instant("DEVICE_MOD.CONFIGURING"),duration:3e4,spinner:"circles",backdropDismiss:!0});t.onDidDismiss().then(t=>{this.stopConfig(),this.second=30,clearInterval(this.interval)}),t.present()})}close(){this.modalController.dismiss()}openSetting(){this.openNativeSettings.open("wifi").then(t=>{console.log("ok")}).catch(t=>{this.toastService.warning(this.translate.instant("DEVICE_MOD.OPEN_SETTING_FAILED"))})}openConfig(){this.wifiWizard2.getConnectedSSID().then(t=>{JSON.stringify(t)==this.id?this.iab.create("http://192.168.1.4","_blank"):this.toastService.warning(this.translate.instant("DEVICE_MOD.WIFI_CORRECT"))}).catch(t=>{this.toastService.warning(this.translate.instant("DEVICE_MOD.OPEN_CONFIG_FAILED"))})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(c.IN),l.Y36(o.Q),l.Y36(s.a),l.Y36(d.k),l.Y36(a.i),l.Y36(u.sK),l.Y36(c.HT),l.Y36(c.HT),l.Y36(l.sBO))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-config-wifi"]],inputs:{id:"id",type:"type",name:"name"},decls:35,vars:19,consts:[["slot","end"],[3,"click"],["name","close"],[3,"formGroup"],["src","../../../assets/img/cabinext.png",4,"ngIf"],["src","../../../assets/img/envisor.png",4,"ngIf"],["src","../../../assets/img/feeding.png",4,"ngIf"],["lines","inset",2,"text-align","center"],["slot","end","formControlName","password"],[1,"ion-text-center"],["shape","round",3,"disabled","click"],["src","../../../assets/img/cabinext.png"],["src","../../../assets/img/envisor.png"],["src","../../../assets/img/feeding.png"]],template:function(t,e){1&t&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.TgZ(5,"ion-buttons",0),l.TgZ(6,"ion-button",1),l.NdJ("click",function(){return e.close()}),l._UZ(7,"ion-icon",2),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(8,"ion-content"),l.TgZ(9,"ion-card",3),l.YNc(10,g,1,0,"img",4),l.YNc(11,p,1,0,"img",5),l.YNc(12,m,1,0,"img",6),l.TgZ(13,"ion-card-content"),l.TgZ(14,"ion-list",7),l.TgZ(15,"ion-item"),l.TgZ(16,"ion-label"),l._uU(17),l.ALo(18,"translate"),l.qZA(),l.TgZ(19,"ion-text",0),l._uU(20),l.qZA(),l.qZA(),l.TgZ(21,"ion-item"),l.TgZ(22,"ion-label"),l._uU(23,"Wifi"),l.qZA(),l.TgZ(24,"ion-text",0),l._uU(25),l.qZA(),l.qZA(),l.TgZ(26,"ion-item"),l.TgZ(27,"ion-label"),l._uU(28),l.ALo(29,"translate"),l.qZA(),l._UZ(30,"ion-input",8),l.qZA(),l.qZA(),l.TgZ(31,"div",9),l.TgZ(32,"ion-button",10),l.NdJ("click",function(){return e.save()}),l._uU(33),l.ALo(34,"translate"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&t&&(l.xp6(3),l.hij("",l.lcZ(4,11,"DEVICE_MOD.CONFIG")," wifi"),l.xp6(6),l.Q6J("formGroup",e.form),l.xp6(1),l.Q6J("ngIf","cabinet"==e.type),l.xp6(1),l.Q6J("ngIf","envisor"==e.type),l.xp6(1),l.Q6J("ngIf","feeding"==e.type),l.xp6(5),l.Oqu(l.lcZ(18,13,"DEVICE_MOD.NAME")),l.xp6(3),l.Oqu(e.name),l.xp6(5),l.Oqu(e.form.value.wifi),l.xp6(3),l.Oqu(l.lcZ(29,15,"AUTH.PASSWORD")),l.xp6(4),l.Q6J("disabled",e.form.invalid),l.xp6(1),l.Oqu(l.lcZ(34,17,"DEVICE_MOD.CONFIG")))},directives:[c.Gu,c.sr,c.wd,c.Sm,c.YG,c.gu,c.W2,c.PM,r.JL,r.sg,h.O5,c.FN,c.q_,c.Ie,c.Q$,c.yW,c.pK,c.j9,r.JJ,r.u],pipes:[u.X$],styles:[""]}),t})()},82629:function(t,e,i){i.d(e,{d:function(){return s}});var n=i(15189),o=i(37716);let s=(()=>{class t{constructor(t){this.reqApiService=t,this.PATH_FT="http://35.240.204.122:8882/farmext",this.PATH_DEVICE="/manager/device-api",this.PATH_ADD_DEVICE="/manager/add-device-api",this.SITE_PATH_API="http://35.240.204.122:8882/api",this.listPermision=["company_manager","farm_manager","pond_manager"]}checkPermission(t){return!!this.listPermision.includes(t)}setPondCode(t){this.pcode=t}list(){return this.reqApiService.get(this.PATH_DEVICE+"?action=list&pcode="+this.pcode).toPromise()}get(t){return this.reqApiService.get(this.PATH_DEVICE+"?action=get&device_id_fb="+t+"&pcode="+this.pcode).toPromise()}update(t,e){return this.reqApiService.post(this.PATH_DEVICE+"?action=update&id="+e+"&pcode="+this.pcode,{name:t,pond_code:this.pcode}).toPromise()}add(t){return this.reqApiService.post(this.PATH_ADD_DEVICE,t).toPromise()}move(t,e,i){return this.reqApiService.post(this.PATH_DEVICE+"?action=update&id="+i+"&pcode="+this.pcode,{name:t,pond_code:e}).toPromise()}remove(t){return this.reqApiService.get(this.PATH_DEVICE+"?action=remove&id="+t+"&pcode="+this.pcode).toPromise()}check(t){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/qr/"+t).toPromise()}active(t){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/qr/"+t,{}).toPromise()}changeStatusContactor(t,e,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+i+"/peripherals/"+e+"/control",t)}getInforDevice(t){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+t).toPromise()}getListCondition(t,e){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/subscribes")}removeCondition(t,e,i){return this.reqApiService.deleteTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/subscribes/"+i)}addCondition(t,e,i){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/subscribes",i)}updateNameContactor(t,e,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t,i)}updateTimer(t,e,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/timer",i)}updateSetting(t,e){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/setting",e).toPromise()}addConditonPub(t,e,i){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/conditions",i)}updateConditonPub(t,e,i,n){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/conditions/"+i,n)}removeConditionPub(t,e,i){return this.reqApiService.deleteTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/conditions/"+i)}saveAutoRecord(t,e){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/third-setting",e)}commandFeeding(t,e){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+t+"/command",e)}removeTimer(t,e,i){return this.reqApiService.deleteTokenFt(this.PATH_FT+"/v2/devices/"+i+"/peripherals/"+e+"/timer/"+t)}addTimer(t,e,i){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/timer",i)}updateTimerFeed(t,e,i,n){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+i+"/peripherals/"+e+"/timer/"+t,n)}plus_analyze(t,e,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/plus_analyze",i)}abstract_analyze(t,e,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/abstract_analyze",i)}asyncData(t,e,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/sync",i)}removeDataFeed(t,e,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/clear",i)}updateCommonSetting(t,e){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t,e)}getListRepast(t,e){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/data")}getSuggestCalib(t,e,i,n){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+n+"/get-suggest-calib?feed="+i+"&start="+t+"&end="+e)}quickAddRepast(t,e,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/timer/feed",i)}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(n.$))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);