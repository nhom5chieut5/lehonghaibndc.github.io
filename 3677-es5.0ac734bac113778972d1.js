!function(){"use strict";function e(t,n){return(e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(t,n)}function t(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var o,a=i(e);if(t){var r=i(this).constructor;o=Reflect.construct(a,arguments,r)}else o=a.apply(this,arguments);return n(this,o)}}function n(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[3677],{54395:function(n,i,a){a.d(i,{b:function(){return u}});var s=a(77393),l=a(33637);function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.P;return function(n){return n.lift(new c(e,t))}}var c=function(){function e(t,n){o(this,e),this.dueTime=t,this.scheduler=n}return r(e,[{key:"call",value:function(e,t){return t.subscribe(new d(e,this.dueTime,this.scheduler))}}]),e}(),d=function(n){!function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&e(t,n)}(a,n);var i=t(a);function a(e,t,n){var r;return o(this,a),(r=i.call(this,e)).dueTime=t,r.scheduler=n,r.debouncedSubscription=null,r.lastValue=null,r.hasValue=!1,r}return r(a,[{key:"_next",value:function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(m,this.dueTime,this))}},{key:"_complete",value:function(){this.debouncedNext(),this.destination.complete()}},{key:"debouncedNext",value:function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}}},{key:"clearDebounce",value:function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)}}]),a}(s.L);function m(e){e.debouncedNext()}},73473:function(e,t,n){n.d(t,{l:function(){return s}});var i,a=n(37716),s=((i=function(){function e(t){o(this,e),this.el=t,this.permissionsCanShow=[],this.el.nativeElement.style.visibility="hidden",this.el.nativeElement.style.display="none"}return r(e,[{key:"PermissionsShow",set:function(e){this.permissionsCanShow=e}},{key:"CurrentPermisson",set:function(e){this.currentPermission=e,this.setShow()}},{key:"PermissionAction",set:function(e){this.currentPermission=e,this.setPointEvents()}},{key:"ngOnInit",value:function(){}},{key:"setShow",value:function(){this.permissionsCanShow.includes(this.currentPermission)?(this.el.nativeElement.style.visibility="visible",this.el.nativeElement.style.display="block"):(this.el.nativeElement.style.visibility="hidden",this.el.nativeElement.style.display="none")}},{key:"setPointEvents",value:function(){this.el.nativeElement.style.visibility="visible",this.el.nativeElement.style.display="block",this.el.nativeElement.style["pointer-events"]=this.permissionsCanShow.includes(this.currentPermission)?"visible":"none"}}]),e}()).\u0275fac=function(e){return new(e||i)(a.Y36(a.SBq))},i.\u0275dir=a.lG2({type:i,selectors:[["","appPermission",""]],inputs:{PermissionsShow:["appPermission","PermissionsShow"],CurrentPermisson:["currentPermission","CurrentPermisson"],PermissionAction:["permissionAction","PermissionAction"]}}),i)},51937:function(e,t,n){n.d(t,{D:function(){return c}});var i,a=n(76329),s=n(15189),l=n(88002),u=n(37716),c=((i=function(){function e(t){o(this,e),this.reqAPIService=t,this.urlApi="/manager/farm-api",this.urlApiAdress="/manager/address-api",this.reload$=new a.BehaviorSubject(0),this.numberOfPonds=0}return r(e,[{key:"setCode",value:function(e){this.fcode=e}},{key:"setFarm",value:function(e){this.farm=e,this.permission=e.permission}},{key:"loadPonds",value:function(){return this.reqAPIService.get("/manager/farm-api-mobie?fcode="+this.fcode+"&action=get-item-pond").pipe((0,l.U)(function(e){return e}))}},{key:"listAddress",value:function(e){return this.reqAPIService.get(this.urlApiAdress+"?action=listUnit&id="+e)}},{key:"loadFarm",value:function(){var e=this;return this.reqAPIService.get("/manager/farm-api-info?fcode="+this.fcode).pipe((0,l.U)(function(t){return e.setFarm(t.data),t}))}},{key:"getSeting",value:function(){return this.reqAPIService.get("/manager/farm-api-mobie?action=get-farm-setting&fcode="+this.fcode).pipe((0,l.U)(function(e){return e}))}},{key:"updatePrivate",value:function(e){return this.reqAPIService.post("/manager/farm-api-mobie?action=add-farm-setting&fcode="+this.fcode,e).pipe((0,l.U)(function(e){return e}))}},{key:"removePermission",value:function(e,t){return this.reqAPIService.get("/manager/farm-api-mobie?action=remove-manager&fcode="+this.fcode+"&user_id="+e+"&position="+t).pipe((0,l.U)(function(e){return e}))}},{key:"updateFarm",value:function(e){return this.reqAPIService.post("/manager/farm-edit-api-mobie?action=edit&fcode="+this.fcode,e).pipe((0,l.U)(function(e){return e}))}},{key:"destroyValue",value:function(){this.farm=null,this.fcode=null,this.permission=null,this.numberOfPonds=null}},{key:"getSpecies",value:function(){return this.reqAPIService.get("/manager/farm-create-api?action=get-species").pipe((0,l.U)(function(e){return e}))}},{key:"insertPond",value:function(e){return this.reqAPIService.post("/manager/farm-api-mobie?action=add-pond&fcode="+this.fcode,e).pipe((0,l.U)(function(e){return e}))}},{key:"insertOnePond",value:function(e){return this.reqAPIService.post("/manager/farm-api-mobie?action=add-a-pond&fcode="+this.fcode,e).pipe((0,l.U)(function(e){return e}))}},{key:"loadReport",value:function(){return this.reqAPIService.get("/manager/farm-api-report?fcode="+this.fcode)}},{key:"listStore",value:function(){return this.reqAPIService.get("/manager/farm-api-mobie?fcode="+this.fcode+"&action=list-store")}}]),e}()).\u0275fac=function(e){return new(e||i)(u.LFG(s.$))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i)},83677:function(e,t,n){n.r(t),n.d(t,{MoneyPageModule:function(){return Ye}});var i=n(38583),a=n(90665),s=n(13619),l=n(47063),u=n(64762),c=n(16738),d=n(51937),m=n(27887),p=n(62014),f=n(19228),h=n(54395),g=n(87519),v=n(49038),Z=n(84267),y=n(37716),A=n(84465),_=n(81780),b=n(82196),x=n(25375);function C(e,t){if(1&e&&(y.TgZ(0,"ion-select-option",30),y._uU(1),y.qZA()),2&e){var n=y.oxw().$implicit;y.Q6J("value",n.id),y.xp6(1),y.Oqu(n.name)}}function T(e,t){if(1&e&&(y.TgZ(0,"div"),y.YNc(1,C,2,2,"ion-select-option",29),y.qZA()),2&e){var n=t.$implicit,i=y.oxw(2);y.xp6(1),y.Q6J("ngIf",n.type==i.addForm.value.type&&4!=+n.id)}}function O(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-item",7),y.TgZ(1,"ion-label"),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.TgZ(4,"ion-select",26),y.YNc(5,T,2,1,"div",27),y.qZA(),y.TgZ(6,"ion-buttons",3),y.TgZ(7,"ion-button",1),y.NdJ("click",function(){return y.CHM(n),y.oxw().presentAddGroup()}),y._UZ(8,"ion-icon",28),y.qZA(),y.qZA(),y.qZA()}if(2&e){var i=y.oxw();y.xp6(2),y.Oqu(y.lcZ(3,2,"MONEY_MOD.GROUP")),y.xp6(3),y.Q6J("ngForOf",i.listCategory)}}function S(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-button",33),y.NdJ("click",function(){return y.CHM(n),y.oxw(2).resetBillId()}),y._uU(1),y.ALo(2,"number"),y._UZ(3,"ion-icon",34),y.qZA()}if(2&e){var i=y.oxw(2);y.xp6(1),y.AsE(" ",""!=i.billSeleted.customer_name?i.billSeleted.customer_name:"None"," | ",y.lcZ(2,2,i.billSeleted.amounts-i.billSeleted.amounts_payed)," ")}}function F(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-button",1),y.NdJ("click",function(){return y.CHM(n),y.oxw(2).presentChooseBill()}),y._UZ(1,"ion-icon",28),y.qZA()}}function q(e,t){if(1&e&&(y.TgZ(0,"ion-item",7),y.TgZ(1,"ion-label"),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.YNc(4,S,4,4,"ion-button",31),y.TgZ(5,"ion-buttons",3),y.YNc(6,F,2,0,"ion-button",32),y.qZA(),y.qZA()),2&e){var n=y.oxw();y.xp6(2),y.Oqu(y.lcZ(3,3,"MONEY_MOD.BILL_PAY")),y.xp6(2),y.Q6J("ngIf",n.billSeleted),y.xp6(2),y.Q6J("ngIf",!n.billSeleted)}}function N(e,t){if(1&e&&(y.TgZ(0,"ion-select-option",30),y._uU(1),y.qZA()),2&e){var n=t.$implicit;y.s9C("value",n.code),y.xp6(1),y.Oqu(n.name)}}function D(e,t){1&e&&y._UZ(0,"ion-icon",38)}function E(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-chip",36),y.NdJ("click",function(e){var t=y.CHM(n),i=t.$implicit,o=t.index,a=y.oxw(2);return"farm"==i.type?e.stopPropagation():a.removePond(o)}),y.TgZ(1,"ion-label"),y._uU(2),y.qZA(),y.YNc(3,D,1,0,"ion-icon",37),y.qZA()}if(2&e){var i=t.$implicit;y.xp6(2),y.Oqu(i.name),y.xp6(1),y.Q6J("ngIf","farm"!=i.type)}}function Y(e,t){if(1&e&&(y.TgZ(0,"ion-item",7),y.TgZ(1,"div"),y.YNc(2,E,4,2,"ion-chip",35),y.qZA(),y.qZA()),2&e){var n=y.oxw();y.xp6(2),y.Q6J("ngForOf",n.pondSeleted)}}function M(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-item",7),y.TgZ(1,"ion-label",20),y._uU(2),y.ALo(3,"translate"),y.ALo(4,"translate"),y.qZA(),y.TgZ(5,"ion-input",39),y.NdJ("ionFocus",function(){y.CHM(n);var e=y.oxw();return e.numberFormatCost.realValue?e.numberFormatCostPayed.setValue(e.numberFormatCost.realValue):""})("ionChange",function(e){return y.CHM(n),y.oxw().numberFormatCostPayed.setValue(e.detail.value)}),y.qZA(),y.qZA()}if(2&e){var i=y.oxw();y.xp6(2),y.AsE("",y.lcZ(3,3,"MONEY_MOD.AMOUNT_PAYED")," (",y.lcZ(4,5,"CURRENCY_S"),")"),y.xp6(3),y.Q6J("value",i.numberFormatCostPayed.fakeView)}}function w(e,t){1&e&&(y.TgZ(0,"ion-item",7),y.TgZ(1,"ion-text",40),y._uU(2," Chi ph\xed \u0111\xe3 tr\u1ea3 lu\xf4n nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng chi ph\xed "),y.qZA(),y.qZA())}function k(e,t){1&e&&(y.TgZ(0,"ion-item",7),y.TgZ(1,"ion-label",20),y._uU(2),y.ALo(3,"translate"),y.qZA(),y._UZ(4,"ion-input",41),y.qZA()),2&e&&(y.xp6(2),y.Oqu(y.lcZ(3,1,"MONEY_MOD.CUSTOMER")))}function I(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-item"),y.TgZ(1,"ion-text"),y._uU(2),y.qZA(),y.TgZ(3,"ion-button",33),y.NdJ("click",function(){var e=y.CHM(n).$implicit;return y.oxw(2).setCustomerName(e.customer_name)}),y._uU(4),y.ALo(5,"translate"),y.qZA(),y.qZA()}if(2&e){var i=t.$implicit;y.xp6(2),y.hij(" ",i.customer_name," "),y.xp6(2),y.hij(" ",y.lcZ(5,2,"SELECT")," ")}}function R(e,t){if(1&e&&(y.TgZ(0,"ion-list",42),y.YNc(1,I,6,4,"ion-item",27),y.qZA()),2&e){var n=y.oxw();y.xp6(1),y.Q6J("ngForOf",n.listCustomer)}}function U(e,t){1&e&&(y.TgZ(0,"div"),y._UZ(1,"ion-spinner",43),y.qZA())}var P,L=((P=function(){function e(t,n,i,r,s,l,u,d,f,h){o(this,e),this.modalController=t,this.farmService=n,this.toastService=i,this.navParams=r,this.moneyService=s,this.translate=l,this.alertController=u,this.actionSheetController=d,this.camera=f,this.settingService=h,this.maxDate=c(),this.minDate=c().subtract(180,"days"),this.savingFlag=new m.E,this.numberFormatCost=new p.y(""),this.numberFormatCostPayed=new p.y(""),this.addForm=new a.cw({type:new a.NI("out",a.kI.required),typeAdd:new a.NI("farm",a.kI.required),title:new a.NI("",a.kI.required),amounts:new a.NI("",[a.kI.required]),amounts_payed:new a.NI(""),today:new a.NI(c().format("YYYY-MM-DD"),a.kI.required),accounting_by:new a.NI(""),group_id:new a.NI(""),customer_name:new a.NI("")}),this.pondSeleted=[{name:this.translate.instant("COST")+" "+this.translate.instant("FARM"),code:"",type:"farm"}],this.listCategory=[],this.listCustomer=[],this.dataUpload={path:"",name:"",base:"",file:null}}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.getListPond(),this.getListCategories(),this.addForm.get("customer_name").valueChanges.pipe((0,h.b)(300),(0,g.x)()).subscribe(function(t){e.getListCustomer()})}},{key:"getListCustomer",value:function(){var e=this;this.listCustomer=[],this.moneyService.searchCustomer(this.addForm.value.customer_name,this.addForm.value.type).subscribe(function(t){1==t.status&&(e.listCustomer=t.data.filter(function(t){return t.customer_name!=e.addForm.value.customer_name}),console.log(e.listCustomer))},function(t){e.toastService.danger(e.translate.instant("ERROR_CONNECT"))})}},{key:"setCustomerName",value:function(e){this.addForm.patchValue({customer_name:e})}},{key:"getListPond",value:function(){var e=this;this.farmService.loadPonds().pipe().subscribe(function(t){0==t.status?e.toastService.warning(t.error):e.listPond=t.data},function(t){e.toastService.danger(e.translate.instant("ERROR_CONNECT"))})}},{key:"getListCategories",value:function(){var e=this;this.moneyService.getCategories().subscribe(function(t){if(1==t.status)for(var n in t.data)t.data[n].id=n,e.listCategory.push(t.data[n])})}},{key:"add",value:function(){var e=this,t=new FormData;t.append("type",this.addForm.value.type),t.append("typeAdd",this.addForm.value.typeAdd),this.pondSeleted.forEach(function(e){t.append("ponds[]",e.code)}),t.append("title",this.addForm.value.title),t.append("amounts",this.numberFormatCost.realValue.toString()),t.append("amounts_payed",this.numberFormatCostPayed.realValue.toString()),t.append("today",c(this.addForm.value.today).unix().toString()),t.append("fcode",this.fcode),t.append("accounting_by",this.addForm.value.accounting_by),t.append("group_id",this.addForm.value.group_id),t.append("bill_id",this.billSeleted&&4==+this.addForm.value.group_id?this.billSeleted.id:0),t.append("customer_name",this.addForm.value.customer_name),t.append("is_debt",this.settingService.showDebt?"1":"0"),this.dataUpload.file&&t.append("image",this.dataUpload.file),this.savingFlag.setPending(!0),this.moneyService.add(t).subscribe(function(n){0==n.status?e.toastService.warning(n.error):(e.toastService.success(e.translate.instant("FARM_MOD.NOTI_ADD_BUDGET")),e.modalController.dismiss(t)),e.savingFlag.setResult(!0)},function(){e.toastService.danger(e.translate.instant("ERROR_CONNECT")),e.savingFlag.setResult(!1)})}},{key:"chooseType",value:function(e){var t="";"farm"==e.detail.value?this.pondSeleted=[{name:this.translate.instant("COST")+" "+this.translate.instant("FARM"),code:"",type:"farm"}]:"all_area"==e.detail.value?(t="area",this.pondSeleted=this.listPond.reduce(function(t,n){return n.area>0&&t.push({name:n.name,code:n.code,type:e.detail.value}),t},[])):"all_seed"==e.detail.value?(t="seed",this.pondSeleted=this.listPond.reduce(function(t,n){return n.seed_quantity>0&&t.push({name:n.name,code:n.code,type:e.detail.value}),t},[])):"all_feed"==e.detail.value?(t="feed",this.pondSeleted=this.listPond.reduce(function(t,n){return n.current_season&&t.push({name:n.name,code:n.code,type:e.detail.value}),t},[])):"all_same"==e.detail.value?(t="same",this.pondSeleted=this.listPond.reduce(function(t,n){return n.current_season&&t.push({name:n.name,code:n.code,type:e.detail.value}),t},[]),console.log(this.pondSeleted)):(this.pondSeleted.findIndex(function(e){return"all_area"==e.type||"all_feed"==e.type||"all_seed"==e.type||"all_same"==e.type||"farm"==e.type})>=0&&(this.pondSeleted=[]),this.pondSeleted.push(this.listPond[this.listPond.findIndex(function(t){return t.code===e.detail.value})])),this.addForm.patchValue({accounting_by:t})}},{key:"removePond",value:function(e){this.pondSeleted.length>1&&this.pondSeleted.splice(e,1)}},{key:"presentAddGroup",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("ADD")+" "+this.translate.instant("MONEY_MOD.GROUP"),inputs:[{name:"name",type:"text",placeholder:this.translate.instant("MONEY_MOD.GROUP")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(e){t.moneyService.addCategory({name:e.name,type:t.addForm.value.type}).subscribe(function(n){1==n.status?(t.listCategory.push({name:e.name,type:t.addForm.value.type,id:n.data}),t.addForm.patchValue({group_id:n.data}),t.toastService.success(t.translate.instant("SHOP.CART.ADDRESS.ADD_SUCCESS"))):(t.toastService.warning(n.error),t.filterNameCategory(e.name))},function(){t.toastService.danger(t.translate.instant("ERROR_CONNECT"))})}}]});case 2:return e.next=4,e.sent.present();case 4:case"end":return e.stop()}},e,this)}))}},{key:"filterNameCategory",value:function(e){var t=this,n=this.listCategory.find(function(n){return n.name===e.toString()&&4!=+n.id&&n.type==t.addForm.value.type});console.log(n),n&&this.addForm.patchValue({group_id:n.id})}},{key:"presentChooseBill",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:v.u,componentProps:{type:this.addForm.value.type}});case 2:return(t=e.sent).onDidDismiss().then(function(e){var t=e.data;t&&(n.billSeleted=t,n.addForm.patchValue({customer_name:n.billSeleted.customer_name,amounts:n.billSeleted.amounts-n.billSeleted.amounts_payed}))}),e.next=6,t.present();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}))}},{key:"resetBillId",value:function(){this.billSeleted=null}},{key:"resetType",value:function(){this.addForm.patchValue({group_id:""})}}]),e}()).\u0275fac=function(e){return new(e||P)(y.Y36(l.IN),y.Y36(d.D),y.Y36(A.k),y.Y36(l.X1),y.Y36(f.r),y.Y36(_.sK),y.Y36(l.Br),y.Y36(l.BX),y.Y36(Z.V1),y.Y36(b.R))},P.\u0275cmp=y.Xpm({type:P,selectors:[["app-money-add"]],inputs:{fcode:"fcode"},decls:79,vars:78,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],[3,"data","toUpload"],[3,"formGroup"],["lines","inset"],["formControlName","today",3,"displayFormat","min","max"],["type","text","formControlName","type","interface","action-sheet",3,"ionChange"],["value","in"],["value","out"],["lines","inset",4,"ngIf"],["type","text","formControlName","typeAdd",3,"ionChange"],["value","farm"],["value","all_area"],["value","all_feed"],["value","all_seed"],["value","all_same"],[3,"value",4,"ngFor","ngForOf"],["position","floating"],["type","tel","inputmode","decimal","formControlName","amounts",3,"value","ionChange"],["type","text","formControlName","title"],["lines","none",4,"ngIf"],[1,"ion-text-center"],[4,"ngIf"],["type","text","formControlName","group_id","interface","action-sheet"],[4,"ngFor","ngForOf"],["slot","icon-only","name","add-circle"],[3,"value",4,"ngIf"],[3,"value"],["slot","end",3,"click",4,"ngIf"],[3,"click",4,"ngIf"],["slot","end",3,"click"],["slot","icon-only","name","close-circle"],["color","success",3,"click",4,"ngFor","ngForOf"],["color","success",3,"click"],["name","close-circle",4,"ngIf"],["name","close-circle"],["type","tel","inputmode","decimal","formControlName","amounts_payed",3,"value","ionFocus","ionChange"],["color","danger"],["formControlName","customer_name"],["lines","none"],["name","dots"]],template:function(e,t){1&e&&(y.TgZ(0,"ion-header"),y.TgZ(1,"ion-toolbar"),y.TgZ(2,"ion-buttons",0),y.TgZ(3,"ion-button",1),y.NdJ("click",function(){return t.modalController.dismiss(!1)}),y._UZ(4,"ion-icon",2),y.qZA(),y.qZA(),y.TgZ(5,"ion-title"),y._uU(6),y.ALo(7,"translate"),y.qZA(),y.TgZ(8,"ion-buttons",3),y.TgZ(9,"ion-button",4),y.NdJ("click",function(){return t.add()}),y._uU(10),y.ALo(11,"translate"),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.TgZ(12,"ion-content"),y.TgZ(13,"app-image-picker",5),y.NdJ("toUpload",function(e){return t.dataUpload=e}),y.qZA(),y.TgZ(14,"ion-list"),y.TgZ(15,"form",6),y.TgZ(16,"ion-item",7),y.TgZ(17,"ion-label"),y._uU(18),y.ALo(19,"translate"),y.qZA(),y._UZ(20,"ion-datetime",8),y.ALo(21,"translate"),y.qZA(),y.TgZ(22,"ion-item",7),y.TgZ(23,"ion-label"),y._uU(24),y.ALo(25,"translate"),y.qZA(),y.TgZ(26,"ion-select",9),y.NdJ("ionChange",function(){return t.resetType()}),y.TgZ(27,"ion-select-option",10),y._uU(28),y.ALo(29,"translate"),y.qZA(),y.TgZ(30,"ion-select-option",11),y._uU(31),y.ALo(32,"translate"),y.qZA(),y.qZA(),y.qZA(),y.YNc(33,O,9,4,"ion-item",12),y.YNc(34,q,7,5,"ion-item",12),y.TgZ(35,"ion-item",7),y.TgZ(36,"ion-label"),y._uU(37),y.ALo(38,"translate"),y.ALo(39,"translate"),y.qZA(),y.TgZ(40,"ion-select",13),y.NdJ("ionChange",function(e){return t.chooseType(e)}),y.TgZ(41,"ion-select-option",14),y._uU(42),y.ALo(43,"translate"),y.ALo(44,"translate"),y.qZA(),y.TgZ(45,"ion-select-option",15),y._uU(46),y.ALo(47,"translate"),y.qZA(),y.TgZ(48,"ion-select-option",16),y._uU(49),y.ALo(50,"translate"),y.ALo(51,"translate"),y.qZA(),y.TgZ(52,"ion-select-option",17),y._uU(53),y.ALo(54,"translate"),y.ALo(55,"translate"),y.qZA(),y.TgZ(56,"ion-select-option",18),y._uU(57),y.ALo(58,"translate"),y.ALo(59,"translate"),y.qZA(),y.YNc(60,N,2,2,"ion-select-option",19),y.qZA(),y.qZA(),y.YNc(61,Y,3,1,"ion-item",12),y.TgZ(62,"ion-item",7),y.TgZ(63,"ion-label",20),y._uU(64),y.ALo(65,"translate"),y.ALo(66,"translate"),y.qZA(),y.TgZ(67,"ion-input",21),y.NdJ("ionChange",function(e){return t.numberFormatCost.setValue(e.detail.value)}),y.qZA(),y.qZA(),y.YNc(68,M,6,7,"ion-item",12),y.YNc(69,w,3,0,"ion-item",12),y.TgZ(70,"ion-item",7),y.TgZ(71,"ion-label",20),y._uU(72),y.ALo(73,"translate"),y.qZA(),y._UZ(74,"ion-textarea",22),y.qZA(),y.YNc(75,k,5,3,"ion-item",12),y.qZA(),y.qZA(),y.YNc(76,R,2,1,"ion-list",23),y.TgZ(77,"div",24),y.YNc(78,U,2,0,"div",25),y.qZA(),y.qZA()),2&e&&(y.xp6(6),y.Oqu(y.lcZ(7,36,"FARM_MOD.ADD_BUDGET")),y.xp6(3),y.Q6J("disabled",t.addForm.invalid||t.savingFlag.pending||t.numberFormatCost.realValue<=0||t.numberFormatCostPayed.realValue<0||0==t.pondSeleted.length||t.numberFormatCost.realValue<t.numberFormatCostPayed.realValue),y.xp6(1),y.hij(" ",y.lcZ(11,38,"FARM_MOD.SAVE")," "),y.xp6(3),y.Q6J("data",t.dataUpload),y.xp6(2),y.Q6J("formGroup",t.addForm),y.xp6(3),y.Oqu(y.lcZ(19,40,"FARM_MOD.DATE")),y.xp6(2),y.Q6J("displayFormat",y.lcZ(21,42,"FORMAT_DATE_MOMENT"))("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD")),y.xp6(4),y.Oqu(y.lcZ(25,44,"FARM_MOD.SELECT")),y.xp6(4),y.Oqu(y.lcZ(29,46,"FARM_MOD.INCOME")),y.xp6(3),y.Oqu(y.lcZ(32,48,"FARM_MOD.EXPENSE")),y.xp6(2),y.Q6J("ngIf",t.settingService.showDebt),y.xp6(1),y.Q6J("ngIf",4==+t.addForm.value.group_id&&t.settingService.showDebt),y.xp6(3),y.AsE(" ",y.lcZ(38,50,"FARM"),"/",y.lcZ(39,52,"POND")," "),y.xp6(5),y.AsE("",y.lcZ(43,54,"COST")," ",y.lcZ(44,56,"FARM"),""),y.xp6(4),y.hij("",y.lcZ(47,58,"MONEY_MOD.EQUALLY_DIVIDED")," m2"),y.xp6(3),y.AsE("",y.lcZ(50,60,"MONEY_MOD.EQUALLY_DIVIDED")," ",y.lcZ(51,62,"POND_MOD.FEED"),""),y.xp6(4),y.AsE("",y.lcZ(54,64,"MONEY_MOD.EQUALLY_DIVIDED")," ",y.lcZ(55,66,"POND_MOD.SEED"),""),y.xp6(4),y.AsE("",y.lcZ(58,68,"MONEY_MOD.EQUALLY_DIVIDED")," ",y.lcZ(59,70,"POND"),""),y.xp6(3),y.Q6J("ngForOf",t.listPond),y.xp6(1),y.Q6J("ngIf",t.pondSeleted.length>0),y.xp6(3),y.AsE("",y.lcZ(65,72,"MONEY_MOD.AMOUNT")," (",y.lcZ(66,74,"CURRENCY_S"),")"),y.xp6(3),y.Q6J("value",t.numberFormatCost.fakeView),y.xp6(1),y.Q6J("ngIf",t.settingService.showDebt),y.xp6(1),y.Q6J("ngIf",t.numberFormatCost.realValue<t.numberFormatCostPayed.realValue),y.xp6(3),y.Oqu(y.lcZ(73,76,"MONEY_MOD.NOTE")),y.xp6(3),y.Q6J("ngIf",t.settingService.showDebt),y.xp6(1),y.Q6J("ngIf",t.settingService.showDebt),y.xp6(2),y.Q6J("ngIf",t.savingFlag.pending))},directives:[l.Gu,l.sr,l.Sm,l.YG,l.gu,l.wd,l.W2,x.k,l.q_,a._Y,a.JL,a.sg,l.Ie,l.Q$,l.x4,l.QI,a.JJ,a.u,l.t9,l.n0,i.O5,i.sg,l.pK,l.j9,l.g2,l.hM,l.yW,l.PQ],pipes:[_.X$,i.JJ],styles:[""]}),P),J=n(92340);function Q(e,t){1&e&&(y.TgZ(0,"ion-text",3),y.TgZ(1,"b"),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.qZA()),2&e&&(y.xp6(2),y.Oqu(y.lcZ(3,1,"FARM_MOD.INCOME")))}function V(e,t){1&e&&(y.TgZ(0,"ion-text",3),y.TgZ(1,"b"),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.qZA()),2&e&&(y.xp6(2),y.Oqu(y.lcZ(3,1,"FARM_MOD.EXPENSE")))}function G(e,t){if(1&e&&(y.TgZ(0,"ion-select-option",21),y._uU(1),y.qZA()),2&e){var n=y.oxw().$implicit;y.Q6J("value",n.id),y.xp6(1),y.Oqu(n.name)}}function B(e,t){if(1&e&&(y.TgZ(0,"div"),y.YNc(1,G,2,2,"ion-select-option",20),y.qZA()),2&e){var n=t.$implicit,i=y.oxw(2);y.xp6(1),y.Q6J("ngIf",n.type==i.editForm.value.type&&4!=+n.id)}}function j(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-item",7),y.TgZ(1,"ion-label"),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.TgZ(4,"ion-select",17),y.YNc(5,B,2,1,"div",18),y.qZA(),y.TgZ(6,"ion-buttons",3),y.TgZ(7,"ion-button",1),y.NdJ("click",function(){return y.CHM(n),y.oxw().presentAddGroup()}),y._UZ(8,"ion-icon",19),y.qZA(),y.qZA(),y.qZA()}if(2&e){var i=y.oxw();y.xp6(2),y.Oqu(y.lcZ(3,2,"MONEY_MOD.GROUP")),y.xp6(3),y.Q6J("ngForOf",i.listCategory)}}function $(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-button",24),y.NdJ("click",function(){return y.CHM(n),y.oxw(2).resetBillId()}),y._uU(1),y.ALo(2,"number"),y._UZ(3,"ion-icon",25),y.qZA()}if(2&e){var i=y.oxw(2);y.xp6(1),y.AsE(" ",""!=i.billSeleted.customer_name?i.billSeleted.customer_name:"None"," | ",y.lcZ(2,2,i.billSeleted.amounts-i.billSeleted.amounts_payed)," ")}}function H(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-button",1),y.NdJ("click",function(){return y.CHM(n),y.oxw(2).presentChooseBill()}),y._UZ(1,"ion-icon",19),y.qZA()}}function X(e,t){if(1&e&&(y.TgZ(0,"ion-item",7),y.TgZ(1,"ion-label"),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.YNc(4,$,4,4,"ion-button",22),y.TgZ(5,"ion-buttons",3),y.YNc(6,H,2,0,"ion-button",23),y.qZA(),y.qZA()),2&e){var n=y.oxw();y.xp6(2),y.Oqu(y.lcZ(3,3,"MONEY_MOD.BILL_PAY")),y.xp6(2),y.Q6J("ngIf",n.billSeleted),y.xp6(2),y.Q6J("ngIf",!n.billSeleted)}}function K(e,t){if(1&e&&(y.TgZ(0,"ion-select-option",21),y._uU(1),y.qZA()),2&e){var n=t.$implicit;y.s9C("value",n.code),y.xp6(1),y.Oqu(n.name)}}function W(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-chip",29),y.NdJ("click",function(){var e=y.CHM(n).index;return y.oxw(3).removePond(e)}),y.TgZ(1,"ion-label"),y._uU(2),y.qZA(),y._UZ(3,"ion-icon",30),y.qZA()}if(2&e){var i=t.$implicit;y.xp6(2),y.Oqu(null==i?null:i.name)}}function z(e,t){if(1&e&&(y.TgZ(0,"ion-item",7),y.TgZ(1,"div"),y.YNc(2,W,4,1,"ion-chip",28),y.qZA(),y.qZA()),2&e){var n=y.oxw(2);y.xp6(2),y.Q6J("ngForOf",n.pondSeleted)}}function ee(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"div"),y.TgZ(1,"ion-item",7),y.TgZ(2,"ion-label"),y._uU(3),y.ALo(4,"translate"),y.qZA(),y.TgZ(5,"ion-select",26),y.NdJ("ionChange",function(e){return y.CHM(n),y.oxw().chooseTypeAll(e)}),y.YNc(6,K,2,2,"ion-select-option",27),y.qZA(),y.qZA(),y.YNc(7,z,3,1,"ion-item",10),y.qZA()}if(2&e){var i=y.oxw();y.xp6(3),y.hij(" ",y.lcZ(4,3,"POND")," "),y.xp6(3),y.Q6J("ngForOf",i.listPond),y.xp6(1),y.Q6J("ngIf",i.pondSeleted.length>0)}}function te(e,t){if(1&e&&(y.TgZ(0,"ion-select-option",21),y._uU(1),y.qZA()),2&e){var n=t.$implicit;y.s9C("value",n.code),y.xp6(1),y.Oqu(n.name)}}function ne(e,t){if(1&e&&(y.TgZ(0,"ion-chip",34),y.TgZ(1,"ion-label"),y._uU(2),y.qZA(),y.qZA()),2&e){var n=t.$implicit;y.xp6(2),y.Oqu(null==n?null:n.name)}}function ie(e,t){if(1&e&&(y.TgZ(0,"ion-item",7),y.TgZ(1,"div"),y.YNc(2,ne,3,1,"ion-chip",33),y.qZA(),y.qZA()),2&e){var n=y.oxw(2);y.xp6(2),y.Q6J("ngForOf",n.pondSeleted)}}function oe(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"div"),y.TgZ(1,"ion-item",7),y.TgZ(2,"ion-label"),y._uU(3),y.ALo(4,"translate"),y.ALo(5,"translate"),y.qZA(),y.TgZ(6,"ion-select",31),y.NdJ("ionChange",function(e){return y.CHM(n),y.oxw().chooseType(e)}),y.TgZ(7,"ion-select-option",32),y._uU(8),y.ALo(9,"translate"),y.ALo(10,"translate"),y.qZA(),y.YNc(11,te,2,2,"ion-select-option",27),y.qZA(),y.qZA(),y.YNc(12,ie,3,1,"ion-item",10),y.qZA()}if(2&e){var i=y.oxw();y.xp6(3),y.AsE(" ",y.lcZ(4,7,"FARM"),"/",y.lcZ(5,9,"POND")," "),y.xp6(3),y.Q6J("value",i.pondSeleted[0].code),y.xp6(2),y.AsE("",y.lcZ(9,11,"COST")," ",y.lcZ(10,13,"FARM"),""),y.xp6(3),y.Q6J("ngForOf",i.listPond),y.xp6(1),y.Q6J("ngIf",i.pondSeleted.length>0)}}function ae(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-item",7),y.TgZ(1,"ion-label",12),y._uU(2),y.ALo(3,"translate"),y.ALo(4,"translate"),y.qZA(),y.TgZ(5,"ion-input",35),y.NdJ("ionFocus",function(){y.CHM(n);var e=y.oxw();return e.numberFormatCostPayed.setValue(e.numberFormatCost.realValue)})("ionChange",function(e){return y.CHM(n),y.oxw().numberFormatCostPayed.setValue(e.detail.value)}),y.qZA(),y.qZA()}if(2&e){var i=y.oxw();y.xp6(2),y.AsE("",y.lcZ(3,3,"MONEY_MOD.AMOUNT_PAYED")," (",y.lcZ(4,5,"CURRENCY_S"),")"),y.xp6(3),y.Q6J("value",i.numberFormatCostPayed.fakeView)}}function re(e,t){1&e&&(y.TgZ(0,"ion-item",7),y.TgZ(1,"ion-text",36),y._uU(2," Chi ph\xed \u0111\xe3 tr\u1ea3 lu\xf4n nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng chi ph\xed "),y.qZA(),y.qZA())}function se(e,t){1&e&&(y.TgZ(0,"ion-item",7),y.TgZ(1,"ion-label",12),y._uU(2),y.ALo(3,"translate"),y.qZA(),y._UZ(4,"ion-input",37),y.qZA()),2&e&&(y.xp6(2),y.Oqu(y.lcZ(3,1,"MONEY_MOD.CUSTOMER")))}function le(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-item"),y.TgZ(1,"ion-text"),y._uU(2),y.qZA(),y.TgZ(3,"ion-button",24),y.NdJ("click",function(){var e=y.CHM(n).$implicit;return y.oxw(2).setCustomerName(e.customer_name)}),y._uU(4),y.ALo(5,"translate"),y.qZA(),y.qZA()}if(2&e){var i=t.$implicit;y.xp6(2),y.hij(" ",i.customer_name," "),y.xp6(2),y.hij(" ",y.lcZ(5,2,"SELECT")," ")}}function ue(e,t){if(1&e&&(y.TgZ(0,"ion-list",38),y.YNc(1,le,6,4,"ion-item",18),y.qZA()),2&e){var n=y.oxw();y.xp6(1),y.Q6J("ngForOf",n.listCustomer)}}function ce(e,t){1&e&&(y.TgZ(0,"div"),y._UZ(1,"ion-spinner",39),y.qZA())}var de=function(){var e=function(){function e(t,n,i,r,s,l,u,d,f){o(this,e),this.modalController=t,this.farmService=n,this.toastService=i,this.navParams=r,this.moneyService=s,this.translate=l,this.alertController=u,this.actionSheetController=d,this.settingService=f,this.maxDate=c(),this.minDate=c().subtract(180,"days"),this.savingFlag=new m.E,this.numberFormatCost=new p.y(""),this.numberFormatCostPayed=new p.y(""),this.editForm=new a.cw({type:new a.NI("out",a.kI.required),typeAdd:new a.NI("farm",a.kI.required),title:new a.NI("",a.kI.required),amounts:new a.NI("",[a.kI.required]),amounts_payed:new a.NI(""),today:new a.NI(c().format("YYYY-MM-DD"),a.kI.required),accounting_by:new a.NI(""),group_id:new a.NI(""),customer_name:new a.NI("")}),this.listCategory=[],this.pondSeleted=[{name:this.translate.instant("COST")+" "+this.translate.instant("FARM"),code:"",type:"farm"}],this.listCustomer=[],this.dataUpload={path:"",name:"",base:"",file:null},this.PATH_FILE=J.bl.FILE_PATH}return r(e,[{key:"ngOnInit",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getListPond();case 2:return e.next=4,this.getListCategories();case 4:return e.next=6,this.getBill();case 6:this.buildForm(),this.editForm.get("customer_name").valueChanges.pipe((0,h.b)(300),(0,g.x)()).subscribe(function(e){t.getListCustomer()});case 8:case"end":return e.stop()}},e,this)}))}},{key:"getListCustomer",value:function(){var e=this;this.listCustomer=[],this.moneyService.searchCustomer(this.editForm.value.customer_name,this.editForm.value.type).subscribe(function(t){1==t.status&&(e.listCustomer=t.data.filter(function(t){return t.customer_name!=e.editForm.value.customer_name}))},function(t){e.toastService.danger(e.translate.instant("ERROR_CONNECT"))})}},{key:"setCustomerName",value:function(e){this.editForm.patchValue({customer_name:e})}},{key:"getListCategories",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.moneyService.getCategories().toPromise();case 2:if((t=e.sent)&&1==t.status)for(n in t.data)t.data[n].id=n,this.listCategory.push(t.data[n]);case 4:case"end":return e.stop()}},e,this)}))}},{key:"buildForm",value:function(){var e=this;if(console.log(this.data),this.editForm.patchValue({type:this.data.cr,typeAdd:0==this.data.pond_id?"farm":this.data.pond_id,title:this.data.title,amounts:this.data.amounts,amounts_payed:this.data.amounts_payed,group_id:this.data.group_id,today:c(1e3*this.data.add_time).format("YYYY-MM-DD"),accounting_by:this.data.accounting_by,customer_name:this.data.customer_name}),this.data.image&&(this.dataUpload.path=this.PATH_FILE+"/upload/"+this.data.image),this.data.pond_id&&"NULL"!==this.data.pond_id){var t=this.listPond.find(function(t){return t.code===e.data.pond_id});this.pondSeleted=[{name:null==t?void 0:t.name,code:null==t?void 0:t.code,type:""}]}else this.pondSeleted=[{name:this.translate.instant("COST")+" "+this.translate.instant("FARM"),code:"",type:"farm"}];this.data.code&&(this.editForm.patchValue({typeAdd:"all_"+this.data.accounting_by,accounting_by:this.data.accounting_by}),this.moneyService.getGroup(this.data.code,this.data.cr).subscribe(function(t){if(1==t.status){var n=0,i=0;e.pondSeleted=t.data.reduce(function(t,n){var i=e.listPond.find(function(e){return e.code===n.pond_id});return i&&t.push({name:i.name,code:i.code,type:"all"}),t},[]),t.data.forEach(function(e){n+=+e.amounts,i+=+e.amounts_payed}),e.editForm.patchValue({amounts:n,amounts_payed:i})}}))}},{key:"getListPond",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.farmService.loadPonds().toPromise().catch(function(){n.toastService.danger(n.translate.instant("ERROR_CONNECT"))});case 2:0==+(t=e.sent).status?this.toastService.warning(t.error):this.listPond=t.data,console.log(this.listPond);case 4:case"end":return e.stop()}},e,this)}))}},{key:"chooseTypeAll",value:function(e){this.pondSeleted.find(function(t){return t.code===e.detail.value})||this.pondSeleted.push(this.listPond.find(function(t){return t.code===e.detail.value}))}},{key:"chooseType",value:function(e){if(0==e.detail.value)this.pondSeleted=[{name:this.translate.instant("COST")+" "+this.translate.instant("FARM"),code:"",type:"farm"}];else{var t=this.listPond.find(function(t){return t.code===e.detail.value});t&&(this.pondSeleted=[{name:t.name,code:t.code,type:""}])}}},{key:"removePond",value:function(e){this.pondSeleted.length>1&&this.pondSeleted.splice(e,1)}},{key:"edit",value:function(){var e=this,t=new FormData;t.append("id",this.data.id),t.append("type",this.editForm.value.type),t.append("typeAdd",this.editForm.value.typeAdd),this.pondSeleted.forEach(function(e){t.append("ponds[]",e.code)}),t.append("pond_id",this.pondSeleted[0].code),t.append("group_id",this.editForm.value.group_id),t.append("title",this.editForm.value.title),t.append("amounts",this.numberFormatCost.realValue.toString()),t.append("amounts_payed",this.numberFormatCostPayed.realValue.toString()),t.append("today",c(this.editForm.value.today).unix().toString()),t.append("fcode",this.fcode),t.append("accounting_by",this.editForm.value.accounting_by),t.append("bill_id",this.billSeleted&&4==+this.editForm.value.group_id?this.billSeleted.id:0),t.append("customer_name",this.editForm.value.customer_name),t.append("is_debt",this.settingService.showDebt?"1":"0"),this.dataUpload.file&&t.append("image",this.dataUpload.file),this.pondSeleted.map(function(e){return e.code}),c(this.editForm.value.today).unix(),this.savingFlag.setStart(!0);var n="edit";["all_feed","all_seed","all_area","all_same"].includes(this.editForm.value.typeAdd)&&(n="editGroup"),this.moneyService[n](t).pipe().subscribe(function(n){0==n.status?e.toastService.warning(n.error):(e.toastService.success(e.translate.instant("MONEY_MOD.NOTI_EDIT")),e.modalController.dismiss(t)),e.savingFlag.setResult(!0)},function(){e.savingFlag.setResult(!1),e.toastService.danger(e.translate.instant("ERROR_CONNECT"))})}},{key:"getBill",value:function(){var e=this;0==+this.data.bill_id||4!=+this.data.group_id||this.moneyService.getBill(this.data.bill_id,this.data.cr).subscribe(function(t){1==t.status?e.billSeleted=t.data:e.toastService.warning(t.error)},function(){e.toastService.danger(e.translate.instant("ERROR_CONNECT"))})}},{key:"presentChooseBill",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:v.u,componentProps:{type:this.editForm.value.type,bill_id:this.data.id}});case 2:return(t=e.sent).onDidDismiss().then(function(e){var t=e.data;t&&(n.billSeleted=t,n.editForm.patchValue({customer_name:n.billSeleted.customer_name,amounts:n.billSeleted.amounts-n.billSeleted.amounts_payed}))}),e.next=6,t.present();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}))}},{key:"resetBillId",value:function(){this.billSeleted=null}},{key:"presentAddGroup",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("ADD")+" "+this.translate.instant("MONEY_MOD.GROUP"),inputs:[{name:"name",type:"text",placeholder:this.translate.instant("MONEY_MOD.GROUP")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(e){t.moneyService.addCategory({name:e.name,type:t.editForm.value.type}).subscribe(function(n){1==n.status?(t.listCategory.push({name:e.name,type:t.editForm.value.type,id:n.data}),t.editForm.patchValue({group_id:n.data}),t.toastService.success(t.translate.instant("SHOP.CART.ADDRESS.ADD_SUCCESS"))):(t.toastService.warning(n.error),t.filterNameCategory(e.name))},function(){t.toastService.danger(t.translate.instant("ERROR_CONNECT"))})}}]});case 2:return e.next=4,e.sent.present();case 4:case"end":return e.stop()}},e,this)}))}},{key:"filterNameCategory",value:function(e){var t=this.listCategory.find(function(t){return t.name===e});console.log(t),t&&this.editForm.patchValue({group_id:t.id})}},{key:"resetType",value:function(){this.editForm.patchValue({group_id:""})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(y.Y36(l.IN),y.Y36(d.D),y.Y36(A.k),y.Y36(l.X1),y.Y36(f.r),y.Y36(_.sK),y.Y36(l.Br),y.Y36(l.BX),y.Y36(b.R))},e.\u0275cmp=y.Xpm({type:e,selectors:[["app-money-edit"]],inputs:{fcode:"fcode",data:"data"},decls:49,vars:42,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],[3,"data","toUpload"],[3,"formGroup"],["lines","inset"],["formControlName","today",3,"displayFormat","min","max"],["slot","end",4,"ngIf"],["lines","inset",4,"ngIf"],[4,"ngIf"],["position","floating"],["type","tel","inputmode","decimal","formControlName","amounts",3,"disabled","value","ionChange"],["type","text","formControlName","title"],["lines","none",4,"ngIf"],[1,"ion-text-center"],["type","text","formControlName","group_id","interface","action-sheet"],[4,"ngFor","ngForOf"],["slot","icon-only","name","add-circle"],[3,"value",4,"ngIf"],[3,"value"],["slot","end",3,"click",4,"ngIf"],[3,"click",4,"ngIf"],["slot","end",3,"click"],["slot","icon-only","name","close-circle"],["type","text",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["color","success",3,"click",4,"ngFor","ngForOf"],["color","success",3,"click"],["name","close-circle"],["type","text",3,"value","ionChange"],["value",""],["color","success",4,"ngFor","ngForOf"],["color","success"],["type","tel","inputmode","decimal","formControlName","amounts_payed",3,"value","ionFocus","ionChange"],["color","danger"],["formControlName","customer_name"],["lines","none"],["name","dots"]],template:function(e,t){1&e&&(y.TgZ(0,"ion-header"),y.TgZ(1,"ion-toolbar"),y.TgZ(2,"ion-buttons",0),y.TgZ(3,"ion-button",1),y.NdJ("click",function(){return t.modalController.dismiss(!1)}),y._UZ(4,"ion-icon",2),y.qZA(),y.qZA(),y.TgZ(5,"ion-title"),y._uU(6),y.ALo(7,"translate"),y.qZA(),y.TgZ(8,"ion-buttons",3),y.TgZ(9,"ion-button",4),y.NdJ("click",function(){return t.edit()}),y._uU(10),y.ALo(11,"translate"),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.TgZ(12,"ion-content"),y.TgZ(13,"app-image-picker",5),y.NdJ("toUpload",function(e){return t.dataUpload=e}),y.qZA(),y.TgZ(14,"ion-list"),y.TgZ(15,"form",6),y.TgZ(16,"ion-item",7),y.TgZ(17,"ion-label"),y._uU(18),y.ALo(19,"translate"),y.qZA(),y._UZ(20,"ion-datetime",8),y.ALo(21,"translate"),y.qZA(),y.TgZ(22,"ion-item",7),y.TgZ(23,"ion-label"),y._uU(24),y.ALo(25,"translate"),y.qZA(),y.YNc(26,Q,4,3,"ion-text",9),y.YNc(27,V,4,3,"ion-text",9),y.qZA(),y.YNc(28,j,9,4,"ion-item",10),y.YNc(29,X,7,5,"ion-item",10),y.YNc(30,ee,8,5,"div",11),y.YNc(31,oe,13,15,"div",11),y.TgZ(32,"ion-item",7),y.TgZ(33,"ion-label",12),y._uU(34),y.ALo(35,"translate"),y.ALo(36,"translate"),y.qZA(),y.TgZ(37,"ion-input",13),y.NdJ("ionChange",function(e){return t.numberFormatCost.setValue(e.detail.value)}),y.qZA(),y.qZA(),y.YNc(38,ae,6,7,"ion-item",10),y.YNc(39,re,3,0,"ion-item",10),y.TgZ(40,"ion-item",7),y.TgZ(41,"ion-label",12),y._uU(42),y.ALo(43,"translate"),y.qZA(),y._UZ(44,"ion-textarea",14),y.qZA(),y.YNc(45,se,5,3,"ion-item",10),y.qZA(),y.qZA(),y.YNc(46,ue,2,1,"ion-list",15),y.TgZ(47,"div",16),y.YNc(48,ce,2,0,"div",11),y.qZA(),y.qZA()),2&e&&(y.xp6(6),y.Oqu(y.lcZ(7,26,"MONEY_MOD.EDIT")),y.xp6(3),y.Q6J("disabled",t.editForm.invalid||t.numberFormatCost.realValue<t.numberFormatCostPayed.realValue||t.numberFormatCost.realValue<=0||t.numberFormatCostPayed.realValue<0||t.savingFlag.pending),y.xp6(1),y.hij(" ",y.lcZ(11,28,"FARM_MOD.SAVE")," "),y.xp6(3),y.Q6J("data",t.dataUpload),y.xp6(2),y.Q6J("formGroup",t.editForm),y.xp6(3),y.Oqu(y.lcZ(19,30,"FARM_MOD.DATE")),y.xp6(2),y.Q6J("displayFormat",y.lcZ(21,32,"FORMAT_DATE_MOMENT"))("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD")),y.xp6(4),y.Oqu(y.lcZ(25,34,"MONEY_MOD.SELECT")),y.xp6(2),y.Q6J("ngIf","in"==t.editForm.value.type),y.xp6(1),y.Q6J("ngIf","out"==t.editForm.value.type),y.xp6(1),y.Q6J("ngIf",4!=+t.editForm.value.group_id&&t.settingService.showDebt),y.xp6(1),y.Q6J("ngIf",4==+t.editForm.value.group_id&&t.settingService.showDebt),y.xp6(1),y.Q6J("ngIf",("all_feed"==t.editForm.value.typeAdd||"all_seed"==t.editForm.value.typeAdd||"all_area"==t.editForm.value.typeAdd||"all_same"==t.editForm.value.typeAdd)&&""==t.data.alias),y.xp6(1),y.Q6J("ngIf","all_feed"!=t.editForm.value.typeAdd&&"all_seed"!=t.editForm.value.typeAdd&&"all_area"!=t.editForm.value.typeAdd&&"all_same"!=t.editForm.value.typeAdd&&""==t.data.alias&&4!=+t.editForm.value.group_id),y.xp6(3),y.AsE("",y.lcZ(35,36,"MONEY_MOD.AMOUNT")," (",y.lcZ(36,38,"CURRENCY_S"),")"),y.xp6(3),y.Q6J("disabled",""!=t.data.alias)("value",t.numberFormatCost.fakeView),y.xp6(1),y.Q6J("ngIf",t.settingService.showDebt),y.xp6(1),y.Q6J("ngIf",t.numberFormatCost.realValue<t.numberFormatCostPayed.realValue),y.xp6(3),y.Oqu(y.lcZ(43,40,"MONEY_MOD.NOTE")),y.xp6(3),y.Q6J("ngIf",t.settingService.showDebt),y.xp6(1),y.Q6J("ngIf",t.settingService.showDebt),y.xp6(2),y.Q6J("ngIf",t.savingFlag.pending))},directives:[l.Gu,l.sr,l.Sm,l.YG,l.gu,l.wd,l.W2,x.k,l.q_,a._Y,a.JL,a.sg,l.Ie,l.Q$,l.x4,l.QI,a.JJ,a.u,i.O5,l.pK,l.j9,l.g2,l.yW,l.t9,i.sg,l.n0,l.hM,l.PQ],pipes:[_.X$,i.JJ],styles:[""]}),e}(),me=function(){var e=function(){function e(t,n){o(this,e),this.modalController=t,this.translate=n,this.searchForm=new a.cw({keyword:new a.NI("",a.kI.required),type:new a.NI("out",a.kI.required)}),this.dateRangeStart=c().subtract(3,"days").format("YYYY-MM-DD"),this.dateRangeEnd=c().format("YYYY-MM-DD"),this.maxDate=c(),this.minDate=c().subtract(180,"days")}return r(e,[{key:"ngOnInit",value:function(){this.params&&this.searchForm.setValue({keyword:this.params.keyword,type:this.params.type}),this.params&&this.params.timeFrom&&(this.dateRangeStart=c(1e3*this.params.timeFrom).format("YYYY-MM-DD")),this.params&&this.params.timeTo&&(this.dateRangeEnd=c(1e3*this.params.timeTo).format("YYYY-MM-DD"))}},{key:"onChangeDateStart",value:function(e){this.dateRangeStart=e.detail.value}},{key:"onChangeDateEnd",value:function(e){this.dateRangeEnd=e.detail.value}},{key:"search",value:function(){var e={type:this.searchForm.value.type,keyword:this.searchForm.value.keyword?this.searchForm.value.keyword:"",timeFrom:c(this.dateRangeStart).valueOf()/1e3,timeTo:c(this.dateRangeEnd).endOf("day").valueOf()/1e3};this.modalController.dismiss(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(y.Y36(l.IN),y.Y36(_.sK))},e.\u0275cmp=y.Xpm({type:e,selectors:[["app-money-search"]],inputs:{params:"params"},decls:42,vars:35,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-text-center"],[1,"ion-padding"],[3,"formGroup"],["lines","inset"],["formControlName","type","interface","action-sheet"],["value","in"],["value","out"],[3,"displayFormat","min","max","value","ionChange"],["type","text","formControlName","keyword",3,"placeholder"],[1,"ion-padding","ion-text-center"],["shape","round",3,"click"]],template:function(e,t){1&e&&(y.TgZ(0,"ion-header"),y.TgZ(1,"ion-toolbar"),y.TgZ(2,"ion-buttons",0),y.TgZ(3,"ion-button",1),y.NdJ("click",function(){return t.modalController.dismiss(!1)}),y._UZ(4,"ion-icon",2),y.qZA(),y.qZA(),y._UZ(5,"ion-title"),y.qZA(),y.qZA(),y.TgZ(6,"ion-content"),y.TgZ(7,"div",3),y.TgZ(8,"h1",4),y._uU(9),y.ALo(10,"translate"),y.qZA(),y.qZA(),y.TgZ(11,"form",5),y.TgZ(12,"ion-list"),y.TgZ(13,"ion-item",6),y.TgZ(14,"ion-label"),y._uU(15),y.ALo(16,"translate"),y.qZA(),y.TgZ(17,"ion-select",7),y.TgZ(18,"ion-select-option",8),y._uU(19),y.ALo(20,"translate"),y.qZA(),y.TgZ(21,"ion-select-option",9),y._uU(22),y.ALo(23,"translate"),y.qZA(),y.qZA(),y.qZA(),y.TgZ(24,"ion-item",6),y.TgZ(25,"ion-label"),y._uU(26),y.ALo(27,"translate"),y.qZA(),y.TgZ(28,"ion-datetime",10),y.NdJ("ionChange",function(e){return t.onChangeDateStart(e)}),y.ALo(29,"translate"),y.qZA(),y.qZA(),y.TgZ(30,"ion-item",6),y.TgZ(31,"ion-label"),y._uU(32),y.ALo(33,"translate"),y.qZA(),y.TgZ(34,"ion-datetime",10),y.NdJ("ionChange",function(e){return t.onChangeDateEnd(e)}),y.ALo(35,"translate"),y.qZA(),y.qZA(),y.TgZ(36,"ion-item",6),y._UZ(37,"ion-input",11),y.qZA(),y.qZA(),y.qZA(),y.TgZ(38,"div",12),y.TgZ(39,"ion-button",13),y.NdJ("click",function(){return t.search()}),y._uU(40),y.ALo(41,"translate"),y.qZA(),y.qZA(),y.qZA()),2&e&&(y.xp6(9),y.hij(" ",y.lcZ(10,17,"MONEY_MOD.FILTER_BUDGET")," "),y.xp6(2),y.Q6J("formGroup",t.searchForm),y.xp6(4),y.Oqu(y.lcZ(16,19,"MONEY_MOD.SELECT")),y.xp6(4),y.Oqu(y.lcZ(20,21,"FARM_MOD.INCOME")),y.xp6(3),y.Oqu(y.lcZ(23,23,"FARM_MOD.EXPENSE")),y.xp6(4),y.Oqu(y.lcZ(27,25,"FARM_MOD.FROM")),y.xp6(2),y.Q6J("displayFormat",y.lcZ(29,27,"FORMAT_DATE_MOMENT"))("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD"))("value",t.dateRangeStart),y.xp6(4),y.Oqu(y.lcZ(33,29,"FARM_MOD.TO")),y.xp6(2),y.Q6J("displayFormat",y.lcZ(35,31,"FORMAT_DATE_MOMENT"))("min",t.dateRangeStart)("max",t.maxDate.format("YYYY-MM-DD"))("value",t.dateRangeEnd),y.xp6(3),y.Q6J("placeholder",t.translate.instant("FARM_MOD.KEYWORDS")),y.xp6(3),y.Oqu(y.lcZ(41,33,"FARM_MOD.SEARCH")))},directives:[l.Gu,l.sr,l.Sm,l.YG,l.gu,l.wd,l.W2,a._Y,a.JL,a.sg,l.q_,l.Ie,l.Q$,l.t9,l.QI,a.JJ,a.u,l.n0,l.x4,l.pK,l.j9],pipes:[_.X$],styles:[""]}),e}(),pe=n(60271),fe=n(7115),he=n(71239),ge=n(73473);function ve(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-fab-button",11),y.NdJ("click",function(){return y.CHM(n),y.oxw().presentCustomer()}),y._UZ(1,"ion-icon",12),y.qZA()}}function Ze(e,t){1&e&&(y.TgZ(0,"div",16),y._UZ(1,"ion-spinner",17),y.qZA())}function ye(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-card",20),y.NdJ("click",function(){return y.CHM(n),y.oxw(3).presentCorrectFund()}),y.TgZ(1,"ion-item",21),y.TgZ(2,"ion-text"),y._uU(3," Ti\u1ec1n m\u1eb7t "),y.qZA(),y.TgZ(4,"ion-text",2),y._uU(5),y.ALo(6,"number"),y.qZA(),y.qZA(),y.TgZ(7,"ion-item",21),y.TgZ(8,"ion-text"),y._uU(9," D\u01b0 \u0111\u1ea7u "),y.qZA(),y.TgZ(10,"ion-text",2),y._uU(11),y.ALo(12,"number"),y.qZA(),y.qZA(),y.TgZ(13,"ion-item",21),y.TgZ(14,"ion-text"),y._uU(15," D\u01b0 cu\u1ed1i "),y.qZA(),y.TgZ(16,"ion-text",2),y._uU(17),y.ALo(18,"number"),y.qZA(),y.qZA(),y.TgZ(19,"ion-item",21),y.TgZ(20,"ion-text",2),y._uU(21),y.ALo(22,"number"),y.qZA(),y.qZA(),y.qZA()}if(2&e){var i=y.oxw(3);y.xp6(5),y.hij(" ",y.lcZ(6,4,null==i.fundInfor?null:i.fundInfor.current)," \u0111 "),y.xp6(6),y.hij(" ",y.lcZ(12,6,i.fundInfor.total_in-i.fundInfor.total_out)," \u0111 "),y.xp6(6),y.hij(" ",y.lcZ(18,8,i.fundInfor.current)," \u0111 "),y.xp6(4),y.hij(" ",y.lcZ(22,10,i.fundInfor.current-(i.fundInfor.total_in-i.fundInfor.total_out))," \u0111 ")}}function Ae(e,t){1&e&&y._UZ(0,"ion-icon",28)}function _e(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"ion-item",24),y.NdJ("click",function(){var e=y.CHM(n),t=e.$implicit,i=e.index,o=y.oxw().$implicit;return y.oxw(3).presentActionSheet(o,t,i)}),y.TgZ(1,"h1",25),y._uU(2),y.qZA(),y.TgZ(3,"ion-label"),y.TgZ(4,"p"),y.YNc(5,Ae,1,0,"ion-icon",26),y._uU(6),y.qZA(),y.TgZ(7,"ion-text"),y.TgZ(8,"small"),y._uU(9),y.qZA(),y.qZA(),y.qZA(),y.TgZ(10,"ion-text",27),y._uU(11),y.ALo(12,"number"),y.qZA(),y.qZA()}if(2&e){var i=t.$implicit;y.xp6(2),y.hij(" ",i.day," "),y.xp6(3),y.Q6J("ngIf",1==+i.confirm),y.xp6(1),y.hij(" ",i.date," "),y.xp6(3),y.hij(" ",i.title," "),y.xp6(1),y.Q6J("color","out"==i.cr?"danger":"primary"),y.xp6(1),y.hij(" ",y.lcZ(12,6,i.amounts_payed)," \u0111 ")}}function be(e,t){if(1&e&&(y.TgZ(0,"ion-card",22),y.YNc(1,_e,13,8,"ion-item",23),y.qZA()),2&e){var n=t.$implicit,i=y.oxw(3);y.xp6(1),y.Q6J("ngForOf",i.moneyOb[n])}}function xe(e,t){1&e&&(y.TgZ(0,"div"),y.TgZ(1,"ion-item",21),y.TgZ(2,"ion-label"),y.TgZ(3,"p"),y._uU(4),y.ALo(5,"translate"),y.qZA(),y.qZA(),y.qZA(),y.qZA()),2&e&&(y.xp6(4),y.Oqu(y.lcZ(5,1,"FARM_MOD.EMPTY")))}function Ce(e,t){if(1&e&&(y.TgZ(0,"ion-list"),y.YNc(1,ye,23,12,"ion-card",18),y.YNc(2,be,2,1,"ion-card",19),y.YNc(3,xe,6,3,"div",10),y.qZA()),2&e){var n=y.oxw(2);y.xp6(1),y.Q6J("ngIf",n.settingService.showDebt),y.xp6(1),y.Q6J("ngForOf",n.labelKey),y.xp6(1),y.Q6J("ngIf",0==n.moneys.length)}}function Te(e,t){if(1&e){var n=y.EpF();y.TgZ(0,"div"),y.YNc(1,Ze,2,0,"div",13),y.YNc(2,Ce,4,3,"ion-list",10),y.TgZ(3,"ion-infinite-scroll",14),y.NdJ("ionInfinite",function(e){return y.CHM(n),y.oxw().loadMore(e)}),y._UZ(4,"ion-infinite-scroll-content",15),y.qZA(),y.qZA()}if(2&e){var i=y.oxw();y.xp6(1),y.Q6J("ngIf",i.loadingFlag.pending),y.xp6(1),y.Q6J("ngIf",i.loadingFlag.result)}}var Oe=function(){return["company_manager","farm_manager","keeper_manager"]},Se=function(){var e=function(){function e(t,n,i,a,r,s,l,u,c,d){o(this,e),this.modalController=t,this.route=n,this.farmService=i,this.moneyService=a,this.toastService=r,this.dbLocalService=s,this.alertController=l,this.translate=u,this.actionSheetController=c,this.settingService=d,this.loadingFlag=new m.E,this.moneys=[],this.moneys_filter=[],this.isFilterAdvice=!1,this.isNull=!0,this.disableLoad=!1,this.view=!1,this.page=1,this.moneyOb={},this.labelKey=[],this.fundInfor={}}return r(e,[{key:"ngOnInit",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.fcode=this.route.snapshot.paramMap.get("id"),console.log(this.fcode),this.moneyService.setCode(this.fcode),this.farmService.setCode(this.fcode),this.getList();case 1:case"end":return e.stop()}},e,this)}))}},{key:"ionViewDidEnter",value:function(){this.view=!0}},{key:"getList",value:function(){var e=this;this.loadingFlag.setPending(!0),this.moneyService.loadMoney(this.page).pipe().subscribe(function(t){0==t.status?(e.toastService.warning(t.error),e.loadingFlag.setResult(!1)):(e.isNull=!1,e.loadingFlag.setResult(!0),1==e.page&&(e.fundInfor=t.fund),e.moneys=t.data,e.processList(t.data),e.processCurrentFund())},function(t){e.toastService.danger(e.translate.instant("ERROR_CONNECT")),e.loadingFlag.setResult(!1)})}},{key:"processList",value:function(e){var t=this;e.forEach(function(e){e.date="thg "+c(1e3*e.add_time).format("M YYYY, dddd"),e.day=c(1e3*e.add_time).format("D");var n=c(1e3*e.add_time).format("MM-YYYY");t.moneyOb[n]?t.moneyOb[n].push(e):(t.labelKey.push(n),t.moneyOb[n]=[e])})}},{key:"processCurrentFund",value:function(){var e=this,t=c().format("MM-YYYY");this.fundInfor.current=this.fundInfor.total_in-this.fundInfor.total_out;var n=0;this.moneyOb[t]&&this.moneyOb[t].forEach(function(t){1==+t.confirm&&("out"==t.cr?e.fundInfor.current-=t.amounts_payed:(e.fundInfor.current+=+t.amounts_payed,4!=t.group_id&&1==t.confirm&&(n+=+t.amounts_payed)))}),console.log(n)}},{key:"loadMore",value:function(e){setTimeout(function(){console.log("Done"),e.target.complete()},500),!this.disableLoad&&(this.page+=1,this.filterParams||this.getList())}},{key:"presentAdd",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:L,componentProps:{fcode:this.fcode}});case 2:return(t=e.sent).onDidDismiss().then(function(e){e.data&&(n.resetData(),n.getList())}),e.next=6,t.present();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}))}},{key:"presentAlertDelete",value:function(e,t){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alertController.create({header:this.translate.instant("MONEY_MOD.DELETE"),message:e.title+" ["+e.amounts+"]",buttons:[{text:this.translate.instant("OPTION.OK"),handler:function(){i.delete({fcode:i.fcode,cr:e.cr,item:e.id},t)}},{text:this.translate.instant("OPTION.CANCEL"),role:"cancel",cssClass:"secondary"}]});case 2:return n.next=4,n.sent.present();case 4:case"end":return n.stop()}},n,this)}))}},{key:"presentEdit",value:function(e,t){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.modalController.create({component:de,componentProps:{fcode:this.fcode,data:e}});case 2:return(n=t.sent).onDidDismiss().then(function(e){e.data&&(i.resetData(),i.getList())}),t.next=6,n.present();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t,this)}))}},{key:"presentSearch",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:me,componentProps:{params:this.filterParams}});case 2:return(t=e.sent).onDidDismiss().then(function(e){var t=e.data;t&&(n.filterParams=t,n.filterAdvice(t))}),e.next=6,t.present();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}))}},{key:"filterAdvice",value:function(e){var t=this;this.loadingFlag.setPending(!0),this.moneyService.search(e).pipe().subscribe(function(e){0==e.status?(t.toastService.warning(e.error),t.loadingFlag.setResult(!1)):(t.isNull=!1,t.loadingFlag.setResult(!0),t.resetData(),t.fundInfor.total_in=e.fund?e.fund.total_in:0,t.fundInfor.total_out=e.fund?e.fund.total_out:0,t.processList(e.data))},function(e){t.toastService.danger(t.translate.instant("ERROR_CONNECT")),t.loadingFlag.setResult(!1)})}},{key:"filter",value:function(e){var t=e.target.value;this.moneys_filter=this.moneys.filter(function(e){return e.title.toLowerCase().indexOf(t.toLowerCase())>-1})}},{key:"resetFilter",value:function(){this.getList(),this.isFilterAdvice=!1,this.filterParams=null}},{key:"delete",value:function(e,t){var n=this;this.moneyService.delete(e).pipe().subscribe(function(e){0==e.status?n.toastService.warning(e.message):(n.toastService.success(n.translate.instant("FARM_MOD.NOTI_DEL_BUDGET")),n.resetData(),n.getList())})}},{key:"presentActionSheet",value:function(e,t,n){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function i(){var o,a,r,s,l,u,c=this;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return console.log(t),o=[{text:this.translate.instant("EDIT"),icon:"pencil",handler:function(){c.presentEdit(t,n)}},{text:this.translate.instant("DELETE"),role:"destructive",icon:"trash",handler:function(){c.presentAlertDelete(t,n)}},{text:this.translate.instant("CANCEL"),icon:"close",role:"cancel",handler:function(){console.log("Cancel clicked")}}],"company_manager"===this.farmService.permission&&this.settingService.showDebt&&(a=1==+t.confirm?0:1,o.unshift({text:this.translate.instant(1==+t.confirm?"UNCONFIRM":"CONFIRM"),icon:1==+t.confirm?"checkbox":"checkbox-outline",handler:function(){c.moneyService.confirmMoney(t.id,t.cr,c.dbLocalService.company.code,a).subscribe(function(t){1==t.status?(c.toastService.success(c.translate.instant("WALL.UPDATE_SUCCESS")),c.moneyOb[e][n].confirm=a,console.log(c.moneyOb[e][n]),c.processCurrentFund()):c.toastService.warning(c.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS"))},function(e){c.toastService.danger(c.translate.instant("ERROR_CONNECT")),c.loadingFlag.setResult(!1)})}})),r=this.moneys.filter(function(e){return 4==+e.group_id&&+e.bill_id==+t.id&&1==+e.confirm&&e.cr===t.cr}).reduce(function(e,t){return e+ +t.amounts_payed},0),""==t.code&&4!=t.group_id&&+t.amounts_payed<+t.amounts&&t.amounts-t.amounts_payed-r>0&&this.settingService.showDebt&&o.unshift({text:this.translate.instant("MONEY_MOD.PAY"),icon:"wallet",handler:function(){c.presentAlertPayDebt(t)}}),i.next=7,this.actionSheetController.create({header:"Actions",cssClass:"my-custom-class",buttons:o});case 7:return s=i.sent,i.next=10,s.present();case 10:return i.next=12,s.onDidDismiss();case 12:l=i.sent,u=l.role,console.log("onDidDismiss resolved with role",u);case 15:case"end":return i.stop()}},i,this)}))}},{key:"presentEstimate",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:pe.u});case 2:return e.next=4,e.sent.present();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}))}},{key:"resetData",value:function(){this.moneyOb={},this.labelKey=[],this.fundInfor={},this.page=1}},{key:"presentCorrectFund",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Ch\u1ec9nh ti\u1ec1n m\u1eb7t",inputs:[{name:"value",type:"number",placeholder:"S\u1ed1 ti\u1ec1n \u0111\xfang"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(e){t.moneyService.updateFund(t.fcode,e.value-t.fundInfor.current).subscribe(function(e){1==e.status?(t.toastService.success(t.translate.instant("WALL.UPDATE_SUCCESS")),t.resetData(),t.getList()):t.toastService.warning(t.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS"))},function(){t.toastService.danger(t.translate.instant("ERROR_CONNECT"))})}}]});case 2:return e.next=4,e.sent.present();case 4:case"end":return e.stop()}},e,this)}))}},{key:"presentCustomer",value:function(){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:fe.D});case 2:return e.next=4,e.sent.present();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}))}},{key:"presentAlertPayDebt",value:function(e){return(0,u.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.moneys.filter(function(t){return 4==+t.group_id&&+t.bill_id==+e.id&&1==+t.confirm&&t.cr==e.cr}).reduce(function(e,t){return e+ +t.amounts_payed},0),console.log(this.moneys.filter(function(e){return 684==+e.bill_id&&4==+e.group_id})),t.next=4,this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("MONEY_MOD.PAY"),inputs:[{name:"date",type:"date",min:c(1e3*e.add_time).format("YYYY-MM-DD"),max:c().format("YYYY-MM-DD"),value:c().format("YYYY-MM-DD")},{name:"amounts",type:"text",id:"name2-id",value:e.amounts-e.amounts_payed-n,placeholder:this.translate.instant("MONEY_MOD.AMOUNT")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(t){if(parseInt(t.amounts)<=0)i.translate.instant("DEVICE_MOD.INVALID_NUMBER");else{var n={id:null,type:e.cr,typeAdd:"farm",title:i.translate.instant("MONEY_MOD.PAY")+" bill #"+e.id,amounts:t.amounts,amounts_payed:t.amounts,today:c(t.date).unix(),fcode:i.fcode,accounting_by:e.accounting_by,group_id:4,bill_id:e.id,customer_name:e.customer_name,code:"",alias:"",confirm:0,cr:e.cr,date:"thg "+c(t.date).format("M YYYY, dddd"),day:c(t.date).format("D")},o=new FormData;for(var a in n)o.append(a,n[a]);i.moneyService.add(o).subscribe(function(e){0==e.status?i.toastService.warning(e.error):(i.toastService.success(i.translate.instant("FARM_MOD.NOTI_ADD_BUDGET")),n.id=e.item_id,console.log(n),c(e.date).format("MM-YYYY"),i.resetData(),i.getList())},function(){i.toastService.danger(i.translate.instant("ERROR_CONNECT"))})}}}]});case 4:return t.next=6,t.sent.present();case 6:case"end":return t.stop()}},t,this)}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(y.Y36(l.IN),y.Y36(s.gz),y.Y36(d.D),y.Y36(f.r),y.Y36(A.k),y.Y36(he.T),y.Y36(l.Br),y.Y36(_.sK),y.Y36(l.BX),y.Y36(b.R))},e.\u0275cmp=y.Xpm({type:e,selectors:[["app-money"]],decls:18,vars:8,consts:[["slot","start"],["text","","defaultHref","tabs/management"],["slot","end"],[3,"appPermission","currentPermission","click"],["name","stats-chart-outline"],[3,"click"],["name","filter-outline","slot","icon-only"],["vertical","bottom","horizontal","end","slot","fixed"],["color","warning",3,"click",4,"ngIf"],["name","create"],[4,"ngIf"],["color","warning",3,"click"],["name","person"],["class","spiner-loading",4,"ngIf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","dots"],[1,"spiner-loading"],["name","dots"],["class","ion-padding-top ion-padding-bottom",3,"click",4,"ngIf"],["class","ion-padding-top ion-padding-bottom",4,"ngFor","ngForOf"],[1,"ion-padding-top","ion-padding-bottom",3,"click"],["lines","none"],[1,"ion-padding-top","ion-padding-bottom"],["lines","none","detail","",3,"click",4,"ngFor","ngForOf"],["lines","none","detail","",3,"click"],[1,"ion-margin-end"],["name","checkmark-circle-outline","color","success",4,"ngIf"],["slot","end",3,"color"],["name","checkmark-circle-outline","color","success"]],template:function(e,t){1&e&&(y.TgZ(0,"ion-header"),y.TgZ(1,"ion-toolbar"),y.TgZ(2,"ion-buttons",0),y._UZ(3,"ion-back-button",1),y.qZA(),y.TgZ(4,"ion-title"),y._uU(5),y.ALo(6,"translate"),y.qZA(),y.TgZ(7,"ion-buttons",2),y.TgZ(8,"ion-button",3),y.NdJ("click",function(){return t.presentEstimate()}),y._UZ(9,"ion-icon",4),y.qZA(),y.TgZ(10,"ion-button",5),y.NdJ("click",function(){return t.presentSearch()}),y._UZ(11,"ion-icon",6),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.TgZ(12,"ion-content"),y.TgZ(13,"ion-fab",7),y.YNc(14,ve,2,0,"ion-fab-button",8),y.TgZ(15,"ion-fab-button",5),y.NdJ("click",function(){return t.presentAdd()}),y._UZ(16,"ion-icon",9),y.qZA(),y.qZA(),y.YNc(17,Te,5,2,"div",10),y.qZA()),2&e&&(y.xp6(5),y.Oqu(y.lcZ(6,5,"FARM_MOD.BUDGET")),y.xp6(3),y.Q6J("appPermission",y.DdM(7,Oe))("currentPermission",t.farmService.permission),y.xp6(6),y.Q6J("ngIf",t.settingService.showDebt),y.xp6(3),y.Q6J("ngIf",t.view))},directives:[l.Gu,l.sr,l.Sm,l.oU,l.cs,l.wd,l.YG,ge.l,l.gu,l.W2,l.IJ,i.O5,l.W4,l.ju,l.MB,l.PQ,l.q_,i.sg,l.PM,l.Ie,l.yW,l.Q$],pipes:[_.X$,i.JJ],styles:[""]}),e}(),Fe=n(54373),qe=n(56209),Ne=n(59865),De=n(24023),Ee=[{path:"",component:Se}],Ye=function(){var e=function e(){o(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=y.oAB({type:e}),e.\u0275inj=y.cJS({providers:[Z.V1,Ne.y],imports:[[i.ez,a.u5,a.UX,l.Pc,s.Bz.forChild(Ee),_.aw.forChild(),Fe.i,qe.Ns,De.E]]}),e}()}}])}();