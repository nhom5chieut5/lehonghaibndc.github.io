!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[706],{62014:function(t,n,o){o.d(n,{y:function(){return a}});var a=function(){function t(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"currency";e(this,t),this.setType(n),this.setInput(i),this.processConvert()}return i(t,[{key:"setInput",value:function(e){"string"!=typeof e&&(e=String(e)),this.input=e}},{key:"setValue",value:function(e){"string"!=typeof e&&(e=String(e)),this.input=e,this.processConvert()}},{key:"setType",value:function(e){this.type=e}},{key:"processConvert",value:function(){var e,t,i=this.input.split(",").join("");if(i.indexOf(".")!=i.lastIndexOf(".")&&(i=i.slice(0,i.lastIndexOf("."))),-1!=i.indexOf(".")){t=i.indexOf(".");var n=i.split(".");i=n[0],"float"===this.type&&(e=n[1].substring(0,2))}else t=i.length;for(var o=new Array,a=1,r=-3;Math.abs(r)<t;r-=3)o.push(i.slice(r,t+r+3)),a++;var s=i.slice(0,t-3*(a-1));s.length>0&&o.push(s),o.reverse();var u=i.replace(/,/gi,""),l="";this.fakeView=o.join(),"float"===this.type&&null!=e&&(this.fakeView=this.fakeView+"."+e,l=e),this.realValue=parseFloat(u+"."+l)}}]),t}()},20706:function(t,n,o){o.d(n,{b:function(){return b}});var a=o(16738),r=o(62014),s=o(27887),u=o(19228),l=o(37716),c=o(84465),d=o(81780),h=o(47063),g=o(38583),p=o(90665);function f(e,t){1&e&&l._UZ(0,"ion-progress-bar",10)}function m(e,t){if(1&e&&(l.TgZ(0,"span"),l._uU(1),l.qZA()),2&e){var i=l.oxw().$implicit;l.xp6(1),l.hij("(",i.pond_name,")")}}function A(e,t){if(1&e){var i=l.EpF();l.TgZ(0,"ion-item"),l.TgZ(1,"ion-checkbox",17),l.NdJ("ngModelChange",function(e){var t=l.CHM(i).index;return l.oxw(2).checkList[t].status=e})("ionChange",function(){var e=l.CHM(i).index;return l.oxw(2).setTotalMoneyDebt(e)}),l.qZA(),l.TgZ(2,"ion-label"),l.TgZ(3,"p"),l._uU(4),l.ALo(5,"date"),l.qZA(),l.TgZ(6,"h3"),l._uU(7),l.YNc(8,m,2,1,"span",9),l.qZA(),l.qZA(),l.TgZ(9,"ion-label",3),l.TgZ(10,"p",18),l.TgZ(11,"ion-text",19),l._uU(12),l.ALo(13,"number"),l.qZA(),l.qZA(),l.TgZ(14,"p",18),l.TgZ(15,"ion-text",19),l._uU(16),l.ALo(17,"translate"),l.ALo(18,"number"),l.qZA(),l.qZA(),l.qZA(),l.qZA()}if(2&e){var n=t.$implicit,o=t.index,a=l.oxw(2);l.xp6(1),l.Q6J("ngModel",a.checkList[o].status),l.xp6(3),l.hij(" ",l.xi3(5,7,1e3*n.add_time,"d-MM-Y")," "),l.xp6(3),l.hij(" ",n.title," "),l.xp6(1),l.Q6J("ngIf",n.pond_name),l.xp6(4),l.hij(" ",l.lcZ(13,10,n.amounts),"\u0111 "),l.xp6(4),l.AsE(" ",l.lcZ(17,12,"MONEY_MOD.DEBT")," ",l.lcZ(18,14,n.debt_payed),"\u0111 ")}}function Z(e,t){1&e&&(l.TgZ(0,"p"),l.TgZ(1,"ion-text",19),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.qZA()),2&e&&(l.xp6(2),l.hij(" ",l.lcZ(3,1,"MONEY_MOD.WARNING_MAX_DEBT")," "))}function v(e,t){if(1&e){var i=l.EpF();l.TgZ(0,"div"),l.TgZ(1,"ion-list"),l.YNc(2,A,19,16,"ion-item",11),l.qZA(),l.TgZ(3,"div",12),l.TgZ(4,"ion-item",13),l.TgZ(5,"ion-label"),l._uU(6),l.ALo(7,"translate"),l.qZA(),l.TgZ(8,"ion-datetime",14),l.NdJ("ngModelChange",function(e){return l.CHM(i),l.oxw().date=e}),l.ALo(9,"translate"),l.qZA(),l.qZA(),l.TgZ(10,"ion-item",13),l.TgZ(11,"ion-label",15),l._uU(12),l.ALo(13,"translate"),l.qZA(),l.TgZ(14,"ion-input",16),l.NdJ("ionChange",function(e){return l.CHM(i),l.oxw().numberFormat.setValue(e.detail.value)}),l.qZA(),l.qZA(),l.YNc(15,Z,4,3,"p",9),l.qZA(),l.qZA()}if(2&e){var n=l.oxw();l.xp6(2),l.Q6J("ngForOf",n.list),l.xp6(4),l.Oqu(l.lcZ(7,9,"FARM_MOD.DATE")),l.xp6(2),l.Q6J("displayFormat",l.lcZ(9,11,"FORMAT_DATE_MOMENT"))("ngModel",n.date)("min",n.minDate.format("YYYY-MM-DD"))("max",n.maxDate.format("YYYY-MM-DD")),l.xp6(4),l.hij(" ",l.lcZ(13,13,"MONEY_MOD.AMOUNT")," "),l.xp6(2),l.Q6J("value",n.numberFormat.fakeView),l.xp6(1),l.Q6J("ngIf",n.numberFormat.realValue>n.maxAmounts)}}function y(e,t){if(1&e&&(l.TgZ(0,"span"),l._uU(1),l.qZA()),2&e){var i=l.oxw().$implicit;l.xp6(1),l.hij("(",i.pond_name,")")}}function x(e,t){if(1&e){var i=l.EpF();l.TgZ(0,"ion-item"),l.TgZ(1,"ion-checkbox",17),l.NdJ("ngModelChange",function(e){var t=l.CHM(i).index;return l.oxw(2).checkList[t].status=e})("ionChange",function(){var e=l.CHM(i).index;return l.oxw(2).setTotalMoneyDebt(e)}),l.qZA(),l.TgZ(2,"ion-label"),l.TgZ(3,"p"),l._uU(4),l.ALo(5,"date"),l.qZA(),l.TgZ(6,"h3"),l._uU(7),l.YNc(8,y,2,1,"span",9),l.qZA(),l.qZA(),l.TgZ(9,"ion-label",3),l.TgZ(10,"p",18),l.TgZ(11,"ion-text",19),l._uU(12),l.ALo(13,"number"),l.qZA(),l.qZA(),l.TgZ(14,"p",18),l.TgZ(15,"ion-text",19),l._uU(16),l.ALo(17,"translate"),l.ALo(18,"number"),l.qZA(),l.qZA(),l.qZA(),l.qZA()}if(2&e){var n=t.$implicit,o=t.index,a=l.oxw(2);l.xp6(1),l.Q6J("ngModel",a.checkList[o].status),l.xp6(3),l.hij(" ",l.xi3(5,7,1e3*n.add_time,"d-MM-Y")," "),l.xp6(3),l.hij(" ",n.title," "),l.xp6(1),l.Q6J("ngIf",n.pond_name),l.xp6(4),l.hij(" ",l.lcZ(13,10,n.amounts),"\u0111 "),l.xp6(4),l.AsE(" ",l.lcZ(17,12,"MONEY_MOD.DEBT")," ",l.lcZ(18,14,n.debt_payed),"\u0111 ")}}function q(e,t){1&e&&(l.TgZ(0,"p"),l.TgZ(1,"ion-text",19),l._uU(2),l.ALo(3,"translate"),l.qZA(),l.qZA()),2&e&&(l.xp6(2),l.hij(" ",l.lcZ(3,1,"MONEY_MOD.WARNING_MAX_DEBT")," "))}function M(e,t){if(1&e){var i=l.EpF();l.TgZ(0,"div"),l.TgZ(1,"ion-list"),l.YNc(2,x,19,16,"ion-item",11),l.qZA(),l.TgZ(3,"div",12),l.TgZ(4,"ion-item",13),l.TgZ(5,"ion-label"),l._uU(6),l.ALo(7,"translate"),l.qZA(),l.TgZ(8,"ion-datetime",14),l.NdJ("ngModelChange",function(e){return l.CHM(i),l.oxw().date=e}),l.ALo(9,"translate"),l.qZA(),l.qZA(),l.TgZ(10,"ion-item",13),l.TgZ(11,"ion-label",15),l._uU(12),l.ALo(13,"translate"),l.qZA(),l.TgZ(14,"ion-input",16),l.NdJ("ionChange",function(e){return l.CHM(i),l.oxw().numberFormat.setValue(e.detail.value)}),l.qZA(),l.qZA(),l.YNc(15,q,4,3,"p",9),l.qZA(),l.qZA()}if(2&e){var n=l.oxw();l.xp6(2),l.Q6J("ngForOf",n.list),l.xp6(4),l.Oqu(l.lcZ(7,9,"FARM_MOD.DATE")),l.xp6(2),l.Q6J("displayFormat",l.lcZ(9,11,"FORMAT_DATE_MOMENT"))("ngModel",n.date)("min",n.minDate.format("YYYY-MM-DD"))("max",n.maxDate.format("YYYY-MM-DD")),l.xp6(4),l.hij(" ",l.lcZ(13,13,"MONEY_MOD.AMOUNT")," "),l.xp6(2),l.Q6J("value",n.numberFormat.fakeView),l.xp6(1),l.Q6J("ngIf",n.numberFormat.realValue>n.maxAmounts)}}var T,b=((T=function(){function t(i,n,o,u){e(this,t),this.moneyService=i,this.toastService=n,this.translate=o,this.modalController=u,this.list=[],this.checkList=[],this.loadingFlag=new s.E,this.numberFormat=new r.y(""),this.maxAmounts=0,this.amounts=0,this.date=a().format("YYYY-MM-DD"),this.maxDate=a(),this.minDate=a().subtract(180,"days"),this.type="out"}return i(t,[{key:"ngOnInit",value:function(){this.getListBill()}},{key:"getListBill",value:function(){var e=this;this.moneyService.getDebtCustomer(this.item.customer_slug,this.type).subscribe(function(t){0==t.status?e.toastService.warning(t.error):(e.list=t.data,e.checkList=e.list.map(function(e){return{bill_id:e.id,add_time:e.add_time,value:+e.debt_payed,status:!0,customer:e.customer_name}}),e.maxAmounts=e.checkList.reduce(function(e,t){return e+t.value},0),console.log(e.maxAmounts),e.numberFormat.setValue(e.maxAmounts),e.minDate=a(Math.max.apply(null,e.checkList.map(function(e){return e.status?1e3*e.add_time:0})))),e.loadingFlag.setResult(!0)},function(){e.loadingFlag.setResult(!1),e.toastService.danger(e.translate.instant("ERROR_CONNECT"))})}},{key:"save",value:function(){var e=this,t=this.numberFormat.realValue,i=[];this.checkList.forEach(function(n){n.status&&n.value>0&&t>0&&(i.push({bill_id:n.bill_id,value:n.value<t?n.value:t,title:e.translate.instant("MONEY_MOD.PAY")+" bill #"+n.bill_id,customer:n.customer}),t=n.value<t?t-n.value:0)}),this.loadingFlag.setPending(!0),this.moneyService.addMultiDebtRecord({type:this.type,date:a(this.date).valueOf()/1e3,rows:i}).subscribe(function(t){0==t.status?e.toastService.warning(t.error):(e.toastService.success(e.translate.instant("SHOP.CART.ADDRESS.UPDATE_SUCCESS")),e.modalController.dismiss()),e.loadingFlag.setResult(!0)},function(){e.loadingFlag.setResult(!1),e.toastService.danger(e.translate.instant("ERROR_CONNECT"))})}},{key:"setTotalMoneyDebt",value:function(e){this.numberFormat.setValue(this.checkList[e].status?this.checkList[e].value+this.numberFormat.realValue>this.maxAmounts?this.maxAmounts:this.checkList[e].value+this.numberFormat.realValue:this.numberFormat.realValue-this.checkList[e].value<=0?0:this.numberFormat.realValue-this.checkList[e].value),this.minDate=a(Math.max.apply(null,this.checkList.map(function(e){return e.status?1e3*e.add_time:0}))),a(this.date)<a(this.minDate)&&(this.date=a(this.minDate).format("YYYY-MM-DD"))}},{key:"segmentChanged",value:function(e){this.getListBill()}}]),t}()).\u0275fac=function(e){return new(e||T)(l.Y36(u.r),l.Y36(c.k),l.Y36(d.sK),l.Y36(h.IN))},T.\u0275cmp=l.Xpm({type:T,selectors:[["app-money-debt"]],inputs:{item:"item"},decls:25,vars:17,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],["type","indeterminate",4,"ngIf"],["mode","ios",3,"ngModel","ngModelChange","ionChange"],["value","out"],["value","in"],[4,"ngIf"],["type","indeterminate"],[4,"ngFor","ngForOf"],[1,"ion-padding"],["lines","inset"],[3,"displayFormat","ngModel","min","max","ngModelChange"],["position","floating"],["type","tel","inputmode","decimal",3,"value","ionChange"],["slot","start",3,"ngModel","ngModelChange","ionChange"],[1,"ion-text-end"],["color","danger"]],template:function(e,t){1&e&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-buttons",0),l.TgZ(3,"ion-button",1),l.NdJ("click",function(){return t.modalController.dismiss(!1)}),l._UZ(4,"ion-icon",2),l.qZA(),l.qZA(),l.TgZ(5,"ion-title"),l._uU(6),l.ALo(7,"translate"),l.qZA(),l.TgZ(8,"ion-buttons",3),l.TgZ(9,"ion-button",4),l.NdJ("click",function(){return t.save()}),l._uU(10),l.ALo(11,"translate"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(12,"ion-content"),l.YNc(13,f,1,0,"ion-progress-bar",5),l.TgZ(14,"ion-segment",6),l.NdJ("ngModelChange",function(e){return t.type=e})("ionChange",function(e){return t.segmentChanged(e)}),l.TgZ(15,"ion-segment-button",7),l.TgZ(16,"ion-label"),l._uU(17),l.ALo(18,"translate"),l.qZA(),l.qZA(),l.TgZ(19,"ion-segment-button",8),l.TgZ(20,"ion-label"),l._uU(21),l.ALo(22,"translate"),l.qZA(),l.qZA(),l.qZA(),l.YNc(23,v,16,15,"div",9),l.YNc(24,M,16,15,"div",9),l.qZA()),2&e&&(l.xp6(6),l.Oqu(l.lcZ(7,9,"MONEY_MOD.PAY")),l.xp6(3),l.Q6J("disabled",t.numberFormat.realValue<=0||t.numberFormat.realValue>t.maxAmounts||0==t.list.length),l.xp6(1),l.hij(" ",l.lcZ(11,11,"FARM_MOD.SAVE")," "),l.xp6(3),l.Q6J("ngIf",t.loadingFlag.pending),l.xp6(1),l.Q6J("ngModel",t.type),l.xp6(3),l.Oqu(l.lcZ(18,13,"MONEY_MOD.NEED_PAY")),l.xp6(4),l.Oqu(l.lcZ(22,15,"MONEY_MOD.NEED_COLLECT")),l.xp6(2),l.Q6J("ngIf","out"==t.type),l.xp6(1),l.Q6J("ngIf","in"==t.type))},directives:[h.Gu,h.sr,h.Sm,h.YG,h.gu,h.wd,h.W2,g.O5,h.cJ,h.QI,p.JJ,p.On,h.GO,h.Q$,h.X7,h.q_,g.sg,h.Ie,h.x4,h.pK,h.j9,h.nz,h.w,h.yW],pipes:[d.X$,g.uU,g.JJ],styles:[""]}),T)},19228:function(t,n,o){o.d(n,{r:function(){return l}});var a,r=o(15189),s=o(88002),u=o(37716),l=((a=function(){function t(i){e(this,t),this.reqAPIService=i,this.urlApi="/manager/money-api-mobie",this.urlApiNew="/manager/finance-api"}return i(t,[{key:"setCode",value:function(e){this.fcode=e,console.log(this.fcode)}},{key:"loadMoney",value:function(e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=list&page="+e).pipe((0,s.U)(function(e){return e}))}},{key:"search",value:function(e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=search&keyword="+e.keyword+"&type="+e.type+"&timeFrom="+e.timeFrom+"&timeTo="+e.timeTo+"&page=0&numRow=20").pipe((0,s.U)(function(e){return e}))}},{key:"quickSearch",value:function(e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=quick-search&type="+e.type+"&keyword="+e.keyword).pipe((0,s.U)(function(e){return e}))}},{key:"add",value:function(e){return this.reqAPIService.postApiWithFile("add",e,"&fcode="+this.fcode,this.urlApiNew)}},{key:"edit",value:function(e){return this.reqAPIService.postApiWithFile("edit",e,"&fcode="+this.fcode+"&item="+e.get("id")+"&cr="+e.get("type"),this.urlApiNew)}},{key:"editGroup",value:function(e){return this.reqAPIService.postApiWithFile("editTypeAll",e,"&fcode="+this.fcode+"&item="+e.get("id")+"&cr="+e.get("type"),this.urlApiNew)}},{key:"delete",value:function(e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=detele&item="+e.item+"&cr="+e.cr)}},{key:"getAnalyst",value:function(e){return this.reqAPIService.post(this.urlApiNew+"?fcode="+this.fcode+"&action=analyst",e)}},{key:"getGroup",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=getItemByCode&code="+e+"&cr="+t)}},{key:"getCategories",value:function(){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=listCategory")}},{key:"confirmMoney",value:function(e,t,i,n){return this.reqAPIService.get(this.urlApiNew+"?action=confirm&ccode="+i+"&cr="+t+"&id="+e+"&confirm="+n)}},{key:"updateFund",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=updateFund&fcode="+e+"&value="+t)}},{key:"addCategory",value:function(e){return this.reqAPIService.post(this.urlApiNew+"?action=addCategory&fcode="+this.fcode,e)}},{key:"searchCustomer",value:function(e,t){return this.reqAPIService.post(this.urlApiNew+"?action=searchCustomer&fcode="+this.fcode,{name:e,type:t})}},{key:"getBill",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=get&fcode="+this.fcode+"&type="+t+"&id="+e)}},{key:"getCustomers",value:function(){return this.reqAPIService.get(this.urlApiNew+"?action=getCustomers&fcode="+this.fcode)}},{key:"getACustomer",value:function(e){return this.reqAPIService.get(this.urlApiNew+"?action=getACustomer&fcode="+this.fcode+"&customer_slug="+e)}},{key:"getDebtCustomer",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtCustomer&type="+t+"&fcode="+this.fcode+"&customer_slug="+e)}},{key:"addMultiDebtRecord",value:function(e){return this.reqAPIService.post(this.urlApiNew+"?action=addMultiDebt&fcode="+this.fcode,e)}},{key:"getBillByAlias",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=getByAlias&fcode="+this.fcode+"&alias="+e+"&type="+t)}},{key:"getListMoneyByGroup",value:function(){return this.reqAPIService.get(this.urlApiNew+"?action=getListMoneyByGroup&fcode="+this.fcode)}},{key:"getDetailByGroup",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=getDetailByGroup&fcode="+this.fcode+"&group="+e+"&type="+t)}},{key:"getDebtByGroup",value:function(e,t){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtByGroup&type="+t+"&fcode="+this.fcode+"&group="+e)}}]),t}()).\u0275fac=function(e){return new(e||a)(u.LFG(r.$))},a.\u0275prov=u.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a)}}])}();