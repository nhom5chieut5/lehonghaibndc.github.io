"use strict";(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[2166],{62166:function(e,t,i){i.d(t,{M:function(){return S}});var s=i(64762),n=i(27887),r=i(92760),o=i(81933),c=i(82629),a=i(50384),d=i(37716),p=i(47063),h=i(81780),l=i(13619),u=i(84465),T=i(38583);function A(e,t){1&e&&(d.TgZ(0,"div"),d._UZ(1,"ion-spinner",9),d.qZA())}function v(e,t){if(1&e&&(d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label"),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",3),d._uU(5),d.ALo(6,"date"),d.ALo(7,"translate"),d.qZA(),d.qZA()),2&e){const e=d.oxw(2);d.xp6(2),d.Oqu(d.lcZ(3,2,"CROP")),d.xp6(3),d.Oqu(d.xi3(6,4,1e3*e.item.start_time,d.lcZ(7,7,"FORMAT_DATE")))}}function g(e,t){if(1&e&&(d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label"),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",3),d._uU(5),d.qZA(),d.qZA()),2&e){const e=d.oxw(2);d.xp6(2),d.Oqu(d.lcZ(3,2,"POND")),d.xp6(3),d.Oqu(e.item.pond_name)}}function m(e,t){if(1&e&&(d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label"),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",3),d._uU(5),d.qZA(),d.qZA()),2&e){const e=d.oxw(2);d.xp6(2),d.Oqu(d.lcZ(3,2,"FARM")),d.xp6(3),d.Oqu(e.item.farm_name)}}function _(e,t){if(1&e&&(d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label"),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",3),d._uU(5),d.qZA(),d.qZA()),2&e){const e=d.oxw(2);d.xp6(2),d.Oqu(d.lcZ(3,2,"TRACEABILITY_MOD.OWNER")),d.xp6(3),d.Oqu(e.item.company_name)}}function q(e,t){1&e&&(d.TgZ(0,"div",10),d.TgZ(1,"p"),d.TgZ(2,"ion-text",11),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA(),d.qZA()),2&e&&(d.xp6(3),d.Oqu(d.lcZ(4,1,"TRACEABILITY_MOD.YOU_NOT_HAVE_PERMISSION")))}function Z(e,t){if(1&e&&(d.TgZ(0,"ion-list"),d.YNc(1,v,8,9,"ion-item",6),d.YNc(2,g,6,4,"ion-item",6),d.YNc(3,m,6,4,"ion-item",6),d.YNc(4,_,6,4,"ion-item",6),d.YNc(5,q,5,3,"div",8),d.qZA()),2&e){const e=d.oxw();d.xp6(1),d.Q6J("ngIf","CROP"==e.obj&&e.item.start_time),d.xp6(1),d.Q6J("ngIf",e.item.pond_name),d.xp6(1),d.Q6J("ngIf",e.item.farm_name),d.xp6(1),d.Q6J("ngIf",e.item.company_name),d.xp6(1),d.Q6J("ngIf",!e.showBrow&&e.notPermisson)}}function F(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",4),d.TgZ(1,"ion-button",12),d.NdJ("click",function(){d.CHM(e);const t=d.oxw();return t.toManagent(t.item)}),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.qZA()}2&e&&(d.xp6(2),d.hij(" ",d.lcZ(3,1,"TRACEABILITY_MOD.BROWSE"),""))}function f(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",4),d.TgZ(1,"ion-button",12),d.NdJ("click",function(){return d.CHM(e),d.oxw().toTrace()}),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.qZA()}2&e&&(d.xp6(2),d.hij("",d.lcZ(3,1,"TRACEABILITY")," "))}function P(e,t){1&e&&(d.TgZ(0,"div",10),d.TgZ(1,"p"),d.TgZ(2,"ion-text",11),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA(),d.qZA()),2&e&&(d.xp6(3),d.Oqu(d.lcZ(4,1,"TRACEABILITY_MOD.NOT_HAVE_CODE")))}let S=(()=>{class e{constructor(e,t,i,s,r,o,c,a){this.modalController=e,this.translate=t,this.router=i,this.traceAbility=s,this.toastService=r,this.barcodeScanner=o,this.iotService=c,this.authService=a,this.code="",this.obj="TRAC",this.message="",this.loadingFlag=new n.E,this.showBrow=!1,this.notPermisson=!0}ngOnInit(){this.qrScan()}qrScan(){this.code="",this.barcodeScanner.scan().then(e=>{this.processCode(e.text)}).catch(e=>{this.toastService.warning(this.translate.instant("ERROR_CAMERA"))})}processCode(e){let t=e.slice(0,4).toUpperCase();"FARM"===t||"POND"===t||"CROP"===t||"IOTS"==t?(this.obj=t,this.code=e.slice(5,e.length)):this.code=e,"TRAC"===this.obj?this.toTrace():"IOTS"==this.obj?this.processDevice():(this.loadingFlag.setStart(!0),this.traceAbility.getInfo(this.code,this.obj).subscribe(e=>{1==e.status?(console.log(e),this.item=e.data.data,e.data.permission.length>0?(this.showBrow=!0,this.notPermisson=!1):this.notPermisson=!0):this.message=e.message,this.loadingFlag.setResult(!0)},()=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))}))}toTrace(){this.modalController.dismiss(),this.router.navigateByUrl("/traceability/result/"+this.code)}processDevice(){return(0,s.mG)(this,void 0,void 0,function*(){if(this.loadingFlag.setPending(!0),yield this.getDevice(),this.inforDevice){let e={queryParams:this.inforDevice};console.log(this.inforDevice),this.loadingFlag.setResult(!0),this.modalController.dismiss(),this.router.navigate(["add-device"],e)}else this.loadingFlag.setResult(!0),this.modalController.dismiss(),this.toastService.warning(this.translate.instant("DEVICE_MOD.NOT_RECEIVE"))})}getDevice(){return(0,s.mG)(this,void 0,void 0,function*(){this.inforDevice=null;const e=yield this.iotService.check(this.code).catch(()=>{this.loadingFlag.setResult(!1),this.modalController.dismiss(),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});e&&1==e.status?this.inforDevice={device_id:e.data.id,type:e.data.type,code:this.code}:e&&0==e.status&&this.toastService.warning(e.messages)})}toManagent(e){this.modalController.dismiss();let t=this.obj.toLowerCase();this.router.navigateByUrl("farm"===t||"pond"===t?"/"+t+"/"+this.code:"/pond/"+e.pond_code+"/history/"+this.code)}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(p.IN),d.Y36(h.sK),d.Y36(l.F0),d.Y36(o.X),d.Y36(u.k),d.Y36(r.m),d.Y36(c.d),d.Y36(a.e))},e.\u0275cmp=d.Xpm({type:e,selectors:[["app-scan"]],inputs:{pondsOb:"pondsOb"},decls:22,vars:12,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[1,"ion-padding","ion-text-center"],[1,"ion-padding"],[4,"ngIf"],["class","ion-padding ion-text-center",4,"ngIf"],["class","ion-text-center ion-padding","lines","none",4,"ngIf"],["name","dots"],["lines","none",1,"ion-text-center","ion-padding"],["color","danger"],["shape","round","fill","outline","color","primary",3,"click"]],template:function(e,t){1&e&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-buttons",0),d.TgZ(3,"ion-button",1),d.NdJ("click",function(){return t.modalController.dismiss()}),d._UZ(4,"ion-icon",2),d.qZA(),d.qZA(),d.TgZ(5,"ion-title"),d._uU(6),d.ALo(7,"translate"),d.qZA(),d.TgZ(8,"ion-buttons",3),d.TgZ(9,"ion-button",1),d.NdJ("click",function(){return t.qrScan()}),d._uU(10),d.ALo(11,"translate"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(12,"ion-content"),d.TgZ(13,"div",4),d.TgZ(14,"div",5),d.TgZ(15,"h3"),d._uU(16),d.qZA(),d.qZA(),d.YNc(17,A,2,0,"div",6),d.qZA(),d.YNc(18,Z,6,5,"ion-list",6),d.YNc(19,F,4,3,"div",7),d.YNc(20,f,4,3,"div",7),d.YNc(21,P,5,3,"div",8),d.qZA()),2&e&&(d.xp6(6),d.Oqu(d.lcZ(7,8,"SCAN")),d.xp6(4),d.Oqu(d.lcZ(11,10,"RE_SCAN")),d.xp6(6),d.hij("#",t.code,""),d.xp6(1),d.Q6J("ngIf",t.loadingFlag.pending),d.xp6(1),d.Q6J("ngIf",t.loadingFlag.result&&t.item),d.xp6(1),d.Q6J("ngIf",t.showBrow),d.xp6(1),d.Q6J("ngIf","TRAC"==t.obj&&""!=t.code),d.xp6(1),d.Q6J("ngIf",""==t.code))},directives:[p.Gu,p.sr,p.Sm,p.YG,p.gu,p.wd,p.W2,T.O5,p.PQ,p.q_,p.Ie,p.Q$,p.yW],pipes:[h.X$,T.uU],styles:[""]}),e})()},82629:function(e,t,i){i.d(t,{d:function(){return r}});var s=i(15189),n=i(37716);let r=(()=>{class e{constructor(e){this.reqApiService=e,this.PATH_FT="http://35.240.204.122:8882/farmext",this.PATH_DEVICE="/manager/device-api",this.PATH_ADD_DEVICE="/manager/add-device-api",this.SITE_PATH_API="http://35.240.204.122:8882/api",this.listPermision=["company_manager","farm_manager","pond_manager"]}checkPermission(e){return!!this.listPermision.includes(e)}setPondCode(e){this.pcode=e}list(){return this.reqApiService.get(this.PATH_DEVICE+"?action=list&pcode="+this.pcode).toPromise()}get(e){return this.reqApiService.get(this.PATH_DEVICE+"?action=get&device_id_fb="+e+"&pcode="+this.pcode).toPromise()}update(e,t){return this.reqApiService.post(this.PATH_DEVICE+"?action=update&id="+t+"&pcode="+this.pcode,{name:e,pond_code:this.pcode}).toPromise()}add(e){return this.reqApiService.post(this.PATH_ADD_DEVICE,e).toPromise()}move(e,t,i){return this.reqApiService.post(this.PATH_DEVICE+"?action=update&id="+i+"&pcode="+this.pcode,{name:e,pond_code:t}).toPromise()}remove(e){return this.reqApiService.get(this.PATH_DEVICE+"?action=remove&id="+e+"&pcode="+this.pcode).toPromise()}check(e){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/qr/"+e).toPromise()}active(e){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/qr/"+e,{}).toPromise()}changeStatusContactor(e,t,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+i+"/peripherals/"+t+"/control",e)}getInforDevice(e){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+e).toPromise()}getListCondition(e,t){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/subscribes")}removeCondition(e,t,i){return this.reqApiService.deleteTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/subscribes/"+i)}addCondition(e,t,i){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/subscribes",i)}updateNameContactor(e,t,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e,i)}updateTimer(e,t,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/timer",i)}updateSetting(e,t){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/setting",t).toPromise()}addConditonPub(e,t,i){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/conditions",i)}updateConditonPub(e,t,i,s){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/conditions/"+i,s)}removeConditionPub(e,t,i){return this.reqApiService.deleteTokenFt(this.PATH_FT+"/v2/devices/"+e+"/peripherals/"+t+"/conditions/"+i)}saveAutoRecord(e,t){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e+"/third-setting",t)}commandFeeding(e,t){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+e+"/command",t)}removeTimer(e,t,i){return this.reqApiService.deleteTokenFt(this.PATH_FT+"/v2/devices/"+i+"/peripherals/"+t+"/timer/"+e)}addTimer(e,t,i){return this.reqApiService.postTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/timer",i)}updateTimerFeed(e,t,i,s){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+i+"/peripherals/"+t+"/timer/"+e,s)}plus_analyze(e,t,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/plus_analyze",i)}abstract_analyze(e,t,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/abstract_analyze",i)}asyncData(e,t,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/sync",i)}removeDataFeed(e,t,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/clear",i)}updateCommonSetting(e,t){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+e,t)}getListRepast(e,t){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/data")}getSuggestCalib(e,t,i,s){return this.reqApiService.getTokenFt(this.PATH_FT+"/v2/devices/"+s+"/get-suggest-calib?feed="+i+"&start="+e+"&end="+t)}quickAddRepast(e,t,i){return this.reqApiService.putTokenFt(this.PATH_FT+"/v2/devices/"+t+"/peripherals/"+e+"/timer/feed",i)}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(s.$))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},81933:function(e,t,i){i.d(t,{X:function(){return r}});var s=i(15189),n=i(37716);let r=(()=>{class e{constructor(e){this.reqAPIService=e,this.URL_API="/traceability/traceability-api"}getCrop(e){return this.reqAPIService.get(this.URL_API+"?action=trace&code="+e)}getInfo(e,t){return this.reqAPIService.get(this.URL_API+"?action=scan&object="+t+"&code="+e)}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(s.$))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);