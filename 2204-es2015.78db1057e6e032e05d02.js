"use strict";(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[2204],{54395:function(t,e,i){i.d(e,{b:function(){return s}});var n=i(77393),o=i(33637);function s(t,e=o.P){return i=>i.lift(new a(t,e))}class a{constructor(t,e){this.dueTime=t,this.scheduler=e}call(t,e){return e.subscribe(new r(t,this.dueTime,this.scheduler))}}class r extends n.L{constructor(t,e,i){super(t),this.dueTime=e,this.scheduler=i,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(l,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:t}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}}clearDebounce(){const t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}function l(t){t.debouncedNext()}},62014:function(t,e,i){i.d(e,{y:function(){return n}});class n{constructor(t,e="currency"){this.setType(e),this.setInput(t),this.processConvert()}setInput(t){"string"!=typeof t&&(t=String(t)),this.input=t}setValue(t){"string"!=typeof t&&(t=String(t)),this.input=t,this.processConvert()}setType(t){this.type=t}processConvert(){let t,e,i=this.input.split(",").join("");if(i.indexOf(".")!=i.lastIndexOf(".")&&(i=i.slice(0,i.lastIndexOf("."))),-1!=i.indexOf(".")){e=i.indexOf(".");let n=i.split(".");i=n[0],"float"===this.type&&(t=n[1].substring(0,2))}else e=i.length;let n=new Array,o=1;for(var s=-3;Math.abs(s)<e;s-=3)n.push(i.slice(s,e+s+3)),o++;let a=i.slice(0,e-3*(o-1));a.length>0&&n.push(a),n.reverse();let r=i.replace(/,/gi,""),l="";this.fakeView=n.join(),"float"===this.type&&null!=t&&(this.fakeView=this.fakeView+"."+t,l=t),this.realValue=parseFloat(r+"."+l)}}},19228:function(t,e,i){i.d(e,{r:function(){return a}});var n=i(15189),o=i(88002),s=i(37716);let a=(()=>{class t{constructor(t){this.reqAPIService=t,this.urlApi="/manager/money-api-mobie",this.urlApiNew="/manager/finance-api"}setCode(t){this.fcode=t,console.log(this.fcode)}loadMoney(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=list&page="+t).pipe((0,o.U)(t=>t))}search(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=search&keyword="+t.keyword+"&type="+t.type+"&timeFrom="+t.timeFrom+"&timeTo="+t.timeTo+"&page=0&numRow=20").pipe((0,o.U)(t=>t))}quickSearch(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=quick-search&type="+t.type+"&keyword="+t.keyword).pipe((0,o.U)(t=>t))}add(t){return this.reqAPIService.postApiWithFile("add",t,"&fcode="+this.fcode,this.urlApiNew)}edit(t){return this.reqAPIService.postApiWithFile("edit",t,"&fcode="+this.fcode+"&item="+t.get("id")+"&cr="+t.get("type"),this.urlApiNew)}editGroup(t){return this.reqAPIService.postApiWithFile("editTypeAll",t,"&fcode="+this.fcode+"&item="+t.get("id")+"&cr="+t.get("type"),this.urlApiNew)}delete(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=detele&item="+t.item+"&cr="+t.cr)}getAnalyst(t){return this.reqAPIService.post(this.urlApiNew+"?fcode="+this.fcode+"&action=analyst",t)}getGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=getItemByCode&code="+t+"&cr="+e)}getCategories(){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=listCategory")}confirmMoney(t,e,i,n){return this.reqAPIService.get(this.urlApiNew+"?action=confirm&ccode="+i+"&cr="+e+"&id="+t+"&confirm="+n)}updateFund(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=updateFund&fcode="+t+"&value="+e)}addCategory(t){return this.reqAPIService.post(this.urlApiNew+"?action=addCategory&fcode="+this.fcode,t)}searchCustomer(t,e){return this.reqAPIService.post(this.urlApiNew+"?action=searchCustomer&fcode="+this.fcode,{name:t,type:e})}getBill(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=get&fcode="+this.fcode+"&type="+e+"&id="+t)}getCustomers(){return this.reqAPIService.get(this.urlApiNew+"?action=getCustomers&fcode="+this.fcode)}getACustomer(t){return this.reqAPIService.get(this.urlApiNew+"?action=getACustomer&fcode="+this.fcode+"&customer_slug="+t)}getDebtCustomer(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtCustomer&type="+e+"&fcode="+this.fcode+"&customer_slug="+t)}addMultiDebtRecord(t){return this.reqAPIService.post(this.urlApiNew+"?action=addMultiDebt&fcode="+this.fcode,t)}getBillByAlias(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getByAlias&fcode="+this.fcode+"&alias="+t+"&type="+e)}getListMoneyByGroup(){return this.reqAPIService.get(this.urlApiNew+"?action=getListMoneyByGroup&fcode="+this.fcode)}getDetailByGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDetailByGroup&fcode="+this.fcode+"&group="+t+"&type="+e)}getDebtByGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtByGroup&type="+e+"&fcode="+this.fcode+"&group="+t)}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(n.$))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},92204:function(t,e,i){i.r(e),i.d(e,{PondPageModule:function(){return fr}});var n=i(38583),o=i(90665),s=i(13619),a=i(47063),r=i(56209),l=i(64762),c=i(80272),d=i(27887),u=i(16738),h=i(37716),g=i(81780);function p(t,e){1&t&&(h.TgZ(0,"div",8),h._UZ(1,"ion-spinner",9),h.qZA())}function m(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label",10),h.TgZ(2,"p"),h.TgZ(3,"ion-text",11),h._uU(4),h.qZA(),h._uU(5),h.qZA(),h.TgZ(6,"h3"),h._uU(7),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.xp6(4),h.Oqu(t.vendor_name),h.xp6(1),h.hij(" ",t.time," "),h.xp6(2),h.Oqu(t.message)}}function Z(t,e){if(1&t&&(h.TgZ(0,"div",12),h.TgZ(1,"p"),h._uU(2),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(2),h.Oqu(t.message)}}let f=(()=>{class t{constructor(t,e,i){this.modalCtrl=t,this.pondService=e,this.translate=i,this.loadingFlag=new d.E,this.alertItems=[],this.message="",this.pageIndex=0}ngOnInit(){this.loadAlerList()}loadAlerList(){this.loadingFlag.setPending(!0),this.pondService.getAlertList(this.pageIndex).pipe().subscribe(t=>{t.data&&t.data.length>0&&t.data.map(t=>{t.time=u(1e3*t.add_time).fromNow(),this.alertItems.push(t)}),this.alertItems.length<10&&(this.infiniteScroll.disabled=!this.infiniteScroll.disabled),this.loadingFlag.setResult(!0)},t=>{this.loadingFlag.setResult(!1),this.message=this.translate.instant("ERROR_CONNECT")})}loadData(t){this.pageIndex++,this.pondService.getAlertList(this.pageIndex).pipe().subscribe(e=>{e.data&&e.data.length>0?e.data.map(t=>{t.time=u(1e3*t.add_time).fromNow(),this.alertItems.push(t)}):t.target.disabled=!0,t.target.complete()},e=>{t.target.complete(),this.message=this.translate.instant("ERROR_CONNECT")}),this.pageIndex>20&&(t.target.disabled=!0)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-alert"]],viewQuery:function(t,e){if(1&t&&h.Gf(a.ju,5),2&t){let t;h.iGM(t=h.CRH())&&(e.infiniteScroll=t.first)}},decls:15,vars:6,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["class","spiner-loading",4,"ngIf"],[4,"ngFor","ngForOf"],["class","ion-padding",4,"ngIf"],[3,"ionInfinite"],["loadingSpinner","dots"],[1,"spiner-loading"],["name","dots"],[1,"ion-text-wrap"],["color","primary"],[1,"ion-padding"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.YNc(9,p,2,0,"div",3),h.TgZ(10,"ion-list"),h.YNc(11,m,8,3,"ion-item",4),h.qZA(),h.YNc(12,Z,3,1,"div",5),h.TgZ(13,"ion-infinite-scroll",6),h.NdJ("ionInfinite",function(t){return e.loadData(t)}),h._UZ(14,"ion-infinite-scroll-content",7),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,4,"POND_MOD.WARNING")),h.xp6(3),h.Q6J("ngIf",e.loadingFlag.pending),h.xp6(2),h.Q6J("ngForOf",e.alertItems),h.xp6(1),h.Q6J("ngIf",e.message))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,n.O5,a.q_,n.sg,a.ju,a.MB,a.PQ,a.Ie,a.Q$,a.yW],pipes:[g.X$],styles:[""]}),t})();var A=i(84465);function _(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-chip",18),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).choiceSuggest(e)}),h.TgZ(1,"ion-label"),h._uU(2),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(2),h.Oqu(t)}}function v(t,e){if(1&t&&(h.TgZ(0,"div",6),h.TgZ(1,"p"),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.YNc(4,_,3,1,"ion-chip",17),h.qZA()),2&t){const t=h.oxw();h.xp6(2),h.Oqu(h.lcZ(3,2,"POND_MOD.SUGGEST")),h.xp6(2),h.Q6J("ngForOf",t.valueSuggest)}}let T=(()=>{class t{constructor(t,e,i,n){this.toastService=t,this.modalCtrl=e,this.pondService=i,this.translate=n,this.saveLoadingFlag=new d.E,this.form=new o.cw({date:new o.NI(u().format("YYYY-MM-DD")),value:new o.NI("",[o.kI.required,o.kI.min(0)])}),this.seedsSuggest=[.9,.95,1,1.05,1.1],this.valueSuggest=[],this.maxDate=u(),this.minDate=u().subtract(180,"days")}ngOnInit(){this.form.patchValue({value:this.factor.values[0]}),this.form.controls.value.setValidators([o.kI.min(this.factor.min),o.kI.max(this.factor.max)]),this.factor.values[0]>0&&this.seedsSuggest.forEach(t=>{let e=+(t*this.factor.values[0]).toFixed(1);-1==this.valueSuggest.indexOf(+e)&&this.valueSuggest.push(e)}),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.form.controls.date.valueChanges.subscribe(t=>{let e=u(t).format("YYYY-MM-DD");this.pondService.loadDay(e).subscribe(t=>{t.data?this.form.patchValue({value:t.data[this.factor.key]}):this.form.controls.value.reset()}),console.log(this.form.value)})}dismiss(){this.modalCtrl.dismiss()}onSave(){this.saveLoadingFlag.setPending(!0);let t={};t[this.factor.key]=this.form.value.value;let e=u(this.form.value.date).format("YYYY-MM-DD");this.pondService.quickUpdateParam(t,e).pipe().subscribe(t=>{"success"!=t.status?this.toastService.warning(t.message):this.toastService.success(t.message),this.saveLoadingFlag.setResult(!0),this.form.value.date==this.maxDate.format("YYYY-MM-DD")?this.modalCtrl.dismiss({value:this.form.value.value}):this.dismiss()},()=>{this.saveLoadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}choiceSuggest(t){this.form.patchValue({value:t})}changeDate(t){let e=u(this.form.value.date).add(t,"days");if(e<this.minDate||e>this.maxDate)return!1;this.form.patchValue({date:e.format("YYYY-MM-DD")}),console.log(this.form.value)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(A.k),h.Y36(a.IN),h.Y36(c.p),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-parameter-update"]],inputs:{factor:"factor"},decls:36,vars:25,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],[3,"formGroup"],[1,"ion-text-center"],[1,"title","ion-padding"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back"],["size","8"],["formControlName","date",1,"ion-text-center","w-100",3,"displayFormat","min","max"],["slot","icon-only","name","arrow-forward"],["lines","none",1,"ion-text-center"],["type","tel","inputmode","decimal","required","","autofocus","","formControlName","value",1,"l-r",3,"placeholder"],["class","ion-text-center",4,"ngIf"],["color","secondary","outline","true",3,"click",4,"ngFor","ngForOf"],["color","secondary","outline","true",3,"click"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-buttons",0),h.TgZ(6,"ion-button",1),h.NdJ("click",function(){return e.dismiss()}),h._UZ(7,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.onSave()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(12,"ion-content",5),h.TgZ(13,"div",6),h.TgZ(14,"h1",7),h._uU(15),h.ALo(16,"translate"),h.ALo(17,"uppercase"),h.TgZ(18,"small"),h._uU(19),h.qZA(),h.qZA(),h.TgZ(20,"ion-grid"),h.TgZ(21,"ion-row"),h.TgZ(22,"ion-col",8),h.TgZ(23,"ion-button",9),h.NdJ("click",function(){return e.changeDate(-1)}),h._UZ(24,"ion-icon",10),h.qZA(),h.qZA(),h.TgZ(25,"ion-col",11),h.TgZ(26,"ion-item",6),h._UZ(27,"ion-datetime",12),h.ALo(28,"translate"),h.qZA(),h.qZA(),h.TgZ(29,"ion-col",8),h.TgZ(30,"ion-button",9),h.NdJ("click",function(){return e.changeDate(1)}),h._UZ(31,"ion-icon",13),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(32,"ion-item",14),h._UZ(33,"ion-input",15),h.ALo(34,"translate"),h.qZA(),h.YNc(35,v,5,4,"div",16),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,13,"POND_MOD.ADD_EN_INDEX")),h.xp6(6),h.Q6J("disabled",e.form.invalid),h.xp6(1),h.hij(" ",h.lcZ(11,15,"POND_MOD.SAVE")," "),h.xp6(2),h.Q6J("formGroup",e.form),h.xp6(3),h.hij("",h.lcZ(16,17,h.lcZ(17,19,"POND_MOD.PARAM."+e.factor.name))," "),h.xp6(4),h.Oqu(e.factor.unit),h.xp6(4),h.Q6J("disabled",e.form.value.date<=e.minDate.format("YYYY-MM-DD")),h.xp6(4),h.Q6J("displayFormat",h.lcZ(28,21,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD")),h.xp6(3),h.Q6J("disabled",e.form.value.date>=e.maxDate.format("YYYY-MM-DD")),h.xp6(3),h.Q6J("placeholder",h.lcZ(34,23,"POND_MOD.ENTER_INDEX")),h.xp6(2),h.Q6J("ngIf",e.valueSuggest.length>0))},directives:[a.Gu,a.sr,a.wd,a.Sm,a.YG,a.gu,a.W2,o.JL,o.sg,a.jY,a.Nd,a.wI,a.Ie,a.x4,a.QI,o.JJ,o.u,a.pK,a.j9,o.Q7,n.O5,n.sg,a.hM,a.Q$],pipes:[g.X$,n.gd],styles:[""]}),t})();const q=function(t){return{color:t}};function x(t,e){if(1&t&&(h.TgZ(0,"ion-col",13),h.TgZ(1,"div",14),h._uU(2),h.qZA(),h.TgZ(3,"div",15),h._uU(4),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.Q6J("ngStyle",h.VKq(3,q,t.style)),h.xp6(2),h.hij(" ",t.label," "),h.xp6(2),h.hij(" ",t.data," ")}}function O(t,e){if(1&t&&(h.TgZ(0,"div",10),h.TgZ(1,"ion-grid"),h.TgZ(2,"ion-row"),h.YNc(3,x,5,5,"ion-col",11),h.qZA(),h.qZA(),h._UZ(4,"div",12),h.qZA()),2&t){const t=e.index,i=h.oxw(3);h.xp6(3),h.Q6J("ngForOf",i.groupsChartLabel[t]),h.xp6(1),h.Q6J("options",i.setOption(t))}}function D(t,e){if(1&t&&(h.TgZ(0,"div"),h.YNc(1,O,5,2,"div",9),h.qZA()),2&t){const t=h.oxw(2);h.xp6(1),h.Q6J("ngForOf",t.groupsChartLabel)}}function b(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-content"),h.TgZ(1,"div"),h.TgZ(2,"ion-grid"),h.TgZ(3,"ion-row",4),h.TgZ(4,"ion-col",5),h.TgZ(5,"ion-item",6),h.TgZ(6,"ion-datetime",7),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().onChangeDate(e)}),h.ALo(7,"translate"),h.qZA(),h._UZ(8,"ion-icon",8),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(9,D,2,1,"div",3),h.qZA()}if(2&t){const t=h.oxw();h.xp6(6),h.Q6J("displayFormat",h.lcZ(7,5,"FORMAT_DATE_MOMENT"))("min",t.pondService.seasonStartTime.format("YYYY-MM-DD"))("max",t.dateMax)("value",t.dateRangeSelected),h.xp6(3),h.Q6J("ngIf",t.groupsChartLabel.length>0)}}let S=(()=>{class t{constructor(t,e,i){this.modalCtrl=t,this.pondService=e,this.translate=i,this.factor="",this.loadingFlag=new d.E,this.data=[],this.dataRaw=[],this.dateRangeSelected=u().format("YYYY-MM-DD"),this.dateMax=u().format("YYYY-MM-DD"),this.dateMin=u().format("YYYY-MM-DD"),this.show=!1,this.numberGroupChart=0,this.groupsChart=[],this.groupsChartOption=[],this.groupsChartData=[],this.groupsChartLabel=[],this.optionLine={tooltip:{trigger:"axis",formatter:t=>{let e=u(t[0].value[0]).format(this.translate.instant("FORMAT_DATE_MOMENT"))+"<br/>";return t.forEach(t=>{e+=t.marker+t.seriesName+" : "+(new Intl.NumberFormat).format(t.value[1])+"<br>"}),e},axisPointer:{animation:!0}},xAxis:{type:"time",splitLine:{show:!1},axisLabel:{formatter:"{dd}"}},yAxis:[],series:[]}}ngOnInit(){this.paramSelected=this.pondService.trackingPamameters[0],this.paramSelectedItem=this.pondService.trackingObjects[0],console.log(this.pondService.trackingPamameters),this.numberGroupChart=Math.ceil(this.pondService.trackingPamameters.length/4),console.log(this.numberGroupChart),this.getData()}dismiss(){this.modalCtrl.dismiss()}presentParameterUpdate(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalCtrl.create({component:T,componentProps:{data:this.factor}})).present()})}onChangeDate(t){console.log("vao day"),this.dateRangeSelected=t.detail.value,t.detail.value!=this.dateRangeSelected&&this.getData()}onChangeParam(){this.paramSelectedItem=this.pondService.trackingObjects[this.pondService.trackingObjects.findIndex(t=>t.key==this.paramSelected)],this.prepareData(this.dataRaw)}getData(){this.loadingFlag.setStart(!0),this.pondService.loadParamDaily(this.dateRangeSelected,30).subscribe(t=>{t.data?(this.dataRaw=t.data,console.log(this.dataRaw),this.prepareDataNew(this.dataRaw),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},t=>{this.loadingFlag.setResult(!1),console.log(t)})}prepareDataNew(t){if(0==t.length)return;console.log(this.pondService.trackingObjects);let e=this.pondService.trackingObjects.map(t=>({show:!1,type:"value",name:this.translate.instant(("POND_MOD.PARAM."+t.name).toUpperCase()),min:t.min,max:t.max})),i=this.pondService.trackingObjects.map(e=>({name:this.translate.instant(("POND_MOD.PARAM."+e.name).toUpperCase()),type:"line",yAxisIndex:0,data:t.map(t=>t[e.key]?t[e.key]:"").reverse()})),n=t.map(t=>u(t.date).format("DD/MM")).reverse(),o=this.pondService.trackingObjects.map(t=>t.colorStr),s=[],a=[];for(let r=0;r<this.pondService.trackingObjects.length;r++)r%4==0?(s.push({color:[o[r]],tooltip:{trigger:"axis",position:["50%","50%"]},xAxis:[{type:"category",axisTick:{alignWithLabel:!0},data:n}],yAxis:[e[r]],series:[i[r]]}),a.push([{style:this.pondService.trackingObjects[r].colorStr,label:this.translate.instant(("POND_MOD.PARAM."+this.pondService.trackingObjects[r].name).toUpperCase()),data:this.pondService.trackingObjects[r].values.length>0?this.pondService.trackingObjects[r].values[0]:"-"}])):(i[r].yAxisIndex=r%4,s[s.length-1].color.push(o[r]),s[s.length-1].yAxis.push(e[r]),s[s.length-1].series.push(i[r]),a[a.length-1].push({style:this.pondService.trackingObjects[r].colorStr,label:this.translate.instant(("POND_MOD.PARAM."+this.pondService.trackingObjects[r].name).toUpperCase()),data:this.pondService.trackingObjects[r].values.length>0&&this.pondService.trackingObjects[r].values.length>0?this.pondService.trackingObjects[r].values[0]:"-"}));this.groupsChartLabel=a,this.groupsChartOption=s,console.log(this.groupsChartOption[2]),console.log(this.groupsChartOption[3])}setOption(t){return this.groupsChartOption[t]}prepareData(t){console.log("run s"),console.log("run");let e=[];t.forEach(t=>{let i=new Date(t.date),n=0;this.pondService.trackingObjects.forEach(e=>{void 0===this.data[e.key]&&(this.data[e.key]=[]),this.data[e.key].unshift({name:i.toString(),value:[t.date,t[e.key]]}),null===t[e.key]&&(n+=1)}),e.unshift(n)});for(let i=0;i<e.length;i++)e[i]==this.pondService.trackingObjects.length&&this.pondService.trackingObjects.forEach(t=>{this.data[t.key].splice(i,1)});for(let i=0;i<this.numberGroupChart;i++){this.groupsChart.push(i);let t=this.pondService.trackingObjects.slice(4*i,4*(i+1));this.groupsChartLabel.push(t);let e=[],n=[];t.forEach((t,i)=>{let o={show:0==i,type:"value",name:this.translate.instant(("POND_MOD.PARAM."+t.name).toUpperCase()),min:t.min,max:t.max};e.push(o);let s={data:this.data[t.key],type:"line",yAxisIndex:i,itemStyle:{color:t.colorStr},smooth:!0,name:this.translate.instant(("POND_MOD.PARAM."+t.name).toUpperCase()),showSymbol:!0,hoverAnimation:!0};n.push(s)}),this.groupsChartOption.push(this.setChartOption(e)),this.groupsChartData.push({series:n})}console.log(this.data)}setChartOption(t){let e=Object.assign({},this.optionLine);return e.yAxis=t,e}ionViewDidEnter(){this.show=!0}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-parameter"]],decls:9,vars:4,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[4,"ngIf"],[1,"ion-align-items-center"],["size","8","push","2",1,"ion-align-self-center"],["lines","inset"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","end","name","calendar-outline"],["class","data-item",4,"ngFor","ngForOf"],[1,"data-item"],["class","ion-text-center",3,"ngStyle",4,"ngFor","ngForOf"],["echarts","",1,"demo-chart",3,"options"],[1,"ion-text-center",3,"ngStyle"],[1,"ion-text-uppercase","title"],[1,"para-value"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.YNc(8,b,10,7,"ion-content",3)),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,2,"POND_MOD.WATER_QUANLITY")),h.xp6(2),h.Q6J("ngIf",e.show))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,n.O5,a.W2,a.jY,a.Nd,a.wI,a.Ie,a.x4,a.QI,n.sg,r._w,n.PC],pipes:[g.X$],styles:["[_nghost-%COMP%]   .demo-chart[_ngcontent-%COMP%]{height:400px}[_nghost-%COMP%]   ion-select[_ngcontent-%COMP%]{max-width:90%!important}[_nghost-%COMP%]   .para-value[_ngcontent-%COMP%]{font-size:2em;font-family:Atomic}[_nghost-%COMP%]   .data-item[_ngcontent-%COMP%]{margin-top:2em}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{font-size:.8em}"]}),t})();function C(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label",7),h.TgZ(2,"p"),h.TgZ(3,"ion-text",8),h._uU(4),h.qZA(),h._uU(5),h.qZA(),h.TgZ(6,"h3"),h._uU(7),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.xp6(4),h.Oqu(t.vendor_name),h.xp6(1),h.hij(" ",t.time," "),h.xp6(2),h.Oqu(t.message)}}function y(t,e){if(1&t&&(h.TgZ(0,"div",9),h.TgZ(1,"p"),h._uU(2),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(2),h.Oqu(t.message)}}let N=(()=>{class t{constructor(t,e,i){this.modalCtrl=t,this.pondService=e,this.translate=i,this.loadingFlag=new d.E,this.suggestItems=[],this.message="",this.pageIndex=0}ngOnInit(){this.loadAlerList()}loadAlerList(){this.loadingFlag.setPending(!0),this.pondService.getSuggestList(this.pageIndex).pipe().subscribe(t=>{t.data&&t.data.length>0&&t.data.map(t=>{t.time=u(1e3*t.add_time).fromNow(),this.suggestItems.push(t)}),this.suggestItems.length<10&&(this.infiniteScroll.disabled=!this.infiniteScroll.disabled),this.loadingFlag.setResult(!0)},t=>{this.loadingFlag.setResult(!1),this.message=this.translate.instant("ERROR_CONNECT")})}loadData(t){this.pageIndex++,this.pondService.getSuggestList(this.pageIndex).pipe().subscribe(e=>{e.data&&e.data.length>0?e.data.map(t=>{t.time=u(1e3*t.add_time).fromNow(),this.suggestItems.push(t)}):t.target.disabled=!0,t.target.complete()},e=>{t.target.complete(),this.message=this.translate.instant("ERROR_CONNECT")}),this.pageIndex>20&&(t.target.disabled=!0)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-suggest"]],viewQuery:function(t,e){if(1&t&&h.Gf(a.ju,5),2&t){let t;h.iGM(t=h.CRH())&&(e.infiniteScroll=t.first)}},decls:14,vars:5,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[4,"ngFor","ngForOf"],["class","ion-padding",4,"ngIf"],[3,"ionInfinite"],["loadingSpinner","dots"],[1,"ion-text-wrap"],["color","primary"],[1,"ion-padding"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"ion-list"),h.YNc(10,C,8,3,"ion-item",3),h.qZA(),h.YNc(11,y,3,1,"div",4),h.TgZ(12,"ion-infinite-scroll",5),h.NdJ("ionInfinite",function(t){return e.loadData(t)}),h._UZ(13,"ion-infinite-scroll-content",6),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,3,"POND_MOD.SUGGEST")),h.xp6(4),h.Q6J("ngForOf",e.suggestItems),h.xp6(1),h.Q6J("ngIf",e.message))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.q_,n.sg,n.O5,a.ju,a.MB,a.Ie,a.Q$,a.yW],pipes:[g.X$],styles:[""]}),t})();var E=i(90650),M=i(62374),I=i(82196);function w(t,e){if(1&t&&(h.TgZ(0,"div",12),h.TgZ(1,"small"),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"h1"),h._uU(5),h.ALo(6,"number"),h.TgZ(7,"small"),h._uU(8,"kg"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(2),h.Oqu(h.lcZ(3,2,"POND_MOD.FEED_INCREMENTAL")),h.xp6(3),h.hij("",h.xi3(6,4,null==t.itemSelected?null:t.itemSelected.feed_incremental,"1.0-1")," ")}}function U(t,e){if(1&t&&(h.TgZ(0,"ion-text",18),h._uU(1),h.ALo(2,"translate"),h.ALo(3,"number"),h.TgZ(4,"small"),h._uU(5,"kg"),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.xp6(1),h.AsE("",h.lcZ(2,2,"POND_MOD.EXPECTED")," ",h.xi3(3,4,null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_calendar.value_check,"1.0-1")," ")}}function P(t,e){if(1&t&&(h.TgZ(0,"ion-text",19),h._uU(1),h.ALo(2,"translate"),h.ALo(3,"number"),h.TgZ(4,"small"),h._uU(5,"kg"),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.xp6(1),h.AsE("",h.lcZ(2,2,"POND_MOD.FOR_PROCEDURE")," ",h.xi3(3,4,null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_procedure.feed,"1.0-1")," ")}}function R(t,e){if(1&t&&(h.TgZ(0,"ion-col",22),h.TgZ(1,"ion-text",18),h._uU(2),h.ALo(3,"number"),h.qZA(),h.TgZ(4,"small"),h._uU(5),h.qZA(),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(2),h.hij(" ",h.xi3(3,2,t.quantity,"1.0-1")," "),h.xp6(3),h.Oqu(t.unit)}}function k(t,e){if(1&t&&(h.TgZ(0,"ion-col",22),h.TgZ(1,"ion-text",23),h._uU(2),h.ALo(3,"number"),h.qZA(),h.TgZ(4,"small"),h._uU(5),h.qZA(),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(2),h.hij(" ",h.xi3(3,2,t.quantity,"1.0-1")," "),h.xp6(3),h.Oqu(t.unit)}}function Y(t,e){if(1&t&&(h.TgZ(0,"ion-row"),h.TgZ(1,"ion-col"),h._uU(2),h.qZA(),h.YNc(3,R,6,5,"ion-col",21),h.YNc(4,k,6,5,"ion-col",21),h.qZA()),2&t){const t=e.$implicit;h.xp6(2),h.AsE("",t.store_name," | ",t.product_name,""),h.xp6(1),h.Q6J("ngIf",1==t.type),h.xp6(1),h.Q6J("ngIf",2==t.type)}}function L(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"span",0),h._uU(2),h.qZA(),h.TgZ(3,"ion-label",20),h.TgZ(4,"ion-grid"),h.YNc(5,Y,5,4,"ion-row",17),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit,i=e.index,n=h.oxw(2);h.xp6(2),h.Oqu(i+1),h.xp6(3),h.Q6J("ngForOf",n.convertRepass(t))}}function F(t,e){if(1&t&&(h.TgZ(0,"ion-list",14),h.TgZ(1,"div",3),h.TgZ(2,"span"),h._uU(3),h.ALo(4,"translate"),h.ALo(5,"number"),h.TgZ(6,"small"),h._uU(7,"kg"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"div",3),h.YNc(9,U,6,7,"ion-text",15),h.qZA(),h.TgZ(10,"div",3),h.YNc(11,P,6,7,"ion-text",16),h.qZA(),h.YNc(12,L,6,2,"ion-item",17),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.AsE("",h.lcZ(4,5,"FARM_MOD.TOTAL_FEED")," ",h.xi3(5,7,null==t.itemSelected?null:t.itemSelected.feed_today,"1.0-1")," "),h.xp6(6),h.Q6J("ngIf",t.inforloadExpectedDaily&&t.inforloadExpectedDaily.for_calendar),h.xp6(2),h.Q6J("ngIf",t.inforloadExpectedDaily&&t.inforloadExpectedDaily.for_procedure),h.xp6(1),h.Q6J("ngForOf",t.feed)}}function J(t,e){if(1&t&&h._UZ(0,"div",24),2&t){const t=h.oxw();h.Q6J("options",t.optionLine)("merge",t.dataUpdate)}}let Q=(()=>{class t{constructor(t,e,i,n,o,s){this.modalCtrl=t,this.pondService=e,this.toastService=i,this.translate=n,this.calendarService=o,this.settingService=s,this.loadingFlag=new d.E,this.data=[],this.dataRaw=[],this.dateRangeSelected=u().format("YYYY-MM-DD"),this.maxDate=u(),this.minDate=u().subtract(180,"days"),this.feed=[],this.show=!1,this.optionLine={tooltip:{trigger:"axis",formatter:t=>{let e=u(t[0].value[0]).format(this.translate.instant("FORMAT_DATE_MOMENT"))+"<br/>";return t.forEach(t=>{let i="number"==typeof t.value[1]?(new Intl.NumberFormat).format(t.value[1]):0;e+=t.marker+t.seriesName+" : "+i+"<br>"}),e},axisPointer:{animation:!0}},xAxis:{type:"time",splitLine:{show:!1},axisLabel:{formatter:"{dd}"}},yAxis:{},series:[{data:this.data,type:"line",smooth:!0,name:this.translate.instant("POND_MOD.FEED"),showSymbol:!0,hoverAnimation:!0,lineStyle:{width:1,color:"rgba(128, 255, 165)"},areaStyle:{color:new E.Q.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(128, 255, 165)"},{offset:1,color:"rgba(1, 191, 236)"}])}}]}}ngOnInit(){this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.getData(),this.loadExpectedDaily()}loadExpectedDaily(){console.log(u(this.dateRangeSelected).valueOf()/1e3),this.calendarService.getExpectedDaily(this.pondService.pond.current_season,"feed",u(this.dateRangeSelected).valueOf()/1e3).subscribe(t=>{1==t.status?this.inforloadExpectedDaily=t.data:this.toastService.warning(t.error)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}dismiss(){this.modalCtrl.dismiss()}getData(){this.loadingFlag.setStart(!0),this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},u(this.dateRangeSelected).format("YYYY-MM-DD")).subscribe(t=>{t.data?(this.dataRaw=t.data,console.log(this.dateRangeSelected),this.dataRaw[0].date==u(this.dateRangeSelected).format("YYYY-MM-DD")&&(this.itemSelected=this.dataRaw[0]),!this.itemSelected&&this.dataRaw.length>0&&(this.itemSelected={feed_incremental:this.dataRaw[0].feed_incremental}),console.log(this.itemSelected),this.prepareData(this.dataRaw),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},t=>{this.loadingFlag.setResult(!1),console.log(t)})}prepareData(t){this.processFeed(),this.data=[],t.forEach(t=>{let e=new Date(t.date);this.data.push({name:e.toString(),value:[t.date,+t.feed_today]})}),this.data.reverse(),this.dataUpdate={series:[{data:this.data}]},console.log(this.dataUpdate)}onChangeDate(t){this.dateRangeSelected=t.detail.value;let e=u(this.dateRangeSelected);this.itemSelected=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e.format("YYYY-MM-DD"))],this.processFeed(),(e<u(this.dataRaw[this.dataRaw.length-1].date)||e>u(this.dataRaw[0].date))&&this.getData(),this.loadExpectedDaily()}changeDate(t){let e=u(this.dateRangeSelected).add(t,"days");if(e<this.minDate||e>this.maxDate)return!1;this.dateRangeSelected=e.format("YYYY-MM-DD")}processFeed(){this.feed=[];for(let i=1;i<=this.pondService.numRepast;i++)this.feed.push([]);let t=u(this.dateRangeSelected);if(void 0!==this.itemSelected)this.itemSelected.feed&&this.itemSelected.feed.forEach(t=>{t.type=1,this.feed[t.times-1].push(t)}),this.itemSelected.blend&&this.itemSelected.blend.forEach(t=>{t.type=2,this.feed[t.times-1].push(t)}),console.log(this.feed);else{this.itemSelected={feed_incremental:0,feed_today:0};for(var e=0;e<this.dataRaw.length;e++)if(t>u(this.dataRaw[e].date)){this.itemSelected.feed_incremental=this.dataRaw[e].feed_incremental;break}}}ionViewDidEnter(){this.show=!0}convertItem(t){return 2==+t.group_id&&this.settingService.showGramFeed&&("kg"==t.unit?(t.unit="g",t.quantity=1e3*t.quantity):"lit"==t.unit&&(t.unit="ml",t.quantity=1e3*t.quantity)),t}convertRepass(t){return t.map(t=>this.convertItem(t))}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(A.k),h.Y36(g.sK),h.Y36(M.o),h.Y36(I.R))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-feed"]],decls:26,vars:14,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-text-center"],["class","ion-padding",4,"ngIf"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back-outline"],["size","8"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","icon-only","name","arrow-forward-outline"],["class","ion-padding","lines","none",4,"ngIf"],[1,"ion-padding"],["echarts","","class","demo-chart",3,"options","merge",4,"ngIf"],["lines","none",1,"ion-padding"],["color","secondary",4,"ngIf"],["color","success",4,"ngIf"],[4,"ngFor","ngForOf"],["color","secondary"],["color","success"],[1,"ion-text-wrap"],["class","ion-text-right",4,"ngIf"],[1,"ion-text-right"],["color","tertiary"],["echarts","",1,"demo-chart",3,"options","merge"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"div",3),h.YNc(10,w,9,7,"div",4),h.TgZ(11,"ion-grid"),h.TgZ(12,"ion-row"),h.TgZ(13,"ion-col",5),h.TgZ(14,"ion-button",6),h.NdJ("click",function(){return e.changeDate(-1)}),h._UZ(15,"ion-icon",7),h.qZA(),h.qZA(),h.TgZ(16,"ion-col",8),h.TgZ(17,"ion-item"),h.TgZ(18,"ion-datetime",9),h.NdJ("ionChange",function(t){return e.onChangeDate(t)}),h.ALo(19,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(20,"ion-col",5),h.TgZ(21,"ion-button",6),h.NdJ("click",function(){return e.changeDate(1)}),h._UZ(22,"ion-icon",10),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(23,F,13,10,"ion-list",11),h.TgZ(24,"div",12),h.YNc(25,J,1,2,"div",13),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,10,"POND_MOD.FEED")),h.xp6(4),h.Q6J("ngIf",null!==e.itemSelected),h.xp6(4),h.Q6J("disabled",e.dateRangeSelected<=e.minDate.format("YYYY-MM-DD")),h.xp6(4),h.Q6J("displayFormat",h.lcZ(19,12,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeSelected),h.xp6(3),h.Q6J("disabled",e.dateRangeSelected>=e.maxDate.format("YYYY-MM-DD")),h.xp6(2),h.Q6J("ngIf",e.itemSelected),h.xp6(2),h.Q6J("ngIf",e.show))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,n.O5,a.jY,a.Nd,a.wI,a.Ie,a.x4,a.QI,a.q_,n.sg,a.yW,a.Q$,r._w],pipes:[g.X$,n.JJ],styles:[".title[_ngcontent-%COMP%]{font-size:3em;padding:1em}"]}),t})();function V(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label",14),h.TgZ(2,"ion-grid"),h.TgZ(3,"ion-row"),h.TgZ(4,"ion-col"),h._uU(5),h.qZA(),h.TgZ(6,"ion-col",15),h.TgZ(7,"ion-text",16),h._uU(8),h.ALo(9,"number"),h.qZA(),h.TgZ(10,"small"),h._uU(11),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.xp6(5),h.AsE("",t.store_name," | ",t.product_name,""),h.xp6(3),h.hij(" ",h.xi3(9,4,t.quantity,"1.0-3")," "),h.xp6(3),h.Oqu(t.unit)}}function j(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label",14),h.TgZ(2,"ion-grid"),h.TgZ(3,"ion-row"),h.TgZ(4,"ion-col"),h._uU(5),h.ALo(6,"translate"),h.qZA(),h.TgZ(7,"ion-col",15),h.TgZ(8,"ion-text",17),h._uU(9),h.ALo(10,"number"),h.qZA(),h.TgZ(11,"small"),h._uU(12,"kg"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(5),h.Oqu(h.lcZ(6,2,"POND_MOD.EXPECTED")),h.xp6(4),h.hij(" ",h.xi3(10,4,null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_calendar.value_check,"1.0-3")," ")}}function H(t,e){if(1&t&&h._UZ(0,"div",18),2&t){const t=h.oxw();h.Q6J("options",t.optionChart)("merge",t.dataUpdate)}}let G=(()=>{class t{constructor(t,e,i,n,o){this.modalCtrl=t,this.pondService=e,this.toastService=i,this.translate=n,this.calendarService=o,this.loadingFlag=new d.E,this.data=[],this.dataRaw=[],this.show=!1,this.dateRangeSelected=u().format("YYYY-MM-DD"),this.maxDate=u(),this.minDate=u().subtract(180,"days"),this.itemSelected=[],this.optionChart={legend:{show:!0,bottom:0},grid:{bottom:100},tooltip:{trigger:"axis",formatter:t=>{let e=u(t[0].value[0]).format(this.translate.instant("FORMAT_DATE_MOMENT"))+"<br/>";return t.forEach(t=>{e+=t.marker+t.value[2]+" : "+(new Intl.NumberFormat).format(t.value[1])+"<br>"}),e},axisPointer:{animation:!0}},xAxis:{type:"time",axisLabel:{formatter:"{dd}"}},yAxis:{},series:[]}}ngOnInit(){this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.getData(),this.loadExpectedDaily()}loadExpectedDaily(){console.log(u(this.dateRangeSelected).valueOf()/1e3),this.calendarService.getExpectedDaily(this.pondService.pond.current_season,"enviro",u(this.dateRangeSelected).valueOf()/1e3).subscribe(t=>{1==t.status?this.inforloadExpectedDaily=t.data:this.toastService.warning(t.error)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}getData(){this.loadingFlag.setStart(!0),this.pondService.loadDailyDependency("enviroment",{pageIndex:0,pageSize:7},u(this.dateRangeSelected).format("YYYY-MM-DD")).subscribe(t=>{t.data?(this.dataRaw=t.data,this.itemSelected=this.dataRaw.filter(t=>t.date==u(this.dateRangeSelected).format("YYYY-MM-DD")),this.prepareData(this.dataRaw),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},t=>{this.loadingFlag.setResult(!1),console.log(t)})}prepareData(t){this.processData(),this.data=[];let e=[],i=[];t.forEach(t=>{if(e.includes(t.product_id)){let i=e.findIndex(e=>e==t.product_id);this.data[i].push([t.date,t.quantity*t.packing,t.store_name+" | "+t.product_name])}else e.push(t.product_id),this.data.push([[t.date,t.quantity*t.packing,t.store_name+" | "+t.product_name]]),i.push(t.product_name)});let n=[];e.forEach((t,e)=>{n.push({data:this.data[e],type:"scatter",name:i[e],symbolSize:function(t){let e=2*parseInt(t[1]);return e=e<50?e:50,e=e>5?e:5,e}})}),this.dataUpdate={series:n},console.log(this.dataUpdate)}onChangeDate(t){this.dateRangeSelected=t.detail.value;let e=u(this.dateRangeSelected);this.processData(),this.dataRaw.length>0?(e>u(this.dataRaw[this.dataRaw.length-1].date)||e<u(this.dataRaw[0].date))&&this.getData():this.getData(),this.loadExpectedDaily()}changeDate(t){let e=u(this.dateRangeSelected).add(t,"days");if(e<this.minDate||e>this.maxDate)return!1;this.dateRangeSelected=e.format("YYYY-MM-DD")}processData(){this.itemSelected=this.dataRaw.filter(t=>t.date==u(this.dateRangeSelected).format("YYYY-MM-DD"))}ionViewDidEnter(){this.show=!0}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(A.k),h.Y36(g.sK),h.Y36(M.o))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-enviroment"]],decls:27,vars:14,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-text-center"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back"],["size","8"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","icon-only","name","arrow-forward"],["lines","none",1,"ion-padding"],[4,"ngFor","ngForOf"],[4,"ngIf"],["echarts","","class","demo-chart",3,"options","merge",4,"ngIf"],[1,"ion-text-wrap"],[1,"ion-text-right"],["color","secondary"],["color","danger"],["echarts","",1,"demo-chart",3,"options","merge"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"div",3),h.TgZ(10,"ion-grid"),h.TgZ(11,"ion-row"),h.TgZ(12,"ion-col",4),h.TgZ(13,"ion-button",5),h.NdJ("click",function(){return e.changeDate(-1)}),h._UZ(14,"ion-icon",6),h.qZA(),h.qZA(),h.TgZ(15,"ion-col",7),h.TgZ(16,"ion-item",3),h.TgZ(17,"ion-datetime",8),h.NdJ("ionChange",function(t){return e.onChangeDate(t)}),h.ALo(18,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(19,"ion-col",4),h.TgZ(20,"ion-button",5),h.NdJ("click",function(){return e.changeDate(1)}),h._UZ(21,"ion-icon",9),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(22,"ion-list",10),h.YNc(23,V,12,7,"ion-item",11),h.YNc(24,j,13,7,"ion-item",12),h.qZA(),h.TgZ(25,"div"),h.YNc(26,H,1,2,"div",13),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,10,"POND_MOD.CHEMICAL_TREATMENT")),h.xp6(7),h.Q6J("disabled",e.dateRangeSelected<=e.minDate.format("YYYY-MM-DD")),h.xp6(4),h.Q6J("displayFormat",h.lcZ(18,12,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeSelected),h.xp6(3),h.Q6J("disabled",e.dateRangeSelected>=e.maxDate.format("YYYY-MM-DD")),h.xp6(3),h.Q6J("ngForOf",e.itemSelected),h.xp6(1),h.Q6J("ngIf",e.inforloadExpectedDaily&&e.inforloadExpectedDaily.for_calendar),h.xp6(2),h.Q6J("ngIf",e.show))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.jY,a.Nd,a.wI,a.Ie,a.x4,a.QI,a.q_,n.sg,n.O5,a.Q$,a.yW,r._w],pipes:[g.X$,n.JJ],styles:[""]}),t})();function B(t,e){if(1&t&&(h.TgZ(0,"ion-row"),h.TgZ(1,"ion-col"),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"ion-col",14),h.TgZ(5,"ion-text",15),h._uU(6),h.qZA(),h.TgZ(7,"small"),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(2),h.Oqu(h.lcZ(3,3,"LAB_MOD.VACCINATED")),h.xp6(4),h.hij(" ",null==t.healthLab?null:t.healthLab.vaccinated," "),h.xp6(2),h.Oqu(h.lcZ(9,5,"PCS"))}}function z(t,e){if(1&t&&(h.TgZ(0,"ion-row"),h.TgZ(1,"ion-col"),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"ion-col",14),h.TgZ(5,"ion-text",15),h._uU(6),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(2),h.Oqu(h.lcZ(3,2,"LAB_MOD.ANTIBIOTIC")),h.xp6(4),h.hij(" ",t.joinArray(null==t.dataDisease?null:t.dataDisease.antibiotic)," ")}}function $(t,e){if(1&t&&(h.TgZ(0,"ion-row"),h.TgZ(1,"ion-col"),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"ion-col",14),h.TgZ(5,"ion-text",15),h._uU(6),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(2),h.Oqu(h.lcZ(3,2,"LAB_MOD.BACTERIA")),h.xp6(4),h.hij(" ",t.joinArray(null==t.dataDisease?null:t.dataDisease.bacteria)," ")}}function W(t,e){if(1&t&&(h.TgZ(0,"ion-row"),h.TgZ(1,"ion-col"),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"ion-col",14),h.TgZ(5,"ion-text",15),h._uU(6),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(2),h.Oqu(h.lcZ(3,2,"LAB_MOD.PARASITES")),h.xp6(4),h.hij(" ",t.joinArray(null==t.dataDisease?null:t.dataDisease.parasites)," ")}}function X(t,e){if(1&t&&(h.TgZ(0,"ion-row"),h.TgZ(1,"ion-col"),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"ion-col",14),h.TgZ(5,"ion-text",15),h._uU(6),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(2),h.Oqu(h.lcZ(3,2,"LAB_MOD.DISEASE")),h.xp6(4),h.hij(" ",t.joinArray(null==t.dataDisease?null:t.dataDisease.disease)," ")}}function K(t,e){if(1&t&&h._UZ(0,"div",17),2&t){const t=h.oxw();h.Q6J("options",t.optionChart)("merge",t.dataUpdate)}}let tt=(()=>{class t{constructor(t,e,i,n){this.modalCtrl=t,this.pondService=e,this.toastService=i,this.translate=n,this.loadingFlag=new d.E,this.data=[],this.dataRaw=[],this.dateRangeSelected=u().format("YYYY-MM-DD"),this.maxDate=u(),this.minDate=u().subtract(180,"days"),this.show=!1,this.optionChart={tooltip:{trigger:"axis",formatter:t=>{let e=u(t[0].axisValue).format(this.translate.instant("FORMAT_DATE_MOMENT"))+"<br/>";return t.forEach(t=>{e+=2==t.seriesIndex?t.marker+" "+t.seriesName+": "+t.value[2]+"<br>":t.marker+" "+t.seriesName+": "+(new Intl.NumberFormat).format(t.value[1])+" <br>"}),e}},xAxis:{type:"time",splitLine:{show:!1},axisLabel:{formatter:"{dd}"}},yAxis:[{type:"value",splitLine:{show:!1}},{type:"value",position:"right",splitLine:{show:!1}}],series:[{type:"line",smooth:!0,name:this.translate.instant("POND_MOD.WEIGHT"),itemStyle:{color:"#00c853"}},{type:"bar",name:this.translate.instant("POND_MOD.LOSS"),barWidth:"10%",yAxisIndex:1},{symbolSize:20,name:this.translate.instant("POND_MOD.HEALTH"),type:"scatter",yAxisIndex:1,itemStyle:{shadowBlur:10,shadowColor:"rgba(120, 36, 50, 0.5)",shadowOffsetY:5}}]},this.dataDisease={antibiotic:[],bacteria:[],parasites:[],disease:[]},this.healthLab={accinated:0}}ngOnInit(){this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.getData()}getData(){this.loadingFlag.setStart(!0),this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},u(this.dateRangeSelected).format("YYYY-MM-DD")).subscribe(t=>{t.data?(this.dataRaw=t.data,this.dataRaw[0].date==u(this.dateRangeSelected).format("YYYY-MM-DD")&&(this.itemSelected=this.dataRaw[0]),this.prepareData(this.dataRaw),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1),this.getDataLab()},t=>{this.loadingFlag.setResult(!1),console.log(t)})}prepareData(t){this.data=[];let e=[],i=[];t.forEach(t=>{t.weight>0&&this.data.push([t.date,t.weight]),t.loss>0&&e.push([t.date,t.loss]),t.note_health&&i.push([t.date,t.weight,t.note_health])}),this.data.reverse(),this.dataUpdate={series:[{data:this.data},{data:e},{data:i}]},console.log(this.dataUpdate)}onChangeDate(t){this.dateRangeSelected=t.detail.value;let e=u(this.dateRangeSelected);this.itemSelected=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e.format("YYYY-MM-DD"))],(e<u(this.dataRaw[this.dataRaw.length-1].date)||e>u(this.dataRaw[0].date))&&this.getData(),this.getDataLab()}changeDate(t){let e=u(this.dateRangeSelected).add(t,"days");if(e<this.minDate||e>this.maxDate)return!1;this.dateRangeSelected=e.format("YYYY-MM-DD")}ionViewDidEnter(){this.show=!0}getDataLab(){this.loadingFlag.setPending(!0),this.pondService.loadDailyLab(this.dateRangeSelected).subscribe(t=>{1==+t.status?this.processData(t.data.record):this.toastService.warning(t.warning),this.loadingFlag.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loadingFlag.setResult(!1)})}processData(t){for(let e in t)"health"!=e?this.dataDisease[e]=t[e]:"health"==e&&(this.healthLab={vaccinated:t[e]?this.filterHealth(t[e],"vaccinated"):""});console.log(this.healthLab)}filterHealth(t,e){let i=t.find(t=>t.key==e);return i?i.value:""}joinArray(t){return t.map(t=>t.name).join(", ")}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(A.k),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-health"]],decls:58,vars:32,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-text-center"],[1,"title","ion-padding"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back"],["size","8"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","icon-only","name","arrow-forward"],["lines","none",1,"ion-padding"],[1,"ion-text-wrap"],[4,"ngIf"],[1,"ion-text-right"],["color","danger"],["echarts","","class","demo-chart",3,"options","merge",4,"ngIf"],["echarts","",1,"demo-chart",3,"options","merge"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"div",3),h.TgZ(10,"h1",4),h._uU(11),h.ALo(12,"translate"),h.qZA(),h.TgZ(13,"ion-grid"),h.TgZ(14,"ion-row"),h.TgZ(15,"ion-col",5),h.TgZ(16,"ion-button",6),h.NdJ("click",function(){return e.changeDate(-1)}),h._UZ(17,"ion-icon",7),h.qZA(),h.qZA(),h.TgZ(18,"ion-col",8),h.TgZ(19,"ion-item",3),h.TgZ(20,"ion-datetime",9),h.NdJ("ionChange",function(t){return e.onChangeDate(t)}),h.ALo(21,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(22,"ion-col",5),h.TgZ(23,"ion-button",6),h.NdJ("click",function(){return e.changeDate(1)}),h._UZ(24,"ion-icon",10),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(25,"ion-list",11),h.TgZ(26,"ion-item"),h.TgZ(27,"ion-label",12),h.TgZ(28,"ion-grid"),h.YNc(29,B,10,7,"ion-row",13),h.YNc(30,z,7,4,"ion-row",13),h.YNc(31,$,7,4,"ion-row",13),h.YNc(32,W,7,4,"ion-row",13),h.YNc(33,X,7,4,"ion-row",13),h.qZA(),h.qZA(),h.qZA(),h.TgZ(34,"ion-item"),h.TgZ(35,"ion-label",12),h.TgZ(36,"ion-grid"),h.TgZ(37,"ion-row"),h.TgZ(38,"ion-col"),h._uU(39),h.ALo(40,"translate"),h.qZA(),h.TgZ(41,"ion-col",14),h.TgZ(42,"ion-text",15),h._uU(43),h.ALo(44,"number"),h.qZA(),h.TgZ(45,"small"),h._uU(46,"kg"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(47,"ion-item"),h.TgZ(48,"ion-label",12),h.TgZ(49,"ion-grid"),h.TgZ(50,"ion-row"),h.TgZ(51,"ion-col"),h._uU(52),h.ALo(53,"translate"),h.qZA(),h.TgZ(54,"ion-col",14),h.TgZ(55,"ion-text",15),h._uU(56),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(57,K,1,2,"div",16),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,19,"POND_MOD.HEALTH")),h.xp6(5),h.AsE("",null==e.itemSelected?null:e.itemSelected.weight," g/",h.lcZ(12,21,"PCS"),""),h.xp6(5),h.Q6J("disabled",e.dateRangeSelected<=e.minDate.format("YYYY-MM-DD")),h.xp6(4),h.Q6J("displayFormat",h.lcZ(21,23,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeSelected),h.xp6(3),h.Q6J("disabled",e.dateRangeSelected>=e.maxDate.format("YYYY-MM-DD")),h.xp6(6),h.Q6J("ngIf",+e.healthLab.vaccinated>0),h.xp6(1),h.Q6J("ngIf",e.dataDisease.antibiotic.length>0),h.xp6(1),h.Q6J("ngIf",e.dataDisease.bacteria.length>0),h.xp6(1),h.Q6J("ngIf",e.dataDisease.parasites.length>0),h.xp6(1),h.Q6J("ngIf",e.dataDisease.disease.length>0),h.xp6(6),h.Oqu(h.lcZ(40,25,"POND_MOD.LOSS")),h.xp6(4),h.hij(" ",h.xi3(44,27,(null==e.itemSelected?null:e.itemSelected.loss)*(null==e.itemSelected?null:e.itemSelected.weight)/1e3,"1.0-1")," "),h.xp6(9),h.Oqu(h.lcZ(53,30,"POND_MOD.SESEASE")),h.xp6(4),h.hij(" ",null==e.itemSelected?null:e.itemSelected.note_health," "),h.xp6(1),h.Q6J("ngIf",e.show))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.jY,a.Nd,a.wI,a.Ie,a.x4,a.QI,a.q_,a.Q$,n.O5,a.yW,r._w],pipes:[g.X$,n.JJ],styles:[""]}),t})(),et=(()=>{class t{constructor(t){this.modalCtrl=t}ngOnInit(){}dismiss(){this.modalCtrl.dismiss({dismissed:!0})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-setting"]],decls:18,vars:9,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary"],["slot","start","name","save"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.qZA(),h._UZ(5,"ion-content"),h.TgZ(6,"ion-footer"),h.TgZ(7,"ion-toolbar"),h.TgZ(8,"ion-buttons",0),h.TgZ(9,"ion-button",1),h.NdJ("click",function(){return e.dismiss()}),h._UZ(10,"ion-icon",2),h._uU(11),h.ALo(12,"translate"),h.qZA(),h.qZA(),h.TgZ(13,"ion-buttons",3),h.TgZ(14,"ion-button",4),h._UZ(15,"ion-icon",5),h._uU(16),h.ALo(17,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,3,"POND_MOD.SETTING_AND_CONFIG")),h.xp6(8),h.hij(" ",h.lcZ(12,5,"CLOSE")," "),h.xp6(5),h.hij(" ",h.lcZ(17,7,"SAVE")," "))},directives:[a.Gu,a.sr,a.wd,a.W2,a.fr,a.Sm,a.YG,a.gu],pipes:[g.X$],styles:[""]}),t})();var it=i(62014),nt=i(71239);function ot(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",11),h.qZA())}let st=(()=>{class t{constructor(t,e,i,n,o,s){this.modalCtrl=t,this._formBuilder=e,this.pondService=i,this.toastService=n,this.translate=o,this.dbLocalService=s,this.saveLoading=new d.E,this.numberFormatCost=new it.y("")}ngOnInit(){this.form=this._formBuilder.group({cost:["",o.kI.required],note:["",o.kI.required]})}dismiss(){this.modalCtrl.dismiss({dismissed:!0})}onSubmit(){let t={cost:this.numberFormatCost.realValue,note:this.form.value.note};this.saveLoading.setPending(!0),this.pondService.reqSeasonCancel(t).subscribe(t=>{if(1!=t.error){this.toastService.success(t.message);let e=this.dbLocalService.ponds.findIndex(t=>t.infor.code===this.pondService.pcode);if(e>=0){let t={infor:this.pondService.pond,devices:[]};t.infor.current_season="",t.infor.species_id=null,t.infor.species=null,t.infor.start_time=null,this.dbLocalService.updateItem("ponds",t,e)}this.pondService.seasonStart=!1,this.pondService.reloadSeason$.next(1),this.saveLoading.setResult(!0),this.modalCtrl.dismiss({saved:!0})}else this.toastService.warning(t.message),this.saveLoading.setResult(!1)},()=>{this.saveLoading.setResult(!1),this.translate.get("CONNECT_ERROR").subscribe(t=>{this.toastService.warning(t)})})}formatCost(t){this.numberFormatCost.setValue(t.detail.value)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(o.qu),h.Y36(c.p),h.Y36(A.k),h.Y36(g.sK),h.Y36(nt.T))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-season-cancel"]],inputs:{pondsOb:"pondsOb"},decls:26,vars:19,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[3,"formGroup","ngSubmit"],["lines","inset"],["position","stacked"],["type","tel","formControlName","cost","autofocus","","inputmode","numeric",3,"value","ionChange"],["formControlName","note"],[1,"ion-text-center","ion-padding"],[4,"ngIf"],["type","submit","color","primary","shape","round",3,"disabled"],["name","dots"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"form",3),h.NdJ("ngSubmit",function(){return e.onSubmit()}),h.TgZ(10,"ion-item",4),h.TgZ(11,"ion-label",5),h._uU(12),h.ALo(13,"translate"),h.ALo(14,"translate"),h.qZA(),h.TgZ(15,"ion-input",6),h.NdJ("ionChange",function(t){return e.formatCost(t)}),h.qZA(),h.qZA(),h.TgZ(16,"ion-item",4),h.TgZ(17,"ion-label",5),h._uU(18),h.ALo(19,"translate"),h.qZA(),h._UZ(20,"ion-textarea",7),h.qZA(),h.TgZ(21,"div",8),h.YNc(22,ot,2,0,"div",9),h.TgZ(23,"ion-button",10),h._uU(24),h.ALo(25,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,9,"POND_MOD.CANCEL_SEASON")),h.xp6(3),h.Q6J("formGroup",e.form),h.xp6(3),h.AsE("",h.lcZ(13,11,"POND_MOD.COST_CANCEL")," (",h.lcZ(14,13,"CURRENCY_S"),")"),h.xp6(3),h.Q6J("value",e.numberFormatCost.fakeView),h.xp6(3),h.Oqu(h.lcZ(19,15,"POND_MOD.NOTE")),h.xp6(4),h.Q6J("ngIf",e.saveLoading.pending),h.xp6(1),h.Q6J("disabled",e.form.invalid||e.saveLoading.pending),h.xp6(1),h.hij("",h.lcZ(25,17,"POND_MOD.CONFIRM")," "))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,o._Y,o.JL,o.sg,a.Ie,a.Q$,a.pK,a.j9,o.JJ,o.u,a.g2,n.O5,a.PQ],pipes:[g.X$],styles:[""]}),t})();function at(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",17),h.qZA())}function rt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-content",6),h.TgZ(1,"div",7),h.TgZ(2,"h1"),h._uU(3),h.qZA(),h.YNc(4,at,2,0,"div",8),h.qZA(),h.TgZ(5,"ion-item",9),h.TgZ(6,"ion-label",10),h._uU(7),h.ALo(8,"translate"),h.qZA(),h._UZ(9,"ion-input",11),h.qZA(),h.TgZ(10,"ion-item",9),h.TgZ(11,"ion-label",10),h._uU(12),h.ALo(13,"translate"),h.qZA(),h._UZ(14,"ion-input",12),h.qZA(),h.TgZ(15,"ion-item",9),h.TgZ(16,"ion-label",10),h._uU(17),h.ALo(18,"translate"),h.qZA(),h._UZ(19,"ion-input",13),h.qZA(),h.TgZ(20,"ion-item",9),h.TgZ(21,"ion-label",10),h._uU(22),h.ALo(23,"translate"),h.ALo(24,"translate"),h.qZA(),h.TgZ(25,"ion-input",14),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().formatCost(e)}),h.qZA(),h.qZA(),h.TgZ(26,"ion-item",9),h.TgZ(27,"ion-label",10),h._uU(28),h.ALo(29,"translate"),h.qZA(),h._UZ(30,"ion-input",15),h.qZA(),h.TgZ(31,"ion-item",16),h.TgZ(32,"ion-label"),h.TgZ(33,"p"),h._uU(34),h.ALo(35,"translate"),h.ALo(36,"translate"),h.qZA(),h.TgZ(37,"span"),h._uU(38),h.ALo(39,"number"),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.Q6J("formGroup",t.form),h.xp6(3),h.Oqu(t.data.name),h.xp6(1),h.Q6J("ngIf",t.savingFlag.pending),h.xp6(3),h.Oqu(h.lcZ(8,13,"POND_MOD.NAME_POND")),h.xp6(5),h.Oqu(h.lcZ(13,15,"AREA")),h.xp6(5),h.Oqu(h.lcZ(18,17,"POND_MOD.DEEP")),h.xp6(5),h.AsE("",h.lcZ(23,19,"POND_MOD.COST")," (",h.lcZ(24,21,"CURRENCY_S"),")"),h.xp6(3),h.Q6J("value",t.numberFormatCost.fakeView),h.xp6(3),h.Oqu(h.lcZ(29,23,"FARM_MOD.NUM_SEASON")),h.xp6(6),h.AsE("",h.lcZ(35,25,"FARM_MOD.NUM_CROP")," (",h.lcZ(36,27,"CURRENCY_S"),")"),h.xp6(4),h.Oqu(h.xi3(39,29,t.numberFormatCost.realValue/t.form.value.expire_date,"1.0-0"))}}let lt=(()=>{class t{constructor(t,e,i,n,o,s){this.modalController=t,this.pondService=e,this._formBuilder=i,this.toastService=n,this.translate=o,this.dblocalSerive=s,this.savingFlag=new d.E,this.numberFormatCost=new it.y("")}ngOnInit(){return(0,l.mG)(this,void 0,void 0,function*(){this.data=this.pondService.pond,this.createForm()})}createForm(){console.log(this.data),console.log(this.dblocalSerive.ponds[this.pondLocalIndex]),this.numberFormatCost.setValue(this.data.create_cost),this.form=this._formBuilder.group({name:[this.data.name,o.kI.required],area:[this.data.area,o.kI.required],deep:[this.data.deep,o.kI.required],create_cost:[this.data.create_cost],expire_date:[this.data.expire_date]})}formatCost(t){this.numberFormatCost.setValue(t.detail.value)}save(){if(this.form.invalid||this.savingFlag.pending)return console.log(this.form.value),!1;this.savingFlag.setPending(!0);let t={name:this.form.value.name,area:this.form.value.area,deep:this.form.value.deep,create_cost:this.numberFormatCost.realValue,expire_date:this.form.value.expire_date};this.pondService.updateInfo(this.form.value).subscribe(e=>{e.error||1!=e.status?this.toastService.warning(e.error):(this.toastService.success(e.message),this.pondService.pond.name=t.name,this.pondService.pond.area=t.area,this.pondService.pond.deep=t.deep,this.pondService.pond.create_cost=t.create_cost,this.pondService.pond.expire_date=t.expire_date,this.dblocalSerive.ponds[this.pondLocalIndex].infor=this.pondService.pond,this.dblocalSerive.setLocalData("ponds",this.dblocalSerive.ponds),this.modalController.dismiss()),this.savingFlag.setResult(!0)},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.savingFlag.setResult(!1)})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(o.qu),h.Y36(A.k),h.Y36(g.sK),h.Y36(nt.T))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-edit"]],inputs:{pondLocalIndex:"pondLocalIndex"},decls:13,vars:8,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"ion-padding","ion-text-center"],[4,"ngIf"],["lines","inset"],["position","floating"],["formControlName","name"],["formControlName","area","type","tel","inputmode","decimal"],["formControlName","deep","type","tel","inputmode","decimal"],["formControlName","create_cost","type","tel","inputmode","numeric",3,"value","ionChange"],["type","number","inputmode","numeric","formControlName","expire_date"],["lines","none"],["name","dots"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalController.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.save()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(12,rt,40,32,"ion-content",5)),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,4,"POND_MOD.EDIT_INFOR")),h.xp6(3),h.Q6J("disabled",e.savingFlag.pending),h.xp6(1),h.Oqu(h.lcZ(11,6,"POND_MOD.SAVE")),h.xp6(2),h.Q6J("ngIf",e.data))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,n.O5,a.W2,o.JL,o.sg,a.Ie,a.Q$,a.pK,a.j9,o.JJ,o.u,a.as,a.PQ],pipes:[g.X$,n.JJ],styles:[""]}),t})();function ct(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",11),h.qZA())}let dt=(()=>{class t{constructor(t,e,i,n,o){this.modalController=t,this.pondService=e,this.toastService=i,this.translate=n,this.dblocalSerive=o,this.savingFlag=new d.E,this.viewModeCode=0}ngOnInit(){}selected(t){this.viewModeCode=t.detail.value}save(){this.savingFlag.setPending(!0),this.pondService.updatePrivate({public:this.viewModeCode}).pipe().subscribe(t=>{0==t.status?this.toastService.warning(t.error):(this.pondService.pond.public=this.viewModeCode,this.dblocalSerive.ponds[this.pondLocalIndex].infor=this.pondService.pond,this.dblocalSerive.setLocalData("ponds",this.dblocalSerive.ponds),this.modalController.dismiss(),this.toastService.success(t.message)),this.savingFlag.setResult(!0),this.modalController.dismiss()},t=>{this.savingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(A.k),h.Y36(g.sK),h.Y36(nt.T))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-view-mode"]],inputs:{pondLocalIndex:"pondLocalIndex"},decls:50,vars:31,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],[1,"ion-padding","ion-text-center"],[4,"ngIf"],[3,"value","ionChange"],["slot","start","value","3"],["slot","start","value","2"],["slot","start","value","1"],["name","dots"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalController.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.save()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(12,"ion-content"),h.TgZ(13,"div",5),h.TgZ(14,"h1"),h._uU(15),h.qZA(),h.YNc(16,ct,2,0,"div",6),h.qZA(),h.TgZ(17,"ion-list"),h.TgZ(18,"ion-radio-group",7),h.NdJ("ionChange",function(t){return e.selected(t)}),h.TgZ(19,"ion-list-header"),h.TgZ(20,"ion-label"),h._uU(21),h.ALo(22,"translate"),h.qZA(),h.qZA(),h.TgZ(23,"ion-item"),h.TgZ(24,"ion-label"),h.TgZ(25,"h3"),h._uU(26),h.ALo(27,"translate"),h.qZA(),h.TgZ(28,"p"),h._uU(29),h.ALo(30,"translate"),h.qZA(),h.qZA(),h._UZ(31,"ion-radio",8),h.qZA(),h.TgZ(32,"ion-item"),h.TgZ(33,"ion-label"),h.TgZ(34,"h3"),h._uU(35),h.ALo(36,"translate"),h.qZA(),h.TgZ(37,"p"),h._uU(38),h.ALo(39,"translate"),h.qZA(),h.qZA(),h._UZ(40,"ion-radio",9),h.qZA(),h.TgZ(41,"ion-item"),h.TgZ(42,"ion-label"),h.TgZ(43,"h3"),h._uU(44),h.ALo(45,"translate"),h.qZA(),h.TgZ(46,"p"),h._uU(47),h.ALo(48,"translate"),h.qZA(),h.qZA(),h._UZ(49,"ion-radio",10),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,13,"PRIVATE_MODE")),h.xp6(3),h.Q6J("disabled",e.savingFlag.pending),h.xp6(1),h.Oqu(h.lcZ(11,15,"SAVE")),h.xp6(5),h.Oqu(e.pondService.pond.name),h.xp6(1),h.Q6J("ngIf",e.savingFlag.pending),h.xp6(2),h.Q6J("value",e.pondService.pond.public),h.xp6(3),h.Oqu(h.lcZ(22,17,"POND_MOD.WHO_CAN_SEE_THIS_POND")),h.xp6(5),h.Oqu(h.lcZ(27,19,"PUBLIC")),h.xp6(3),h.Oqu(h.lcZ(30,21,"PRIVATE_MODE_PUBLIC_DETAIL")),h.xp6(6),h.Oqu(h.lcZ(36,23,"FOLLOWER")),h.xp6(3),h.Oqu(h.lcZ(39,25,"PRIVATE_MODE_FOLLOWER_DETAIL")),h.xp6(6),h.Oqu(h.lcZ(45,27,"PROTECTED")),h.xp6(3),h.Oqu(h.lcZ(48,29,"PRIVATE_MODE_PROTECTED_DETAIL")))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,n.O5,a.q_,a.se,a.QI,a.yh,a.Q$,a.Ie,a.B7,a.U5,a.PQ],pipes:[g.X$],styles:[""]}),t})();var ut=i(66341),ht=i(79765),gt=i(25917),pt=i(54395),mt=i(87519),Zt=i(43190);function ft(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-avatar",0),h._UZ(2,"img",8),h.qZA(),h.TgZ(3,"ion-label"),h.TgZ(4,"h3"),h._uU(5),h.TgZ(6,"span",9),h._uU(7),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-button",10),h.NdJ("click",function(){const e=h.CHM(t).index;return h.oxw().presentRemoveUser(e)}),h._uU(9),h.ALo(10,"translate"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw();h.xp6(5),h.hij("",t.user_name," - "),h.xp6(2),h.Oqu(i.permissions[t.key]),h.xp6(2),h.hij(" ",h.lcZ(10,3,"POND_MOD.DELETE")," ")}}function At(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-avatar",0),h._UZ(2,"img",11),h.qZA(),h.TgZ(3,"ion-label"),h.TgZ(4,"h3"),h._uU(5),h.qZA(),h.TgZ(6,"p"),h._uU(7),h.qZA(),h.qZA(),h.TgZ(8,"ion-button",12),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw().presentAddUser(e)}),h._uU(9),h.ALo(10,"translate"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw();h.xp6(2),h.Q6J("src",i.memberService.getSitePath()+"/upload/users/avatars/medium/"+t.photo,h.LSH),h.xp6(3),h.Oqu(t.username),h.xp6(2),h.Oqu(t.email),h.xp6(1),h.Q6J("disabled",i.checkExistUser(t)),h.xp6(1),h.hij(" ",h.lcZ(10,5,"POND_MOD.SELECT")," ")}}function _t(t,e){if(1&t&&(h.TgZ(0,"ion-item",13),h.TgZ(1,"ion-label"),h.TgZ(2,"p"),h._uU(3),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.Oqu(t.message)}}function vt(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",14),h.qZA())}let Tt=(()=>{class t{constructor(t,e,i,n,o,s){this.modalController=t,this.pondService=e,this.memberService=i,this.toastService=n,this.translate=o,this.alertController=s,this.savingFlag=new d.E,this.loadingFlag=new d.E,this.searchTerms=new ht.xQ}ngOnInit(){let t=this.searchTerms.pipe((0,pt.b)(300),(0,mt.x)(),(0,Zt.w)(t=>this.getListMember(t)));this.permissions={pond_operator:this.translate.instant("POND_MOD.OPERATION"),pond_manager:this.translate.instant("FARM_MOD.MANAGER"),pond_expert:this.translate.instant("EXPERT")},this.members$=t,this.members$.subscribe(t=>{t?(this.loadingFlag.setResult(!0),this.message=""):(this.loadingFlag.setResult(!1),this.message=this.translate.instant("POND_MOD.NOT_FOUND"))})}search(t){this.searchTerms.next(t.detail.value)}getListMember(t){return this.loadingFlag.setPending(!0),t.trim()?this.memberService.searchMember(t).pipe():(this.loadingFlag.setResult(!0),(0,gt.of)([]))}onSelect(t){this.memberSelected=t}addPermission(t,e){this.pondService.updatePrivate({user_manager:t.user_id,position:e}).pipe().subscribe(i=>{0==i.status?this.toastService.warning(i.error):(this.manager.push({user_name:t.username,user_id:t.user_id,key:e}),this.toastService.success(this.translate.instant("FARM_MOD.ADDED_STAFF"))),this.savingFlag.setResult(!0)},t=>{this.savingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}removePermission(t){this.pondService.removePermission(this.manager[t].user_id,this.manager[t].key).pipe().subscribe(e=>{0==e.status?this.toastService.warning(e.error):(this.manager.splice(t,1),this.toastService.success(this.translate.instant("FARM_MOD.REMOVED_STAFF"))),this.savingFlag.setResult(!0)},t=>{this.savingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}getLabelPage(){}presentRemoveUser(t){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("CONFIRM")+"!",message:this.translate.instant("FARM_MOD.CONFIRM_REMOVE"),buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"Okay",handler:()=>{this.removePermission(t)}}]})).present()})}presentAddUser(t){return(0,l.mG)(this,void 0,void 0,function*(){let e=[];for(let t in this.permissions)e.push({name:this.permissions[t],type:"radio",value:t,label:this.permissions[t],checked:!1});e[0].checked=!0,yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("CONFIRM")+"!",message:this.translate.instant("FARM_MOD.CONFIRM_ADD"),inputs:e,buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"Okay",handler:e=>{this.addPermission(t,e)}}]})).present()})}close(){this.modalController.dismiss(this.manager)}checkExistUser(t){for(let e=0;e<this.manager.length;e++)if(this.manager[e].user_name==t.username)return!0;return!1}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(ut.n),h.Y36(A.k),h.Y36(g.sK),h.Y36(a.Br))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-manager"]],inputs:{manager:"manager"},decls:23,vars:15,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[3,"placeholder","ionChange"],[4,"ngFor","ngForOf"],["lines","none",4,"ngIf"],[1,"ion-text-center"],[4,"ngIf"],["src","assets/img/default-profile.jpg"],[2,"color","red"],["slot","end","color","danger",3,"click"],["onError","this.src='assets/img/default-profile.jpg'",3,"src"],["slot","end",3,"disabled","click"],["lines","none"],["name","dots"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.close()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"ion-searchbar",3),h.NdJ("ionChange",function(t){return e.search(t)}),h.ALo(10,"translate"),h.qZA(),h.TgZ(11,"ion-list"),h.YNc(12,ft,11,5,"ion-item",4),h.qZA(),h.TgZ(13,"ion-list"),h.TgZ(14,"ion-list-header"),h.TgZ(15,"ion-label"),h._uU(16),h.ALo(17,"translate"),h.qZA(),h.qZA(),h.YNc(18,At,11,7,"ion-item",4),h.ALo(19,"async"),h.YNc(20,_t,4,1,"ion-item",5),h.qZA(),h.TgZ(21,"div",6),h.YNc(22,vt,2,0,"div",7),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,7,"FARM_MOD.MEMBER")),h.xp6(3),h.Q6J("placeholder",h.lcZ(10,9,"FARM_MOD.MANAGER_EMAIL")),h.xp6(3),h.Q6J("ngForOf",e.manager),h.xp6(4),h.Oqu(h.lcZ(17,11,"POND_MOD.RESULT")),h.xp6(2),h.Q6J("ngForOf",h.lcZ(19,13,e.members$)),h.xp6(2),h.Q6J("ngIf",e.message),h.xp6(2),h.Q6J("ngIf",e.loadingFlag.pending))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.VI,a.j9,a.q_,n.sg,a.yh,a.Q$,n.O5,a.Ie,a.BJ,a.PQ],pipes:[g.X$,n.Ov],styles:[""]}),t})();function qt(t,e){if(1&t&&(h.TgZ(0,"ion-item",8),h.TgZ(1,"ion-label"),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"span",9),h.TgZ(5,"ion-text"),h._uU(6),h.ALo(7,"number"),h.qZA(),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.xp6(2),h.hij(" ",h.lcZ(3,3,"POND_MOD.HARVESTED")," "),h.xp6(4),h.Oqu(h.xi3(7,5,t.total_harvest,"1.0-0")),h.xp6(2),h.hij(" ",h.lcZ(9,8,"PCS")," ")}}function xt(t,e){if(1&t&&(h.TgZ(0,"ion-item",8),h.TgZ(1,"ion-label"),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"span",9),h.TgZ(5,"ion-text"),h._uU(6),h.ALo(7,"number"),h.qZA(),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.xp6(2),h.hij(" ",h.lcZ(3,3,"POND_MOD.MOVED")," "),h.xp6(4),h.Oqu(h.xi3(7,5,t.total_move,"1.0-0")),h.xp6(2),h.hij(" ",h.lcZ(9,8,"PCS")," ")}}function Ot(t,e){if(1&t&&(h.TgZ(0,"ion-select-option",38),h._uU(1),h.ALo(2,"translate"),h.ALo(3,"translate"),h.qZA()),2&t){const t=e.$implicit;h.Q6J("value",t.id),h.xp6(1),h.HOy("",t.name," (",h.lcZ(2,5,"CROP_MOD.CROP_CREATED")," ",t.moment_day," ",h.lcZ(3,7,"CROP_MOD.DAYS_AGO"),") ")}}function Dt(t,e){if(1&t&&(h.TgZ(0,"ion-text",10),h._uU(1),h.ALo(2,"number"),h.qZA()),2&t){const t=h.oxw(2);h.xp6(1),h.hij("",h.xi3(2,1,t.post.total_cost/1e6,"1.0-1")," tri\u1ec7u")}}function bt(t,e){if(1&t&&(h.TgZ(0,"ion-text",10),h._uU(1),h.ALo(2,"number"),h.qZA()),2&t){const t=h.oxw(2);h.xp6(1),h.Oqu(h.xi3(2,1,t.post.total_cost,"1.0-1"))}}function St(t,e){if(1&t&&(h.TgZ(0,"p"),h.TgZ(1,"ion-text",10),h.TgZ(2,"strong"),h._uU(3),h.qZA(),h.qZA(),h._uU(4),h.ALo(5,"translate"),h.ALo(6,"translate"),h.qZA()),2&t){const t=h.oxw(2);h.xp6(3),h.Oqu(t.pondSelected.name),h.xp6(1),h.lnq(" ",h.lcZ(5,4,"POND_MOD.STARTED_FROM")," ",t.pondSelected.moment_day," ",h.lcZ(6,6,"DAYS")," ")}}function Ct(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-content",4),h.TgZ(1,"ion-slides",5,6),h.NdJ("ionSlideReachEnd",function(){return h.CHM(t),h.oxw().endView()}),h.TgZ(3,"ion-slide"),h.TgZ(4,"div",7),h.TgZ(5,"h1"),h._uU(6),h.qZA(),h.TgZ(7,"ion-item",8),h.TgZ(8,"ion-label"),h._uU(9),h.ALo(10,"translate"),h.qZA(),h.TgZ(11,"span",9),h.TgZ(12,"ion-text",10),h._uU(13),h.ALo(14,"number"),h.qZA(),h._uU(15),h.ALo(16,"translate"),h.qZA(),h.qZA(),h.YNc(17,qt,10,10,"ion-item",11),h.YNc(18,xt,10,10,"ion-item",11),h.TgZ(19,"p",12),h._uU(20),h.ALo(21,"translate"),h.qZA(),h.TgZ(22,"ion-grid"),h.TgZ(23,"ion-row"),h.TgZ(24,"ion-col",13),h.TgZ(25,"ion-item"),h.TgZ(26,"ion-label",14),h._uU(27),h.ALo(28,"translate"),h.qZA(),h.TgZ(29,"ion-input",15),h.NdJ("ionInput",function(e){return h.CHM(t),h.oxw().changeInput("size",e)}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(30,"ion-col",13),h.TgZ(31,"ion-item"),h.TgZ(32,"ion-label",14),h._uU(33),h.ALo(34,"translate"),h.qZA(),h.TgZ(35,"ion-select",16),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().changeInput("unit",e)}),h.TgZ(36,"ion-select-option",17),h._uU(37),h.ALo(38,"translate"),h.qZA(),h.TgZ(39,"ion-select-option",18),h._uU(40),h.ALo(41,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(42,"ion-row"),h.TgZ(43,"ion-col",13),h.TgZ(44,"ion-item"),h.TgZ(45,"ion-label",14),h._uU(46),h.ALo(47,"translate"),h.ALo(48,"translate"),h.qZA(),h.TgZ(49,"ion-input",19),h.NdJ("ionInput",function(e){return h.CHM(t),h.oxw().changeInput("quantityLive",e)}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(50,"ion-col",13),h.TgZ(51,"ion-item"),h.TgZ(52,"ion-label",14),h._uU(53),h.ALo(54,"translate"),h.qZA(),h.TgZ(55,"ion-input",20),h.NdJ("ionInput",function(e){return h.CHM(t),h.oxw().changeInput("ratio",e)}),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(56,"ion-button",21),h.NdJ("click",function(){return h.CHM(t),h.MAs(2).slideNext()}),h._uU(57),h.ALo(58,"translate"),h._UZ(59,"ion-icon",22),h.qZA(),h.qZA(),h.qZA(),h.TgZ(60,"ion-slide"),h.TgZ(61,"div",23),h.TgZ(62,"ion-item"),h.TgZ(63,"ion-label",14),h._uU(64),h.ALo(65,"translate"),h.qZA(),h.TgZ(66,"ion-select",24),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().selectPond(e)}),h.YNc(67,Ot,4,9,"ion-select-option",25),h.qZA(),h.qZA(),h.TgZ(68,"ion-item"),h.TgZ(69,"ion-label",14),h._uU(70),h.ALo(71,"translate"),h.ALo(72,"translate"),h.qZA(),h.TgZ(73,"ion-input",26),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().numberFormatQuantity.setValue(e.detail.value)}),h.qZA(),h.qZA(),h.TgZ(74,"ion-item"),h.TgZ(75,"ion-label",14),h._uU(76),h.ALo(77,"translate"),h.ALo(78,"translate"),h.qZA(),h.TgZ(79,"ion-input",27),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().numberFormatCost.setValue(e.detail.value)}),h.qZA(),h.qZA(),h.TgZ(80,"ion-item"),h.TgZ(81,"ion-label",14),h._uU(82),h.ALo(83,"translate"),h.qZA(),h._UZ(84,"ion-input",28),h.qZA(),h.TgZ(85,"p",12),h._uU(86),h.ALo(87,"translate"),h.qZA(),h.TgZ(88,"ion-button",29),h.NdJ("click",function(){return h.CHM(t),h.MAs(2).slidePrev()}),h._UZ(89,"ion-icon",30),h._uU(90),h.ALo(91,"translate"),h.qZA(),h.TgZ(92,"ion-button",21),h.NdJ("click",function(){return h.CHM(t),h.MAs(2).slideNext()}),h._uU(93),h.ALo(94,"translate"),h._UZ(95,"ion-icon",22),h.qZA(),h.qZA(),h.qZA(),h.TgZ(96,"ion-slide"),h.TgZ(97,"div",31),h.TgZ(98,"ion-text",10),h.TgZ(99,"h1"),h._uU(100),h.ALo(101,"translate"),h.qZA(),h.qZA(),h.TgZ(102,"p",12),h._uU(103),h.ALo(104,"translate"),h.qZA(),h.TgZ(105,"ion-item"),h.TgZ(106,"ion-label"),h.TgZ(107,"h3"),h._uU(108),h.ALo(109,"translate"),h.qZA(),h.TgZ(110,"p"),h._uU(111),h.ALo(112,"number"),h.TgZ(113,"span"),h._uU(114),h.ALo(115,"translate"),h.qZA(),h._uU(116," ("),h.TgZ(117,"span"),h._uU(118),h.ALo(119,"number"),h.ALo(120,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(121,"ion-item"),h.TgZ(122,"ion-label"),h.TgZ(123,"h3"),h._uU(124),h.ALo(125,"translate"),h.ALo(126,"translate"),h.qZA(),h.TgZ(127,"ion-badge",32),h._uU(128),h.qZA(),h.TgZ(129,"ion-badge",33),h._uU(130),h.ALo(131,"number"),h.ALo(132,"translate"),h.qZA(),h.TgZ(133,"ion-badge",34),h._uU(134),h.qZA(),h.qZA(),h.qZA(),h.TgZ(135,"ion-item"),h.TgZ(136,"ion-label"),h.TgZ(137,"h3"),h._uU(138),h.ALo(139,"translate"),h.qZA(),h.TgZ(140,"p"),h.YNc(141,Dt,3,4,"ion-text",35),h.YNc(142,bt,3,4,"ion-text",35),h._uU(143),h.ALo(144,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(145,"ion-item"),h.TgZ(146,"ion-label"),h.TgZ(147,"h3"),h._uU(148),h.ALo(149,"translate"),h.qZA(),h.TgZ(150,"p"),h.TgZ(151,"span"),h._uU(152),h.qZA(),h._uU(153),h.ALo(154,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(155,"ion-item"),h.TgZ(156,"ion-label"),h.TgZ(157,"h3"),h._uU(158),h.ALo(159,"translate"),h.qZA(),h.TgZ(160,"p"),h._uU(161),h.qZA(),h.qZA(),h.qZA(),h.TgZ(162,"ion-item"),h.TgZ(163,"ion-label"),h.TgZ(164,"h3"),h._uU(165),h.ALo(166,"translate"),h.qZA(),h.YNc(167,St,7,8,"p",36),h.qZA(),h.qZA(),h.TgZ(168,"div",37),h.TgZ(169,"ion-button",29),h.NdJ("click",function(){return h.CHM(t),h.MAs(2).slidePrev()}),h._UZ(170,"ion-icon",30),h._uU(171),h.ALo(172,"translate"),h.qZA(),h.TgZ(173,"ion-button",21),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentAlert()}),h._uU(174),h.ALo(175,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.Q6J("formGroup",t.form),h.xp6(6),h.Oqu(t.pondService.pond.name),h.xp6(3),h.hij(" ",h.lcZ(10,58,"POND_MOD.TOTAL_COST")," "),h.xp6(4),h.Oqu(h.xi3(14,60,null==t.seasonInfo?null:t.seasonInfo.total,"1.0-0")),h.xp6(2),h.hij(" ",h.lcZ(16,63,"CURRENCY_S")," "),h.xp6(2),h.Q6J("ngIf",t.total_harvest>0),h.xp6(1),h.Q6J("ngIf",t.total_move>0),h.xp6(2),h.hij(" ",h.lcZ(21,65,"POND_MOD.CURRENT_SEASON")," "),h.xp6(7),h.Oqu(h.lcZ(28,67,"POND_MOD.SIZE")),h.xp6(6),h.Oqu(h.lcZ(34,69,"POND_MOD.UNIT")),h.xp6(4),h.hij("",h.lcZ(38,71,"PCS"),"/kg"),h.xp6(3),h.hij("gr/",h.lcZ(41,73,"PCS"),""),h.xp6(6),h.AsE("",h.lcZ(47,75,"POND_MOD.QUANTITY")," (",h.lcZ(48,77,"PCS"),")"),h.xp6(3),h.Q6J("value",t.numberFormatQuantityLive.fakeView),h.xp6(4),h.hij("",h.lcZ(54,79,"POND_MOD.SURVIVAL_RATE")," (%)"),h.xp6(3),h.Q6J("disabled",t.form.controls.form1.invalid),h.xp6(1),h.hij(" ",h.lcZ(58,81,"NEXT")," "),h.xp6(7),h.Oqu(h.lcZ(65,83,"POND_MOD.CHOOSE_POND_DES")),h.xp6(3),h.Q6J("ngForOf",t.targetPonds),h.xp6(3),h.AsE("",h.lcZ(71,85,"POND_MOD.QUANTITY")," ",h.lcZ(72,87,"POND_MOD.MOVE")," (kg)"),h.xp6(3),h.Q6J("value",t.numberFormatQuantity.fakeView),h.xp6(3),h.AsE("",h.lcZ(77,89,"POND_MOD.TRANS_COST")," (",h.lcZ(78,91,"CURRENCY_S"),")"),h.xp6(3),h.Q6J("value",t.numberFormatCost.fakeView),h.xp6(3),h.Oqu(h.lcZ(83,93,"POND_MOD.NOTE")),h.xp6(4),h.hij(" ",h.lcZ(87,95,"CROP_MOD.NOTE_MOVE")," "),h.xp6(4),h.hij(" ",h.lcZ(91,97,"BACK")," "),h.xp6(2),h.Q6J("disabled",t.form.controls.form2.invalid),h.xp6(1),h.hij(" ",h.lcZ(94,99,"NEXT")," "),h.xp6(7),h.hij("",h.lcZ(101,101,"POND_MOD.CAREFUL"),"!"),h.xp6(3),h.hij(" ",h.lcZ(104,103,"POND_MOD.NOTE_CAREFUL")," "),h.xp6(5),h.Oqu(h.lcZ(109,105,"POND_MOD.SIZE_FISH")),h.xp6(3),h.hij("",h.xi3(112,107,t.post.weight,"1.0-1")," "),h.xp6(3),h.hij("g/",h.lcZ(115,110,"POND_MOD.ANIMAL"),""),h.xp6(4),h.AsE("",h.xi3(119,112,t.post.size,"1.0-1")," ",h.lcZ(120,115,"POND_MOD.ANIMAL"),"/kg)"),h.xp6(6),h.AsE("",h.lcZ(125,117,"POND_MOD.QUANTITY")," ",h.lcZ(126,119,"POND_MOD.MOVE"),""),h.xp6(4),h.hij("",t.form.value.form2.quantity," kg"),h.xp6(2),h.AsE("",h.xi3(131,121,t.post.quantity_individual,"1.0-0")," ",h.lcZ(132,124,"PCS"),""),h.xp6(4),h.hij("",t.post.ratio_move," % "),h.xp6(4),h.Oqu(h.lcZ(139,126,"CROP_MOD.SETTLEMENT_COST")),h.xp6(3),h.Q6J("ngIf","vi"==t.translate.currentLang),h.xp6(1),h.Q6J("ngIf","vi"!=t.translate.currentLang),h.xp6(1),h.hij(" ",h.lcZ(144,128,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(149,130,"POND_MOD.TRANS_COST")),h.xp6(4),h.Oqu(t.form.value.form2.move_cost),h.xp6(1),h.hij(" ",h.lcZ(154,132,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(159,134,"POND_MOD.NOTE")),h.xp6(3),h.Oqu(t.form.value.form2.note),h.xp6(4),h.Oqu(h.lcZ(166,136,"POND_MOD.MOVE_IN")),h.xp6(2),h.Q6J("ngIf",t.pondSelected),h.xp6(4),h.hij("",h.lcZ(172,138,"BACK")," "),h.xp6(2),h.Q6J("disabled",t.form.invalid||t.savingFlag.pending),h.xp6(1),h.hij(" ",h.lcZ(175,140,"CONFIRM"),"")}}let yt=(()=>{class t{constructor(t,e,i,n,o,s){this.modalController=t,this._formBuilder=e,this.pondService=i,this.toastService=n,this.translate=o,this.alertController=s,this.seed_quantity=0,this.pondsLoading=new d.E,this.savingFlag=new d.E,this.numberFormatQuantity=new it.y(""),this.numberFormatQuantityLive=new it.y(""),this.numberFormatCost=new it.y(""),this.total_seed=0,this.total_move=0,this.total_harvest=0,this.post={date:Math.ceil((new Date).getTime()/1e3),pond_target:0,from_season_code:"",ratio_move:0,quantity:0,quantity_individual:0,size:0,weight:0,date_old:0,total_cost:0,move_cost:0,note:"",seed_cost:0},this.focusState={quantity:!0,ratio:!1}}ngOnInit(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.getTargetPonds(),this.buildForm(),this.getWeight()})}buildForm(){this.form=this._formBuilder.group({form1:this._formBuilder.group({quantityLive:["",[o.kI.required,o.kI.min(0)]],ratio:["",[o.kI.required,o.kI.min(0),o.kI.max(100)]],unit:["",o.kI.required],size:["",[o.kI.required,o.kI.min(0)]]}),form2:this._formBuilder.group({quantity:["",[o.kI.required,o.kI.min(0)]],pond_target:["",o.kI.required],move_cost:[""],note:["Chuy\u1ec3n giai \u0111o\u1ea1n "]})}),this.targetPonds&&1==this.targetPonds.length&&this.form.controls.form2.patchValue({pond_target:this.targetPonds[0].id})}getWeight(){this.pondService.getWeight().subscribe(t=>{1==t.status?(this.weight={total_loss:t.data.total_loss?t.data.total_loss:0,weight:t.data.weight?t.data.weight:0},this.seedTimes.forEach(t=>{this.seed_quantity+=+t.seed_quantity}),this.harvestTimes.forEach(t=>{this.seed_quantity-=1e3*t.harvest_quantity/t.harvest_size}),this.moveTimes.forEach(t=>{t.to_season_code==this.pondService.pond.current_season?(this.seed_quantity+=+t.quantity_individual,t.weight>=this.weight.weight&&(this.weight.weight=t.weight)):this.seed_quantity-=t.quantity_individual}),this.seed_quantity-=this.weight.total_loss,this.numberFormatQuantityLive.setValue(this.seed_quantity),this.form.controls.form1.patchValue({size:this.weight.weight,unit:"con",quantityLive:this.seed_quantity,ratio:100}),this.numberFormatQuantity.setValue((this.seed_quantity*this.weight.weight/1e3).toFixed(0)),this.reloadData()):this.toastService.warning(t.message)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}onSave(){if(this.post.ratio_move>100)return this.toastService.warning(this.translate.instant("POND_MOD.ERROR_MOVE")),!1;this.post.pond_target=this.form.value.form2.pond_target,this.post.from_season_code=this.seasonInfo.code,this.post.quantity=this.numberFormatQuantity.realValue,this.post.date_old=this.seasonInfo.old,this.post.move_cost=this.form.value.form2.move_cost,this.post.note=this.form.value.form2.note,console.log(this.post),this.savingFlag.setPending(!0),this.pondService.reqSeasonMove(this.post).subscribe(t=>{1==t.status?(this.toastService.success(t.message),100==this.post.ratio_move&&(this.pondService.seasonStart=!1),this.pondService.reloadSeason$.next(1),this.savingFlag.setResult(!0),this.modalController.dismiss()):(this.toastService.warning(t.message),this.savingFlag.setResult(!1))},()=>{this.savingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}endView(){"con"==this.form.value.form1.unit?(this.post.weight=this.form.value.form1.size,this.post.size=1e3/this.form.value.form1.size):(this.post.size=this.form.value.form1.size,this.post.weight=1e3/this.form.value.form1.size),this.post.quantity_individual=Math.ceil(1e3*this.numberFormatQuantity.realValue/this.post.weight),this.post.ratio_move=parseFloat((100*this.post.quantity_individual/this.seed_quantity).toFixed(0));let t=0;if(t+=this.seasonInfo.harvest_list.reduce((t,e)=>t+ +e.cost,0),t+=this.seasonInfo.moved_list.reduce((t,e)=>e.from_season_code==this.seasonInfo.code?t+parseInt(e.cost):t,0),console.log(t),!(this.post.ratio_move<=100))return this.post.total_cost=this.seasonInfo.total-t,this.toastService.warning(this.translate.instant("POND_MOD.ERROR_MOVE")),!1;this.post.total_cost=(this.seasonInfo.total-t)*this.post.ratio_move/100,this.post.seed_cost=this.post.total_cost/this.post.quantity_individual,console.log(this.post)}selectPond(t){let e=this.targetPonds.findIndex(e=>e.id==t.target.value);this.pondSelected=this.targetPonds[e]}quantityLiveChange(){if(0!=this.seed_quantity&&0!=this.focusState.quantity){var t=(100*this.numberFormatQuantityLive.realValue/this.seed_quantity).toFixed(0);this.form.get("form1.ratio").patchValue(t);var e=this.form.controls.form1.value.size;"kg"==this.form.controls.form1.value.unit&&(e=1e3/e),console.log(this.seed_quantity*(+t/100)*e/1e3),this.numberFormatQuantity.setValue(this.seed_quantity*(+t/100)*e/1e3)}}ratioChange(t){let e=Math.round(this.seed_quantity*t.target.value/100);e>0&&1==this.focusState.ratio&&this.numberFormatQuantityLive.setValue(e)}getTargetPonds(){return(0,l.mG)(this,void 0,void 0,function*(){this.pondsLoading.setPending(!0);const t=yield this.pondService.getTargetPonds().toPromise().catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});1==t.status?(this.targetPonds=t.data,this.seasonInfo=t.season,this.numberFormatQuantityLive.setValue(t.season.now_individual),this.total_harvest=this.seasonInfo.harvest_list.reduce((t,e)=>t+1e3*e.harvest_quantity/e.harvest_size,0),this.total_move=this.seasonInfo.moved_list.reduce((t,e)=>(console.log(e.from_season_code+" = "+this.seasonInfo.code),e.from_season_code==this.seasonInfo.code?t+parseInt(e.quantity_individual):t),0),this.pondsLoading.setResult(!0)):(this.toastService.warning(t.error),this.pondsLoading.setResult(!1))})}presentAlert(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("POND_MOD.CAREFUL"),message:this.translate.instant("POND_MOD.NOTE_CAREFUL"),buttons:[{text:this.translate.instant("CANCEL"),role:"cancel",cssClass:"secondary"},{text:"OK",handler:()=>{this.onSave()}}]})).present()})}changeUnit(){}changeInput(t,e){if(this.form.controls.form1.value.size&&0!=this.seed_quantity){switch(t){case"size":this.form.get("form1.size").patchValue(e.target.value);break;case"unit":this.form.controls.form1.patchValue({size:1e3/this.form.controls.form1.value.size});break;case"quantityLive":this.numberFormatQuantityLive.setValue(e.target.value);var i=(100*this.numberFormatQuantityLive.realValue/this.seed_quantity).toFixed(0);this.form.get("form1.ratio").patchValue(i);break;case"ratio":let t=Math.round(this.seed_quantity*e.target.value/100);this.form.get("form1.ratio").patchValue(e.target.value),this.numberFormatQuantityLive.setValue(t)}this.reloadData()}}reloadData(){var t=+this.form.controls.form1.value.ratio;console.log(t);var e=+this.form.controls.form1.value.size;"kg"==this.form.controls.form1.value.unit&&(e=1e3/e),this.numberFormatQuantity.setValue(this.seed_quantity*(+t/100)*e/1e3)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(o.qu),h.Y36(c.p),h.Y36(A.k),h.Y36(g.sK),h.Y36(a.Br))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-season-move"]],inputs:{harvestTimes:"harvestTimes",seedTimes:"seedTimes",moveTimes:"moveTimes"},decls:9,vars:4,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[3,"ionSlideReachEnd"],["slides",""],["formGroupName","form1",1,"w-100","ion-padding"],["lines","none"],["slot","end"],["color","danger"],["lines","none",4,"ngIf"],[1,"tip"],["size","6"],["color","primary","position","floating"],["required","","formControlName","size","type","tel","inputmode","decimal",3,"ionInput"],["formControlName","unit",3,"ionChange"],["value","kg"],["value","con"],["required","","formControlName","quantityLive","type","tel","inputmode","numeric",3,"value","ionInput"],["required","","formControlName","ratio","type","tel","inputmode","decimal",3,"ionInput"],["shape","round",3,"disabled","click"],["slot","end","name","arrow-forward"],["formGroupName","form2",1,"w-100","ion-padding"],["formControlName","pond_target",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["required","","type","tel","inputmode","numeric","formControlName","quantity",3,"value","ionChange"],["required","","type","tel","inputmode","numeric","formControlName","move_cost",3,"value","ionChange"],["required","","type","text","inputmode","text","formControlName","note"],["shape","round","fill","clear",3,"click"],["slot","start","name","arrow-back"],[1,"w-100","ion-padding"],["color","primary",1,"mr-2"],["color","success",1,"mr-2"],["color","tertiary",1,"mr-2"],["color","danger",4,"ngIf"],[4,"ngIf"],[1,"ion-padding"],[3,"value"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalController.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.YNc(8,Ct,176,142,"ion-content",3)),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,2,"POND_MOD.MOVE_POND")),h.xp6(2),h.Q6J("ngIf",e.seasonInfo))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,n.O5,a.W2,o.JL,o.sg,a.Hr,a.A$,o.x0,a.Ie,a.Q$,a.yW,a.jY,a.Nd,a.wI,a.pK,a.j9,o.Q7,o.JJ,o.u,a.t9,a.QI,a.n0,n.sg,a.yp],pipes:[g.X$,n.JJ],styles:["[_nghost-%COMP%]   ion-slides[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   ion-slides[_ngcontent-%COMP%]   .w-100[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   ion-slides[_ngcontent-%COMP%]   .tip[_ngcontent-%COMP%]{font-size:.6em;font-style:italic;padding:10px}[_nghost-%COMP%]   ion-slides[_ngcontent-%COMP%]   .p-info[_ngcontent-%COMP%]{padding:5px 0}[_nghost-%COMP%]   ion-slides[_ngcontent-%COMP%]   .mr-2[_ngcontent-%COMP%]{margin-right:5px}"]}),t})();var Nt=i(82629);function Et(t,e){1&t&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"PRIVATE_MODE_PUBLIC")))}function Mt(t,e){1&t&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"PRIVATE_MODE_FOLLOWER")))}function It(t,e){1&t&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"PRIVATE_MODE_PROTECTED")))}function wt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-text",0),h._uU(2),h.qZA(),h.TgZ(3,"ion-button",21),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).moveDevice(e.value,"pub",e.key)}),h._uU(4,"Chuy\u1ec3n"),h.qZA(),h.TgZ(5,"ion-button",22),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).removeDevice("pub",e.key,e.value.id)}),h._uU(6,"X\xf3a"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(2),h.Oqu(t.value.name)}}function Ut(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-text",0),h._uU(2),h.qZA(),h.TgZ(3,"ion-button",21),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).moveDevice(e.value,"sub",e.key)}),h._uU(4,"Chuy\u1ec3n"),h.qZA(),h.TgZ(5,"ion-button",22),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).removeDevice("sub",e.key,e.value.id)}),h._uU(6,"X\xf3a"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(2),h.Oqu(t.value.name)}}function Pt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-text",0),h._uU(2),h.qZA(),h.TgZ(3,"ion-button",21),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).moveDevice(e.value,"feed",e.key)}),h._uU(4,"Chuy\u1ec3n"),h.qZA(),h.TgZ(5,"ion-button",22),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).removeDevice("feed",e.key,e.value.id)}),h._uU(6,"X\xf3a"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(2),h.Oqu(t.value.name)}}function Rt(t,e){if(1&t&&(h.TgZ(0,"div"),h.TgZ(1,"ion-card",11),h.TgZ(2,"ion-card-header"),h.TgZ(3,"ion-card-subtitle"),h._UZ(4,"ion-icon",19),h._uU(5," Qu\u1ea3n l\xfd thi\u1ebft b\u1ecb "),h.qZA(),h.qZA(),h.TgZ(6,"ion-card-content"),h.TgZ(7,"ion-list",5),h.YNc(8,wt,7,1,"ion-item",20),h.ALo(9,"keyvalue"),h.YNc(10,Ut,7,1,"ion-item",20),h.ALo(11,"keyvalue"),h.YNc(12,Pt,7,1,"ion-item",20),h.ALo(13,"keyvalue"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(8),h.Q6J("ngForOf",h.lcZ(9,3,t.pubs)),h.xp6(2),h.Q6J("ngForOf",h.lcZ(11,5,t.subs)),h.xp6(2),h.Q6J("ngForOf",h.lcZ(13,7,t.feedings))}}function kt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-button",23),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentMove()}),h._UZ(1,"ion-icon",24),h._uU(2),h.ALo(3,"translate"),h.qZA()}2&t&&(h.xp6(2),h.hij(" ",h.lcZ(3,1,"CROP_MOD.MOVE_AWAY")," "))}function Yt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-button",25),h.NdJ("click",function(){return h.CHM(t),h.oxw().openSeasonCancel()}),h._UZ(1,"ion-icon",26),h._uU(2),h.ALo(3,"translate"),h.qZA()}2&t&&(h.xp6(2),h.hij(" ",h.lcZ(3,1,"CROP_MOD.CANCEL_CROP")," "))}let Lt=(()=>{class t{constructor(t,e,i,n,o,s,a,r,l){this.modalCtrl=t,this.pondService=e,this.router=i,this.alertController=n,this.loadingController=o,this.toastService=s,this.translate=a,this.iotService=r,this.dblocalService=l,this.manager=[]}ngOnInit(){this.loadSetting(),this.dblocalService.getLocalData(),this.ponds=this.dblocalService.ponds}dismiss(){this.modalCtrl.dismiss({dismissed:!0})}presentViewMode(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalCtrl.create({component:dt,componentProps:{pondLocalIndex:this.pondLocalIndex}})).present()})}presentManager(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.modalCtrl.create({component:Tt,componentProps:{manager:this.manager}});return t.onDidDismiss().then(t=>{t.data&&(this.manager=t.data)}),yield t.present()})}presentEdit(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalCtrl.create({component:lt,componentProps:{pondLocalIndex:this.pondLocalIndex}})).present()})}presentSetting(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalCtrl.create({component:et})).present()})}openSeasonCancel(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalCtrl.create({component:st,componentProps:{pondLocalIndex:this.pondLocalIndex}})).present()})}presentMove(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalCtrl.create({component:yt})).present()})}gotoHistory(){this.modalCtrl.dismiss(),this.router.navigateByUrl("pond/"+this.pondService.pcode+"/history")}loadSetting(){this.pondService.getSeting().pipe().subscribe(t=>{1==t.status&&("pond_operator"in t.data.manager&&t.data.manager.pond_operator.forEach(t=>{t.key="pond_operator",this.manager.push(t)}),"pond_manager"in t.data.manager&&t.data.manager.pond_manager.forEach(t=>{t.key="pond_manager",this.manager.push(t)}),"pond_expert"in t.data.manager&&t.data.manager.pond_expert.forEach(t=>{t.key="pond_expert",this.manager.push(t)}),console.log(this.manager))})}presentDeletePond(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("POND_MOD.CAREFUL"),message:this.translate.instant("POND_MOD.CONFIRM_DELETE")+" <strong>"+this.pondService.pond.name+"</strong>?",inputs:[{name:"confirmInput",type:"text",placeholder:this.translate.instant("POND_MOD.ENTER")+' "OK"'}],buttons:[{text:this.translate.instant("NO"),role:"cancel",cssClass:"secondary"},{text:this.translate.instant("POND_MOD.DELETE"),cssClass:"secondary",handler:t=>{"OK"===t.confirmInput&&(this.loadingController.create({message:this.translate.instant("POND_MOD.DELETING")}).then(t=>{t.present()}),this.deletePond())}}]})).present()})}deletePond(){this.pondService.deletePond({confirm:"XOA"}).pipe().subscribe(t=>{1==t.status?(this.toastService.success(t.message),this.dblocalService.ponds.splice(this.pondLocalIndex,1),this.modalCtrl.dismiss(),this.router.navigateByUrl("tabs/management")):this.toastService.warning(t.error),this.loadingController.dismiss()})}moveDevice(t,e,i){return(0,l.mG)(this,void 0,void 0,function*(){let n=[];this.ponds.forEach(t=>{n.push({name:t.infor.name,type:"radio",label:t.infor.name,value:t.infor.code,checked:!1})}),n[0].checked=!0,yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.MOVE_TEXT"),message:this.translate.instant("DEVICE_MOD.CHOOSE_POND"),inputs:n,buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:n=>{this.handleMove(t,n,e,i)}}]})).present()})}handleMove(t,e,i,n){return(0,l.mG)(this,void 0,void 0,function*(){const o=yield this.iotService.move(t.name,e,t.id).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});if(o&&1==o.status){this.toastService.success(this.translate.instant("DEVICE_MOD.MOVE_SUCCESS")),"sub"==i?delete this.subs[n]:"pubs"==i?delete this.pubs[n]:"feed"==i&&delete this.feedings[n];let t=this.findIndexDevice(n),o=this.findIndexPond(e);-1!=o&&-1!=t&&(this.dblocalService.ponds[o].devices.push(this.dblocalService.ponds[this.pondLocalIndex].devices[t]),this.dblocalService.ponds[this.pondLocalIndex].devices.splice(t,1),this.dblocalService.setLocalData("ponds",this.dblocalService.ponds))}else o&&0==o.status&&this.toastService.warning(o.error)})}findIndexDevice(t){return this.dblocalService.ponds[this.pondLocalIndex].devices.findIndex(e=>e.device_id_fb===t)}findIndexPond(t){return this.dblocalService.ponds.findIndex(e=>e.infor.code===t)}handleRemove(t,e,i){return(0,l.mG)(this,void 0,void 0,function*(){const n=yield this.iotService.remove(i).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});if(n&&1==n.status){this.toastService.success(this.translate.instant("DEVICE_MOD.REMOVE_SUCCESS"));let i=this.findIndexDevice(e);-1!=i&&(this.dblocalService.ponds[this.pondLocalIndex].devices.splice(i,1),this.dblocalService.setLocalData("ponds",this.dblocalService.ponds)),"sub"==t?delete this.subs[e]:"pub"==t?delete this.pubs[e]:"feed"==t&&delete this.feedings[e]}else n&&0==n.status&&this.toastService.warning(n.error)})}removeDevice(t,e,i){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.NOTI_REMOVE"),message:this.translate.instant("DEVICE_MOD.CONFIRM_REMOVE_DEVICE"),buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"Okay",handler:()=>{this.handleRemove(t,e,i)}}]})).present()})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(s.F0),h.Y36(a.Br),h.Y36(a.HT),h.Y36(A.k),h.Y36(g.sK),h.Y36(Nt.d),h.Y36(nt.T))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-info"]],inputs:{subs:"subs",pubs:"pubs",feedings:"feedings",showDevice:"showDevice",pondLocalIndex:"pondLocalIndex"},decls:64,vars:42,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-padding","ion-text-center"],[3,"src"],["lines","none"],["detail","",3,"click"],["name","information-circle-outline","slot","start"],["name","eye-outline","slot","start"],[4,"ngIf"],["src","assets/icon/supervised_user_circle-24px.svg","slot","start"],["mode","ios"],["name","options"],["size","large","expand","block","shape","round","fill","outline",3,"click",4,"ngIf"],["size","large","color","danger","expand","block","shape","round","fill","outline",3,"click",4,"ngIf"],["size","large","color","medium","expand","block","shape","round","fill","outline",3,"click"],["name","timer-outline","slot","start"],["size","small","color","medium","expand","block","fill","clear",3,"click"],["name","remove-circle-outline","slot","start"],["name","hardware-chip-outline"],[4,"ngFor","ngForOf"],["expand","block","shape","round","fill","outline","slot","end","size","small",3,"click"],["expand","block","shape","round","fill","outline","slot","end","size","small","color","danger",3,"click"],["size","large","expand","block","shape","round","fill","outline",3,"click"],["src","assets/icon/priority.svg","slot","start"],["size","large","color","danger","expand","block","shape","round","fill","outline",3,"click"],["name","trash-outline","slot","start"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"div",3),h._UZ(10,"img",4),h.TgZ(11,"h1"),h._uU(12),h.qZA(),h.TgZ(13,"span"),h._uU(14),h.qZA(),h.qZA(),h.TgZ(15,"ion-list",5),h.TgZ(16,"ion-item",6),h.NdJ("click",function(){return e.presentEdit()}),h._UZ(17,"ion-icon",7),h.TgZ(18,"ion-label"),h.TgZ(19,"h3"),h._uU(20),h.ALo(21,"translate"),h.qZA(),h.TgZ(22,"p"),h._uU(23),h.ALo(24,"translate"),h.ALo(25,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(26,"ion-item",6),h.NdJ("click",function(){return e.presentViewMode()}),h._UZ(27,"ion-icon",8),h.TgZ(28,"ion-label"),h.TgZ(29,"h3"),h._uU(30),h.ALo(31,"translate"),h.qZA(),h.TgZ(32,"p"),h.YNc(33,Et,3,3,"span",9),h.YNc(34,Mt,3,3,"span",9),h.YNc(35,It,3,3,"span",9),h.qZA(),h.qZA(),h.qZA(),h.TgZ(36,"ion-item",6),h.NdJ("click",function(){return e.presentManager()}),h._UZ(37,"ion-icon",10),h.TgZ(38,"ion-label"),h.TgZ(39,"h3"),h._uU(40),h.ALo(41,"translate"),h.qZA(),h.TgZ(42,"p"),h._uU(43),h.ALo(44,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(45,Rt,14,9,"div",9),h.TgZ(46,"div"),h.TgZ(47,"ion-card",11),h.TgZ(48,"ion-card-header"),h.TgZ(49,"ion-card-subtitle"),h._UZ(50,"ion-icon",12),h._uU(51),h.ALo(52,"translate"),h.qZA(),h.qZA(),h.TgZ(53,"ion-card-content"),h.YNc(54,kt,4,3,"ion-button",13),h.YNc(55,Yt,4,3,"ion-button",14),h.TgZ(56,"ion-button",15),h.NdJ("click",function(){return e.gotoHistory()}),h._UZ(57,"ion-icon",16),h._uU(58),h.ALo(59,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(60,"ion-button",17),h.NdJ("click",function(){return e.presentDeletePond()}),h._UZ(61,"ion-icon",18),h._uU(62),h.ALo(63,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,22,"POND_MOD.POND_INFORMATION")),h.xp6(4),h.Q6J("src","https://chart.googleapis.com/chart?chs=120x120&cht=qr&chl=pond:"+e.pondService.pond.code+"&choe=UTF-8",h.LSH),h.xp6(2),h.Oqu(e.pondService.pond.name),h.xp6(2),h.hij("#",e.pondService.pond.code,""),h.xp6(6),h.Oqu(h.lcZ(21,24,"POND_MOD.POND_SPECIFICATIONS")),h.xp6(3),h.HOy("",h.lcZ(24,26,"AREA"),": ",e.pondService.pond.area," m2, ",h.lcZ(25,28,"DEEP"),": ",e.pondService.pond.deep," m"),h.xp6(7),h.Oqu(h.lcZ(31,30,"PRIVATE_MODE")),h.xp6(3),h.Q6J("ngIf",3==e.pondService.pond.public),h.xp6(1),h.Q6J("ngIf",2==e.pondService.pond.public),h.xp6(1),h.Q6J("ngIf",1==e.pondService.pond.public),h.xp6(5),h.Oqu(h.lcZ(41,32,"MANAGER")),h.xp6(3),h.AsE("",null==e.manager?null:e.manager.length," ",h.lcZ(44,34,"FARM_MOD.MEMBER"),""),h.xp6(2),h.Q6J("ngIf",e.showDevice),h.xp6(6),h.hij(" ",h.lcZ(52,36,"CROP_MOD.CROP_MANAGEMENT")," "),h.xp6(3),h.Q6J("ngIf",e.pondService.seasonStart),h.xp6(1),h.Q6J("ngIf",e.pondService.seasonStart),h.xp6(3),h.hij(" ",h.lcZ(59,38,"POND_MOD.POND_HISTORY")," "),h.xp6(4),h.hij(" ",h.lcZ(63,40,"POND_MOD.REMOVE_POND")," "))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.q_,a.Ie,a.Q$,n.O5,a.PM,a.Zi,a.tO,a.FN,n.sg,a.yW],pipes:[g.X$,n.Nd],styles:[""]}),t})();var Ft=i(17238),Jt=i(22923),Qt=i(1965);function Vt(t,e){if(1&t&&(h.TgZ(0,"ion-segment-button",21),h.TgZ(1,"h2"),h._uU(2),h.qZA(),h.qZA()),2&t){const t=e.index;h.Q6J("value",t),h.xp6(2),h.Oqu(t+1)}}function jt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",18),h.TgZ(1,"p",5),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"ion-segment",19),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().changeRepast(e)}),h.YNc(5,Vt,3,2,"ion-segment-button",20),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(2),h.Oqu(h.lcZ(3,3,"POND_MOD.REPAST")),h.xp6(2),h.Q6J("value",t.repastSelected),h.xp6(1),h.Q6J("ngForOf",t.repasts)}}function Ht(t,e){if(1&t&&(h.TgZ(0,"ion-chip",22),h._UZ(1,"ion-icon",23),h.TgZ(2,"ion-label",24),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.AsE("",h.lcZ(4,2,"POND_MOD.EXPECTED")," ",null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_calendar.value_check,"kg")}}function Gt(t,e){if(1&t&&(h.TgZ(0,"ion-chip",25),h._UZ(1,"ion-icon",26),h.TgZ(2,"ion-label",27),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.AsE("",h.lcZ(4,2,"POND_MOD.FOR_PROCEDURE")," ",null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_procedure.feed,"kg")}}function Bt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-row",32),h.TgZ(1,"ion-col",7),h.TgZ(2,"ion-button",33),h.NdJ("click",function(){const e=h.CHM(t).index,i=h.oxw().index;return h.oxw().removeRowFeed(i,e)}),h._UZ(3,"ion-icon",34),h.qZA(),h.qZA(),h.TgZ(4,"ion-col",35),h.TgZ(5,"ion-item"),h.TgZ(6,"ion-label",36),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.TgZ(9,"ion-input",37),h.NdJ("click",function(){const e=h.CHM(t),i=e.index,n=e.$implicit,o=h.oxw().index;return h.oxw().openPicker(1,"feed",o,i,n)})("ngModelChange",function(t){return e.$implicit.product_name=t}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(10,"ion-col",38),h.TgZ(11,"ion-item"),h.TgZ(12,"ion-label",36),h._uU(13),h.qZA(),h.TgZ(14,"ion-input",39),h.NdJ("ngModelChange",function(t){return e.$implicit.quantity=t})("ionBlur",function(){const e=h.CHM(t).$implicit;return h.oxw(2).checkInvetory(e,"repast")}),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=e.index,n=h.oxw(2);h.xp6(2),h.Q6J("disabled",0==i),h.xp6(5),h.AsE("",t.store_name," | ",h.lcZ(8,8,"POND_MOD.FEED"),""),h.xp6(2),h.Q6J("disabled",n.disableForm.feed)("ngModel",t.product_name)("value",t.product_name),h.xp6(4),h.Oqu(t.unit),h.xp6(1),h.Q6J("ngModel",t.quantity)}}function zt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-row",32),h.TgZ(1,"ion-col",7),h.TgZ(2,"ion-button",33),h.NdJ("click",function(){const e=h.CHM(t).index,i=h.oxw().index;return h.oxw().removeRowBlend(i,e)}),h._UZ(3,"ion-icon",34),h.qZA(),h.qZA(),h.TgZ(4,"ion-col",35),h.TgZ(5,"ion-item"),h.TgZ(6,"ion-label",36),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.TgZ(9,"ion-input",37),h.NdJ("click",function(){const e=h.CHM(t),i=e.index,n=e.$implicit,o=h.oxw().index;return h.oxw().openPicker(2,"blend",o,i,n)})("ngModelChange",function(t){return e.$implicit.product_name=t}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(10,"ion-col",38),h.TgZ(11,"ion-item"),h.TgZ(12,"ion-label",36),h._uU(13),h.qZA(),h.TgZ(14,"ion-input",39),h.NdJ("ngModelChange",function(t){return e.$implicit.quantity=t})("ionBlur",function(){const e=h.CHM(t).$implicit;return h.oxw(2).checkInvetory(e,"blend")}),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=e.index,n=h.oxw(2);h.xp6(2),h.Q6J("disabled",0==i),h.xp6(5),h.AsE("",t.store_name," | ",h.lcZ(8,8,"POND_MOD.FEED_SUPPLEMENT"),""),h.xp6(2),h.Q6J("disabled",n.disableForm.blend)("ngModel",t.product_name)("value",t.product_name),h.xp6(4),h.Oqu(t.unit),h.xp6(1),h.Q6J("ngModel",t.quantity)}}function $t(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",28),h.TgZ(1,"ion-grid"),h.YNc(2,Bt,15,10,"ion-row",29),h.YNc(3,zt,15,10,"ion-row",29),h.TgZ(4,"ion-row"),h.TgZ(5,"ion-col",5),h.TgZ(6,"ion-button",30),h.NdJ("click",function(){const e=h.CHM(t).index;return h.oxw().presentOptionProduct(1,e)}),h._UZ(7,"ion-icon",31),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.TgZ(10,"ion-button",30),h.NdJ("click",function(){const e=h.CHM(t).index;return h.oxw().presentOptionProduct(2,e)}),h._UZ(11,"ion-icon",31),h._uU(12),h.ALo(13,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=e.index,i=h.oxw();h.Q6J("hidden",t!=i.repastSelected)("@showRepast",t==i.repastSelected),h.xp6(2),h.Q6J("ngForOf",i.feed[t]),h.xp6(1),h.Q6J("ngForOf",i.blend[t]),h.xp6(3),h.Q6J("disabled",i.feed[t].length>=6),h.xp6(2),h.hij(" ",h.lcZ(9,8,"POND_MOD.FEED")," "),h.xp6(2),h.Q6J("disabled",i.blend[t].length>=10),h.xp6(2),h.hij(" ",h.lcZ(13,10,"POND_MOD.BLEND")," ")}}function Wt(t,e){1&t&&(h.TgZ(0,"div",5),h._UZ(1,"ion-spinner",40),h.qZA())}function Xt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",41),h.TgZ(1,"ion-chip",1),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentRemind()}),h._UZ(2,"ion-icon",42),h.TgZ(3,"ion-label"),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(4),h.AsE("",h.lcZ(5,2,"POND_MOD.REMIND_MIXED")," ",t.itemRemind,"")}}let Kt=(()=>{class t{constructor(t,e,i,n,o,s,a,r,l,c,h){this.modalCtrl=t,this.pondService=e,this.pickerCtrl=i,this.toastService=n,this.calendarService=o,this.alertController=s,this.translate=a,this.settingService=r,this.storeService=l,this.modalController=c,this.dbLocalService=h,this.loadingFlag=new d.E,this.savingFlag=new d.E,this.dateRangeSelected=u().format("YYYY-MM-DD"),this.maxDate=u(),this.minDate=u().subtract(180,"days"),this.dataRaw=[],this.repastSelected=0,this.repasts=[],this.feed=[],this.blend=[],this.itemRemind="",this.disableForm={feed:!1,blend:!1}}ngOnInit(){this.settingService.getSetting("showGramFeed"),this.repastSelected=this.repast?this.repast:0,this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.item.date==this.dateRangeSelected&&(this.itemSelected=this.item);for(let t=1;t<=this.pondService.numRepast;t++)this.repasts.push([]);this.processGroupRepast(),this.loadExpectedDaily()}loadStore(){return(0,l.mG)(this,void 0,void 0,function*(){if(0==this.dbLocalService.stores.length){const t=yield this.storeService.getApiStore("get-list-avaiable","&pcode="+this.pondService.pcode,"manager/pond-store-mobie").toPromise().catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});1==t.status?(this.dbLocalService.stores=t.data.map(t=>({infor:t,store:[]})),this.dbLocalService.setLocalData("stores",this.dbLocalService.stores)):this.toastService.warning(t.error)}if(0==this.dbLocalService.stores[0].store.length){const t=yield this.storeService.getApiStore("get-list-product","&pcode="+this.pondService.pcode+"&wcode="+this.dbLocalService.stores[0].infor.code,"manager/pond-store-mobie").toPromise().catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});1==t.status?(this.dbLocalService.stores[0].store=t.data,this.dbLocalService.setLocalData("stores",this.dbLocalService.stores)):this.toastService.warning(t.error)}})}loadExpectedDaily(){console.log(u(this.dateRangeSelected).valueOf()/1e3),this.calendarService.getExpectedDaily(this.pondService.pond.current_season,"feed",u(this.dateRangeSelected).valueOf()/1e3).subscribe(t=>{1==t.status?this.inforloadExpectedDaily=t.data:this.toastService.warning(t.error)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}dismiss(){this.modalCtrl.dismiss()}save(){this.savingFlag.setPending(!0);let t=[];this.repasts.forEach((e,i)=>{console.log(e),t[i]={feeds:this.feed[i].map(t=>{if(t.product_id)return{kind:t.product_id,quantity:t.quantity.toString().replace(",","."),wcode:t.wcode,packing:t.packing}}),blends:this.blend[i].map(t=>{if(t.product_id)return{kind:t.product_id,quantity:parseFloat((t.quantity.toString().replace(",",".")*this.getFactor(t,"blend")).toFixed(5)),wcode:t.wcode,packing:t.packing}})}});let e=u(this.dateRangeSelected).format("YYYY-MM-DD"),i={date:e,repast:t};console.log(i),this.pondService.fullUpdate(i).subscribe(t=>{"success"==t.status?(this.toastService.success(this.translate.instant("POND_MOD.NOTI_UPDATE")),this.savingFlag.setResult(!0),e==this.maxDate.format("YYYY-MM-DD")?this.modalCtrl.dismiss(i):this.dismiss()):(this.toastService.warning(t.message),this.savingFlag.setResult(!1))},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}onChangeDate(t){this.dateRangeSelected=t.detail.value;let e=u(this.dateRangeSelected);this.dataRaw.length>0?(this.itemSelected=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e.format("YYYY-MM-DD"))],this.processGroupRepast(),(e<u(this.dataRaw[this.dataRaw.length-1].date)||e>u(this.dataRaw[0].date))&&this.getData()):this.getData(),this.loadExpectedDaily()}changeDate(t){let e=u(this.dateRangeSelected).add(t,"days");if(e<this.minDate||e>this.maxDate)return!1;this.dateRangeSelected=e.format("YYYY-MM-DD")}changeRepast(t){this.repastSelected=t.detail.value}removeRowFeed(t,e){if(0==e)return this.feed[t][0].quantity=0,!1;this.feed[t].splice(e,1)}removeRowBlend(t,e){if(0==e)return this.blend[t][0].quantity=0,!1;this.blend[t].splice(e,1)}getData(){this.loadingFlag.setStart(!0);let t=u(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},t).subscribe(e=>{e.data?(this.dataRaw=e.data,this.itemSelected=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t)],this.processGroupRepast(),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},t=>{this.loadingFlag.setResult(!1),this.toastService.danger(t)})}processGroupRepast(){this.blend=[],this.feed=[];for(let t=1;t<=this.pondService.numRepast;t++)this.feed.push([]),this.blend.push([]);void 0!==this.itemSelected?(this.itemSelected.feed&&this.itemSelected.feed.forEach(t=>{t.type=1,this.feed[t.times-1].push(t)}),this.itemSelected.blend&&this.itemSelected.blend.forEach(t=>{this.checkUnitBlend(t);const e={pond_daily_id:t.pond_daily_id,product_id:t.product_id,product_name:t.product_name,quantity:parseFloat((t.quantity/this.getFactor(t,"blend")).toFixed(5).toString()),type:2,store_name:t.store_name,wcode:t.wcode,unit:t.unit};console.log(e),this.blend[t.times-1].push(e)})):console.log("item undefined")}openPicker(t,e,i,n,o){return(0,l.mG)(this,void 0,void 0,function*(){const s=yield this.modalController.create({component:Qt.z,componentProps:{groupId:t,item:o}});return s.onDidDismiss().then(t=>{if(t.data){const o={product_name:t.data.product_name,product_id:t.data.product_id,unit:t.data.unit,quantity_current:t.data.quantity_current,wcode:t.data.wcode,store_name:t.data.store_name,quantity:t.data.quantity};console.log(o),this[e][i][n]=o,this.itemRemind=o.product_name}}),yield s.present()})}presentRemind(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("POND_MOD.REMIND"),message:this.translate.instant("POND_MOD.DAY_MIXED")+" <strong>"+this.itemRemind+"</strong> "+this.translate.instant("POND_MOD.REPEAT")+"?",inputs:[{name:"date",type:"number",min:1,max:60,placeholder:this.translate.instant("POND_MOD.DAY_COME")}],buttons:[{text:this.translate.instant("OPTION.CANCEL"),role:"cancel",cssClass:"secondary"},{text:"Ok",handler:t=>{this.saveRemind(t.date)}}]})).present()})}saveRemind(t){let e=u().add(t,"days"),i={content:this.translate.instant("POND_MOD.DAY_MIXED")+" "+this.itemRemind+" "+this.translate.instant("POND_MOD.REPEAT"),date:e.format("YYYY-MM-DD"),time:e.format("HH:mm"),pond_id:this.pondService.pcode,done:!1};this.calendarService.insertCalendar(i).subscribe(t=>{t.error||1!=t.status?this.toastService.warning(t.error):(this.toastService.success(this.translate.instant("POND_MOD.NOTI_ADD_REMIND")),this.itemRemind=null)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}checkInvetory(t,e){!this.settingService.alertInventory||!t.quantity_current||(console.log(t.quantity_current),console.log(this.getFactor(t,e)),console.log(t.quantity),+t.quantity_current<+this.getFactor(t,e)*t.quantity&&this.presentAlertInvetory(t))}getFactor(t,e){return console.log(t),"g"==t.unit||"ml"==t.unit?.001:1}presentAlertInvetory(t){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("POND_MOD.ALERT"),message:this.translate.instant("POND_MOD.PRODUCT")+" <strong>"+t.product_name+"</strong> "+this.translate.instant("POND_MOD.NOT_ENOUGH")+"!",inputs:[{name:"data",type:"checkbox",value:!0,label:this.translate.instant("POND_MOD.DONT_SHOW_NEXT_TIME"),placeholder:this.translate.instant("POND_MOD.DAY_COME")}],buttons:[{text:this.translate.instant("OPTION.CANCEL"),role:"cancel",cssClass:"secondary"},{text:"Ok",handler:t=>{console.log(t),t[0]&&this.settingService.alertInventoryChange(!1)}}]})).present()})}presentOptionProduct(t,e){return(0,l.mG)(this,void 0,void 0,function*(){const i=yield this.modalController.create({component:Qt.z,componentProps:{groupId:t}});return i.onDidDismiss().then(i=>{if(i.data){const n={product_name:i.data.product_name,product_id:i.data.product_id,unit:i.data.unit,quantity_current:i.data.quantity_current,wcode:i.data.wcode,store_name:i.data.store_name,packing:i.data.packing,quantity:""};console.log(this.settingService.showGramFeed),1===t?this.feed[e].push(n):(this.checkUnitBlend(n),this.blend[e].push(n)),this.itemRemind=n.product_name}}),yield i.present()})}checkValid(){var t=!0;return this.repasts.forEach((e,i)=>{this.feed[i].forEach(e=>{(!e.product_id||e.quantity<0)&&(t=!1)}),this.blend[i].forEach(e=>{(!e.product_id||e.quantity<0)&&(t=!1)})}),t}checkInvalid(){return this.repasts[this.repastSelected].find(t=>!parseFloat(t.quantity)||parseFloat(t.quantity)<0)}checkUnitBlend(t){this.settingService.showGramFeed&&("kg"==t.unit?t.unit="g":"lit"==t.unit&&(t.unit="ml"))}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(a.up),h.Y36(A.k),h.Y36(M.o),h.Y36(a.Br),h.Y36(g.sK),h.Y36(I.R),h.Y36(Jt.d),h.Y36(a.IN),h.Y36(nt.T))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-feed-update"]],inputs:{repast:"repast",item:"item"},decls:34,vars:21,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],[1,"ion-text-center"],["class","title ion-padding",4,"ngIf"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back"],["size","8"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","icon-only","name","arrow-forward"],["mode","ios","outline","","color","primary",4,"ngIf"],["mode","ios","outline","","color","success",4,"ngIf"],[3,"hidden",4,"ngFor","ngForOf"],["class","ion-text-center",4,"ngIf"],["class","ion-text-center ion-padding",4,"ngIf"],[1,"title","ion-padding"],["scrollable","","layout","icon-bottom",3,"value","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["mode","ios","outline","","color","primary"],["name","happy"],["color","primary"],["mode","ios","outline","","color","success"],["name","bulb"],["color","success"],[3,"hidden"],["class","align-items-center",4,"ngFor","ngForOf"],["shape","round","fill","outline","size","small","color","primary",3,"disabled","click"],["name","add","slot","start"],[1,"align-items-center"],["fill","clear","color","medium",3,"disabled","click"],["name","remove-circle-outline","slot","icon-only"],["size","6"],["position","floating"],[3,"disabled","ngModel","value","click","ngModelChange"],["size","4"],["type","tel","inputmode","decimal",3,"ngModel","ngModelChange","ionBlur"],["name","dots"],[1,"ion-text-center","ion-padding"],["name","stopwatch-outline"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-buttons",0),h.TgZ(6,"ion-button",1),h.NdJ("click",function(){return e.dismiss()}),h._UZ(7,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.save()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(12,"ion-content"),h.TgZ(13,"div",5),h.YNc(14,jt,6,5,"div",6),h.TgZ(15,"div",5),h.TgZ(16,"ion-grid"),h.TgZ(17,"ion-row"),h.TgZ(18,"ion-col",7),h.TgZ(19,"ion-button",8),h.NdJ("click",function(){return e.changeDate(-1)}),h._UZ(20,"ion-icon",9),h.qZA(),h.qZA(),h.TgZ(21,"ion-col",10),h.TgZ(22,"ion-item",5),h.TgZ(23,"ion-datetime",11),h.NdJ("ionChange",function(t){return e.onChangeDate(t)}),h.ALo(24,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(25,"ion-col",7),h.TgZ(26,"ion-button",8),h.NdJ("click",function(){return e.changeDate(1)}),h._UZ(27,"ion-icon",12),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(28,"div",5),h.YNc(29,Ht,5,4,"ion-chip",13),h.YNc(30,Gt,5,4,"ion-chip",14),h.qZA(),h.YNc(31,$t,14,12,"div",15),h.YNc(32,Wt,2,0,"div",16),h.YNc(33,Xt,6,4,"div",17),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,15,"POND_MOD.ADD_FEED")),h.xp6(6),h.Q6J("disabled",e.savingFlag.pending||!e.checkValid()),h.xp6(1),h.hij(" ",h.lcZ(11,17,"POND_MOD.SAVE")," "),h.xp6(4),h.Q6J("ngIf",e.repasts.length>1),h.xp6(5),h.Q6J("disabled",e.dateRangeSelected<=e.minDate.format("YYYY-MM-DD")),h.xp6(4),h.Q6J("displayFormat",h.lcZ(24,19,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeSelected),h.xp6(3),h.Q6J("disabled",e.dateRangeSelected>=e.maxDate.format("YYYY-MM-DD")),h.xp6(3),h.Q6J("ngIf",e.inforloadExpectedDaily&&e.inforloadExpectedDaily.for_calendar),h.xp6(1),h.Q6J("ngIf",e.inforloadExpectedDaily&&e.inforloadExpectedDaily.for_procedure),h.xp6(1),h.Q6J("ngForOf",e.repasts),h.xp6(1),h.Q6J("ngIf",e.loadingFlag.pending),h.xp6(1),h.Q6J("ngIf",e.itemRemind))},directives:[a.Gu,a.sr,a.wd,a.Sm,a.YG,a.gu,a.W2,n.O5,a.jY,a.Nd,a.wI,a.Ie,a.QI,a.x4,n.sg,a.cJ,a.GO,a.hM,a.Q$,a.pK,a.j9,o.JJ,o.On,a.PQ],pipes:[g.X$],styles:[""],data:{animation:[(0,Ft.X$)("showRepast",[(0,Ft.SB)("true",(0,Ft.oB)({opacity:1})),(0,Ft.SB)("false",(0,Ft.oB)({opacity:1})),(0,Ft.eR)("false <=> true",(0,Ft.jt)(500))])]}}),t})();function te(t,e){1&t&&(h.TgZ(0,"div",5),h._UZ(1,"ion-spinner",18),h.qZA())}function ee(t,e){if(1&t&&(h.TgZ(0,"ion-chip",19),h._UZ(1,"ion-icon",20),h.TgZ(2,"ion-label",21),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.AsE("",h.lcZ(4,2,"POND_MOD.EXPECTED")," ",null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_calendar.value_check,"kg")}}function ie(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-row",22),h.TgZ(1,"ion-col",6),h.TgZ(2,"ion-button",23),h.NdJ("click",function(){const e=h.CHM(t).index;return h.oxw().removeRow(e)}),h._UZ(3,"ion-icon",24),h.qZA(),h.qZA(),h.TgZ(4,"ion-col",25),h.TgZ(5,"ion-item"),h.TgZ(6,"ion-label",26),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.TgZ(9,"ion-input",27),h.NdJ("click",function(){const e=h.CHM(t),i=e.$implicit,n=e.index;return h.oxw().openPicker(i,n)})("ngModelChange",function(t){return e.$implicit.product_name=t}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(10,"ion-col",28),h.TgZ(11,"ion-item"),h.TgZ(12,"ion-label",26),h._uU(13),h.qZA(),h.TgZ(14,"ion-input",29),h.NdJ("ngModelChange",function(t){return e.$implicit.quantity=t})("ionBlur",function(){const e=h.CHM(t).$implicit;return h.oxw().checkInvetory(e)}),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw();h.xp6(7),h.AsE("",t.store_name," | ",h.lcZ(8,7,"POND_MOD.PRODUCT"),""),h.xp6(2),h.Q6J("disabled",i.disabledForm)("ngModel",t.product_name)("value",t.product_name),h.xp6(4),h.Oqu(t.unit),h.xp6(1),h.Q6J("ngModel",t.quantity)}}function ne(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",30),h.TgZ(1,"ion-chip",1),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentRemind()}),h._UZ(2,"ion-icon",31),h.TgZ(3,"ion-label"),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(4),h.AsE("",h.lcZ(5,2,"POND_MOD.REMIND_USE")," ",t.itemRemind,"")}}let oe=(()=>{class t{constructor(t,e,i,n,o,s,a,r,l){this.modalCtrl=t,this.pondService=e,this.pickerCtrl=i,this.toastService=n,this.alertController=o,this.calendarService=s,this.translate=a,this.settingService=r,this.modalController=l,this.loadingFlag=new d.E,this.savingFlag=new d.E,this.dateRangeSelected=u().format("YYYY-MM-DD"),this.maxDate=u(),this.minDate=u().subtract(180,"days"),this.enviro=[],this.dataRaw=[],this.itemRemind="",this.disabledForm=!1}ngOnInit(){console.log(this.item),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.item.date==this.dateRangeSelected&&(this.itemSelected=this.item),this.processData(),this.loadExpectedDaily()}loadExpectedDaily(){console.log(u(this.dateRangeSelected).valueOf()/1e3),this.calendarService.getExpectedDaily(this.pondService.pond.current_season,"enviro",u(this.dateRangeSelected).valueOf()/1e3).subscribe(t=>{1==t.status?this.inforloadExpectedDaily=t.data:this.toastService.warning(t.error)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}dismiss(){this.modalCtrl.dismiss()}onChangeDate(t){this.dateRangeSelected=t.detail.value,console.log(t.detail);let e=u(this.dateRangeSelected);console.log(this.dataRaw.length),this.dataRaw.length>0?(this.itemSelected=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e.format("YYYY-MM-DD"))],console.log(this.itemSelected),this.processData(),(e<u(this.dataRaw[this.dataRaw.length-1].date)||e>u(this.dataRaw[0].date))&&this.getData()):this.getData(),this.loadExpectedDaily()}changeDate(t){let e=u(this.dateRangeSelected).add(t,"days");if(e<this.minDate||e>this.maxDate)return!1;this.dateRangeSelected=e.format("YYYY-MM-DD")}checkInvetory(t){!this.settingService.alertInventory||!t.quantity_current||(console.log(t),+t.quantity_current<+t.quantity&&this.presentAlertInvetory(t))}presentAlertInvetory(t){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("POND_MOD.ALERT"),message:this.translate.instant("POND_MOD.PRODUCT")+" <strong>"+t.product_name+"</strong> "+this.translate.instant("POND_MOD.NOT_ENOUGH")+"!",inputs:[{name:"data",type:"checkbox",value:!0,label:this.translate.instant("POND_MOD.DONT_SHOW_NEXT_TIME"),placeholder:this.translate.instant("POND_MOD.DAY_COME")}],buttons:[{text:this.translate.instant("OPTION.CANCEL"),role:"cancel",cssClass:"secondary"},{text:"Ok",handler:t=>{console.log(t),t[0]&&this.settingService.alertInventoryChange(!1)}}]})).present()})}removeRow(t){if(0==t)return this.enviro[0].quantity=0,!1;this.enviro.splice(t,1)}getData(){this.loadingFlag.setStart(!0);let t=u(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},t).subscribe(e=>{e.data?(this.dataRaw=e.data,this.itemSelected=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t)],this.processData(),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},t=>{this.loadingFlag.setResult(!1),this.toastService.warning(t)})}processData(){this.enviro=[],this.itemSelected&&this.itemSelected.enviroment&&this.itemSelected.enviroment.forEach(t=>{this.enviro.push(t)})}save(){this.savingFlag.setPending(!0);let t=[];console.log(this.enviro);for(let i=0;i<this.enviro.length;i++)this.enviro[i].quantity=this.enviro[i].quantity.replace(",","."),this.enviro[i].quantity>=0&&t.push({kind:this.enviro[i].product_id,quantity:this.enviro[i].quantity,wcode:this.enviro[i].wcode});let e={date:u(this.dateRangeSelected).format("YYYY-MM-DD"),enviro:t};this.pondService.fullUpdate(e).subscribe(t=>{"success"==t.status?(this.toastService.success(this.translate.instant("POND_MOD.NOTI_UPDATE")),this.savingFlag.setResult(!0),this.dateRangeSelected==this.maxDate.format("YYYY-MM-DD")?this.modalCtrl.dismiss(this.enviro):this.modalCtrl.dismiss()):(this.toastService.warning(t.message),this.savingFlag.setResult(!1))},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}openPicker(t,e){return(0,l.mG)(this,void 0,void 0,function*(){const i=yield this.modalController.create({component:Qt.z,componentProps:{groupId:3,item:t}});return i.onDidDismiss().then(t=>{if(t.data){const i={product_name:t.data.product_name,product_id:t.data.product_id,unit:t.data.unit,quantity_current:t.data.quantity_current,wcode:t.data.wcode,store_name:t.data.store_name,quantity:t.data.quantity};console.log(i),this.enviro[e]=i,this.itemRemind=i.product_name}}),yield i.present()})}presentRemind(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("POND_MOD.REMIND"),message:this.translate.instant("POND_MOD.DAY_PROCESS")+" <strong>"+this.itemRemind+"</strong> "+this.translate.instant("POND_MOD.REPEAT")+"?",inputs:[{name:"date",type:"number",min:1,max:60,placeholder:this.translate.instant("POND_MOD.DAY_COME")}],buttons:[{text:this.translate.instant("OPTION.CANCEL"),role:"cancel",cssClass:"secondary"},{text:"Ok",handler:t=>{this.saveRemind(t.date)}}]})).present()})}saveRemind(t){let e=u().add(t,"days"),i={content:this.translate.instant("POND_MOD.PROCESS")+" "+this.itemRemind+" "+this.translate.instant("POND_MOD.REPEAT"),date:e.format("YYYY-MM-DD"),time:e.format("HH:mm"),pond_id:this.pondService.pcode,done:!1};this.calendarService.insertCalendar(i).subscribe(t=>{t.error||1!=t.status?this.toastService.warning(t.error):(this.toastService.success(this.translate.instant("POND_MOD.NOTI_ADD_REMIND")),this.itemRemind=null)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}presentOptionProduct(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:Qt.z,componentProps:{groupId:3}});return t.onDidDismiss().then(t=>{if(t.data){const e={product_name:t.data.product_name,product_id:t.data.product_id,unit:t.data.unit,quantity_current:t.data.quantity_current,wcode:t.data.wcode,store_name:t.data.store_name,quantity:""};this.enviro.push(e),this.itemRemind=e.product_name}}),yield t.present()})}checkInvalid(){return this.enviro.find(t=>""===t.quantity||parseFloat(t.quantity)<0)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(a.up),h.Y36(A.k),h.Y36(a.Br),h.Y36(M.o),h.Y36(g.sK),h.Y36(I.R),h.Y36(a.IN))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-enviroment-update"]],inputs:{item:"item"},decls:38,vars:23,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],[1,"ion-text-center"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back"],["size","8"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","icon-only","name","arrow-forward"],["class","ion-text-center",4,"ngIf"],["mode","ios","outline","","color","primary",4,"ngIf"],["class","align-items-center",4,"ngFor","ngForOf"],["shape","round","fill","outline","size","small","color","primary",3,"disabled","click"],["name","add","slot","start"],["class","ion-text-center ion-padding",4,"ngIf"],["name","dots"],["mode","ios","outline","","color","primary"],["name","happy"],["color","primary"],[1,"align-items-center"],["fill","clear","color","medium",3,"click"],["name","remove-circle-outline","slot","icon-only"],["size","6"],["position","floating"],[3,"disabled","ngModel","value","click","ngModelChange"],["size","4"],["type","tel","inputmode","decimal",3,"ngModel","ngModelChange","ionBlur"],[1,"ion-text-center","ion-padding"],["name","stopwatch-outline"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-buttons",0),h.TgZ(6,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(7,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.save()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(12,"ion-content"),h.TgZ(13,"div",5),h.TgZ(14,"ion-grid"),h.TgZ(15,"ion-row"),h.TgZ(16,"ion-col",6),h.TgZ(17,"ion-button",7),h.NdJ("click",function(){return e.changeDate(-1)}),h._UZ(18,"ion-icon",8),h.qZA(),h.qZA(),h.TgZ(19,"ion-col",9),h.TgZ(20,"ion-item",5),h.TgZ(21,"ion-datetime",10),h.NdJ("ionChange",function(t){return e.onChangeDate(t)}),h.ALo(22,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(23,"ion-col",6),h.TgZ(24,"ion-button",7),h.NdJ("click",function(){return e.changeDate(1)}),h._UZ(25,"ion-icon",11),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(26,te,2,0,"div",12),h.TgZ(27,"div",5),h.YNc(28,ee,5,4,"ion-chip",13),h.qZA(),h.TgZ(29,"ion-grid"),h.YNc(30,ie,15,9,"ion-row",14),h.TgZ(31,"ion-row"),h.TgZ(32,"ion-col",5),h.TgZ(33,"ion-button",15),h.NdJ("click",function(){return e.presentOptionProduct()}),h._UZ(34,"ion-icon",16),h._uU(35),h.ALo(36,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(37,ne,6,4,"div",17),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,15,"POND_MOD.CHEMICAL_TREATMENT")),h.xp6(6),h.Q6J("disabled",e.savingFlag.pending||e.checkInvalid()),h.xp6(1),h.hij(" ",h.lcZ(11,17,"POND_MOD.SAVE")," "),h.xp6(7),h.Q6J("disabled",e.dateRangeSelected<=e.minDate.format("YYYY-MM-DD")),h.xp6(4),h.Q6J("displayFormat",h.lcZ(22,19,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeSelected),h.xp6(3),h.Q6J("disabled",e.dateRangeSelected>=e.maxDate.format("YYYY-MM-DD")),h.xp6(2),h.Q6J("ngIf",e.loadingFlag.pending),h.xp6(2),h.Q6J("ngIf",e.inforloadExpectedDaily&&e.inforloadExpectedDaily.for_calendar),h.xp6(2),h.Q6J("ngForOf",e.enviro),h.xp6(3),h.Q6J("disabled",e.enviro.length>=7),h.xp6(2),h.hij(" ",h.lcZ(36,21,"ADD")," "),h.xp6(2),h.Q6J("ngIf",e.itemRemind))},directives:[a.Gu,a.sr,a.wd,a.Sm,a.YG,a.gu,a.W2,a.jY,a.Nd,a.wI,a.Ie,a.x4,a.QI,n.O5,n.sg,a.PQ,a.hM,a.Q$,a.pK,a.j9,o.JJ,o.On],pipes:[g.X$],styles:[""]}),t})();i(35386);var se=i(82482);const ae=["inputDisease"];function re(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-button",27),h.NdJ("click",function(){const e=h.CHM(t).index;return h.oxw(2).removeDisease(e)}),h._uU(1),h._UZ(2,"ion-icon",28),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(1),h.hij(" ",t.name," ")}}function le(t,e){if(1&t&&(h.TgZ(0,"ion-col",13),h.TgZ(1,"ion-item"),h.YNc(2,re,3,1,"ion-button",26),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(2),h.Q6J("ngForOf",t.diseaseSelected)}}let ce=(()=>{class t{constructor(t,e,i,n,s,a,r,l){this.toastService=t,this.modalCtrl=e,this.pondService=i,this._fb=n,this.translate=s,this.cd=a,this.alertController=r,this.el=l,this.loadingFlag=new d.E,this.savingFlag=new d.E,this.dateRangeSelected=u().format("YYYY-MM-DD"),this.maxDate=u(),this.minDate=u().subtract(180,"days"),this.dataRaw=[],this.invalid=!0,this.form=this._fb.group({weight:new o.NI("",[o.kI.required,o.kI.min(0)]),loss:new o.NI("",[o.kI.min(0)]),lossKg:new o.NI("",[o.kI.min(0)]),note:new o.NI(""),unit:new o.NI("kg"),textSearch:new o.NI("")}),this.configMention={dropUp:!0,labelKey:"name"},this.listDisease=[],this.diseaseSelected=[]}ngOnInit(){this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.item.date==this.dateRangeSelected&&(this.itemSelected=this.item,this.itemSelected.disease=this.disease),this.processData(),this.getListDisease()}getListDisease(){this.loadingFlag.setPending(!0),this.pondService.getListDisease().subscribe(t=>{1==+t.status?this.listDisease=t.data:this.toastService.warning(t.error)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}chooseDisease(t){console.log(t),this.diseaseSelected.find(e=>e.id===t.id)||this.diseaseSelected.push(t)}checkRemoveDisease(t){if(8===t.keyCode){let t=this.form.value.note,e=-1!==t.lastIndexOf("@")?t.substring(t.lastIndexOf("@"),t.length):"";console.log(e),this.diseaseSelected.forEach((i,n)=>{e==="@"+i.name&&""!==e&&(t=t.replace(new RegExp("@"+i.name,"g"),""),t=t.replace(new RegExp("@"+i.name.slice(0,-1),"g"),""),this.diseaseSelected.splice(n,1))}),this.form.patchValue({note:t})}}removeDisease(t){let e=this.form.value.note;e=e.replace(new RegExp("@"+this.diseaseSelected[t].name,"g"),this.diseaseSelected[t].name),this.form.patchValue({note:e}),this.diseaseSelected.splice(t,1)}onChangeDate(t){this.dateRangeSelected=t.detail.value;let e=u(this.dateRangeSelected);if(this.dataRaw.length>0){let t=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e.format("YYYY-MM-DD"))];void 0!==t&&(this.itemSelected=t,this.processData()),(e<u(this.dataRaw[this.dataRaw.length-1].date)||e>u(this.dataRaw[0].date))&&this.getData()}else this.getData()}changeDate(t){let e=u(this.dateRangeSelected).add(t,"days");if(e<this.minDate||e>this.maxDate)return!1;this.dateRangeSelected=e.format("YYYY-MM-DD")}getData(){this.loadingFlag.setStart(!0);let t=u(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},t).subscribe(e=>{if(e.data){this.dataRaw=e.data;let i=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t)];void 0!==i&&(this.itemSelected=i,this.processData()),this.loadingFlag.setResult(!0)}else this.loadingFlag.setResult(!1)},t=>{this.loadingFlag.setResult(!1),this.toastService.danger(t)})}save(){this.savingFlag.setPending(!0);let t=u(this.dateRangeSelected).format("YYYY-MM-DD"),e=this.form.value;this.pondService.updateHealth({date:t,health:e,disease:this.diseaseSelected}).subscribe(t=>{"success"==t.status?(this.toastService.success(this.translate.instant("POND_MOD.NOTI_UPDATE")),this.savingFlag.setResult(!0),e.date=u(this.dateRangeSelected).format("YYYY-MM-DD"),e.disease=this.diseaseSelected,this.modalCtrl.dismiss(e)):(this.toastService.warning(t.message),this.savingFlag.setResult(!1))},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}processData(){if(void 0!==this.itemSelected&&this.itemSelected){let t=this.itemSelected.weight>0?this.itemSelected.weight:"",e=t*this.itemSelected.loss/1e3;this.diseaseSelected=this.itemSelected.disease?this.itemSelected.disease:[],console.log(this.diseaseSelected),this.form.patchValue({weight:t,loss:this.itemSelected.loss,lossKg:e,note:this.itemSelected.note_health})}}convertLoss(){if(this.form.value.weight>0){if("kg"==this.form.value.unit){let t=Math.ceil(this.form.value.lossKg/(this.form.value.weight/1e3));this.form.patchValue({loss:t})}else{let t=Math.ceil(this.form.value.loss*this.form.value.weight/1e3);this.form.patchValue({lossKg:t})}this.form.get("weight").clearValidators()}else 0!=this.form.value.loss||0!=this.form.value.lossKg?(this.form.get("weight").setValidators([o.kI.required,o.kI.min(.01)]),this.form.get("weight").updateValueAndValidity()):this.form.get("weight").clearValidators();this.invalid=this.form.invalid}presentAlertRemoveDisease(t,e){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"Option",inputs:[{name:"radio1",type:"radio",label:this.translate.instant("DISEASE.DELETE_ALL"),value:"all",checked:!0},{name:"radio2",type:"radio",label:this.translate.instant("DISEASE.DELETE_LAST"),value:"one"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:e=>{this.pondService.saveProcessDisease({type_action:0,action_del:e,disease_id:t.id}).subscribe(t=>{1==t.status?this.toastService.success(this.translate.instant("DISEASE.REMOVE_SUCCESS")):this.toastService.warning(t.error)})}}]})).present()})}checkFocus(){let t=this.el.nativeElement.querySelector("textarea");if(t){if(t.setSelectionRange)return t.setSelectionRange(t.value.length,t.value.length);t.select()}}closeModal(){this.modalCtrl.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(A.k),h.Y36(a.IN),h.Y36(c.p),h.Y36(o.qu),h.Y36(g.sK),h.Y36(h.sBO),h.Y36(a.Br),h.Y36(h.SBq))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-health-update"]],viewQuery:function(t,e){if(1&t&&h.Gf(ae,5),2&t){let t;h.iGM(t=h.CRH())&&(e.inputElement=t.first)}},hostBindings:function(t,e){1&t&&h.NdJ("click",function(){return e.checkFocus()})},inputs:{item:"item",disease:"disease"},decls:63,vars:39,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],[1,"ion-text-center"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back"],["size","8"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","icon-only","name","arrow-forward"],[3,"formGroup"],["size","12"],["position","floating"],["autofocus","","formControlName","weight","type","tel","inputmode","decimal",3,"ionChange"],["size","6"],[3,"hidden"],["formControlName","loss","type","tel","inputmode","decimal",3,"ionChange"],["formControlName","lossKg","type","tel","inputmode","decimal",3,"ionChange"],["formControlName","unit"],["value","con"],["value","kg"],["size","12",4,"ngIf"],[1,"healstatusBox"],["move-end","","formControlName","note","type","text",1,"tagsInput",3,"mentionConfig","mention","itemSelected","keydown.ArrowLeft","keydown.ArrowRight","keydown.ArrowUp","keydown.ArrowDown","keydown"],["color","danger","size","small",3,"click",4,"ngFor","ngForOf"],["color","danger","size","small",3,"click"],["name","remove-circle-outline"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.closeModal()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.save()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(12,"ion-content"),h.TgZ(13,"div",5),h.TgZ(14,"ion-grid"),h.TgZ(15,"ion-row"),h.TgZ(16,"ion-col",6),h.TgZ(17,"ion-button",7),h.NdJ("click",function(){return e.changeDate(-1)}),h._UZ(18,"ion-icon",8),h.qZA(),h.qZA(),h.TgZ(19,"ion-col",9),h.TgZ(20,"ion-item",5),h.TgZ(21,"ion-datetime",10),h.NdJ("ionChange",function(t){return e.onChangeDate(t)}),h.ALo(22,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(23,"ion-col",6),h.TgZ(24,"ion-button",7),h.NdJ("click",function(){return e.changeDate(1)}),h._UZ(25,"ion-icon",11),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(26,"div"),h.TgZ(27,"ion-grid",12),h.TgZ(28,"ion-row"),h.TgZ(29,"ion-col",13),h.TgZ(30,"ion-item"),h.TgZ(31,"ion-label",14),h._uU(32),h.ALo(33,"translate"),h.qZA(),h.TgZ(34,"ion-input",15),h.NdJ("ionChange",function(){return e.convertLoss()}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(35,"ion-col",16),h.TgZ(36,"ion-item",17),h.TgZ(37,"ion-label",14),h._uU(38),h.ALo(39,"translate"),h.qZA(),h.TgZ(40,"ion-input",18),h.NdJ("ionChange",function(){return e.convertLoss()}),h.qZA(),h.qZA(),h.TgZ(41,"ion-item",17),h.TgZ(42,"ion-label",14),h._uU(43),h.ALo(44,"translate"),h.qZA(),h.TgZ(45,"ion-input",19),h.NdJ("ionChange",function(){return e.convertLoss()}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(46,"ion-col",16),h.TgZ(47,"ion-item"),h.TgZ(48,"ion-label",14),h._uU(49),h.ALo(50,"translate"),h.qZA(),h.TgZ(51,"ion-select",20),h.TgZ(52,"ion-select-option",21),h._uU(53),h.ALo(54,"translate"),h.qZA(),h.TgZ(55,"ion-select-option",22),h._uU(56,"Kg"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(57,le,3,1,"ion-col",23),h.qZA(),h.TgZ(58,"div",24),h.TgZ(59,"ion-label"),h._uU(60),h.ALo(61,"translate"),h.qZA(),h.TgZ(62,"textarea",25),h.NdJ("itemSelected",function(t){return e.chooseDisease(t)})("keydown.ArrowLeft",function(t){return t.preventDefault()})("keydown.ArrowRight",function(t){return t.preventDefault()})("keydown.ArrowUp",function(t){return t.preventDefault()})("keydown.ArrowDown",function(t){return t.preventDefault()})("keydown",function(t){return e.checkRemoveDisease(t)}),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.hij(" ",h.lcZ(7,21,"POND_MOD.HEALTH"),""),h.xp6(3),h.Q6J("disabled",e.form.invalid),h.xp6(1),h.hij(" ",h.lcZ(11,23,"SAVE")," "),h.xp6(7),h.Q6J("disabled",e.dateRangeSelected<=e.minDate.format("YYYY-MM-DD")),h.xp6(4),h.Q6J("displayFormat",h.lcZ(22,25,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeSelected),h.xp6(3),h.Q6J("disabled",e.dateRangeSelected>=e.maxDate.format("YYYY-MM-DD")),h.xp6(3),h.Q6J("formGroup",e.form),h.xp6(5),h.hij(" ",h.lcZ(33,27,"WEIGHT")," (g)"),h.xp6(4),h.Q6J("hidden","kg"==e.form.value.unit),h.xp6(2),h.Oqu(h.lcZ(39,29,"POND_MOD.LOSS")),h.xp6(3),h.Q6J("hidden","con"==e.form.value.unit),h.xp6(2),h.Oqu(h.lcZ(44,31,"POND_MOD.LOSS")),h.xp6(6),h.Oqu(h.lcZ(50,33,"POND_MOD.UNIT")),h.xp6(4),h.Oqu(h.lcZ(54,35,"POND_MOD.ANIMAL")),h.xp6(4),h.Q6J("ngIf",e.diseaseSelected.length>0),h.xp6(3),h.Oqu(h.lcZ(61,37,"POND_MOD.HEALTH_STATUS")),h.xp6(2),h.Q6J("mentionConfig",e.configMention)("mention",e.listDisease))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.jY,a.Nd,a.wI,a.Ie,a.x4,a.QI,o.JL,o.sg,a.Q$,a.pK,a.j9,o.JJ,o.u,a.t9,a.n0,n.O5,o.Fj,se.Db,n.sg],pipes:[g.X$],styles:[".input_opacy{background:transparent;color:#000;-webkit-text-fill-color:transparent;z-index:100}.text{position:absolute;top:0;left:0;width:100%;height:100%;padding-top:10px;padding-bottom:10px}.red{color:red}.suggest-box{position:absolute;bottom:0;width:100%}.suggest-box .disease-suggest{z-index:100;background-color:#fff;padding:15px 10px 10px;border-top-left-radius:10px;border-top-right-radius:10px;box-shadow:#c7c6c6 0 1px 10px}.suggest-box .disease-suggest .disease-suggest-item{text-align:center;padding:10px;margin:3px auto;border-radius:20px;border:1px solid silver}.healstatusBox{padding:26px;border-bottom-style:solid;border-bottom-color:#f5f5f5}.healstatusBox:focus{border-bottom-style:solid;border-bottom-color:#2dd36f}.tagsInput{border:none;background-color:transparent;resize:none;outline:none;width:100%}mentions-list{top:0px}.scrollable-menu{max-height:100px}\n"],encapsulation:2}),t})(),de=(()=>{class t{constructor(t,e,i,n){this.toastService=t,this.modalCtrl=e,this.pondService=i,this.translate=n,this.loadingFlag=new d.E,this.savingFlag=new d.E,this.dateRangeSelected=u().format("YYYY-MM-DD"),this.maxDate=u(),this.minDate=u().subtract(180,"days"),this.dataRaw=[],this.form=new o.cw({cost:new o.NI("",[o.kI.min(0)]),income:new o.NI("",[o.kI.min(0)]),note:new o.NI("")})}ngOnInit(){this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.item.date==this.dateRangeSelected&&(this.itemSelected=this.item),this.processData()}onChangeDate(t){this.dateRangeSelected=t.detail.value;let e=u(this.dateRangeSelected);this.dataRaw.length>0?(this.itemSelected=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e.format("YYYY-MM-DD"))],this.processData(),(e<u(this.dataRaw[this.dataRaw.length-1].date)||e>u(this.dataRaw[0].date))&&this.getData()):this.getData()}changeDate(t){let e=u(this.dateRangeSelected).add(t,"days");if(e<this.minDate||e>this.maxDate)return!1;this.dateRangeSelected=e.format("YYYY-MM-DD")}getData(){this.loadingFlag.setStart(!0);let t=u(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},t).subscribe(e=>{e.data?(this.dataRaw=e.data,this.itemSelected=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t)],this.processData(),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},t=>{this.loadingFlag.setResult(!1),this.toastService.warning(t)})}save(){this.savingFlag.setPending(!0);let t=u(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.fullUpdate({date:t,cost_other:this.form.value.cost,income:this.form.value.income,note_general:this.form.value.note}).subscribe(e=>{"success"==e.status?(this.toastService.success(this.translate.instant("POND_MOD.NOTI_UPDATE")),this.savingFlag.setResult(!0),t==this.maxDate.format("YYYY-MM-DD")?this.modalCtrl.dismiss(this.form.value):this.modalCtrl.dismiss()):(this.toastService.warning(e.message),this.savingFlag.setResult(!1))},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}processData(){void 0!==this.itemSelected&&this.itemSelected&&(console.log(this.itemSelected),this.form.setValue({cost:this.itemSelected.cost_other,income:this.itemSelected.income,note:this.itemSelected.note_general}))}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(A.k),h.Y36(a.IN),h.Y36(c.p),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-note-update"]],inputs:{item:"item"},decls:44,vars:31,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],[1,"ion-text-center"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back"],["size","8"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","icon-only","name","arrow-forward"],[3,"formGroup"],["lines","inset"],["position","floating"],["autofocus","","formControlName","cost","type","tel","inputmode","decimal"],["formControlName","income","type","tel","inputmode","decimal"],["type","type","formControlName","note"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.save()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(12,"ion-content"),h.TgZ(13,"div",5),h.TgZ(14,"ion-grid"),h.TgZ(15,"ion-row"),h.TgZ(16,"ion-col",6),h.TgZ(17,"ion-button",7),h.NdJ("click",function(){return e.changeDate(-1)}),h._UZ(18,"ion-icon",8),h.qZA(),h.qZA(),h.TgZ(19,"ion-col",9),h.TgZ(20,"ion-item",5),h.TgZ(21,"ion-datetime",10),h.NdJ("ionChange",function(t){return e.onChangeDate(t)}),h.ALo(22,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(23,"ion-col",6),h.TgZ(24,"ion-button",7),h.NdJ("click",function(){return e.changeDate(1)}),h._UZ(25,"ion-icon",11),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(26,"div",12),h.TgZ(27,"ion-item",13),h.TgZ(28,"ion-label",14),h._uU(29),h.ALo(30,"translate"),h.ALo(31,"translate"),h.qZA(),h._UZ(32,"ion-input",15),h.qZA(),h.TgZ(33,"ion-item",13),h.TgZ(34,"ion-label",14),h._uU(35),h.ALo(36,"translate"),h.ALo(37,"translate"),h.qZA(),h._UZ(38,"ion-input",16),h.qZA(),h.TgZ(39,"ion-item",13),h.TgZ(40,"ion-label",14),h._uU(41),h.ALo(42,"translate"),h.qZA(),h._UZ(43,"ion-input",17),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,15,"POND_MOD.NOTE")),h.xp6(3),h.Q6J("disabled",e.savingFlag.pending),h.xp6(1),h.hij(" ",h.lcZ(11,17,"SAVE")," "),h.xp6(7),h.Q6J("disabled",e.dateRangeSelected<=e.minDate.format("YYYY-MM-DD")),h.xp6(4),h.Q6J("displayFormat",h.lcZ(22,19,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeSelected),h.xp6(3),h.Q6J("disabled",e.dateRangeSelected>=e.maxDate.format("YYYY-MM-DD")),h.xp6(2),h.Q6J("formGroup",e.form),h.xp6(3),h.AsE("",h.lcZ(30,21,"POND_MOD.EXPENSE_OTHER")," (",h.lcZ(31,23,"CURRENCY_S"),")"),h.xp6(6),h.AsE("",h.lcZ(36,25,"POND_MOD.INCOME_OTHER")," (",h.lcZ(37,27,"CURRENCY_S"),")"),h.xp6(6),h.Oqu(h.lcZ(42,29,"POND_MOD.NOTE")))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.jY,a.Nd,a.wI,a.Ie,a.x4,a.QI,o.JL,o.sg,a.Q$,a.pK,a.j9,o.JJ,o.u],pipes:[g.X$],styles:[""]}),t})();var ue=i(26262);function he(t,e){1&t&&(h.TgZ(0,"div",9),h._UZ(1,"ion-spinner",10),h.qZA())}let ge=(()=>{class t{constructor(t,e,i,n){this.modalController=t,this.toastService=e,this.expertService=i,this.pondService=n,this.saveLoadingFlag=new d.E,this.content=new o.NI("",o.kI.required)}ngOnInit(){}send(){this.saveLoadingFlag.setPending(!0),this.expertService.addSuggest({content:this.content.value,pond:this.pondService.pond.code}).pipe().subscribe(t=>{1==t.status?(this.toastService.success(t.message),this.saveLoadingFlag.setResult(!0),this.modalController.dismiss()):(this.toastService.warning(t.error),this.saveLoadingFlag.setResult(!1))})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(A.k),h.Y36(ue.$),h.Y36(c.p))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-suggest-add"]],decls:21,vars:13,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-padding","ion-text-center"],[1,"ion-padding"],["line","inset"],[3,"formControl","placeholder"],["class","spiner-loading",4,"ngIf"],["shape","round",3,"disabled","click"],[1,"spiner-loading"],["name","dots"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalController.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"div",3),h.TgZ(10,"h1"),h._uU(11),h.qZA(),h.qZA(),h.TgZ(12,"ion-list",4),h.TgZ(13,"ion-item",5),h._UZ(14,"ion-textarea",6),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.YNc(16,he,2,0,"div",7),h.TgZ(17,"div",3),h.TgZ(18,"ion-button",8),h.NdJ("click",function(){return e.send()}),h._uU(19),h.ALo(20,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,7,"FARM_MOD.ADVISORY")),h.xp6(5),h.Oqu(e.pondService.pond.name),h.xp6(3),h.Q6J("formControl",e.content)("placeholder",h.lcZ(15,9,"POND_MOD.CONTENT")),h.xp6(2),h.Q6J("ngIf",e.saveLoadingFlag.pending),h.xp6(2),h.Q6J("disabled",e.content.invalid||e.saveLoadingFlag.pending),h.xp6(1),h.Oqu(h.lcZ(20,11,"POND_MOD.SEND")))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.q_,a.Ie,a.g2,a.j9,o.JJ,o.oH,n.O5,a.PQ],pipes:[g.X$],styles:[""]}),t})();function pe(t,e){1&t&&(h.TgZ(0,"div",8),h._UZ(1,"ion-spinner",9),h.qZA())}function me(t,e){if(1&t&&(h.TgZ(0,"ion-text",13),h.TgZ(1,"p"),h._uU(2),h.ALo(3,"translate"),h.ALo(4,"number"),h.ALo(5,"translate"),h.qZA(),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(2),h.lnq("",h.lcZ(3,3,"POND_MOD.INCOME_OTHER"),": ",h.lcZ(4,5,t.income)," ",h.lcZ(5,7,"CURRENCY_S"),"")}}function Ze(t,e){if(1&t&&(h.TgZ(0,"ion-text",13),h.TgZ(1,"p"),h._uU(2),h.ALo(3,"translate"),h.ALo(4,"number"),h.ALo(5,"translate"),h.qZA(),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(2),h.lnq("",h.lcZ(3,3,"POND_MOD.EXPENSE_OTHER"),": ",h.lcZ(4,5,t.cost_other)," ",h.lcZ(5,7,"CURRENCY_S"),"")}}function fe(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label",10),h.TgZ(2,"p"),h._uU(3),h.ALo(4,"date"),h.ALo(5,"translate"),h.qZA(),h.TgZ(6,"ion-text",11),h.TgZ(7,"h3"),h._uU(8),h.qZA(),h.qZA(),h.YNc(9,me,6,9,"ion-text",12),h.YNc(10,Ze,6,9,"ion-text",12),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.xp6(3),h.Oqu(h.xi3(4,4,t.date,h.lcZ(5,7,"FORMAT_DATE"))),h.xp6(5),h.hij(" ",t.note_general,""),h.xp6(1),h.Q6J("ngIf",t.income>0),h.xp6(1),h.Q6J("ngIf",t.cost_other>0)}}function Ae(t,e){1&t&&(h.TgZ(0,"ion-card"),h.TgZ(1,"ion-card-content"),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.qZA()),2&t&&(h.xp6(2),h.hij(" ",h.lcZ(3,1,"POND_MOD.NO_NOTES")," "))}let _e=(()=>{class t{constructor(t,e,i){this.toastController=t,this.modalCtrl=e,this.pondService=i,this.items=[],this.loadingFlag=new d.E,this.pageLoaded=0}ngOnInit(){this.getData(0)}getData(t){console.log("h"),this.loadingFlag.setStart(!0),this.pondService.loadDailyPaging({pageIndex:t,pageSize:20},u().format("YYYY-MM-DD")).subscribe(t=>{t.data?(this.items=this.items.concat(this.filter(t.data)),this.loadingFlag.setResult(!0),this.pageLoaded++):this.loadingFlag.setResult(!1),this.infiniteScroll.complete(),(this.pageLoaded>=10||t.data.length<3)&&(this.infiniteScroll.disabled=!0),console.log(this.infiniteScroll)},t=>{this.loadingFlag.setResult(!1),console.log(t)})}filter(t){return t.filter(t=>t.cost_other>0||t.income>0||""!=t.note_general)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.yF),h.Y36(a.IN),h.Y36(c.p))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-note"]],viewQuery:function(t,e){if(1&t&&h.Gf(a.ju,5),2&t){let t;h.iGM(t=h.CRH())&&(e.infiniteScroll=t.first)}},decls:15,vars:6,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["class","spiner-loading",4,"ngIf"],[4,"ngFor","ngForOf"],[4,"ngIf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","dots"],[1,"spiner-loading"],["name","dots"],[1,"ion-text-wrap"],["color","primary"],["color","secondary",4,"ngIf"],["color","secondary"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.YNc(9,pe,2,0,"div",3),h.TgZ(10,"ion-list"),h.YNc(11,fe,11,9,"ion-item",4),h.qZA(),h.YNc(12,Ae,4,3,"ion-card",5),h.TgZ(13,"ion-infinite-scroll",6),h.NdJ("ionInfinite",function(){return e.getData(e.pageLoaded)}),h._UZ(14,"ion-infinite-scroll-content",7),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,4,"POND_MOD.NOTE")),h.xp6(3),h.Q6J("ngIf",e.loadingFlag.pending),h.xp6(2),h.Q6J("ngForOf",e.items),h.xp6(1),h.Q6J("ngIf",0==e.items.length&&e.loadingFlag.result))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,n.O5,a.q_,n.sg,a.ju,a.MB,a.PQ,a.Ie,a.Q$,a.yW,a.PM,a.FN],pipes:[g.X$,n.uU,n.JJ],styles:[""]}),t})();var ve=i(73473);function Te(t,e){if(1&t&&(h.TgZ(0,"small"),h._uU(1),h.ALo(2,"number"),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.hij("\xb1",h.xi3(2,1,(null==t.todayData?null:t.todayData.quantityPCSDelta)/1e3,"1.0-1"),"")}}function qe(t,e){if(1&t&&(h.TgZ(0,"small"),h._uU(1),h.ALo(2,"number"),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.hij("\xb1",h.xi3(2,1,(null==t.todayData?null:t.todayData.quantityDelta)/1e3,"1.0-1"),"")}}function xe(t,e){if(1&t&&(h.TgZ(0,"small"),h._uU(1),h.ALo(2,"number"),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.hij("\xb1",h.xi3(2,1,(null==t.todayData?null:t.todayData.quantityDelta)/1e3,"1.0-1"),"")}}const Oe=function(){return["company_manager"]};let De=(()=>{class t{constructor(t,e,i){this.modalCtrl=t,this.toastService=e,this.pondService=i,this.costLoadingFlag=new d.E,this.priceLoadingFlag=new d.E,this.showDelta=!1,this.todayData={},this.next7Data={},this.priceList=[],this.price=0,this.price7day=0,this.day=7}ngOnInit(){this.procesEstimate(),"company_manager"==this.pondService.permission&&this.loadCost()}procesEstimate(){this.procedure&&this.procedure.culture_day>0&&this.procedure.FCR>0&&this.procedure.survival_ratio>0?(this.todayData.quantityPCSTheory=this.data.old<this.procedure.culture_day?this.data.old*this.pondService.seasonInfo.seedQuantity*this.procedure.survival_ratio/this.procedure.culture_day:this.pondService.seasonInfo.seedQuantity*this.procedure.survival_ratio,this.todayData.quantityPCSDelta=Math.abs(this.todayData.quantityPCSTheory-this.data.quantity_pcs)/2,this.todayData.quantityFCR=this.data.feed/parseFloat(this.procedure.FCR),this.next7Data.quantityPCSTheory=(this.data.old+this.day)*this.pondService.seasonInfo.seedQuantity*this.procedure.survival_ratio/this.procedure.culture_day,this.next7Data.quantityPCSDelta=Math.abs(this.next7Data.quantityPCSTheory-this.data.quantity_pcs)/2):(this.todayData.quantityPCSDelta=0,this.todayData.quantityPCSTheory=this.data.quantity_pcs,this.todayData.quantityFCR=this.data.quantity_pcs*this.data.weight/1e3,this.next7Data.quantityPCSDelta=0,this.next7Data.quantityPCSTheory=this.data.quantity_pcs),this.todayData.quantity=Math.min(this.todayData.quantityPCSTheory*this.data.weight/1e3,this.data.quantity,this.todayData.quantityFCR),this.todayData.quantityDelta=Math.abs(this.todayData.quantity-Math.max(this.todayData.quantityPCSTheory*this.data.weight/1e3,this.data.quantity,this.todayData.quantityFCR))/2,this.todayData.quantityPCS=1e3*this.todayData.quantity/this.data.weight,this.next7Data.weight=this.data.grow_speed*this.day+this.data.weight,this.next7Data.quantity=this.todayData.quantityPCS*this.next7Data.weight/1e3,this.getCurrentPrice()}loadCost(){this.costLoadingFlag.setStart(!0),this.pondService.getTotalCost().subscribe(t=>{if(1==t.status){this.todayData.cost=t.data.cost.feed+t.data.cost.blend+t.data.cost.enviroment+t.data.cost.seed+t.data.cost.other+parseInt(t.data.cost.record.amounts);let e=this.data.FCR*this.next7Data.quantity*(t.data.cost.feed/this.data.feed)-t.data.cost.feed;e<0&&(e=t.data.cost.feed/this.data.old*this.day),this.next7Data.deltaCost=e+t.data.cost.enviroment/this.data.old*this.day,this.next7Data.cost=t.data.cost.feed+this.next7Data.deltaCost}else this.toastService.warning(t.error);this.costLoadingFlag.setResult(!0)},()=>{this.costLoadingFlag.setResult(!1)})}getCurrentPrice(){this.priceLoadingFlag.setStart(!0),this.pondService.getCurrentPrice(this.season.species_id,0).subscribe(t=>{"success"==t.status?(1==t.data.length?(this.price=t.data[0].price,this.price7day=t.data[0].price):(this.priceList=t.data,this.priceList.push({price:0,time:0,diff:"",size:parseFloat(this.data.weight)}),this.price=this.matchPrice(this.priceList,this.data.weight),this.priceList.push({price:0,time:0,diff:"",size:parseFloat(this.next7Data.weight)}),this.price7day=this.matchPrice(this.priceList,this.next7Data.weight)),console.log(this.price)):this.toastService.warning(t.error.message),this.priceLoadingFlag.setResult(!0)},()=>{this.priceLoadingFlag.setResult(!1)})}matchPrice(t,e){let i=0;t.map(t=>(parseFloat(t.size),t)),console.log("runing"),t.sort((t,e)=>t.size>e.size?1:t.size<e.size?-1:0),console.log(e);let n=t.findIndex(t=>t.size==e&&0==t.time);return console.log(n),console.log(t),0==n?(i=t.length>1?t[1].price*e/t[1].size:0,console.log(i)):n+1==t.length?(i=t[n-1].price,console.log(n)):i=(t[n+1].price-t[n-1].price)/(t[n+1].size-t[n-1].size)*(e-t[n-1].size)+parseInt(t[n-1].price),t.splice(n,1),i>1e4&&(i=100*Math.round(i/100)),i}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(A.k),h.Y36(c.p))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-estimate"]],inputs:{data:"data",procedure:"procedure",season:"season"},decls:185,vars:164,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["mode","ios","color","medium"],["name","medical-outline"],["lines","full"],["slot","end",1,"ion-margin"],[4,"ngIf"],["lines","none",3,"appPermission","currentPermission"],["mode","ios","color","tertiary"],[3,"appPermission","currentPermission"],[3,"ngModel","ngModelChange"],["lines","inset"],["position","fixed"],[1,"ion-padding"],[1,"sm-text","ion-text-center"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-buttons",0),h.TgZ(6,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(7,"ion-icon",2),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"ion-card",3),h.TgZ(10,"ion-card-header"),h.TgZ(11,"ion-card-subtitle"),h._UZ(12,"ion-icon",4),h._uU(13),h.ALo(14,"translate"),h.qZA(),h.qZA(),h.TgZ(15,"ion-list",5),h.TgZ(16,"ion-item"),h.TgZ(17,"ion-label"),h.TgZ(18,"h3"),h._uU(19),h.ALo(20,"translate"),h.TgZ(21,"small"),h._uU(22),h.ALo(23,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(24,"span",6),h._uU(25),h.ALo(26,"number"),h.qZA(),h.qZA(),h.TgZ(27,"ion-item"),h.TgZ(28,"ion-label"),h.TgZ(29,"h3"),h._uU(30),h.ALo(31,"translate"),h.TgZ(32,"small"),h._uU(33),h.ALo(34,"number"),h.ALo(35,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(36,"span",6),h._uU(37),h.ALo(38,"number"),h.TgZ(39,"small"),h._uU(40,"g"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(41,"ion-item"),h.TgZ(42,"ion-label"),h.TgZ(43,"h3"),h._uU(44),h.ALo(45,"translate"),h.TgZ(46,"small"),h._uU(47),h.ALo(48,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(49,"span",6),h._uU(50),h.ALo(51,"number"),h.YNc(52,Te,3,4,"small",7),h.qZA(),h.qZA(),h.TgZ(53,"ion-item"),h.TgZ(54,"ion-label"),h.TgZ(55,"h3"),h._uU(56),h.ALo(57,"translate"),h.TgZ(58,"small"),h._uU(59),h.ALo(60,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(61,"span",6),h._uU(62),h.ALo(63,"number"),h.YNc(64,qe,3,4,"small",7),h.qZA(),h.qZA(),h.TgZ(65,"ion-item"),h.TgZ(66,"ion-label"),h.TgZ(67,"h3"),h._uU(68),h.ALo(69,"translate"),h.TgZ(70,"small"),h._uU(71),h.ALo(72,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(73,"span",6),h._uU(74),h.ALo(75,"number"),h.qZA(),h.qZA(),h.TgZ(76,"ion-item",8),h.TgZ(77,"ion-label"),h.TgZ(78,"h3"),h._uU(79),h.ALo(80,"translate"),h.TgZ(81,"small"),h._uU(82),h.ALo(83,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(84,"span",6),h.TgZ(85,"b"),h._uU(86),h.ALo(87,"number"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(88,"ion-card",9),h.TgZ(89,"ion-card-header"),h.TgZ(90,"ion-card-subtitle"),h._UZ(91,"ion-icon",4),h._uU(92),h.ALo(93,"translate"),h.qZA(),h.qZA(),h.TgZ(94,"ion-list",5),h.TgZ(95,"ion-item"),h.TgZ(96,"ion-label"),h.TgZ(97,"h3"),h._uU(98),h.ALo(99,"translate"),h.TgZ(100,"small"),h._uU(101),h.ALo(102,"number"),h.ALo(103,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(104,"span",6),h._uU(105),h.ALo(106,"number"),h.TgZ(107,"small"),h._uU(108,"g"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(109,"ion-item"),h.TgZ(110,"ion-label"),h.TgZ(111,"h3"),h._uU(112),h.ALo(113,"translate"),h.TgZ(114,"small"),h._uU(115),h.ALo(116,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(117,"span",6),h._uU(118),h.ALo(119,"number"),h.YNc(120,xe,3,4,"small",7),h.qZA(),h.qZA(),h.TgZ(121,"ion-item"),h.TgZ(122,"ion-label"),h.TgZ(123,"h3"),h._uU(124),h.ALo(125,"translate"),h.TgZ(126,"small"),h._uU(127),h.ALo(128,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(129,"span",6),h._uU(130),h.ALo(131,"number"),h.qZA(),h.qZA(),h.TgZ(132,"ion-item",10),h.TgZ(133,"ion-label"),h.TgZ(134,"h3"),h._uU(135),h.ALo(136,"translate"),h.TgZ(137,"small"),h._uU(138),h.ALo(139,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(140,"span",6),h._uU(141),h.ALo(142,"number"),h.qZA(),h.qZA(),h.TgZ(143,"ion-item"),h.TgZ(144,"ion-label"),h.TgZ(145,"h3"),h._uU(146),h.ALo(147,"translate"),h.TgZ(148,"small"),h._uU(149),h.ALo(150,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(151,"span",6),h._uU(152),h.ALo(153,"number"),h.qZA(),h.qZA(),h.TgZ(154,"ion-item",8),h.TgZ(155,"ion-label"),h.TgZ(156,"h3"),h._uU(157),h.ALo(158,"translate"),h.TgZ(159,"small"),h._uU(160),h.ALo(161,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(162,"span",6),h.TgZ(163,"b"),h._uU(164),h.ALo(165,"number"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(166,"ion-list"),h.TgZ(167,"ion-item"),h.TgZ(168,"ion-label"),h._uU(169),h.ALo(170,"translate"),h.qZA(),h.TgZ(171,"ion-toggle",11),h.NdJ("ngModelChange",function(t){return e.showDelta=t}),h.qZA(),h.qZA(),h.TgZ(172,"ion-item",12),h.TgZ(173,"ion-label",13),h._uU(174),h.ALo(175,"translate"),h.qZA(),h.TgZ(176,"ion-input",11),h.NdJ("ngModelChange",function(t){return e.price=t}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(177,"div",14),h.TgZ(178,"p",15),h._uU(179),h.ALo(180,"translate"),h._UZ(181,"br"),h.TgZ(182,"span"),h._uU(183),h.ALo(184,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,57,"POND_MOD.ESTIMATE")),h.xp6(10),h.hij(" ",h.lcZ(14,59,"POND_MOD.TODAY")," "),h.xp6(6),h.hij("",h.lcZ(20,61,"POND_MOD.GROW_SPEED")," "),h.xp6(3),h.hij("g/",h.lcZ(23,63,"DAY"),""),h.xp6(3),h.Oqu(h.xi3(26,65,e.data.grow_speed,"0.0-1")),h.xp6(5),h.hij("",h.lcZ(31,68,"POND_MOD.SIZE")," "),h.xp6(3),h.AsE("(",h.xi3(34,70,1e3/e.data.weight,"1.0-1")," ",h.lcZ(35,73,"PCS"),"/kg)"),h.xp6(4),h.hij("",h.xi3(38,75,e.data.weight,"1.0-1")," "),h.xp6(7),h.hij("",h.lcZ(45,78,"POND_MOD.NUMBER_OF_ANIMALS")," "),h.xp6(3),h.hij("(",h.lcZ(48,80,"POND_MOD.THOUSAND"),")"),h.xp6(3),h.hij("",h.xi3(51,82,(null==e.todayData?null:e.todayData.quantityPCS)/1e3,"1.0-1")," "),h.xp6(2),h.Q6J("ngIf",e.showDelta),h.xp6(4),h.hij("",h.lcZ(57,85,"POND_MOD.QUANTITY")," "),h.xp6(3),h.Oqu(h.lcZ(60,87,"POND_MOD.TON")),h.xp6(3),h.hij("",h.xi3(63,89,e.todayData.quantity/1e3,"1.0-2")," "),h.xp6(2),h.Q6J("ngIf",e.showDelta),h.xp6(4),h.hij("",h.lcZ(69,92,"POND_MOD.REVENUE")," "),h.xp6(3),h.Oqu(h.lcZ(72,94,"CURRENCY_S")),h.xp6(3),h.Oqu(h.xi3(75,96,e.todayData.quantity*e.price,"1.0-0")),h.xp6(2),h.Q6J("appPermission",h.DdM(161,Oe))("currentPermission",e.pondService.permission),h.xp6(3),h.hij("",h.lcZ(80,99,"POND_MOD.PROFIT")," "),h.xp6(3),h.Oqu(h.lcZ(83,101,"CURRENCY_S")),h.xp6(4),h.Oqu(h.xi3(87,103,e.todayData.quantity*e.price-e.todayData.cost,"1.0-0")),h.xp6(6),h.AsE(" ",e.day," ",h.lcZ(93,106,"POND_MOD.NEXT_DAYS")," "),h.xp6(6),h.hij("",h.lcZ(99,108,"POND_MOD.SIZE")," "),h.xp6(3),h.AsE("(",h.xi3(102,110,1e3/e.next7Data.weight,"1.0-1")," ",h.lcZ(103,113,"PCS"),"/kg)"),h.xp6(4),h.hij("",h.xi3(106,115,e.next7Data.weight,"1.0-1")," "),h.xp6(7),h.hij("",h.lcZ(113,118,"POND_MOD.QUANTITY")," "),h.xp6(3),h.Oqu(h.lcZ(116,120,"POND_MOD.TON")),h.xp6(3),h.hij("",h.xi3(119,122,e.next7Data.quantity/1e3,"1.0-1")," "),h.xp6(2),h.Q6J("ngIf",e.showDelta),h.xp6(4),h.hij("",h.lcZ(125,125,"POND_MOD.ESITMATE_PRICE")," "),h.xp6(3),h.Oqu(h.lcZ(128,127,"CURRENCY_S")),h.xp6(3),h.Oqu(h.xi3(131,129,e.price7day,"1.0-1")),h.xp6(2),h.Q6J("appPermission",h.DdM(162,Oe))("currentPermission",e.pondService.permission),h.xp6(3),h.hij("",h.lcZ(136,132,"POND_MOD.INVEST_MORE")," "),h.xp6(3),h.Oqu(h.lcZ(139,134,"CURRENCY_S")),h.xp6(3),h.Oqu(h.xi3(142,136,e.next7Data.deltaCost,"1.0-0")),h.xp6(5),h.hij("",h.lcZ(147,139,"POND_MOD.REVENUE")," "),h.xp6(3),h.Oqu(h.lcZ(150,141,"CURRENCY_S")),h.xp6(3),h.Oqu(h.xi3(153,143,e.next7Data.quantity*e.price7day,"1.0-0")),h.xp6(2),h.Q6J("appPermission",h.DdM(163,Oe))("currentPermission",e.pondService.permission),h.xp6(3),h.hij("",h.lcZ(158,146,"POND_MOD.PROFIT")," "),h.xp6(3),h.Oqu(h.lcZ(161,148,"CURRENCY_S")),h.xp6(4),h.Oqu(h.xi3(165,150,e.next7Data.quantity*e.price7day-e.next7Data.cost,"1.0-0")),h.xp6(5),h.Oqu(h.lcZ(170,153,"POND_MOD.SHOW_ERROR")),h.xp6(2),h.Q6J("ngModel",e.showDelta),h.xp6(3),h.Oqu(h.lcZ(175,155,"POND_MOD.ENTER_PRICE")),h.xp6(2),h.Q6J("ngModel",e.price),h.xp6(3),h.Oqu(h.lcZ(180,157,"POND_MOD.ESITMATE_WARNING")),h.xp6(4),h.hij("",h.lcZ(184,159,"POND_MOD.PRICE_FROM")," tepbac.com"))},directives:[a.Gu,a.sr,a.wd,a.Sm,a.YG,a.gu,a.W2,a.PM,a.Zi,a.tO,a.q_,a.Ie,a.Q$,n.O5,ve.l,a.ho,a.w,o.JJ,o.On,a.pK,a.j9],pipes:[g.X$,n.JJ],styles:[""]}),t})(),be=(()=>{class t{constructor(t,e,i,n){this.toastService=t,this.modalCtrl=e,this.translate=i,this.pondService=n,this.form=new o.cw({type_action:new o.NI("1",o.kI.required),description:new o.NI(""),time_stamp:new o.NI("")})}ngOnInit(){this.form.patchValue({time_stamp:(new Date).getTime()})}save(){let t=this.form.value;t.disease_id=this.item.disease_id,this.pondService.saveProcessDisease(t).subscribe(e=>{1==e.status?(this.toastService.success(this.translate.instant("DISEASE.HANDING_SUCCESS")),this.modalCtrl.dismiss(1==t.type_action)):this.toastService.warning(e.error)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(A.k),h.Y36(a.IN),h.Y36(g.sK),h.Y36(c.p))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-process-disease"]],inputs:{item:"item"},decls:19,vars:10,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-padding"],[3,"formGroup"],["position","floating"],["formControlName","description"],[2,"text-align","center"],["shape","round",3,"click"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content",3),h.TgZ(9,"ion-list",4),h.TgZ(10,"ion-item"),h.TgZ(11,"ion-label",5),h._uU(12),h.ALo(13,"translate"),h.qZA(),h._UZ(14,"ion-textarea",6),h.qZA(),h.qZA(),h.TgZ(15,"div",7),h.TgZ(16,"ion-button",8),h.NdJ("click",function(){return e.save()}),h._uU(17),h.ALo(18,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,4,"DISEASE.HANDING")),h.xp6(3),h.Q6J("formGroup",e.form),h.xp6(3),h.hij(" ",h.lcZ(13,6,"DISEASE.DESCRIPTION")," "),h.xp6(5),h.Oqu(h.lcZ(18,8,"SAVE")))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.q_,o.JL,o.sg,a.Ie,a.Q$,a.g2,a.j9,o.JJ,o.u],pipes:[g.X$],styles:[""]}),t})();var Se=i(26215),Ce=i(92340),ye=i(69814),Ne=i(1533),Ee=i(55396),Me=i(66542),Ie=i(87152),we=i(98626),Ue=i(23211),Pe=i(88459),Re=i(59419),ke=i(90593),Ye=i(10086);function Le(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h.TgZ(2,"p"),h._uU(3),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.xp6(3),h.hij(" ",t.todo," ")}}function Fe(t,e){if(1&t&&(h.TgZ(0,"ion-list"),h.TgZ(1,"ion-list-header"),h.TgZ(2,"ion-label"),h._uU(3,"Quan tr\u1ecdng"),h.qZA(),h.qZA(),h.YNc(4,Le,4,1,"ion-item",9),h.qZA()),2&t){const t=h.oxw(2);h.xp6(4),h.Q6J("ngForOf",t.data.procedure_problem)}}function Je(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h.TgZ(2,"p"),h._uU(3),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.xp6(3),h.hij(" ",t.todo," ")}}function Qe(t,e){1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h.TgZ(2,"p"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.hij(" ",h.lcZ(4,1,"POND_MOD.NO_ITEM")," "))}function Ve(t,e){if(1&t&&(h.TgZ(0,"div"),h.TgZ(1,"div",6),h.TgZ(2,"ion-text"),h.TgZ(3,"h3"),h._uU(4),h.qZA(),h.qZA(),h.qZA(),h.TgZ(5,"ion-item",7),h.TgZ(6,"ion-label"),h.TgZ(7,"h3"),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.TgZ(10,"p"),h.TgZ(11,"ion-text",8),h._uU(12),h.qZA(),h._uU(13,"\xa0"),h.TgZ(14,"span"),h._uU(15),h.ALo(16,"translate"),h.TgZ(17,"sup"),h._uU(18,"2"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(19,"div"),h.TgZ(20,"p"),h._uU(21),h.qZA(),h.qZA(),h.YNc(22,Fe,5,1,"ion-list",3),h.TgZ(23,"ion-list"),h.TgZ(24,"ion-list-header"),h.TgZ(25,"ion-label"),h._uU(26),h.ALo(27,"translate"),h.qZA(),h.qZA(),h.YNc(28,Je,4,1,"ion-item",9),h.YNc(29,Qe,5,3,"ion-item",3),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(4),h.Oqu(t.data.procedure_info.name),h.xp6(4),h.Oqu(h.lcZ(9,9,"POND_MOD.DENSITY")),h.xp6(4),h.Oqu(t.data.procedure_info.density),h.xp6(3),h.hij("",h.lcZ(16,11,"PCS"),"/m"),h.xp6(6),h.Oqu(t.data.procedure_info.description),h.xp6(1),h.Q6J("ngIf",t.data.procedure_problem.length>0),h.xp6(4),h.Oqu(h.lcZ(27,13,"POND_MOD.TODO")),h.xp6(2),h.Q6J("ngForOf",t.data.procedure_todo),h.xp6(1),h.Q6J("ngIf",0==t.data.procedure_todo.length)}}function je(t,e){1&t&&(h.TgZ(0,"div",10),h._UZ(1,"ion-spinner",11),h.qZA())}function He(t,e){if(1&t&&h._UZ(0,"div",12),2&t){const t=h.oxw();h.Q6J("options",t.optionChart)("merge",t.dataUpdate)}}let Ge=(()=>{class t{constructor(t,e,i,n,o){this.pondService=t,this.toastController=e,this.modalCtrl=i,this.procedureService=n,this.translate=o,this.loadingFlag=new d.E,this.dataRaw=[],this.dataChart=[],this.feedData=[],this.weightData=[],this.show=!1,this.optionChart={tooltip:{trigger:"axis",formatter:t=>{console.log(t);let e=this.translate.instant("DATE")+": "+t[0].axisValue+"<br/>";return t.forEach(t=>{e+=t.marker+t.seriesName+" : "+(new Intl.NumberFormat).format(t.value[1])+"<br>"}),e},axisPointer:{animation:!0}},xAxis:{type:"value",splitLine:{show:!1}},yAxis:[{type:"value",show:!1,splitLine:{show:!1}},{type:"value",show:!1,position:"right",splitLine:{show:!1}}],series:[{type:"bar",smooth:!0,name:this.translate.instant("POND_MOD.HEIGHT"),itemStyle:{color:"#FBC02D"}},{type:"line",name:this.translate.instant("POND_MOD.FEED"),barWidth:"10%",yAxisIndex:1},{type:"bar",smooth:!0,name:this.translate.instant("POND_MOD.CURRENT_WEIGHT"),itemStyle:{color:"#F57F17"}},{type:"line",name:this.translate.instant("POND_MOD.CURRENT_FEED"),barWidth:"10%",yAxisIndex:1}]}}ngOnInit(){this.getDetail(),this.getDaily()}getDetail(){this.loadingFlag.setStart(!0),this.procedureService.getProcedureRawDetail(this.data.procedure_info.id).subscribe(t=>{t.data?(this.dataRaw=t.data.curves,this.prepareData(this.dataRaw),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},t=>{this.loadingFlag.setResult(!1),console.log(t)})}prepareData(t){this.dataChart=[],t.forEach(t=>{t.weight>0&&this.weightData.push([t.day,t.weight]),t.feed>0&&this.feedData.push([t.day,t.feed])}),this.dataUpdate={series:[{data:this.weightData},{data:this.feedData}]}}prepareDailyData(t){let e=[],i=[];t.forEach((t,n)=>{let o=Math.abs(u().diff(u(t.date),"days")-this.dateOld);i.push([o,t.weight]),e.push([o,t.feed_today])}),this.dataUpdate={series:[{data:this.weightData},{data:this.feedData},{data:i},{data:e}]}}getDaily(){this.loadingFlag.setStart(!0),this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},u().format("YYYY-MM-DD")).subscribe(t=>{t.data?(this.prepareDailyData(t.data),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},t=>{this.loadingFlag.setResult(!1),console.log(t)})}ionViewDidEnter(){this.show=!0}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(c.p),h.Y36(a.yF),h.Y36(a.IN),h.Y36(Ye.d),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-procedure-view"]],inputs:{data:"data",dateOld:"dateOld"},decls:12,vars:6,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[4,"ngIf"],["class","spiner-loading",4,"ngIf"],["echarts","","class","demo-chart",3,"options","merge",4,"ngIf"],[1,"ion-padding"],["lines","none"],["color","primary"],[4,"ngFor","ngForOf"],[1,"spiner-loading"],["name","dots"],["echarts","",1,"demo-chart",3,"options","merge"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.YNc(9,Ve,30,15,"div",3),h.YNc(10,je,2,0,"div",4),h.YNc(11,He,1,2,"div",5),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,4,"PROCEDURE")),h.xp6(3),h.Q6J("ngIf",e.data),h.xp6(1),h.Q6J("ngIf",e.loadingFlag.pending),h.xp6(1),h.Q6J("ngIf",e.show))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,n.O5,a.yW,a.Ie,a.Q$,a.q_,a.yh,n.sg,a.PQ,r._w],pipes:[g.X$],styles:[""]}),t})();function Be(t,e){1&t&&h._UZ(0,"ion-icon",9)}function ze(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",10),h.NdJ("click",function(){return h.CHM(t),h.oxw(2).removeBlock()}),h.TgZ(1,"ion-button",11),h._UZ(2,"ion-icon",12),h.qZA(),h.qZA()}}function $e(t,e){if(1&t&&(h.TgZ(0,"div",13),h.TgZ(1,"p"),h._uU(2),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.xp6(2),h.Oqu(t.dailyProcedure.procedure_info.name)}}function We(t,e){1&t&&(h.TgZ(0,"p",17),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"POND_MOD.NO_INFOR")))}function Xe(t,e){if(1&t&&(h.TgZ(0,"ion-card-content"),h.TgZ(1,"ion-list",14),h.TgZ(2,"ion-item"),h.TgZ(3,"ion-label"),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.TgZ(6,"span",15),h._uU(7),h.TgZ(8,"small"),h._uU(9,"g"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(10,"ion-item"),h.TgZ(11,"ion-label"),h._uU(12),h.ALo(13,"translate"),h.qZA(),h.TgZ(14,"span",15),h._uU(15),h.TgZ(16,"small"),h._uU(17,"kg"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(18,We,3,3,"p",16),h.qZA()),2&t){const t=h.oxw(2);h.xp6(4),h.hij(" ",h.lcZ(5,5,"POND_MOD.HEIGHT")," "),h.xp6(3),h.hij("",null==t.dailyProcedure?null:t.dailyProcedure.procedure_curve.weight," "),h.xp6(5),h.hij(" ",h.lcZ(13,7,"POND_MOD.FEED")," "),h.xp6(3),h.hij("",null==t.dailyProcedure?null:t.dailyProcedure.procedure_curve.feed," "),h.xp6(3),h.Q6J("ngIf",t.loadingFlag.result&&!(null!=t.dailyProcedure&&t.dailyProcedure.procedure_info))}}function Ke(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",18),h.TgZ(1,"ion-button",19),h.NdJ("click",function(){return h.CHM(t),h.oxw(2).upBlockProperty()}),h._UZ(2,"ion-icon",20),h.qZA(),h.TgZ(3,"ion-button",19),h.NdJ("click",function(){return h.CHM(t),h.oxw(2).downBlockProperty()}),h._UZ(4,"ion-icon",21),h.qZA(),h.qZA()}}function ti(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-card",1),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw();return i.enableSort?e.stopPropagation():i.openProcedure()}),h.TgZ(1,"ion-card-header",2),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",3),h._uU(4),h.ALo(5,"translate"),h.YNc(6,Be,1,0,"ion-icon",4),h.qZA(),h.YNc(7,ze,3,0,"ion-buttons",5),h.qZA(),h.YNc(8,$e,3,1,"div",6),h.YNc(9,Xe,19,9,"ion-card-content",7),h.TgZ(10,"div"),h.YNc(11,Ke,5,0,"ion-buttons",8),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.Q6J("ngClass",t.enableSort?"jiggleBlock":""),h.xp6(4),h.hij(" ",h.lcZ(5,7,"PROCEDURE")," "),h.xp6(2),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",(null==t.dailyProcedure?null:t.dailyProcedure.procedure_curve)&&!t.enableSort),h.xp6(2),h.Q6J("ngIf",t.enableSort)}}let ei=(()=>{class t{constructor(t,e,i,n){this.pondService=t,this.toastService=e,this.modalCtrl=i,this.translate=n,this.loadingFlag=new d.E,this.dateOld=0,this.eventUp=new h.vpe,this.eventDown=new h.vpe,this.eventRemove=new h.vpe,console.log("onload procerdure")}ngOnInit(){this.loadProcedure()}openProcedure(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalCtrl.create({component:Ge,componentProps:{data:this.dailyProcedure,dateOld:this.dateOld}})).present()})}loadProcedure(){console.log("load procedure"),this.loadingFlag.setPending(!0),this.pondService.getProcedure().pipe().subscribe(t=>{console.log(t),t.error||1!=t.status?this.toastService.warning(t.error):(this.dailyProcedure=t.data,this.dateOld=t.old),this.loadingFlag.setResult(!0)},t=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}upBlockProperty(){this.eventUp.emit(this.index)}downBlockProperty(){this.eventDown.emit(this.index)}removeBlock(){this.eventRemove.emit(this.index)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(c.p),h.Y36(A.k),h.Y36(a.IN),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-procedure"]],inputs:{enableSort:"enableSort",index:"index"},outputs:{eventUp:"eventUp",eventDown:"eventDown",eventRemove:"eventRemove"},decls:1,vars:1,consts:[["mode","ios",3,"ngClass","click",4,"ngIf"],["mode","ios",3,"ngClass","click"],[1,"procedure"],["src","assets/icon/procedure.svg",1,"icon-f"],["class","icon-detail","name","chevron-forward-outline",4,"ngIf"],["class","btnRemoveBlock",3,"click",4,"ngIf"],["class","ion-padding",4,"ngIf"],[4,"ngIf"],["class","ion-float-end",4,"ngIf"],["name","chevron-forward-outline",1,"icon-detail"],[1,"btnRemoveBlock",3,"click"],["size","small","color","light"],["name","close"],[1,"ion-padding"],["lines","none","mode","ios"],["slot","end",1,"ion-margin"],["class","ion-text-center",4,"ngIf"],[1,"ion-text-center"],[1,"ion-float-end"],["size","small","color","tertiary",3,"click"],["name","chevron-up-circle-outline"],["name","chevron-down-circle-outline"]],template:function(t,e){1&t&&h.YNc(0,ti,12,9,"ion-card",0),2&t&&h.Q6J("ngIf",e.dailyProcedure)},directives:[n.O5,a.PM,n.mk,a.Zi,a.tO,a.gu,a.Sm,a.YG,a.FN,a.q_,a.Ie,a.Q$],pipes:[g.X$],styles:["[_nghost-%COMP%]   .procedure[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#68768A,#3dc2ff)}[_nghost-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#fff!important;padding-left:3em}[_nghost-%COMP%]   ion-icon.icon-f[_ngcontent-%COMP%]{font-size:2em;position:absolute;left:0;top:-.2em}[_nghost-%COMP%]   .jiggleBlock[_ngcontent-%COMP%]{animation:jiggle .4s infinite;-webkit-animation:jiggle .4s infinite;-moz-animation-duration:.4s;-moz-animation-name:jiggle;-moz-animation-iteration-count:infinite;-webkit-transform:rotate(-1deg);-moz-transform:rotate(-1deg)}@keyframes jiggle{0%{transform:rotate(-1deg)}50%{transform:rotate(1deg)}}@-webkit-keyframes jiggle{0%{-webkit-transform:rotate(-1deg)}50%{-webkit-transform:rotate(1deg)}}[_nghost-%COMP%]   .btnRemoveBlock[_ngcontent-%COMP%]{position:absolute;top:0;right:0}[_nghost-%COMP%]   .disableEvent[_ngcontent-%COMP%]{pointer-events:none!important}"]}),t})();function ii(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-checkbox",14),h.NdJ("ngModelChange",function(t){return e.$implicit.checked=t})("click",function(){const e=h.CHM(t),i=e.$implicit,n=e.index;return h.oxw().setDone(i,n)}),h.qZA(),h.TgZ(2,"ion-label"),h._uU(3),h.TgZ(4,"p"),h._uU(5),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(1),h.Q6J("ngModel",t.checked),h.xp6(2),h.hij(" ",t.content," "),h.xp6(2),h.Oqu(t.time.format("HH:mm A"))}}function ni(t,e){1&t&&(h.TgZ(0,"ion-item",15),h.TgZ(1,"ion-label",3),h.TgZ(2,"p"),h.TgZ(3,"i"),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(4),h.Oqu(h.lcZ(5,1,"POND_MOD.NO_TODO")))}function oi(t,e){1&t&&(h.TgZ(0,"div",3),h._UZ(1,"ion-spinner",16),h.qZA())}let si=(()=>{class t{constructor(t,e,i,n,o){this.modalCtrl=t,this.toastService=e,this.calendarService=i,this.pondService=n,this.translate=o,this.loadingFlag=new d.E,this.data=[],this.dataRaw=[],this.dateRangeSelectedOld=u(),this.dateRangeSelected=u(),this.maxDate=u().add(180,"days"),this.minDate=u().subtract(180,"days"),this.minDateTamp=u(),this.maxDateTamp=u()}ngOnInit(){console.log(this.item),this.item.length>0&&void 0!==this.item&&0==this.dateRangeSelected.diff(this.item[0].time,"day")?this.itemSelected=this.item:this.getData("up"),this.minDate=u(1e3*this.pondService.pond.add_time),this.maxDate=u().add(7,"days")}getData(t){this.loadingFlag.setPending(!0);let e=0;e="up"==t?this.dateRangeSelected.valueOf()/1e3:this.dateRangeSelected.endOf("day").valueOf()/1e3,this.calendarService.getListByPond(this.pondService.pcode,e,t).pipe().subscribe(t=>{if(t.error)this.itemSelected=[];else{this.dataRaw=t.data.map(t=>(t.time=u(1e3*t.time),t));for(let t=0;t<this.dataRaw.length;t++)this.dataRaw[t].checked=0!=this.dataRaw[t].done;this.procesData()}this.loadingFlag.setResult(!0)},t=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}onChangeDate(t){let e="up";if(t.detail.value<this.dateRangeSelectedOld.format("YYYY-MM-DD")&&(e="down"),this.dateRangeSelected=u(t.detail.value),this.dateRangeSelectedOld=this.dateRangeSelected,this.dataRaw.length>0){let t="down"===e?this.dataRaw[this.dataRaw.length-1].time.diff(this.dateRangeSelected,"days"):this.dataRaw[0].time.diff(this.dateRangeSelected,"days");t<=-1&&"down"==e||t>=1&&"up"==e?this.procesData():this.getData(e)}else this.getData(e)}procesData(){this.itemSelected=this.dataRaw.filter(t=>{let e=t.time.diff(this.dateRangeSelected.startOf("day"),"days",!0);return e<1&&e>=0})}changeDate(t){this.dateRangeSelected=u(this.dateRangeSelected).add(t,"days")}setDone(t,e){this.pondService.doneTodo(t.id).subscribe(t=>{1==t.status?this.itemSelected[e].checked?(this.itemSelected[e].done=1,this.toastService.success(this.translate.instant("POND_MOD.DONE_TODO"))):(this.item[e].done=0,this.toastService.warning(this.translate.instant("POND_MOD.UNDONE_TODO"))):1==this.itemSelected[e].checked?(this.itemSelected[e].done=0,this.itemSelected[e].checked=!1):(this.itemSelected[e].done=1,this.itemSelected[e].checked=!0,this.toastService.warning(t.error))},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(A.k),h.Y36(M.o),h.Y36(c.p),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-todo"]],inputs:{item:"item"},decls:26,vars:14,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-text-center"],["size","2"],["fill","clear",3,"disabled","click"],["slot","icon-only","name","arrow-back-outline"],["size","8"],[1,"ion-text-center","w-100",3,"displayFormat","min","max","value","ionChange"],["slot","icon-only","name","arrow-forward-outline"],["lines","none",1,"ion-padding"],[4,"ngFor","ngForOf"],["lines","none",4,"ngIf"],["class","ion-text-center",4,"ngIf"],["slot","start",3,"ngModel","ngModelChange","click"],["lines","none"],["name","dots"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"div",3),h.TgZ(10,"ion-grid"),h.TgZ(11,"ion-row"),h.TgZ(12,"ion-col",4),h.TgZ(13,"ion-button",5),h.NdJ("click",function(){return e.changeDate(-1)}),h._UZ(14,"ion-icon",6),h.qZA(),h.qZA(),h.TgZ(15,"ion-col",7),h.TgZ(16,"ion-item",3),h.TgZ(17,"ion-datetime",8),h.NdJ("ionChange",function(t){return e.onChangeDate(t)}),h.ALo(18,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(19,"ion-col",4),h.TgZ(20,"ion-button",5),h.NdJ("click",function(){return e.changeDate(1)}),h._UZ(21,"ion-icon",9),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(22,"ion-list",10),h.YNc(23,ii,6,3,"ion-item",11),h.YNc(24,ni,6,3,"ion-item",12),h.qZA(),h.YNc(25,oi,2,0,"div",13),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,10,"POND_MOD.TODO")),h.xp6(7),h.Q6J("disabled",e.dateRangeSelected.format("YYYY-MM-DD")<=e.minDate.format("YYYY-MM-DD")),h.xp6(4),h.Q6J("displayFormat",h.lcZ(18,12,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeSelected.format("YYYY-MM-DD")),h.xp6(3),h.Q6J("disabled",e.dateRangeSelected.format("YYYY-MM-DD")>=e.maxDate.format("YYYY-MM-DD")),h.xp6(3),h.Q6J("ngForOf",e.itemSelected),h.xp6(1),h.Q6J("ngIf",0==(null==e.itemSelected?null:e.itemSelected.length)),h.xp6(1),h.Q6J("ngIf",e.loadingFlag.pending))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.jY,a.Nd,a.wI,a.Ie,a.x4,a.QI,a.q_,n.sg,n.O5,a.nz,a.w,o.JJ,o.On,a.Q$,a.PQ],pipes:[g.X$],styles:[""]}),t})(),ai=(()=>{class t{constructor(t,e,i,n,s){this.modalCtrl=t,this.toastService=e,this.pondService=i,this.calendarService=n,this.translate=s,this.savingFlag=new d.E,this.minDate=u(),this.maxDate=u().add(30,"days"),this.form=new o.cw({date:new o.NI(u().format("YYYY-MM-DD"),o.kI.required),time:new o.NI(u().toISOString(),[o.kI.required]),content:new o.NI("",[o.kI.required])})}ngOnInit(){}save(){let t=u(this.form.value.time),e=u(this.form.value.date);if(e.set({hour:t.get("hour"),minute:t.get("minute")}),this.form.value.date<this.minDate.format("YYYY-MM-DD"))return this.toastService.success(this.translate.instant("POND_MOD.TIME_PASSED")),!1;let i={content:this.form.value.content,date:e.format("YYYY-MM-DD"),time:e.format("HH:mm"),pond_id:this.pondService.pcode,done:!1};this.savingFlag.setPending(!0),this.calendarService.insertCalendar(i).subscribe(t=>{t.error||1!=t.status?this.toastService.warning(t.error):(this.toastService.success(this.translate.instant("POND_MOD.NOTI_ADD_TODO")),this.form.value.date==this.minDate.format("YYYY-MM-DD")?this.modalCtrl.dismiss(i):this.modalCtrl.dismiss()),this.savingFlag.setResult(!0)},t=>{this.savingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(A.k),h.Y36(c.p),h.Y36(M.o),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-todo-add"]],decls:31,vars:22,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[3,"formGroup"],[1,"ion-text-center"],[1,"title","ion-padding"],["lines","inset"],["displayFormat","HH:mm","minuteValues","0,15,30,45","formControlName","time"],["formControlName","date",3,"displayFormat","min","max"],["position","floating"],["rows","2","formControlName","content"],["shape","round","color","primary",3,"disabled","click"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalCtrl.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(5,"ion-content",3),h.TgZ(6,"div",4),h.TgZ(7,"h1",5),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA(),h.TgZ(10,"ion-list"),h.TgZ(11,"ion-item",6),h.TgZ(12,"ion-label"),h._uU(13),h.ALo(14,"translate"),h.qZA(),h._UZ(15,"ion-datetime",7),h.qZA(),h.TgZ(16,"ion-item",6),h.TgZ(17,"ion-label"),h._uU(18),h.ALo(19,"translate"),h.qZA(),h._UZ(20,"ion-datetime",8),h.ALo(21,"translate"),h.qZA(),h.TgZ(22,"ion-item",6),h.TgZ(23,"ion-label",9),h._uU(24),h.ALo(25,"translate"),h.qZA(),h._UZ(26,"ion-textarea",10),h.qZA(),h.qZA(),h.TgZ(27,"div",4),h.TgZ(28,"ion-button",11),h.NdJ("click",function(){return e.save()}),h._uU(29),h.ALo(30,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(5),h.Q6J("formGroup",e.form),h.xp6(3),h.Oqu(h.lcZ(9,10,"POND_MOD.ADD_TODO")),h.xp6(5),h.Oqu(h.lcZ(14,12,"POND_MOD.HOUR")),h.xp6(5),h.Oqu(h.lcZ(19,14,"POND_MOD.DATE")),h.xp6(2),h.Q6J("displayFormat",h.lcZ(21,16,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD")),h.xp6(4),h.Oqu(h.lcZ(25,18,"POND_MOD.CONTENT")),h.xp6(4),h.Q6J("disabled",e.form.invalid||e.savingFlag.pending),h.xp6(1),h.Oqu(h.lcZ(30,20,"SAVE")))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.W2,o.JL,o.sg,a.q_,a.Ie,a.Q$,a.x4,a.QI,o.JJ,o.u,a.g2,a.j9],pipes:[g.X$],styles:[""]}),t})();function ri(t,e){1&t&&h._UZ(0,"ion-icon",7)}function li(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",8),h.NdJ("click",function(){return h.CHM(t),h.oxw().removeBlock()}),h.TgZ(1,"ion-button",9),h._UZ(2,"ion-icon",10),h.qZA(),h.qZA()}}const ci=function(){return["company_manager","farm_manager","farm_operation","pond_operator","pond_manager"]};function di(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-button",17),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(3);return i.enableSort?e.stopPropagation():i.presentAdd(e)}),h._UZ(1,"ion-icon",18),h.qZA()}if(2&t){const t=h.oxw(3);h.Q6J("appPermission",h.DdM(2,ci))("currentPermission",t.pondService.permission)}}function ui(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",14),h.TgZ(2,"ion-label",15),h.TgZ(3,"b"),h._uU(4),h.qZA(),h._uU(5),h.qZA(),h.YNc(6,di,2,3,"ion-button",16),h.qZA()),2&t){const t=e.$implicit,i=e.index,n=h.oxw(2);h.xp6(1),h.Q6J("color",1==t.done?"success":"")("name",0!=t.done&&t.done?"checkmark-outline":"pricetag-outline"),h.xp6(1),h.Q6J("color",1==t.done?"success":""),h.xp6(2),h.Oqu(t.time.format("HH:mm A")),h.xp6(1),h.hij(" | ",t.content," "),h.xp6(1),h.Q6J("ngIf",i==n.items.length-1)}}function hi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h.TgZ(2,"p"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.TgZ(5,"ion-button",17),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(2);return i.enableSort?e.stopPropagation():i.presentAdd(e)}),h._UZ(6,"ion-icon",18),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(2);h.xp6(3),h.Oqu(h.lcZ(4,3,"POND_MOD.NOTHING_TODO_TODAY")),h.xp6(2),h.Q6J("appPermission",h.DdM(5,ci))("currentPermission",t.pondService.permission)}}function gi(t,e){if(1&t&&(h.TgZ(0,"ion-list",11),h.YNc(1,ui,7,6,"ion-item",12),h.YNc(2,hi,7,6,"ion-item",13),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.Q6J("ngForOf",t.items),h.xp6(1),h.Q6J("ngIf",0==(null==t.items?null:t.items.length))}}function pi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",19),h.TgZ(1,"ion-button",20),h.NdJ("click",function(){return h.CHM(t),h.oxw().upBlockProperty()}),h._UZ(2,"ion-icon",21),h.qZA(),h.TgZ(3,"ion-button",20),h.NdJ("click",function(){return h.CHM(t),h.oxw().downBlockProperty()}),h._UZ(4,"ion-icon",22),h.qZA(),h.qZA()}}let mi=(()=>{class t{constructor(t,e,i,n){this.modalController=t,this.pondService=e,this.toastService=i,this.translate=n,this.loadingFlag=new d.E,this.items=[],this.eventUp=new h.vpe,this.eventDown=new h.vpe,this.eventRemove=new h.vpe}ngOnInit(){this.loadList()}presentTodo(){return(0,l.mG)(this,void 0,void 0,function*(){for(let t=0;t<this.items.length;t++)this.items[t].checked=0!=this.items[t].done;return yield(yield this.modalController.create({component:si,componentProps:{item:this.items}})).present()})}presentAdd(t){return(0,l.mG)(this,void 0,void 0,function*(){t.target&&t.stopPropagation();const e=yield this.modalController.create({component:ai});return e.onDidDismiss().then(t=>{t.data&&this.items.push(t.data)}),yield e.present()})}loadList(){let t=u().startOf("day").valueOf()/1e3;this.loadingFlag.setPending(!0),this.pondService.getCalendarList(t).pipe().subscribe(t=>{console.log(t),!t.error&&t.data.length>0?(this.items=t.data.map(t=>(t.time=u(1e3*t.time),t)),this.items=this.items.slice(0,5)):this.items=[],this.loadingFlag.setResult(!0)},t=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}upBlockProperty(){this.eventUp.emit(this.index)}downBlockProperty(){this.eventDown.emit(this.index)}removeBlock(){this.eventRemove.emit(this.index)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(A.k),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-todo-info"]],inputs:{enableSort:"enableSort",index:"index"},outputs:{eventUp:"eventUp",eventDown:"eventDown",eventRemove:"eventRemove"},decls:12,vars:8,consts:[["mode","ios",3,"ngClass","click"],[1,"todo"],["name","list",1,"icon-f"],["class","icon-detail","name","chevron-forward-outline",4,"ngIf"],["class","btnRemoveBlock",3,"click",4,"ngIf"],["lines","none","mode","ios",4,"ngIf"],["class","ion-float-end",4,"ngIf"],["name","chevron-forward-outline",1,"icon-detail"],[1,"btnRemoveBlock",3,"click"],["size","small","color","light"],["name","close"],["lines","none","mode","ios"],[4,"ngFor","ngForOf"],[4,"ngIf"],["slot","start",3,"color","name"],[3,"color"],["slot","end","shape","round","fill","clear","size","default",3,"appPermission","currentPermission","click",4,"ngIf"],["slot","end","shape","round","fill","clear","size","default",3,"appPermission","currentPermission","click"],["name","add-circle-outline","slot","icon-only"],[1,"ion-float-end"],["size","small","color","tertiary",3,"click"],["name","chevron-up-circle-outline"],["name","chevron-down-circle-outline"]],template:function(t,e){1&t&&(h.TgZ(0,"div"),h.TgZ(1,"ion-card",0),h.NdJ("click",function(t){return e.enableSort?t.stopPropagation():e.presentTodo()}),h.TgZ(2,"ion-card-header",1),h.TgZ(3,"ion-card-subtitle"),h._UZ(4,"ion-icon",2),h._uU(5),h.ALo(6,"translate"),h.YNc(7,ri,1,0,"ion-icon",3),h.qZA(),h.YNc(8,li,3,0,"ion-buttons",4),h.qZA(),h.YNc(9,gi,3,2,"ion-list",5),h.TgZ(10,"div"),h.YNc(11,pi,5,0,"ion-buttons",6),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(1),h.Q6J("ngClass",e.enableSort?"jiggleBlock":""),h.xp6(4),h.hij(" ",h.lcZ(6,6,"POND_MOD.TODO")," "),h.xp6(2),h.Q6J("ngIf",!e.enableSort),h.xp6(1),h.Q6J("ngIf",e.enableSort),h.xp6(1),h.Q6J("ngIf",!e.enableSort),h.xp6(2),h.Q6J("ngIf",e.enableSort))},directives:[a.PM,n.mk,a.Zi,a.tO,a.gu,n.O5,a.Sm,a.YG,a.q_,n.sg,a.Ie,a.Q$,ve.l],pipes:[g.X$],styles:["[_nghost-%COMP%]   .todo[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#567C73,#3dc2ff)}[_nghost-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#fff!important;padding-left:3em}[_nghost-%COMP%]   ion-icon.icon-f[_ngcontent-%COMP%]{font-size:2em;position:absolute;left:0;top:-.2em}[_nghost-%COMP%]   .jiggleBlock[_ngcontent-%COMP%]{animation:jiggle .4s infinite;-webkit-animation:jiggle .4s infinite;-moz-animation-duration:.4s;-moz-animation-name:jiggle;-moz-animation-iteration-count:infinite;-webkit-transform:rotate(-1deg);-moz-transform:rotate(-1deg)}@keyframes jiggle{0%{transform:rotate(-1deg)}50%{transform:rotate(1deg)}}@-webkit-keyframes jiggle{0%{-webkit-transform:rotate(-1deg)}50%{-webkit-transform:rotate(1deg)}}[_nghost-%COMP%]   .btnRemoveBlock[_ngcontent-%COMP%]{position:absolute;top:0;right:0}[_nghost-%COMP%]   .disableEvent[_ngcontent-%COMP%]{pointer-events:none!important}"]}),t})();var Zi=i(88002),fi=i(19228),Ai=i(25375);function _i(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",30),h.qZA())}function vi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item",31),h.TgZ(1,"ion-label",22),h._uU(2),h.ALo(3,"translate"),h.TgZ(4,"ion-text",32),h._uU(5),h.ALo(6,"translate"),h.ALo(7,"number"),h.ALo(8,"translate"),h.qZA(),h.qZA(),h.TgZ(9,"ion-input",33),h.NdJ("ionFocus",function(){return h.CHM(t),h.oxw().setAmountPayed()})("ionChange",function(e){return h.CHM(t),h.oxw().numberFormatPayed.setValue(e.detail.value)}),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(2),h.Oqu(h.lcZ(3,5,"MONEY_MOD.PAYED")),h.xp6(3),h.lnq("(",h.lcZ(6,7,"SHOP.CART.TOTAL")," ",h.lcZ(7,9,t.totalCost),"",h.lcZ(8,11,"CURRENCY_S"),")"),h.xp6(4),h.Q6J("value",t.numberFormatPayed.fakeView)}}function Ti(t,e){1&t&&(h.TgZ(0,"ion-item",31),h.TgZ(1,"ion-text",34),h._uU(2," Chi ph\xed \u0111\xe3 tr\u1ea3 lu\xf4n nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng chi ph\xed "),h.qZA(),h.qZA())}function qi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",35),h.TgZ(2,"ion-label",36),h.TgZ(3,"h3"),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._uU(6),h.qZA(),h.qZA(),h.TgZ(7,"ion-button",37),h.NdJ("click",function(){return h.CHM(t),h.oxw().removeSelected()}),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(4),h.Oqu(t.manufacturerSelected.name),h.xp6(2),h.Oqu(t.manufacturerSelected.fullname),h.xp6(2),h.hij(" ",h.lcZ(9,3,"DELETE")," ")}}function xi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",35),h.TgZ(2,"ion-label"),h.TgZ(3,"h3"),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._uU(6),h.qZA(),h.qZA(),h.TgZ(7,"ion-button",38),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw().onSelect(e)}),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(4),h.Oqu(t.name),h.xp6(2),h.Oqu(t.fullname),h.xp6(2),h.hij(" ",h.lcZ(9,3,"SELECT")," ")}}function Oi(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h.TgZ(2,"p"),h._uU(3),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.Oqu(t.message)}}function Di(t,e){1&t&&(h.TgZ(0,"ion-item",31),h.TgZ(1,"ion-label",22),h._uU(2),h.ALo(3,"translate"),h.qZA(),h._UZ(4,"ion-input",39),h.qZA()),2&t&&(h.xp6(2),h.Oqu(h.lcZ(3,1,"MONEY_MOD.CUSTOMER")))}function bi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-text"),h._uU(2),h.qZA(),h.TgZ(3,"ion-button",38),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).setCustomerName(e.customer_name)}),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(2),h.hij(" ",t.customer_name," "),h.xp6(2),h.hij(" ",h.lcZ(5,2,"SELECT")," ")}}function Si(t,e){if(1&t&&(h.TgZ(0,"ion-list",27),h.YNc(1,bi,6,4,"ion-item",28),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.Q6J("ngForOf",t.listCustomer)}}function Ci(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",30),h.qZA())}let yi=(()=>{class t{constructor(t,e,i,n,s,a,r,l){this.modalController=t,this._formBuilder=e,this.toastService=i,this.pondService=n,this.translate=s,this.moneyService=a,this.dbLocalService=r,this.settingService=l,this.loadingFlag=new d.E,this.savingFlag=new d.E,this.numberFormatPrice=new it.y(""),this.numberFormatQuantity=new it.y(""),this.numberFormatPayed=new it.y(""),this.minDate=u().subtract(180,"days"),this.maxDate=u(),this.searchTerms=new ht.xQ,this.message="",this.form=this._formBuilder.group({seed_quantity:["",o.kI.required],seed_quantity_individuals:[""],seed_supplier:[""],seed_supplier_id:[""],seed_old:[""],seed_cost:[""],seed_cost_individuals:[""],seed_cost_kg:[""],seed_weight:[""],note:[""],seed_date:u().format("YYYY-MM-DD"),unit:["con"],customer:[""],amounts_payed:[""]}),this.totalCost=0,this.dataUpload={path:"",name:"",base:"",file:null},this.listCustomer=[]}ngOnInit(){this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.form.get("customer").valueChanges.pipe((0,pt.b)(300),(0,mt.x)()).subscribe(t=>{this.getListCustomer()});let t=this.searchTerms.pipe((0,pt.b)(300),(0,mt.x)(),(0,Zt.w)(t=>this.getListManufacturer(t)));this.manufacturer$=t,this.manufacturer$.subscribe(t=>{this.message=t.length>0||this.manufacturerSelected?"":this.translate.instant("POND_MOD.NO_INFOR"),this.loadingFlag.setResult(!0)});const e=this.dbLocalService.farms.findIndex(t=>t.infor.id==this.pondService.pond.farm_id);e>=0&&this.moneyService.setCode(this.dbLocalService.farms[e].infor.code)}search(t){this.searchTerms.next(t)}getListCustomer(){this.listCustomer=[],this.moneyService.searchCustomer(this.form.value.customer,"").subscribe(t=>{1==t.status&&(this.listCustomer=t.data.filter(t=>t.customer_name!=this.form.value.customer),console.log(this.listCustomer))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}setCustomerName(t){this.form.patchValue({customer:t})}setAmountPayed(){"kg"==this.form.controls.unit.value?(console.log(this.form.controls.seed_weight.value),this.numberFormatPayed.setValue(this.form.value.seed_cost_kg*this.numberFormatQuantity.realValue)):this.numberFormatPayed.setValue(this.numberFormatQuantity.realValue*this.form.value.seed_cost_individuals),this.totalCost=this.numberFormatPayed.realValue}getListManufacturer(t){return this.loadingFlag.setPending(!0),t.trim()?this.pondService.searchManufacturer(t).pipe((0,Zi.U)(t=>t.data.filter(t=>!this.manufacturerSelected||t.id!=this.manufacturerSelected.id))):(this.loadingFlag.setResult(!0),this.message="",(0,gt.of)([]))}onSave(){let t=!1,e={seed_quantity:this.numberFormatQuantity.realValue,seed_quantity_individuals:0,seed_supplier:this.form.value.seed_supplier,seed_supplier_id:this.form.value.seed_supplier_id,seed_old:this.form.value.seed_old,seed_cost:this.form.value.seed_cost.toString().replace(",","."),seed_cost_individuals:this.form.value.seed_cost_individuals.toString().replace(",","."),seed_cost_kg:this.form.value.seed_cost_kg.toString().replace(",","."),seed_weight:this.form.value.seed_weight,note:this.form.value.note,seed_date:u(this.form.value.seed_date).valueOf()/1e3,unit:this.form.value.unit,amounts_payed:this.numberFormatPayed.realValue,customer:this.form.value.customer,is_debt:this.settingService.showDebt?1:0};this.manufacturerSelected?(e.seed_supplier=this.manufacturerSelected.fullname,e.seed_supplier_id=this.manufacturerSelected.id):e.seed_supplier=this.form.value.seed_supplier,"kg"==this.form.controls.unit.value?(console.log(this.form.controls.seed_weight.value),""!=this.form.controls.seed_weight.value?(e.seed_quantity_individuals=1e3*e.seed_quantity/e.seed_weight,e.seed_cost=e.seed_cost_kg*e.seed_weight/1e3):(this.form.controls.seed_weight.setValidators(o.kI.required),this.toastService.warning(this.translate.instant("POND_MOD.ERROR_SIZE")),t=!0),this.form.controls.seed_cost_kg.setValidators(o.kI.required)):(this.form.controls.seed_cost_individuals.setValidators(o.kI.required),e.seed_quantity_individuals=this.numberFormatQuantity.realValue,e.seed_cost=this.form.value.seed_cost_individuals);let i=new FormData;for(let n in e)i.append(n,e[n]);this.dataUpload.file&&i.append("image",this.dataUpload.file),0==t&&(this.savingFlag.setPending(!0),this.pondService.reqSeasonSeed(i).subscribe(t=>{1==+t.status?(this.toastService.success(t.message),this.savingFlag.setResult(!0),this.modalController.dismiss(e)):(this.toastService.warning(t.message),this.savingFlag.setResult(!1))},()=>{this.savingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))}))}onSelect(t){this.manufacturerSelected=t,this.form.controls.seed_supplier.setValue(t.fullname),this.form.controls.seed_supplier_id.setValue(t.id)}removeSelected(){this.manufacturerSelected=null,this.form.controls.seed_supplier.setValue(""),this.form.controls.seed_supplier_id.setValue("")}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(o.qu),h.Y36(A.k),h.Y36(c.p),h.Y36(g.sK),h.Y36(fi.r),h.Y36(nt.T),h.Y36(I.R))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-season-seed"]],decls:86,vars:70,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],[3,"formGroup"],[1,"ion-text-center"],[4,"ngIf"],[3,"data","toUpload"],["color","primary"],["formControlName","seed_date",3,"displayFormat","min","max"],["size","8"],["color","primary","position","floating"],["required","","formControlName","seed_quantity","type","tel","inputmode","numeric",3,"value","ionChange"],["size","4"],["formControlName","unit",3,"ionChange"],["value","con"],["value","kg"],[3,"hidden"],["formControlName","seed_cost_individuals","type","tel","inputmode","decimal",3,"ionChange"],["formControlName","seed_cost_kg","type","tel","inputmode","decimal",3,"ionChange"],["lines","inset",4,"ngIf"],["position","floating"],["formControlName","seed_weight","type","tel","inputmode","decimal"],["formControlName","seed_old","type","tel","inputmode","decimal"],["rows","2","formControlName","note"],["formControlName","seed_supplier",3,"ionChange"],["lines","none"],[4,"ngFor","ngForOf"],["lines","none",4,"ngIf"],["name","dots"],["lines","inset"],["color","success"],["formControlName","amounts_payed","type","tel","inputmode","numeric",3,"value","ionFocus","ionChange"],["color","danger"],["name","business","slot","start"],[1,"ion-text-wrap"],["color","danger","slot","end",3,"click"],["slot","end",3,"click"],["formControlName","customer"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalController.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.onSave()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(12,"ion-content",5),h.TgZ(13,"div",6),h.YNc(14,_i,2,0,"div",7),h.qZA(),h.TgZ(15,"app-image-picker",8),h.NdJ("toUpload",function(t){return e.dataUpload=t}),h.qZA(),h.TgZ(16,"ion-grid"),h.TgZ(17,"ion-item"),h.TgZ(18,"ion-label",9),h._uU(19),h.ALo(20,"translate"),h.qZA(),h._UZ(21,"ion-datetime",10),h.ALo(22,"translate"),h.qZA(),h.TgZ(23,"ion-row"),h.TgZ(24,"ion-col",11),h.TgZ(25,"ion-item"),h.TgZ(26,"ion-label",12),h._uU(27),h.ALo(28,"translate"),h.qZA(),h.TgZ(29,"ion-input",13),h.NdJ("ionChange",function(t){return e.numberFormatQuantity.setValue(t.detail.value),e.setAmountPayed()}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(30,"ion-col",14),h.TgZ(31,"ion-item"),h.TgZ(32,"ion-label",12),h._uU(33),h.ALo(34,"translate"),h.qZA(),h.TgZ(35,"ion-select",15),h.NdJ("ionChange",function(){return e.setAmountPayed()}),h.TgZ(36,"ion-select-option",16),h._uU(37),h.ALo(38,"translate"),h.qZA(),h.TgZ(39,"ion-select-option",17),h._uU(40,"kg"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(41,"ion-item",18),h.TgZ(42,"ion-label",12),h._uU(43),h.ALo(44,"translate"),h.ALo(45,"translate"),h.ALo(46,"translate"),h.qZA(),h.TgZ(47,"ion-input",19),h.NdJ("ionChange",function(){return e.setAmountPayed()}),h.qZA(),h.qZA(),h.TgZ(48,"ion-item",18),h.TgZ(49,"ion-label",12),h._uU(50),h.ALo(51,"translate"),h.ALo(52,"translate"),h.qZA(),h.TgZ(53,"ion-input",20),h.NdJ("ionChange",function(){return e.setAmountPayed()}),h.qZA(),h.qZA(),h.YNc(54,vi,10,13,"ion-item",21),h.YNc(55,Ti,3,0,"ion-item",21),h.TgZ(56,"ion-item"),h.TgZ(57,"ion-label",22),h._uU(58),h.ALo(59,"translate"),h.ALo(60,"translate"),h.qZA(),h._UZ(61,"ion-input",23),h.qZA(),h.TgZ(62,"ion-item"),h.TgZ(63,"ion-label",22),h._uU(64),h.ALo(65,"translate"),h.qZA(),h._UZ(66,"ion-input",24),h.qZA(),h.TgZ(67,"ion-item"),h.TgZ(68,"ion-label",22),h._uU(69),h.ALo(70,"translate"),h.qZA(),h._UZ(71,"ion-textarea",25),h.qZA(),h.TgZ(72,"ion-item"),h.TgZ(73,"ion-label",22),h._uU(74),h.ALo(75,"translate"),h.qZA(),h.TgZ(76,"ion-input",26),h.NdJ("ionChange",function(){return e.search(e.form.controls.seed_supplier.value)}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(77,"ion-list",27),h.YNc(78,qi,10,5,"ion-item",7),h.YNc(79,xi,10,5,"ion-item",28),h.ALo(80,"async"),h.YNc(81,Oi,4,1,"ion-item",7),h.YNc(82,Di,5,3,"ion-item",21),h.qZA(),h.YNc(83,Si,2,1,"ion-list",29),h.TgZ(84,"div",6),h.YNc(85,Ci,2,0,"div",7),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,34,"CROP_MOD.CROP_STOCKING")),h.xp6(3),h.Q6J("disabled",e.form.invalid||e.totalCost<e.numberFormatPayed.realValue),h.xp6(1),h.hij(" ",h.lcZ(11,36,"SAVE")," "),h.xp6(2),h.Q6J("formGroup",e.form),h.xp6(2),h.Q6J("ngIf",e.savingFlag.pending),h.xp6(1),h.Q6J("data",e.dataUpload),h.xp6(4),h.Oqu(h.lcZ(20,38,"DATE")),h.xp6(2),h.Q6J("displayFormat",h.lcZ(22,40,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD")),h.xp6(6),h.Oqu(h.lcZ(28,42,"QUANTITY")),h.xp6(2),h.Q6J("value",e.numberFormatQuantity.fakeView),h.xp6(4),h.Oqu(h.lcZ(34,44,"UNIT")),h.xp6(4),h.Oqu(h.lcZ(38,46,"PCS")),h.xp6(4),h.Q6J("hidden","con"!=e.form.controls.unit.value),h.xp6(2),h.lnq("",h.lcZ(44,48,"PRICE")," (",h.lcZ(45,50,"CURRENCY_S"),"/",h.lcZ(46,52,"PCS"),")"),h.xp6(5),h.Q6J("hidden","kg"!=e.form.controls.unit.value),h.xp6(2),h.AsE("",h.lcZ(51,54,"PRICE")," (",h.lcZ(52,56,"CURRENCY_S"),"/kg)"),h.xp6(4),h.Q6J("ngIf",(e.form.value.seed_cost_kg>0||e.form.value.seed_cost_individuals>0)&&e.numberFormatQuantity.realValue>0&&e.settingService.showDebt),h.xp6(1),h.Q6J("ngIf",e.totalCost<e.numberFormatPayed.realValue&&e.settingService.showDebt),h.xp6(3),h.AsE("",h.lcZ(59,58,"WEIGHT")," (g/",h.lcZ(60,60,"PCS"),")"),h.xp6(6),h.Oqu(h.lcZ(65,62,"CROP_MOD.DATE_OLD")),h.xp6(5),h.Oqu(h.lcZ(70,64,"NOTE")),h.xp6(5),h.Oqu(h.lcZ(75,66,"SUPPLIER")),h.xp6(4),h.Q6J("ngIf",e.manufacturerSelected),h.xp6(1),h.Q6J("ngForOf",h.lcZ(80,68,e.manufacturer$)),h.xp6(2),h.Q6J("ngIf",e.message),h.xp6(1),h.Q6J("ngIf",e.settingService.showDebt),h.xp6(1),h.Q6J("ngIf",e.settingService.showDebt),h.xp6(2),h.Q6J("ngIf",e.loadingFlag.pending))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,o.JL,o.sg,n.O5,Ai.k,a.jY,a.Ie,a.Q$,a.x4,a.QI,o.JJ,o.u,a.Nd,a.wI,a.pK,a.j9,o.Q7,a.t9,a.n0,a.g2,a.q_,n.sg,a.PQ,a.yW],pipes:[g.X$,n.Ov,n.JJ],styles:[""]}),t})();function Ni(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",31),h.qZA())}function Ei(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item",32),h.TgZ(1,"ion-label",23),h._uU(2),h.ALo(3,"translate"),h.TgZ(4,"ion-text",33),h._uU(5),h.ALo(6,"translate"),h.ALo(7,"number"),h.ALo(8,"translate"),h.qZA(),h.qZA(),h.TgZ(9,"ion-input",34),h.NdJ("ionFocus",function(){return h.CHM(t),h.oxw(2).setAmountPayed()})("ionChange",function(e){return h.CHM(t),h.oxw(2).numberFormatPayed.setValue(e.detail.value)}),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(2);h.xp6(2),h.Oqu(h.lcZ(3,5,"MONEY_MOD.PAYED")),h.xp6(3),h.lnq("(",h.lcZ(6,7,"SHOP.CART.TOTAL")," ",h.lcZ(7,9,t.totalCost),"",h.lcZ(8,11,"CURRENCY_S"),")"),h.xp6(4),h.Q6J("value",t.numberFormatPayed.fakeView)}}function Mi(t,e){1&t&&(h.TgZ(0,"ion-item",32),h.TgZ(1,"ion-text",35),h._uU(2," Chi ph\xed \u0111\xe3 tr\u1ea3 lu\xf4n nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng chi ph\xed "),h.qZA(),h.qZA())}function Ii(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",36),h.TgZ(2,"ion-label",37),h.TgZ(3,"h3"),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._uU(6),h.qZA(),h.qZA(),h.TgZ(7,"ion-button",38),h.NdJ("click",function(){return h.CHM(t),h.oxw(2).removeSelected()}),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(2);h.xp6(4),h.Oqu(t.manufacturerSelected.name),h.xp6(2),h.Oqu(t.manufacturerSelected.fullname),h.xp6(2),h.hij(" ",h.lcZ(9,3,"DELETE")," ")}}function wi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",36),h.TgZ(2,"ion-label"),h.TgZ(3,"h3"),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._uU(6),h.qZA(),h.qZA(),h.TgZ(7,"ion-button",39),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).onSelect(e)}),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(4),h.Oqu(t.name),h.xp6(2),h.Oqu(t.fullname),h.xp6(2),h.hij(" ",h.lcZ(9,3,"SELECT")," ")}}function Ui(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h.TgZ(2,"p"),h._uU(3),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.xp6(3),h.Oqu(t.message)}}function Pi(t,e){1&t&&(h.TgZ(0,"ion-item",32),h.TgZ(1,"ion-label",23),h._uU(2),h.ALo(3,"translate"),h.qZA(),h._UZ(4,"ion-input",40),h.qZA()),2&t&&(h.xp6(2),h.Oqu(h.lcZ(3,1,"MONEY_MOD.CUSTOMER")))}function Ri(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-text"),h._uU(2),h.qZA(),h.TgZ(3,"ion-button",39),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(3).setCustomerName(e.customer_name)}),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(2),h.hij(" ",t.customer_name," "),h.xp6(2),h.hij(" ",h.lcZ(5,2,"SELECT")," ")}}function ki(t,e){if(1&t&&(h.TgZ(0,"ion-list",28),h.YNc(1,Ri,6,4,"ion-item",29),h.qZA()),2&t){const t=h.oxw(2);h.xp6(1),h.Q6J("ngForOf",t.listCustomer)}}function Yi(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",31),h.qZA())}function Li(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-content",6),h.TgZ(1,"div",7),h.YNc(2,Ni,2,0,"div",8),h.qZA(),h.TgZ(3,"app-image-picker",9),h.NdJ("toUpload",function(e){return h.CHM(t),h.oxw().dataUpload=e}),h.qZA(),h.TgZ(4,"ion-grid"),h.TgZ(5,"ion-item"),h.TgZ(6,"ion-label",10),h._uU(7),h.ALo(8,"translate"),h.qZA(),h._UZ(9,"ion-datetime",11),h.ALo(10,"translate"),h.qZA(),h.TgZ(11,"ion-row"),h.TgZ(12,"ion-col",12),h.TgZ(13,"ion-item"),h.TgZ(14,"ion-label",13),h._uU(15),h.ALo(16,"translate"),h.qZA(),h.TgZ(17,"ion-input",14),h.NdJ("ionChange",function(e){h.CHM(t);const i=h.oxw();return i.numberFormatQuantity.setValue(e.detail.value),i.setAmountPayed()}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(18,"ion-col",15),h.TgZ(19,"ion-item"),h.TgZ(20,"ion-label",13),h._uU(21),h.ALo(22,"translate"),h.qZA(),h.TgZ(23,"ion-select",16),h.NdJ("ionChange",function(){return h.CHM(t),h.oxw().setAmountPayed()}),h.TgZ(24,"ion-select-option",17),h._uU(25),h.ALo(26,"translate"),h.qZA(),h.TgZ(27,"ion-select-option",18),h._uU(28,"kg"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(29,"ion-item",19),h.TgZ(30,"ion-label",13),h._uU(31),h.ALo(32,"translate"),h.ALo(33,"translate"),h.ALo(34,"translate"),h.qZA(),h.TgZ(35,"ion-input",20),h.NdJ("ionChange",function(){return h.CHM(t),h.oxw().setAmountPayed()}),h.qZA(),h.qZA(),h.TgZ(36,"ion-item",19),h.TgZ(37,"ion-label",13),h._uU(38),h.ALo(39,"translate"),h.ALo(40,"translate"),h.qZA(),h.TgZ(41,"ion-input",21),h.NdJ("ionChange",function(){return h.CHM(t),h.oxw().setAmountPayed()}),h.qZA(),h.qZA(),h.YNc(42,Ei,10,13,"ion-item",22),h.YNc(43,Mi,3,0,"ion-item",22),h.TgZ(44,"ion-item"),h.TgZ(45,"ion-label",23),h._uU(46),h.ALo(47,"translate"),h.ALo(48,"translate"),h.qZA(),h._UZ(49,"ion-input",24),h.qZA(),h.TgZ(50,"ion-item"),h.TgZ(51,"ion-label",23),h._uU(52),h.ALo(53,"translate"),h.qZA(),h._UZ(54,"ion-input",25),h.qZA(),h.TgZ(55,"ion-item"),h.TgZ(56,"ion-label",23),h._uU(57),h.ALo(58,"translate"),h.qZA(),h._UZ(59,"ion-textarea",26),h.qZA(),h.TgZ(60,"ion-item"),h.TgZ(61,"ion-label",23),h._uU(62),h.ALo(63,"translate"),h.qZA(),h.TgZ(64,"ion-input",27),h.NdJ("ionChange",function(){h.CHM(t);const e=h.oxw();return e.search(e.form.controls.seed_supplier.value)}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(65,"ion-list",28),h.YNc(66,Ii,10,5,"ion-item",8),h.YNc(67,wi,10,5,"ion-item",29),h.ALo(68,"async"),h.YNc(69,Ui,4,1,"ion-item",8),h.YNc(70,Pi,5,3,"ion-item",22),h.qZA(),h.YNc(71,ki,2,1,"ion-list",30),h.TgZ(72,"div",7),h.YNc(73,Yi,2,0,"div",8),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.Q6J("formGroup",t.form),h.xp6(2),h.Q6J("ngIf",t.savingFlag.pending),h.xp6(1),h.Q6J("data",t.dataUpload),h.xp6(4),h.Oqu(h.lcZ(8,31,"DATE")),h.xp6(2),h.Q6J("displayFormat",h.lcZ(10,33,"FORMAT_DATE_MOMENT"))("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD")),h.xp6(6),h.Oqu(h.lcZ(16,35,"QUANTITY")),h.xp6(2),h.Q6J("value",t.numberFormatQuantity.fakeView),h.xp6(4),h.Oqu(h.lcZ(22,37,"UNIT")),h.xp6(4),h.Oqu(h.lcZ(26,39,"PCS")),h.xp6(4),h.Q6J("hidden","con"!=t.form.controls.unit.value),h.xp6(2),h.lnq("",h.lcZ(32,41,"PRICE")," (",h.lcZ(33,43,"CURRENCY_S"),"/",h.lcZ(34,45,"PCS"),")"),h.xp6(5),h.Q6J("hidden","kg"!=t.form.controls.unit.value),h.xp6(2),h.AsE("",h.lcZ(39,47,"PRICE")," (",h.lcZ(40,49,"CURRENCY_S"),"/kg)"),h.xp6(4),h.Q6J("ngIf",(t.form.value.seed_cost_kg>0||t.form.value.seed_cost_individuals>0)&&t.numberFormatQuantity.realValue>0&&t.settingService.showDebt),h.xp6(1),h.Q6J("ngIf",t.totalCost<t.numberFormatPayed.realValue),h.xp6(3),h.AsE("",h.lcZ(47,51,"WEIGHT")," (g/",h.lcZ(48,53,"PCS"),")"),h.xp6(6),h.Oqu(h.lcZ(53,55,"CROP_MOD.DATE_OLD")),h.xp6(5),h.Oqu(h.lcZ(58,57,"NOTE")),h.xp6(5),h.Oqu(h.lcZ(63,59,"SUPPLIER")),h.xp6(4),h.Q6J("ngIf",t.manufacturerSelected),h.xp6(1),h.Q6J("ngForOf",h.lcZ(68,61,t.manufacturer$)),h.xp6(2),h.Q6J("ngIf",t.message),h.xp6(1),h.Q6J("ngIf",t.settingService.showDebt),h.xp6(1),h.Q6J("ngIf",t.settingService.showDebt),h.xp6(2),h.Q6J("ngIf",t.loadingFlag.pending)}}let Fi=(()=>{class t{constructor(t,e,i,n,s,a,r,l){this.modalController=t,this._formBuilder=e,this.toastService=i,this.pondService=n,this.translate=s,this.moneyService=a,this.dbLocalService=r,this.settingService=l,this.loadingFlag=new d.E,this.savingFlag=new d.E,this.numberFormatPrice=new it.y(""),this.numberFormatQuantity=new it.y(""),this.numberFormatPayed=new it.y(""),this.minDate=u().subtract(180,"days"),this.maxDate=u(),this.searchTerms=new ht.xQ,this.message="",this.show=!1,this.form=this._formBuilder.group({seed_quantity:["",o.kI.required],seed_quantity_individuals:[""],seed_supplier:[""],seed_supplier_id:[""],seed_old:[""],seed_cost:[""],seed_cost_individuals:[""],seed_cost_kg:[""],seed_weight:[""],note:[""],seed_date:u().format("YYYY-MM-DD"),unit:["con"],customer:[""],amounts_payed:[""]}),this.listCustomer=[],this.dataUpload={path:"",name:"",base:"",file:null},this.totalCost=0}ngOnInit(){this.item.seed_cost=parseFloat(this.item.seed_cost.toString().replace(",",".")),this.numberFormatQuantity.setValue(this.item.seed_quantity),this.numberFormatPrice.setValue(this.item.seed_cost),this.createForm(),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.form.get("customer").valueChanges.pipe((0,pt.b)(300),(0,mt.x)()).subscribe(t=>{this.getListCustomer()});let t=this.searchTerms.pipe((0,pt.b)(300),(0,mt.x)(),(0,Zt.w)(t=>this.getListManufacturer(t)));this.manufacturer$=t,this.manufacturer$.subscribe(t=>{this.message=t.length>0?"":this.translate.instant("POND_MOD.NO_INFOR"),this.loadingFlag.setResult(!0)});const e=this.dbLocalService.farms.findIndex(t=>t.infor.id==this.pondService.pond.farm_id);e>=0&&this.moneyService.setCode(this.dbLocalService.farms[e].infor.code),this.getBill()}search(t){this.searchTerms.next(t)}getListCustomer(){this.listCustomer=[],this.moneyService.searchCustomer(this.form.value.customer,"").subscribe(t=>{1==t.status&&(this.listCustomer=t.data.filter(t=>t.customer_name!=this.form.value.customer),console.log(this.listCustomer))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}setCustomerName(t){this.form.patchValue({customer:t})}setAmountPayed(){"kg"==this.form.controls.unit.value?(console.log(this.form.controls.seed_weight.value),this.numberFormatPayed.setValue(this.form.value.seed_cost_kg*this.numberFormatQuantity.realValue)):this.numberFormatPayed.setValue(this.numberFormatQuantity.realValue*this.form.value.seed_cost_individuals),this.totalCost=this.numberFormatPayed.realValue}getListManufacturer(t){return this.loadingFlag.setPending(!0),t.trim()?this.pondService.searchManufacturer(t).pipe((0,Zi.U)(t=>t.data.filter(t=>!this.manufacturerSelected||t.id!=this.manufacturerSelected.id))):(this.loadingFlag.setResult(!0),this.message="",(0,gt.of)([]))}createForm(){this.numberFormatQuantity.setValue(this.item.seed_quantity),this.numberFormatPrice.setValue(this.item.seed_cost),this.form.setValue({seed_quantity:this.numberFormatQuantity.fakeView,seed_quantity_individuals:"",seed_supplier:this.item.supplier,seed_supplier_id:this.item.supplier_id,seed_old:this.item.seed_old,seed_cost:this.numberFormatPrice.fakeView,seed_cost_individuals:+this.item.seed_cost,seed_cost_kg:"",seed_weight:this.item.seed_weight,note:this.item.note,seed_date:u(1e3*this.item.seed_date).format("YYYY-MM-DD"),unit:"con",customer:"",amounts_payed:""}),0!=+this.item.supplier_id&&(this.manufacturerSelected={id:this.item.supplier_id,fullname:this.item.supplier,name:""}),this.totalCost=this.item.seed_quantity*this.item.seed_cost,this.item.image&&(this.dataUpload.path=Ce.bl.FILE_PATH+"/upload/"+this.item.image)}onSave(){let t=!1,e={id:this.item.id,seed_quantity:this.numberFormatQuantity.realValue,seed_quantity_individuals:this.numberFormatQuantity.realValue,seed_supplier:this.form.value.seed_supplier,seed_supplier_id:this.form.value.seed_supplier_id,seed_old:this.form.value.seed_old,seed_cost:this.form.value.seed_cost,seed_cost_individuals:this.form.value.seed_cost_individuals.toString().replace(",","."),seed_cost_kg:this.form.value.seed_cost_kg.toString().replace(",","."),seed_weight:this.form.value.seed_weight,note:this.form.value.note,seed_date:u(this.form.value.seed_date).valueOf()/1e3,unit:this.form.value.unit,amounts_payed:this.numberFormatPayed.realValue,customer:this.form.value.customer,is_debt:this.settingService.showDebt?1:0};this.manufacturerSelected?(e.seed_supplier=this.manufacturerSelected.fullname,e.seed_supplier_id=this.manufacturerSelected.id):e.seed_supplier=this.form.value.seed_supplier,"kg"==this.form.controls.unit.value?(""!=this.form.controls.seed_weight.value?(e.seed_quantity_individuals=1e3*+e.seed_quantity/+e.seed_weight,e.seed_cost=e.seed_cost_kg*e.seed_weight/1e3):(this.form.controls.seed_weight.setValidators(o.kI.required),this.toastService.warning(this.translate.instant("POND_MOD.ERROR_SIZE")),t=!0),this.form.controls.seed_cost_kg.setValidators(o.kI.required)):(this.form.controls.seed_cost_individuals.setValidators(o.kI.required),e.seed_cost=this.form.value.seed_cost_individuals);let i=new FormData;for(let n in e)i.append(n,e[n]);this.dataUpload.file&&i.append("image",this.dataUpload.file),0==t&&(this.savingFlag.setPending(!0),this.pondService.reqSeasonSeedEdit(i,this.item.id).subscribe(t=>{1!=t.error?(this.toastService.warning(t.message),this.savingFlag.setResult(!0),this.modalController.dismiss(e)):(this.toastService.success(t.message),this.savingFlag.setResult(!1))},()=>{this.savingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))}))}onSelect(t){console.log(t),this.manufacturerSelected=t,this.form.controls.seed_supplier.setValue(t.fullname),this.form.controls.seed_supplier_id.setValue(t.id)}ionViewDidEnter(){this.show=!0}removeSelected(){this.manufacturerSelected=null,this.form.controls.seed_supplier.setValue(""),this.form.controls.seed_supplier_id.setValue("")}getBill(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.moneyService.getBillByAlias("seed_cost_"+this.item.id,"out").toPromise();t&&1==+t.status&&(this.numberFormatPayed.setValue(t.data.amounts_payed),this.form.patchValue({amounts_payed:this.numberFormatPayed.fakeView,customer:t.data.customer_name}),t.data.image&&(this.dataUpload.path=Ce.bl.FILE_PATH+"/upload/"+t.data.image))})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(o.qu),h.Y36(A.k),h.Y36(c.p),h.Y36(g.sK),h.Y36(fi.r),h.Y36(nt.T),h.Y36(I.R))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-season-seed-edit"]],decls:13,vars:8,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"ion-text-center"],[4,"ngIf"],[3,"data","toUpload"],["color","primary"],["formControlName","seed_date",3,"displayFormat","min","max"],["size","8"],["color","primary","position","floating"],["required","","formControlName","seed_quantity","type","tel","inputmode","numeric",3,"value","ionChange"],["size","4"],["formControlName","unit",3,"ionChange"],["value","con"],["value","kg"],[3,"hidden"],["formControlName","seed_cost_individuals","type","tel","inputmode","decimal",3,"ionChange"],["formControlName","seed_cost_kg","type","tel","inputmode","decimal",3,"ionChange"],["lines","inset",4,"ngIf"],["position","floating"],["formControlName","seed_weight","type","tel","inputmode","decimal"],["formControlName","seed_old","type","tel","inputmode","decimal"],["rows","2","formControlName","note"],["formControlName","seed_supplier",3,"ionChange"],["lines","none"],[4,"ngFor","ngForOf"],["lines","none",4,"ngIf"],["name","dots"],["lines","inset"],["color","success"],["formControlName","amounts_payed","type","tel","inputmode","numeric",3,"value","ionFocus","ionChange"],["color","danger"],["name","business","slot","start"],[1,"ion-text-wrap"],["color","danger","slot","end",3,"click"],["slot","end",3,"click"],["formControlName","customer"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalController.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.onSave()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(12,Li,74,63,"ion-content",5)),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,4,"CROP_MOD.CROP_STOCKING_EDIT")),h.xp6(3),h.Q6J("disabled",(null==e.form?null:e.form.invalid)||e.totalCost<e.numberFormatPayed.realValue),h.xp6(1),h.hij(" ",h.lcZ(11,6,"SAVE")," "),h.xp6(2),h.Q6J("ngIf",e.show))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,n.O5,a.W2,o.JL,o.sg,Ai.k,a.jY,a.Ie,a.Q$,a.x4,a.QI,o.JJ,o.u,a.Nd,a.wI,a.pK,a.j9,o.Q7,a.t9,a.n0,a.g2,a.q_,n.sg,a.PQ,a.yW],pipes:[g.X$,n.Ov,n.JJ],styles:[""]}),t})();function Ji(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",32),h.qZA())}function Qi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",33),h.TgZ(2,"ion-label",34),h.TgZ(3,"h3"),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._uU(6),h.qZA(),h.qZA(),h.TgZ(7,"ion-button",35),h.NdJ("click",function(){return h.CHM(t),h.oxw(2).onRemove()}),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(2);h.xp6(4),h.Oqu(t.buyerSelected.name),h.xp6(2),h.Oqu(t.buyerSelected.fullname),h.xp6(2),h.hij(" ",h.lcZ(9,3,"DELETE")," ")}}function Vi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",33),h.TgZ(2,"ion-label"),h.TgZ(3,"h3"),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._uU(6),h.qZA(),h.qZA(),h.TgZ(7,"ion-button",36),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).onSelect(e)}),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(4),h.Oqu(t.name),h.xp6(2),h.Oqu(t.fullname),h.xp6(2),h.hij(" ",h.lcZ(9,3,"SELECT")," ")}}function ji(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h.TgZ(2,"p"),h._uU(3),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.xp6(3),h.Oqu(t.message)}}function Hi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item",37),h.TgZ(1,"ion-label",22),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"ion-input",38),h.NdJ("ionFocus",function(){return h.CHM(t),h.oxw(2).setAmountPayed()})("ionChange",function(e){return h.CHM(t),h.oxw(2).numberFormatPayed.setValue(e.detail.value)}),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(2);h.xp6(2),h.Oqu(h.lcZ(3,2,"MONEY_MOD.PAYED")),h.xp6(2),h.Q6J("value",t.numberFormatPayed.fakeView)}}function Gi(t,e){1&t&&(h.TgZ(0,"ion-item",37),h.TgZ(1,"ion-text",39),h._uU(2," Chi ph\xed \u0111\xe3 tr\u1ea3 lu\xf4n nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng chi ph\xed "),h.qZA(),h.qZA())}function Bi(t,e){1&t&&(h.TgZ(0,"ion-item",37),h.TgZ(1,"ion-label",22),h._uU(2),h.ALo(3,"translate"),h.qZA(),h._UZ(4,"ion-input",40),h.qZA()),2&t&&(h.xp6(2),h.Oqu(h.lcZ(3,1,"MONEY_MOD.CUSTOMER")))}function zi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-text"),h._uU(2),h.qZA(),h.TgZ(3,"ion-button",36),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(3).setCustomerName(e.customer_name)}),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(2),h.hij(" ",t.customer_name," "),h.xp6(2),h.hij(" ",h.lcZ(5,2,"SELECT")," ")}}function $i(t,e){if(1&t&&(h.TgZ(0,"ion-list",27),h.YNc(1,zi,6,4,"ion-item",28),h.qZA()),2&t){const t=h.oxw(2);h.xp6(1),h.Q6J("ngForOf",t.listCustomer)}}function Wi(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",32),h.qZA())}function Xi(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-content",6),h.TgZ(1,"div",7),h.YNc(2,Ji,2,0,"div",8),h.qZA(),h.TgZ(3,"app-image-picker",9),h.NdJ("toUpload",function(e){return h.CHM(t),h.oxw().dataUpload=e}),h.qZA(),h.TgZ(4,"div",10),h.TgZ(5,"h1"),h._uU(6),h.ALo(7,"date"),h.ALo(8,"translate"),h.qZA(),h.TgZ(9,"h3"),h._uU(10),h.ALo(11,"translate"),h.ALo(12,"translate"),h.qZA(),h.qZA(),h.TgZ(13,"ion-grid"),h.TgZ(14,"ion-row"),h.TgZ(15,"ion-col",11),h.TgZ(16,"ion-item"),h.TgZ(17,"ion-label",12),h._uU(18),h.ALo(19,"translate"),h.qZA(),h.TgZ(20,"ion-input",13),h.NdJ("ionInput",function(e){return h.CHM(t),h.oxw().checkChange("size",e)}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(21,"ion-col",14),h.TgZ(22,"ion-item"),h.TgZ(23,"ion-label",12),h._uU(24),h.ALo(25,"translate"),h.qZA(),h.TgZ(26,"ion-select",15),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().checkChange("unit",e)}),h.TgZ(27,"ion-select-option",16),h._uU(28),h.ALo(29,"translate"),h.qZA(),h.TgZ(30,"ion-select-option",17),h._uU(31),h.ALo(32,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(33,"ion-row"),h.TgZ(34,"ion-col",18),h.TgZ(35,"ion-item"),h.TgZ(36,"ion-label",19),h._uU(37),h.ALo(38,"translate"),h.qZA(),h.TgZ(39,"ion-input",20),h.NdJ("input",function(e){return h.CHM(t),h.oxw().checkChange("quantity",e)}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(40,"ion-col",18),h.TgZ(41,"ion-item"),h.TgZ(42,"ion-label",19),h._uU(43),h.ALo(44,"translate"),h.ALo(45,"translate"),h.qZA(),h.TgZ(46,"ion-input",21),h.NdJ("ionChange",function(e){h.CHM(t);const i=h.oxw();return i.numberFormatPrice.setValue(e.detail.value),i.setAmountPayed()}),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(47,"ion-item"),h.TgZ(48,"ion-label",22),h._uU(49),h.ALo(50,"translate"),h.qZA(),h.TgZ(51,"ion-input",23),h.NdJ("ionInput",function(e){return h.CHM(t),h.oxw().checkChange("ratio",e)}),h.qZA(),h.qZA(),h.TgZ(52,"ion-item"),h.TgZ(53,"ion-label",22),h._uU(54),h.ALo(55,"translate"),h.ALo(56,"translate"),h.qZA(),h.TgZ(57,"ion-input",24),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().numberFormatCost.setValue(e.detail.value)}),h.qZA(),h.qZA(),h.TgZ(58,"ion-item"),h.TgZ(59,"ion-label",22),h._uU(60),h.ALo(61,"translate"),h.qZA(),h._UZ(62,"ion-textarea",25),h.qZA(),h.TgZ(63,"ion-item"),h.TgZ(64,"ion-label",22),h._uU(65),h.ALo(66,"translate"),h.qZA(),h.TgZ(67,"ion-input",26),h.NdJ("ionChange",function(){h.CHM(t);const e=h.oxw();return e.search(e.form.controls.buyer.value)}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(68,"ion-list",27),h.YNc(69,Qi,10,5,"ion-item",8),h.YNc(70,Vi,10,5,"ion-item",28),h.ALo(71,"async"),h.YNc(72,ji,4,1,"ion-item",8),h.qZA(),h.TgZ(73,"ion-list"),h.TgZ(74,"ion-item",27),h.TgZ(75,"ion-label"),h._uU(76),h.ALo(77,"translate"),h.qZA(),h.TgZ(78,"span"),h.TgZ(79,"ion-text",29),h._uU(80),h.ALo(81,"number"),h.qZA(),h._uU(82),h.ALo(83,"translate"),h.qZA(),h.qZA(),h.YNc(84,Hi,5,4,"ion-item",30),h.YNc(85,Gi,3,0,"ion-item",30),h.YNc(86,Bi,5,3,"ion-item",30),h.YNc(87,$i,2,1,"ion-list",31),h.qZA(),h.TgZ(88,"div",7),h.YNc(89,Wi,2,0,"div",8),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.Q6J("formGroup",t.form),h.xp6(2),h.Q6J("ngIf",t.savingFlag.pending),h.xp6(1),h.Q6J("data",t.dataUpload),h.xp6(3),h.Oqu(h.xi3(7,33,1e3*t.item.harvest_date,h.lcZ(8,36,"FORMAT_DATE"))),h.xp6(4),h.lnq("",h.lcZ(11,38,"LIFE-RATIO.SEED")," ",t.seed_quantity," ",h.lcZ(12,40,"PCS"),""),h.xp6(8),h.Oqu(h.lcZ(19,42,"SIZE")),h.xp6(6),h.Oqu(h.lcZ(25,44,"UNIT")),h.xp6(4),h.Oqu(h.lcZ(29,46,"PCS")),h.xp6(3),h.hij("g/",h.lcZ(32,48,"PCS"),""),h.xp6(6),h.hij("",h.lcZ(38,50,"CROP_MOD.HARVEST_QUANTITY")," (kg)"),h.xp6(2),h.Q6J("value",t.numberFormatQuantity.fakeView),h.xp6(4),h.AsE("",h.lcZ(44,52,"PRICE")," (",h.lcZ(45,54,"CURRENCY_S"),")"),h.xp6(3),h.Q6J("value",t.numberFormatPrice.fakeView),h.xp6(3),h.hij("",h.lcZ(50,56,"CROP_MOD.HARVEST_RATIO")," (%)"),h.xp6(5),h.AsE("",h.lcZ(55,58,"CROP_MOD.HARVEST_COST")," (",h.lcZ(56,60,"CURRENCY_S"),")"),h.xp6(3),h.Q6J("value",t.numberFormatCost.fakeView),h.xp6(3),h.Oqu(h.lcZ(61,62,"NOTE")),h.xp6(5),h.Oqu(h.lcZ(66,64,"CROP_MOD.HARVEST_CUSTOMER")),h.xp6(4),h.Q6J("ngIf",t.buyerSelected),h.xp6(1),h.Q6J("ngForOf",h.lcZ(71,66,t.manufacturer$)),h.xp6(2),h.Q6J("ngIf",t.message),h.xp6(4),h.Oqu(h.lcZ(77,68,"REVENUE")),h.xp6(4),h.Oqu(h.xi3(81,70,t.numberFormatPrice.realValue*t.numberFormatQuantity.realValue,"0.0-0")),h.xp6(2),h.hij(" ",h.lcZ(83,73,"CURRENCY_S"),""),h.xp6(2),h.Q6J("ngIf",t.settingService.showDebt),h.xp6(1),h.Q6J("ngIf",t.numberFormatPrice.realValue*t.numberFormatQuantity.realValue<t.numberFormatPayed.realValue&&t.settingService.showDebt),h.xp6(1),h.Q6J("ngIf",t.settingService.showDebt),h.xp6(1),h.Q6J("ngIf",t.settingService.showDebt),h.xp6(2),h.Q6J("ngIf",t.loadingFlag.pending)}}let Ki=(()=>{class t{constructor(t,e,i,n,o,s,a,r){this.modalController=t,this._formBuilder=e,this.toastService=i,this.pondService=n,this.translate=o,this.dbLocalService=s,this.moneyService=a,this.settingService=r,this.loadingFlag=new d.E,this.savingFlag=new d.E,this.numberFormatPrice=new it.y(""),this.numberFormatQuantity=new it.y(""),this.numberFormatCost=new it.y(""),this.numberFormatPayed=new it.y(""),this.minDate=u().subtract(180,"days"),this.maxDate=u(),this.searchTerms=new ht.xQ,this.message="",this.seed_quantity=0,this.dataUpload={path:"",name:"",base:"",file:null},this.listCustomer=[]}ngOnInit(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.getInfomation(),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.form.get("customer").valueChanges.pipe((0,pt.b)(300),(0,mt.x)()).subscribe(t=>{this.getListCustomer()});let t=this.searchTerms.pipe((0,pt.b)(300),(0,mt.x)(),(0,Zt.w)(t=>this.getListManufacturer(t)));this.manufacturer$=t,this.manufacturer$.subscribe(t=>{this.message=t.length>0?"":this.translate.instant("POND_MOD.NO_INFOR"),this.loadingFlag.setResult(!0)});const e=this.dbLocalService.farms.findIndex(t=>t.infor.id==this.pondService.pond.farm_id);e>=0&&this.moneyService.setCode(this.dbLocalService.farms[e].infor.code),console.log(this.dbLocalService.farms[e].infor.code)})}getListCustomer(){this.listCustomer=[],this.moneyService.searchCustomer(this.form.value.customer,"").subscribe(t=>{1==t.status&&(this.listCustomer=t.data.filter(t=>t.customer_name!=this.form.value.customer),console.log(this.listCustomer))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}setCustomerName(t){this.form.patchValue({customer:t})}setAmountPayed(){!this.numberFormatPrice.realValue||!this.numberFormatQuantity.realValue||this.numberFormatPayed.setValue(this.numberFormatPrice.realValue*this.numberFormatQuantity.realValue)}search(t){this.searchTerms.next(t)}getInfomation(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.pondService.reqSeasonCollectInfo(this.item.id).toPromise();t.data&&(this.item=t.data,this.buildForm())})}getListManufacturer(t){return this.loadingFlag.setPending(!0),t.trim()?this.pondService.searchManufacturer(t).pipe((0,Zi.U)(t=>t.data)):(0,gt.of)([])}checkChange(t,e){if(this.form.value.size&&this.form.value.unit&&this.form.value.quantity){switch(t){case"unit":var i;i=(1e3/this.form.value.size).toFixed(0),this.form.patchValue({size:i});break;case"size":var n=this.seed_quantity*e.target.value/1e3*(this.form.value.harvest_ratio?this.form.value.harvest_ratio/100:1);"kg"==this.form.value.unit&&(n=this.seed_quantity/e.target.value*(this.form.value.harvest_ratio?this.form.value.harvest_ratio/100:1)),console.log(n),this.numberFormatQuantity.setValue(n.toFixed(0));break;case"quantity":this.numberFormatQuantity.setValue(e.target.value),this.getRatio();break;case"ratio":let t=e.target.value;if(!t)break;n=this.seed_quantity*this.form.value.size/1e3*(t?t/100:1),"kg"==this.form.value.unit&&(n=this.seed_quantity/this.form.value.size*(t?t/100:1)),console.log(n),this.numberFormatQuantity.setValue(n.toFixed(0))}this.setAmountPayed()}}getRatio(){if(this.form.value.size&&this.form.value.unit){console.log(this.numberFormatQuantity);var t=1e3*this.numberFormatQuantity.realValue/this.form.value.size*100/this.seed_quantity;"kg"==this.form.value.unit&&(t=100*this.numberFormatQuantity.realValue*this.form.value.size/this.seed_quantity),console.log(t),this.form.patchValue({harvest_ratio:t.toFixed(0)})}}onSelect(t){this.buyerSelected=t,this.form.controls.buyer.setValue(t.fullname),this.form.controls.buyer_id.setValue(t.id)}buildForm(){this.numberFormatQuantity.setValue(this.item.harvest_quantity),this.numberFormatPrice.setValue(this.item.harvest_price),this.numberFormatCost.setValue(this.item.harvest_cost),this.form=this._formBuilder.group({method:[this.item.method],quantity:[this.item.harvest_quantity,o.kI.required],price:[this.item.harvest_price,o.kI.required],size:[this.item.harvest_size,o.kI.required],buyer:[this.item.buyer],buyer_id:[this.item.buyer_id],harvest_cost:[this.item.harvest_cost],note:[this.item.note],unit:["con",o.kI.required],harvest_ratio:[this.item.ratio,o.kI.required],customer:[""],amounts_payed:[""]}),this.seed_quantity=(100*this.item.harvest_quantity*(1e3/this.item.harvest_size)/this.item.ratio).toFixed(),this.item.image&&(this.dataUpload.path=Ce.bl.FILE_PATH+"/upload/"+this.item.image),this.getBill()}onSave(){if(this.validateAllFormFields(this.form),this.form.invalid)return!1;"kg"==this.form.value.unit&&(this.form.value.size=(1e3/this.form.value.size).toFixed(2),this.form.value.unit="con");const t={method:this.form.value.method,quantity:this.numberFormatQuantity.realValue,price:this.numberFormatPrice.realValue,size:this.form.value.size,buyer:this.form.value.buyer,buyer_id:this.form.value.buyer_id,harvest_cost:this.form.value.harvest_cost,harvest_ratio:this.form.value.harvest_ratio,note:this.form.value.note,customer:this.form.value.customer,amounts_payed:this.numberFormatPayed.realValue,is_debt:this.settingService.showDebt?1:0};let e=new FormData;for(let i in t)e.append(i,t[i]);this.dataUpload.file&&e.append("image",this.dataUpload.file),this.savingFlag.setPending(!0),this.pondService.reqSeasonCollectEdit(e,this.item.id).subscribe(t=>{1==t.status?(this.toastService.success(t.message),this.modalController.dismiss(this.form.value),this.savingFlag.setResult(!0)):(this.toastService.warning(t.message),this.savingFlag.setResult(!1))},()=>{this.savingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}validateAllFormFields(t){Object.keys(t.controls).forEach(e=>{const i=t.get(e);i instanceof o.NI?i.markAsTouched({onlySelf:!0}):i instanceof o.cw&&this.validateAllFormFields(i)})}onRemove(){this.buyerSelected=null,this.form.controls.buyer.setValue(""),this.form.controls.buyer_id.setValue("")}getBill(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.moneyService.getBillByAlias("harvest_amounts_"+this.item.id,"in").toPromise();t&&1==+t.status&&(this.numberFormatPayed.setValue(t.data.amounts_payed),this.form.patchValue({amounts_payed:this.numberFormatPayed.fakeView,customer:t.data.customer_name}),t.data.image&&(this.dataUpload.path=Ce.bl.FILE_PATH+"/upload/"+t.data.image))})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(o.qu),h.Y36(A.k),h.Y36(c.p),h.Y36(g.sK),h.Y36(nt.T),h.Y36(fi.r),h.Y36(I.R))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-season-harvest-edit"]],inputs:{item:"item"},decls:13,vars:8,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"ion-text-center"],[4,"ngIf"],[3,"data","toUpload"],[1,"ion-text-center","ion-padding"],["size","8"],["color","primary","position","floating"],["required","","formControlName","size","type","tel","inputmode","decimal",3,"ionInput"],["size","4"],["formControlName","unit","required","",3,"ionChange"],["value","kg"],["value","con"],["size","6"],["position","floating","color","primary"],["formControlName","quantity","type","tel","inputmode","decimal","required","",3,"value","input"],["formControlName","price","type","tel","inputmode","decimal","required","",3,"value","ionChange"],["position","floating"],["formControlName","harvest_ratio","type","tel","inputmode","decimal",3,"ionInput"],["formControlName","harvest_cost","type","tel","inputmode","decimal",3,"value","ionChange"],["rows","2","formControlName","note"],["formControlName","buyer",3,"ionChange"],["lines","none"],[4,"ngFor","ngForOf"],["color","success"],["lines","inset",4,"ngIf"],["lines","none",4,"ngIf"],["name","dots"],["name","business","slot","start"],[1,"ion-text-wrap"],["color","danger","slot","end",3,"click"],["slot","end",3,"click"],["lines","inset"],["formControlName","amounts_payed","type","tel","inputmode","numeric",3,"value","ionFocus","ionChange"],["color","danger"],["formControlName","customer"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalController.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.onSave()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(12,Xi,90,75,"ion-content",5)),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,4,"CROP_MOD.HARVEST_EDIT")),h.xp6(3),h.Q6J("disabled",(null==e.form?null:e.form.invalid)||(null==e.form?null:e.form.value.harvest_ratio)>100||e.numberFormatPrice.realValue*e.numberFormatQuantity.realValue<e.numberFormatPayed.realValue),h.xp6(1),h.hij(" ",h.lcZ(11,6,"SAVE")," "),h.xp6(2),h.Q6J("ngIf",e.form))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,n.O5,a.W2,o.JL,o.sg,Ai.k,a.jY,a.Nd,a.wI,a.Ie,a.Q$,a.pK,a.j9,o.Q7,o.JJ,o.u,a.t9,a.QI,a.n0,a.g2,a.q_,n.sg,a.yW,a.PQ],pipes:[g.X$,n.uU,n.Ov,n.JJ],styles:[""]}),t})();function tn(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",35),h.qZA())}function en(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label",26),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"ion-input",36),h.NdJ("ionInput",function(e){return h.CHM(t),h.oxw().checkChange("ratio",e)}),h.qZA(),h.qZA()}2&t&&(h.xp6(2),h.hij("",h.lcZ(3,1,"CROP_MOD.HARVEST_RATIO")," (%)"))}function nn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",37),h.TgZ(2,"ion-label",38),h.TgZ(3,"h3"),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._uU(6),h.qZA(),h.qZA(),h.TgZ(7,"ion-button",39),h.NdJ("click",function(){return h.CHM(t),h.oxw().onRemove()}),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(4),h.Oqu(t.buyerSelected.name),h.xp6(2),h.Oqu(t.buyerSelected.fullname),h.xp6(2),h.hij(" ",h.lcZ(9,3,"DELETE")," ")}}function on(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",37),h.TgZ(2,"ion-label"),h.TgZ(3,"h3"),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._uU(6),h.qZA(),h.qZA(),h.TgZ(7,"ion-button",40),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw().onSelect(e)}),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(4),h.Oqu(t.name),h.xp6(2),h.Oqu(t.fullname),h.xp6(2),h.hij(" ",h.lcZ(9,3,"SELECT")," ")}}function sn(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h.TgZ(2,"p"),h._uU(3),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.Oqu(t.message)}}function an(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item",41),h.TgZ(1,"ion-label",26),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"ion-input",42),h.NdJ("ionFocus",function(){return h.CHM(t),h.oxw().setAmountPayed()})("ionChange",function(e){return h.CHM(t),h.oxw().numberFormatPayed.setValue(e.detail.value)}),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(2),h.Oqu(h.lcZ(3,2,"MONEY_MOD.PAYED")),h.xp6(2),h.Q6J("value",t.numberFormatPayed.fakeView)}}function rn(t,e){1&t&&(h.TgZ(0,"ion-item",41),h.TgZ(1,"ion-text",43),h._uU(2," Chi ph\xed \u0111\xe3 tr\u1ea3 lu\xf4n nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng chi ph\xed "),h.qZA(),h.qZA())}function ln(t,e){1&t&&(h.TgZ(0,"ion-item",41),h.TgZ(1,"ion-label",26),h._uU(2),h.ALo(3,"translate"),h.qZA(),h._UZ(4,"ion-input",44),h.qZA()),2&t&&(h.xp6(2),h.Oqu(h.lcZ(3,1,"MONEY_MOD.CUSTOMER")))}function cn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-text"),h._uU(2),h.qZA(),h.TgZ(3,"ion-button",40),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).setCustomerName(e.customer_name)}),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(2),h.hij(" ",t.customer_name," "),h.xp6(2),h.hij(" ",h.lcZ(5,2,"SELECT")," ")}}function dn(t,e){if(1&t&&(h.TgZ(0,"ion-list",30),h.YNc(1,cn,6,4,"ion-item",31),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.Q6J("ngForOf",t.listCustomer)}}function un(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",35),h.qZA())}let hn=(()=>{class t{constructor(t,e,i,n,s,a,r,l,c){this.modalController=t,this._formBuilder=e,this.toastService=i,this.pondService=n,this.translate=s,this.router=a,this.dbLocalService=r,this.moneyService=l,this.settingService=c,this.seed_quantity=0,this.weight={total_loss:0,weight:0},this.loadingFlag=new d.E,this.savingFlag=new d.E,this.numberFormatPrice=new it.y(""),this.numberFormatCost=new it.y(""),this.numberFormatQuantity=new it.y(""),this.numberFormatPayed=new it.y(""),this.minDate=u().subtract(180,"days"),this.maxDate=u(),this.searchTerms=new ht.xQ,this.message="",this.revenue=0,this.form=this._formBuilder.group({method:["",o.kI.required],quantity:["",o.kI.required],price:["",o.kI.required],size:["",o.kI.required],buyer:[""],buyer_id:[""],harvest_cost:[""],note:[""],unit:["",o.kI.required],harvest_ratio:["",[o.kI.min(1),o.kI.max(100)]],autoCalculator:[!0],customer:[""],amounts_payed:[""]}),this.dataUpload={path:"",name:"",base:"",file:null},this.listCustomer=[]}ngOnInit(){this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.form.get("customer").valueChanges.pipe((0,pt.b)(300),(0,mt.x)()).subscribe(t=>{this.getListCustomer()});let t=this.searchTerms.pipe((0,pt.b)(300),(0,mt.x)(),(0,Zt.w)(t=>this.getListManufacturer(t)));this.manufacturer$=t,this.manufacturer$.subscribe(t=>{this.message=t.length>0||this.buyerSelected?"":this.translate.instant("POND_MOD.NOT_FOUND"),this.loadingFlag.setResult(!0)});const e=this.dbLocalService.farms.findIndex(t=>t.infor.id==this.pondService.pond.farm_id);e>=0&&this.moneyService.setCode(this.dbLocalService.farms[e].infor.code),this.getWeight()}getListCustomer(){this.listCustomer=[],this.moneyService.searchCustomer(this.form.value.customer,"").subscribe(t=>{1==t.status&&(this.listCustomer=t.data.filter(t=>t.customer_name!=this.form.value.customer),console.log(this.listCustomer))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}setCustomerName(t){this.form.patchValue({customer:t})}setAmountPayed(){!this.numberFormatPrice.realValue||!this.numberFormatQuantity.realValue||this.numberFormatPayed.setValue(this.numberFormatPrice.realValue*this.numberFormatQuantity.realValue)}getWeight(){this.pondService.getWeight().subscribe(t=>{1==t.status?(this.weight={total_loss:t.data.total_loss?t.data.total_loss:0,weight:t.data.weight?t.data.weight:0},this.seedTimes.forEach(t=>{this.seed_quantity+=+t.seed_quantity}),this.harvestTimes.forEach(t=>{this.seed_quantity-=1e3*t.harvest_quantity/t.harvest_size}),this.moveTimes.forEach(t=>{t.to_season_code==this.pondService.pond.current_season?(this.seed_quantity+=+t.quantity_individual,t.weight>=this.weight.weight&&(this.weight.weight=t.weight)):this.seed_quantity-=t.quantity_individual}),this.form.patchValue({size:this.weight.weight,unit:"con",method:"end"}),this.numberFormatQuantity.setValue(((this.seed_quantity-this.weight.total_loss)*this.form.value.size/1e3).toFixed(0))):this.toastService.warning(t.message)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}search(t){this.searchTerms.next(t)}getListManufacturer(t){return this.loadingFlag.setPending(!0),t.trim()?this.pondService.searchManufacturer(t).pipe((0,Zi.U)(t=>t.data.filter(t=>!this.buyerSelected||t.id!=this.buyerSelected.id))):(this.message="",this.loadingFlag.setResult(!0),(0,gt.of)([]))}onSelect(t){this.buyerSelected=t,this.form.controls.buyer.setValue(t.fullname),this.form.controls.buyer_id.setValue(t.id),this.message=""}onRemove(){this.buyerSelected=null,this.form.controls.buyer.setValue(""),this.form.controls.buyer_id.setValue("")}validateAllFormFields(t){Object.keys(t.controls).forEach(e=>{const i=t.get(e);i instanceof o.NI?i.markAsTouched({onlySelf:!0}):i instanceof o.cw&&this.validateAllFormFields(i)})}checkChange(t,e){if(this.form.value.autoCalculator&&(this.form.value.size||this.form.value.quantity)){switch(t){case"method":var i=(this.seed_quantity-this.weight.total_loss)*(n=this.form.value.size)/1e3;"kg"==this.form.value.unit&&(i=(this.seed_quantity-this.weight.total_loss)/n),this.numberFormatQuantity.setValue(i.toFixed(0)),this.getRatio();break;case"unit":var n=this.form.value.size;n=(1e3/this.form.value.size).toFixed(0),this.form.patchValue({size:n}),this.getRatio();break;case"size":i=(this.seed_quantity-this.weight.total_loss)*e.target.value/1e3*(this.form.value.harvest_ratio?this.form.value.harvest_ratio/100:1),"kg"==this.form.value.unit&&(i=(this.seed_quantity-this.weight.total_loss)/e.target.value*(this.form.value.harvest_ratio?this.form.value.harvest_ratio/100:1)),this.form.patchValue({size:e.target.value}),this.numberFormatQuantity.setValue(i.toFixed(0));break;case"quantity":this.numberFormatQuantity.setValue(e.target.value),this.getRatio();break;case"ratio":let t=e.target.value;if(console.log(t),!t)break;i=(this.seed_quantity-this.weight.total_loss)*this.form.value.size/1e3*(t?t/100:1),"kg"==this.form.value.unit&&(i=(this.seed_quantity-this.weight.total_loss)/this.form.value.size*(t?t/100:1)),this.numberFormatQuantity.setValue(i.toFixed(0))}this.setAmountPayed()}}getRatio(){if(this.form.value.size&&this.form.value.unit){var t=1e3*this.numberFormatQuantity.realValue/this.form.value.size*100/(this.seed_quantity-this.weight.total_loss);"kg"==this.form.value.unit&&(t=100*this.numberFormatQuantity.realValue*this.form.value.size/(this.seed_quantity-this.weight.total_loss)),"end"==this.form.value.method&&(t=100),this.form.patchValue({harvest_ratio:t?t.toFixed(0):0})}}onSave(){if(this.validateAllFormFields(this.form),this.form.invalid)return!1;"kg"==this.form.value.unit&&(this.form.value.size=(1e3/this.form.value.size).toFixed(2),this.form.value.unit="con");const t={method:this.form.value.method,quantity:this.numberFormatQuantity.realValue,price:this.numberFormatPrice.realValue,size:this.form.value.size,buyer:this.form.value.buyer,buyer_id:this.form.value.buyer_id,harvest_cost:this.form.value.harvest_cost,harvest_ratio:this.form.value.harvest_ratio,note:this.form.value.note,customer:this.form.value.customer,amounts_payed:this.numberFormatPayed.realValue,is_debt:this.settingService.showDebt?1:0};let e=new FormData;for(let i in t)e.append(i,t[i]);this.dataUpload.file&&e.append("image",this.dataUpload.file),this.savingFlag.setPending(!0),this.pondService.reqSeasonCollect(e).subscribe(t=>{if(1==t.status){if(this.toastService.success(t.message),"end"==this.form.value.method){let t=this.dbLocalService.ponds.findIndex(t=>t.infor.code===this.pondService.pcode);if(t>=0){let e={infor:this.pondService.pond,devices:[]};e.infor.current_season="",e.infor.species_id=null,e.infor.species=null,e.infor.start_time=null,this.dbLocalService.updateItem("ponds",e,t)}this.pondService.seasonStart=!1,this.modalController.dismiss(this.form.value),this.router.navigateByUrl("pond/"+this.pondService.pcode+"/history")}else this.modalController.dismiss(this.form.value);this.savingFlag.setResult(!0)}else this.toastService.warning(t.message),this.savingFlag.setResult(!1)},()=>{this.savingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(o.qu),h.Y36(A.k),h.Y36(c.p),h.Y36(g.sK),h.Y36(s.F0),h.Y36(nt.T),h.Y36(fi.r),h.Y36(I.R))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-season-collect"]],inputs:{harvestTimes:"harvestTimes",seedTimes:"seedTimes",moveTimes:"moveTimes"},decls:105,vars:82,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],[3,"formGroup"],[1,"ion-text-center"],[4,"ngIf"],[3,"data","toUpload"],["formControlName","autoCalculator","mode","ios"],["color","primary"],["formControlName","method","required","",3,"placeholder","ionChange"],["value","end"],["value","keep"],["size","8"],["color","primary","position","floating"],["required","","formControlName","size","type","tel","inputmode","decimal","required","",3,"ionInput"],["size","4"],["color","primary","position","floating","required",""],["formControlName","unit",3,"ionChange"],["value","kg"],["value","con"],["size","6"],["position","floating","color","primary"],["formControlName","quantity","type","tel","inputmode","decimal","required","",3,"value","ionInput"],["formControlName","price","type","tel","inputmode","decimal","required","",3,"value","ionChange"],["position","floating"],["formControlName","harvest_cost","type","tel","inputmode","decimal",3,"value","ionChange"],["rows","2","formControlName","note"],["formControlName","buyer",3,"ionChange"],["lines","none"],[4,"ngFor","ngForOf"],["color","success"],["lines","inset",4,"ngIf"],["lines","none",4,"ngIf"],["name","dots"],["formControlName","harvest_ratio","type","tel","inputmode","decimal",3,"ionInput"],["name","business","slot","start"],[1,"ion-text-wrap"],["color","danger","slot","end",3,"click"],["slot","end",3,"click"],["lines","inset"],["formControlName","amounts_payed","type","tel","inputmode","numeric",3,"value","ionFocus","ionChange"],["color","danger"],["formControlName","customer"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalController.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.onSave()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(12,"ion-content",5),h.TgZ(13,"div",6),h.YNc(14,tn,2,0,"div",7),h.qZA(),h.TgZ(15,"app-image-picker",8),h.NdJ("toUpload",function(t){return e.dataUpload=t}),h.qZA(),h.TgZ(16,"ion-grid"),h.TgZ(17,"ion-item"),h.TgZ(18,"ion-label"),h._uU(19),h.ALo(20,"translate"),h.qZA(),h._UZ(21,"ion-toggle",9),h.qZA(),h.TgZ(22,"ion-item"),h.TgZ(23,"ion-label",10),h._uU(24),h.ALo(25,"translate"),h.qZA(),h.TgZ(26,"ion-select",11),h.NdJ("ionChange",function(t){return e.checkChange("method",t)}),h.ALo(27,"translate"),h.TgZ(28,"ion-select-option",12),h._uU(29),h.ALo(30,"translate"),h.qZA(),h.TgZ(31,"ion-select-option",13),h._uU(32),h.ALo(33,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(34,"ion-row"),h.TgZ(35,"ion-col",14),h.TgZ(36,"ion-item"),h.TgZ(37,"ion-label",15),h._uU(38),h.ALo(39,"translate"),h.qZA(),h.TgZ(40,"ion-input",16),h.NdJ("ionInput",function(t){return e.checkChange("size",t)}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(41,"ion-col",17),h.TgZ(42,"ion-item"),h.TgZ(43,"ion-label",18),h._uU(44),h.ALo(45,"translate"),h.qZA(),h.TgZ(46,"ion-select",19),h.NdJ("ionChange",function(t){return e.checkChange("unit",t)}),h.TgZ(47,"ion-select-option",20),h._uU(48),h.ALo(49,"translate"),h.qZA(),h.TgZ(50,"ion-select-option",21),h._uU(51),h.ALo(52,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(53,"ion-row"),h.TgZ(54,"ion-col",22),h.TgZ(55,"ion-item"),h.TgZ(56,"ion-label",23),h._uU(57),h.ALo(58,"translate"),h.qZA(),h.TgZ(59,"ion-input",24),h.NdJ("ionInput",function(t){return e.checkChange("quantity",t)}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(60,"ion-col",22),h.TgZ(61,"ion-item"),h.TgZ(62,"ion-label",23),h._uU(63),h.ALo(64,"translate"),h.ALo(65,"translate"),h.qZA(),h.TgZ(66,"ion-input",25),h.NdJ("ionChange",function(t){return e.numberFormatPrice.setValue(t.detail.value),e.setAmountPayed()}),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(67,en,5,3,"ion-item",7),h.TgZ(68,"ion-item"),h.TgZ(69,"ion-label",26),h._uU(70),h.ALo(71,"translate"),h.ALo(72,"translate"),h.qZA(),h.TgZ(73,"ion-input",27),h.NdJ("ionChange",function(t){return e.numberFormatCost.setValue(t.detail.value)}),h.qZA(),h.qZA(),h.TgZ(74,"ion-item"),h.TgZ(75,"ion-label",26),h._uU(76),h.ALo(77,"translate"),h.qZA(),h._UZ(78,"ion-textarea",28),h.qZA(),h.TgZ(79,"ion-item"),h.TgZ(80,"ion-label",26),h._uU(81),h.ALo(82,"translate"),h.qZA(),h.TgZ(83,"ion-input",29),h.NdJ("ionChange",function(){return e.search(e.form.controls.buyer.value)}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(84,"ion-list",30),h.YNc(85,nn,10,5,"ion-item",7),h.YNc(86,on,10,5,"ion-item",31),h.ALo(87,"async"),h.YNc(88,sn,4,1,"ion-item",7),h.qZA(),h.TgZ(89,"ion-item",30),h.TgZ(90,"ion-label"),h._uU(91),h.ALo(92,"translate"),h.qZA(),h.TgZ(93,"span"),h.TgZ(94,"ion-text",32),h._uU(95),h.ALo(96,"number"),h.qZA(),h._uU(97),h.ALo(98,"translate"),h.qZA(),h.qZA(),h.YNc(99,an,5,4,"ion-item",33),h.YNc(100,rn,3,0,"ion-item",33),h.YNc(101,ln,5,3,"ion-item",33),h.YNc(102,dn,2,1,"ion-list",34),h.TgZ(103,"div",6),h.YNc(104,un,2,0,"div",7),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,37,"CROP_MOD.HARVEST")),h.xp6(3),h.Q6J("disabled",(null==e.form?null:e.form.invalid)||"keep"==e.form.value&&(!e.form.value.harvest_ratio||e.form.value.harvest_ratio>100)||e.numberFormatPrice.realValue*e.numberFormatQuantity.realValue<e.numberFormatPayed.realValue),h.xp6(1),h.hij(" ",h.lcZ(11,39,"SAVE")," "),h.xp6(2),h.Q6J("formGroup",e.form),h.xp6(2),h.Q6J("ngIf",e.savingFlag.pending),h.xp6(1),h.Q6J("data",e.dataUpload),h.xp6(4),h.Oqu(h.lcZ(20,41,"POND_MOD.AUTO_FOR_DAILY")),h.xp6(5),h.Oqu(h.lcZ(25,43,"CROP_MOD.HARVEST_FORM")),h.xp6(2),h.Q6J("placeholder",h.lcZ(27,45,"SELECT")),h.xp6(3),h.Oqu(h.lcZ(30,47,"CROP_MOD.HARVEST_FULL")),h.xp6(3),h.Oqu(h.lcZ(33,49,"CROP_MOD.HARVEST_PARTIAL")),h.xp6(6),h.Oqu(h.lcZ(39,51,"SIZE")),h.xp6(6),h.Oqu(h.lcZ(45,53,"UNIT")),h.xp6(4),h.hij("",h.lcZ(49,55,"PCS"),"/kg"),h.xp6(3),h.hij("g/",h.lcZ(52,57,"PCS"),""),h.xp6(6),h.hij("",h.lcZ(58,59,"CROP_MOD.HARVEST_QUANTITY")," (kg)"),h.xp6(2),h.Q6J("value",e.numberFormatQuantity.fakeView),h.xp6(4),h.AsE("",h.lcZ(64,61,"PRICE")," (",h.lcZ(65,63,"CURRENCY_S"),")"),h.xp6(3),h.Q6J("value",e.numberFormatPrice.fakeView),h.xp6(1),h.Q6J("ngIf","keep"==e.form.controls.method.value),h.xp6(3),h.AsE("",h.lcZ(71,65,"CROP_MOD.HARVEST_COST")," (",h.lcZ(72,67,"CURRENCY_S"),")"),h.xp6(3),h.Q6J("value",e.numberFormatCost.fakeView),h.xp6(3),h.Oqu(h.lcZ(77,69,"NOTE")),h.xp6(5),h.Oqu(h.lcZ(82,71,"CROP_MOD.HARVEST_CUSTOMER")),h.xp6(4),h.Q6J("ngIf",e.buyerSelected),h.xp6(1),h.Q6J("ngForOf",h.lcZ(87,73,e.manufacturer$)),h.xp6(2),h.Q6J("ngIf",e.message),h.xp6(3),h.Oqu(h.lcZ(92,75,"REVENUE")),h.xp6(4),h.Oqu(h.xi3(96,77,e.numberFormatPrice.realValue*e.numberFormatQuantity.realValue,"0.0-0")),h.xp6(2),h.hij(" ",h.lcZ(98,80,"CURRENCY_S"),""),h.xp6(2),h.Q6J("ngIf",e.settingService.showDebt),h.xp6(1),h.Q6J("ngIf",e.numberFormatPrice.realValue*e.numberFormatQuantity.realValue<e.numberFormatPayed.realValue&&e.settingService.showDebt),h.xp6(1),h.Q6J("ngIf",e.settingService.showDebt),h.xp6(1),h.Q6J("ngIf",e.settingService.showDebt),h.xp6(2),h.Q6J("ngIf",e.loadingFlag.pending))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,o.JL,o.sg,n.O5,Ai.k,a.jY,a.Ie,a.Q$,a.ho,a.w,o.JJ,o.u,a.t9,a.QI,o.Q7,a.n0,a.Nd,a.wI,a.pK,a.j9,a.g2,a.q_,n.sg,a.yW,a.PQ],pipes:[g.X$,n.Ov,n.JJ],styles:[""]}),t})();const gn=function(){return["company_manager","farm_manager","pond_operator","pond_manager"]};function pn(t,e){if(1&t&&h._UZ(0,"ion-icon",9),2&t){const t=h.oxw();h.Q6J("appPermission",h.DdM(2,gn))("currentPermission",t.pondService.permission)}}function mn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",10),h.NdJ("click",function(){return h.CHM(t),h.oxw().removeBlock()}),h.TgZ(1,"ion-button",11),h._UZ(2,"ion-icon",12),h.qZA(),h.qZA()}}const Zn=function(){return[]},fn=function(){return["history"]};function An(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item",13),h.TgZ(1,"ion-label"),h._uU(2,"Qu\u1ea3n l\xfd"),h.qZA(),h.TgZ(3,"ion-button",14),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw();return i.enableSort?e.stopPropagation():i.openSeasonCancel()}),h._uU(4," H\u1ee7y v\u1ee5 "),h.qZA(),h.TgZ(5,"ion-button",15),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw();return i.enableSort?e.stopPropagation():i.presentMove()}),h._uU(6," Chuy\u1ec3n \u0111i "),h.qZA(),h.TgZ(7,"ion-button",16),h._uU(8," L\u1ecbch s\u1eed "),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.Q6J("appPermission",h.DdM(4,gn))("currentPermission",t.pondService.permission),h.xp6(5),h.Q6J("disabled",0==t.seedTimes.length&&0==t.moveTimes.length),h.xp6(2),h.Q6J("routerLink",t.enableSort?h.DdM(5,Zn):h.DdM(6,fn))}}function _n(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h._uU(2),h.ALo(3,"date"),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"span",23),h._uU(6),h.ALo(7,"number"),h.qZA(),h.TgZ(8,"ion-button",24),h.NdJ("click",function(e){const i=h.CHM(t),n=i.$implicit,o=i.index,s=h.oxw(2);return s.enableSort?e.stopPropagation():s.presentSeedEdit(n,o)}),h._UZ(9,"ion-icon",25),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw(2);h.xp6(2),h.hij(" ",h.xi3(3,5,1e3*t.seed_date,h.lcZ(4,8,"FORMAT_DATE_S"))," "),h.xp6(4),h.Oqu(h.xi3(7,10,t.seed_quantity,"1.0-0")),h.xp6(2),h.Q6J("appPermission",h.DdM(13,gn))("currentPermission",i.pondService.permission)("disabled",!t.id)}}function vn(t,e){1&t&&h._UZ(0,"ion-icon",28)}function Tn(t,e){1&t&&h._UZ(0,"ion-icon",29)}function qn(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.YNc(1,vn,1,0,"ion-icon",26),h.YNc(2,Tn,1,0,"ion-icon",27),h.TgZ(3,"ion-label"),h._uU(4),h.ALo(5,"date"),h.ALo(6,"translate"),h.qZA(),h.TgZ(7,"span",23),h._uU(8),h.ALo(9,"number"),h.qZA(),h.qZA()),2&t){const t=e.$implicit,i=h.oxw(3);h.xp6(1),h.Q6J("ngIf",t.from_season_code!=i.pondService.pond.current_season),h.xp6(1),h.Q6J("ngIf",t.from_season_code==i.pondService.pond.current_season),h.xp6(2),h.hij(" ",h.xi3(5,4,1e3*t.add_time,h.lcZ(6,7,"FORMAT_DATE_S"))," "),h.xp6(4),h.Oqu(h.xi3(9,9,t.quantity_individual,"1.0-0"))}}function xn(t,e){if(1&t&&(h.TgZ(0,"ion-list",17),h.TgZ(1,"ion-item"),h.TgZ(2,"ion-label"),h.TgZ(3,"p"),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA(),h.qZA(),h.YNc(6,qn,10,12,"ion-item",20),h.qZA()),2&t){const t=h.oxw(2);h.xp6(4),h.Oqu(h.lcZ(5,2,"CROP_MOD.MOVE_IN")),h.xp6(2),h.Q6J("ngForOf",t.moveTimes)}}function On(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h._uU(2),h.ALo(3,"date"),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"span",23),h._uU(6),h.ALo(7,"number"),h.qZA(),h.TgZ(8,"ion-button",24),h.NdJ("click",function(e){const i=h.CHM(t),n=i.$implicit,o=i.index,s=h.oxw(3);return s.enableSort?e.stopPropagation():s.presentHarvestEdit(n,o)}),h._UZ(9,"ion-icon",25),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw(3);h.xp6(2),h.hij(" ",h.xi3(3,5,1e3*t.harvest_date,h.lcZ(4,8,"FORMAT_DATE_S"))," "),h.xp6(4),h.Oqu(h.xi3(7,10,t.harvest_quantity,"1.0-0")),h.xp6(2),h.Q6J("appPermission",h.DdM(13,gn))("currentPermission",i.pondService.permission)("disabled",!t.id)}}function Dn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-list",30),h.TgZ(1,"ion-item"),h.TgZ(2,"ion-label"),h.TgZ(3,"p"),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA(),h.TgZ(6,"ion-button",18),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(2);return i.enableSort?e.stopPropagation():i.presentCollect()}),h._UZ(7,"ion-icon",19),h.qZA(),h.qZA(),h.YNc(8,On,10,14,"ion-item",20),h.qZA()}if(2&t){const t=h.oxw(2);h.xp6(4),h.Oqu(h.lcZ(5,4,"CROP_MOD.HARVEST")),h.xp6(2),h.Q6J("appPermission",h.DdM(6,gn))("currentPermission",t.pondService.permission),h.xp6(2),h.Q6J("ngForOf",t.harvestTimes)}}function bn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div"),h.TgZ(1,"ion-list",17),h.TgZ(2,"ion-item"),h.TgZ(3,"ion-label"),h.TgZ(4,"p"),h._uU(5),h.ALo(6,"translate"),h.qZA(),h.qZA(),h.TgZ(7,"ion-button",18),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw();return i.enableSort?e.stopPropagation():i.presentSeed()}),h._UZ(8,"ion-icon",19),h.qZA(),h.qZA(),h.YNc(9,_n,10,14,"ion-item",20),h.qZA(),h.YNc(10,xn,7,4,"ion-list",21),h.YNc(11,Dn,9,7,"ion-list",22),h.qZA()}if(2&t){const t=h.oxw();h.xp6(5),h.Oqu(h.lcZ(6,6,"CROP_MOD.CROP_STOCKING")),h.xp6(2),h.Q6J("appPermission",h.DdM(8,gn))("currentPermission",t.pondService.permission),h.xp6(2),h.Q6J("ngForOf",t.seedTimes),h.xp6(1),h.Q6J("ngIf",t.moveTimes.length>0),h.xp6(1),h.Q6J("ngIf",t.seedTimes.length>0||t.moveTimes.length>0)}}function Sn(t,e){if(1&t&&(h.TgZ(0,"p"),h._uU(1),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.Oqu(t.message)}}function Cn(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",31),h.qZA())}function yn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",32),h.TgZ(1,"ion-button",33),h.NdJ("click",function(){return h.CHM(t),h.oxw().upBlockProperty()}),h._UZ(2,"ion-icon",34),h.qZA(),h.TgZ(3,"ion-button",33),h.NdJ("click",function(){return h.CHM(t),h.oxw().downBlockProperty()}),h._UZ(4,"ion-icon",35),h.qZA(),h.qZA()}}const Nn=function(t){return[t]};let En=(()=>{class t{constructor(t,e,i,n){this.pondService=t,this.modalController=e,this.translate=i,this.router=n,this.loadingFlag=new d.E,this.message="",this.seedTimes=[],this.moveTimes=[],this.harvestTimes=[],this.eventUp=new h.vpe,this.eventDown=new h.vpe,this.eventRemove=new h.vpe}ngOnInit(){this.getData(),console.log(this.pondService.seasonInfo)}getData(){this.loadingFlag.setStart(!0),this.pondService.loadDependency().subscribe(t=>{console.log(t),0==t.status?this.message=t.error:(this.harvestTimes=t.data.harvest,this.seedTimes=t.data.seed,this.moveTimes=t.data.move),this.loadingFlag.setResult(!0)},()=>{this.message=this.translate.instant("ERROR_CONNECT"),this.loadingFlag.setResult(!1)})}presentSeed(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:yi});return t.onDidDismiss().then(t=>{t.data&&("kg"==t.data.unit&&(t.data.seed_quantity=t.data.seed_quantity_individuals),this.seedTimes.push(t.data))}),yield t.present()})}presentSeedEdit(t,e){return(0,l.mG)(this,void 0,void 0,function*(){const i=yield this.modalController.create({component:Fi,componentProps:{item:t}});return i.onDidDismiss().then(t=>{t.data&&("kg"==t.data.unit&&(t.data.seed_quantity=t.data.seed_quantity_individuals),this.seedTimes[e]=t.data,this.seedTimes[e].supplier=t.data.seed_supplier,this.seedTimes[e].supplier_id=t.data.seed_supplier_id,this.seedTimes[e].seed_date=t.data.seed_date)}),yield i.present()})}presentCollect(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:hn,componentProps:{harvestTimes:this.harvestTimes,seedTimes:this.seedTimes,moveTimes:this.moveTimes}});return t.onDidDismiss().then(t=>{if(t.data){let e={harvest_date:u().valueOf()/1e3,harvest_quantity:new it.y(t.data.quantity).realValue};this.harvestTimes.push(e)}}),yield t.present()})}presentHarvestEdit(t,e){return(0,l.mG)(this,void 0,void 0,function*(){const i=yield this.modalController.create({component:Ki,componentProps:{item:t}});return i.onDidDismiss().then(t=>{t.data&&(this.harvestTimes[e].harvest_quantity=new it.y(t.data.harvest_quantity).realValue)}),yield i.present()})}openSeasonCancel(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:st})).present()})}presentMove(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:yt,componentProps:{harvestTimes:this.harvestTimes,seedTimes:this.seedTimes,moveTimes:this.moveTimes}})).present()})}upBlockProperty(){this.eventUp.emit(this.index)}downBlockProperty(){this.eventDown.emit(this.index)}removeBlock(){this.eventRemove.emit(this.index)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(c.p),h.Y36(a.IN),h.Y36(g.sK),h.Y36(s.F0))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-season-info"]],inputs:{enableSort:"enableSort",index:"index"},outputs:{eventUp:"eventUp",eventDown:"eventDown",eventRemove:"eventRemove"},decls:16,vars:15,consts:[["mode","ios",3,"ngClass"],[1,"season",3,"routerLink"],["name","archive-outline",1,"icon-f"],["class","icon-detail","name","chevron-forward-outline",3,"appPermission","currentPermission",4,"ngIf"],["class","btnRemoveBlock",3,"click",4,"ngIf"],["lines","full",3,"appPermission","currentPermission",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center"],["class","ion-float-end",4,"ngIf"],["name","chevron-forward-outline",1,"icon-detail",3,"appPermission","currentPermission"],[1,"btnRemoveBlock",3,"click"],["size","small","color","light"],["name","close"],["lines","full",3,"appPermission","currentPermission"],["slot","end","color","danger","fill","outline",3,"click"],["slot","end","fill","outline",3,"disabled","click"],["slot","end","fill","outline",3,"routerLink"],["lines","none","mode","ios"],["shape","round","fill","clear","size","default","slot","end",3,"appPermission","currentPermission","click"],["name","add-circle-outline","slot","icon-only"],[4,"ngFor","ngForOf"],["lines","none","mode","ios",4,"ngIf"],["lines","none",4,"ngIf"],["slot","end",1,"ion-margin"],["slot","end","shape","round","fill","clear","size","default",3,"appPermission","currentPermission","disabled","click"],["src","assets/icon/edit-24px.svg","slot","icon-only"],["slot","start","name","log-in-outline",4,"ngIf"],["slot","start","name","log-out-outline",4,"ngIf"],["slot","start","name","log-in-outline"],["slot","start","name","log-out-outline"],["lines","none"],["name","dots"],[1,"ion-float-end"],["size","small","color","tertiary",3,"click"],["name","chevron-up-circle-outline"],["name","chevron-down-circle-outline"]],template:function(t,e){1&t&&(h.TgZ(0,"div"),h.TgZ(1,"ion-card",0),h.TgZ(2,"ion-card-header",1),h.TgZ(3,"ion-card-subtitle"),h._UZ(4,"ion-icon",2),h._uU(5),h.ALo(6,"translate"),h.YNc(7,pn,1,3,"ion-icon",3),h.qZA(),h.YNc(8,mn,3,0,"ion-buttons",4),h.qZA(),h.YNc(9,An,9,7,"ion-item",5),h.YNc(10,bn,12,9,"div",6),h.YNc(11,Sn,2,1,"p",6),h.TgZ(12,"div",7),h.YNc(13,Cn,2,0,"div",6),h.qZA(),h.TgZ(14,"div"),h.YNc(15,yn,5,0,"ion-buttons",8),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(1),h.Q6J("ngClass",e.enableSort?"jiggleBlock":""),h.xp6(1),h.Q6J("routerLink",e.enableSort?h.DdM(12,Zn):h.VKq(13,Nn,"history/"+e.pondService.pond.current_season)),h.xp6(3),h.hij(" ",h.lcZ(6,10,"CROP")," "),h.xp6(2),h.Q6J("ngIf",!e.enableSort),h.xp6(1),h.Q6J("ngIf",e.enableSort),h.xp6(1),h.Q6J("ngIf",!e.enableSort),h.xp6(1),h.Q6J("ngIf",!e.enableSort),h.xp6(1),h.Q6J("ngIf",e.message),h.xp6(2),h.Q6J("ngIf",e.loadingFlag.pending),h.xp6(2),h.Q6J("ngIf",e.enableSort))},directives:[a.PM,n.mk,a.Zi,a.YI,s.rH,a.tO,a.gu,n.O5,ve.l,a.Sm,a.YG,a.Ie,a.Q$,a.q_,n.sg,a.PQ],pipes:[g.X$,n.uU,n.JJ],styles:["[_nghost-%COMP%]   .season[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#0078d7,#3dc2ff)}[_nghost-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#fff!important;padding-left:3em}[_nghost-%COMP%]   ion-icon.icon-f[_ngcontent-%COMP%]{font-size:2em;position:absolute;left:0;top:-.2em}[_nghost-%COMP%]   .jiggleBlock[_ngcontent-%COMP%]{animation:jiggle .4s infinite;-webkit-animation:jiggle .4s infinite;-moz-animation-duration:.4s;-moz-animation-name:jiggle;-moz-animation-iteration-count:infinite;-webkit-transform:rotate(-1deg);-moz-transform:rotate(-1deg)}@keyframes jiggle{0%{transform:rotate(-1deg)}50%{transform:rotate(1deg)}}@-webkit-keyframes jiggle{0%{-webkit-transform:rotate(-1deg)}50%{-webkit-transform:rotate(1deg)}}[_nghost-%COMP%]   .btnRemoveBlock[_ngcontent-%COMP%]{position:absolute;top:0;right:0}[_nghost-%COMP%]   .disableEvent[_ngcontent-%COMP%]{pointer-events:none!important}"]}),t})();var Mn=i(35498),In=i(18409);function wn(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",10),h.qZA())}function Un(t,e){if(1&t&&h._UZ(0,"div",11),2&t){const t=h.oxw();h.Q6J("options",t.option)("merge",t.dataUpdate)}}let Pn=(()=>{class t{constructor(t,e,i){this.modalController=t,this.pondService=e,this.translate=i,this.loadingFlag=new d.E,this.dataRaw=[],this.date=[],this.costFeed=[],this.costBlend=[],this.costEnviro=[],this.costOther=[],this.costAccounting=[],this.costWater=[],this.pageLoaded=0,this.loadDisabled=!1,this.show=!1,this.option={tooltip:{trigger:"axis",formatter:t=>{let e=u(t[0].axisValue).format(this.translate.instant("FORMAT_DATE_MOMENT"))+"<br/>";return t.forEach(t=>{let i=(new Intl.NumberFormat).format(parseInt(t.value));e+=t.marker+t.seriesName+" : "+i+"<br>"}),e},axisPointer:{animation:!0}},legend:{data:[this.translate.instant("POND_MOD.FEED"),this.translate.instant("POND_MOD.FEED_SUPPLEMENT"),this.translate.instant("POND_MOD.CHEMICAL_TREATMENT"),this.translate.instant("POND_MOD.OTHER"),this.translate.instant("POND_MOD.WATER_TREAMENT")]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{data:[],axisLabel:{formatter:t=>new Date(t).getDate()}}],yAxis:[{type:"value"}],series:[{name:this.translate.instant("POND_MOD.FEED"),type:"line",stack:"a",areaStyle:{},data:[]},{name:this.translate.instant("POND_MOD.FEED_SUPPLEMENT"),type:"line",stack:"a",areaStyle:{},data:[]},{name:this.translate.instant("POND_MOD.CHEMICAL_TREATMENT"),type:"line",stack:"a",areaStyle:{},data:[]},{name:this.translate.instant("POND_MOD.OTHER"),type:"line",stack:"a",areaStyle:{},data:[]},{name:this.translate.instant("POND_MOD.COST_ACCOUTING"),type:"line",stack:"a",areaStyle:{},data:[]},{name:this.translate.instant("POND_MOD.WATER_TREAMENT"),type:"line",stack:"a",areaStyle:{},data:[]}]}}ngOnInit(){this.getData(0)}getData(t){this.loadingFlag.setStart(!0),this.pondService.loadDailyPaging({pageIndex:t,pageSize:30},u().format("YYYY-MM-DD")).subscribe(t=>{t.data?(this.dataRaw=t.data,this.prepareData(this.dataRaw),this.loadingFlag.setResult(!0),this.pageLoaded++,t.data.length<30&&(this.loadDisabled=!0)):this.loadingFlag.setResult(!1)},t=>{this.loadingFlag.setResult(!1),console.log(t)})}prepareData(t){t.forEach(t=>{this.costFeed.unshift(t.feed_cost),this.costBlend.unshift(t.cost_blend),this.costEnviro.unshift(t.cost_enviro),this.costOther.unshift(t.cost_other),this.costWater.unshift(t.cost_water),this.costAccounting.unshift(t.amounts),this.date.unshift(t.date)}),this.dataUpdate={xAxis:[{data:this.date}],series:[{data:this.costFeed},{data:this.costBlend},{data:this.costEnviro},{data:this.costOther},{data:this.costAccounting},{data:this.costWater}]}}loadMore(){this.getData(this.pageLoaded)}ionViewDidEnter(){this.show=!0}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-cost"]],inputs:{item:"item"},decls:25,vars:18,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-text-center"],[1,"title","ion-padding"],["color","danger"],[4,"ngIf"],["echarts","",3,"options","merge",4,"ngIf"],["shape","round","size","small",3,"disabled","click"],["name","arrow-back","slot","start"],["name","dots"],["echarts","",3,"options","merge"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.modalController.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"div",3),h.TgZ(10,"h1",4),h.TgZ(11,"ion-text",5),h._uU(12),h.ALo(13,"countNumerPipe"),h.ALo(14,"translate"),h.qZA(),h._uU(15),h.ALo(16,"translate"),h.qZA(),h.qZA(),h.TgZ(17,"div",3),h.YNc(18,wn,2,0,"div",6),h.qZA(),h.YNc(19,Un,1,2,"div",7),h.TgZ(20,"div",3),h.TgZ(21,"ion-button",8),h.NdJ("click",function(){return e.loadMore()}),h._UZ(22,"ion-icon",9),h._uU(23),h.ALo(24,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,7,"POND_MOD.COST_REPORT")),h.xp6(6),h.Oqu(h.xi3(13,9,e.item,h.lcZ(14,12,"FORMAT_COUNTER_KM"))),h.xp6(3),h.hij(" ",h.lcZ(16,14,"CURRENCY_S"),""),h.xp6(3),h.Q6J("ngIf",e.loadingFlag.pending),h.xp6(1),h.Q6J("ngIf",e.show),h.xp6(2),h.Q6J("disabled",e.loadDisabled),h.xp6(2),h.hij(" ",h.lcZ(24,16,"MORE")," "))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.yW,n.O5,a.PQ,r._w],pipes:[g.X$,In.u],styles:[""]}),t})();function Rn(t,e){1&t&&h._UZ(0,"ion-icon",7)}function kn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",8),h.NdJ("click",function(){return h.CHM(t),h.oxw().removeBlock()}),h.TgZ(1,"ion-button",9),h._UZ(2,"ion-icon",10),h.qZA(),h.qZA()}}function Yn(t,e){if(1&t&&(h.TgZ(0,"ion-card-content"),h.TgZ(1,"p"),h._uU(2),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.xp6(2),h.Oqu(t.message)}}function Ln(t,e){1&t&&(h.TgZ(0,"div"),h._UZ(1,"ion-spinner",15),h.qZA())}function Fn(t,e){if(1&t&&(h.TgZ(0,"div"),h.TgZ(1,"ion-card-content",11),h.TgZ(2,"span"),h.TgZ(3,"ion-text",12),h._uU(4),h.ALo(5,"countNumerPipe"),h.ALo(6,"translate"),h.qZA(),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.qZA(),h._UZ(9,"div",13),h.YNc(10,Yn,3,1,"ion-card-content",5),h.TgZ(11,"div",14),h.YNc(12,Ln,2,0,"div",5),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(4),h.Oqu(h.xi3(5,6,t.totalCost,h.lcZ(6,9,"FORMAT_COUNTER_KMB"))),h.xp6(3),h.hij(" ",h.lcZ(8,11,"CURRENCY_S")," "),h.xp6(2),h.Q6J("options",t.options)("merge",t.dataUpdate),h.xp6(1),h.Q6J("ngIf",t.message),h.xp6(2),h.Q6J("ngIf",t.loadingFlag.pending)}}function Jn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",16),h.TgZ(1,"ion-button",17),h.NdJ("click",function(){return h.CHM(t),h.oxw().upBlockProperty()}),h._UZ(2,"ion-icon",18),h.qZA(),h.TgZ(3,"ion-button",17),h.NdJ("click",function(){return h.CHM(t),h.oxw().downBlockProperty()}),h._UZ(4,"ion-icon",19),h.qZA(),h.qZA()}}let Qn=(()=>{class t{constructor(t,e,i){this.pondService=t,this.modalController=e,this.translate=i,this.loadingFlag=new d.E,this.eventUp=new h.vpe,this.eventDown=new h.vpe,this.eventRemove=new h.vpe,this.options={tooltip:{trigger:"item",formatter:function(t){return`${t.seriesName}<br />\n                ${t.name}: ${(new Intl.NumberFormat).format(t.data.value)} (${t.percent}%)<br />`},position:["20%","50%"]},series:[{name:this.translate.instant("POND_MOD.COST"),type:"pie",radius:"55%",data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},this.totalCost=0}ngOnInit(){this.loadCost(),console.log(this.enableSort)}ngOnChanges(t){t.enableSort&&(this.enableSort=t.enableSort.currentValue)}loadCost(){this.loadingFlag.setStart(!0),this.pondService.getTotalCost().subscribe(t=>{1==t.status?(this.totalCost=t.data.cost.feed+t.data.cost.blend+t.data.cost.enviroment+t.data.cost.seed+t.data.cost.other+ +t.data.cost.record.amounts+t.data.cost.water,this.dataUpdate={series:[{data:[{name:this.translate.instant("POND_MOD.FEED"),value:t.data.cost.feed},{name:this.translate.instant("POND_MOD.FEED_SUPPLEMENT"),value:t.data.cost.blend},{name:this.translate.instant("POND_MOD.CHEMICAL_TREATMENT"),value:t.data.cost.enviroment},{name:this.translate.instant("POND_MOD.SEED"),value:t.data.cost.seed},{name:this.translate.instant("POND_MOD.WATER_TREAMENT"),value:t.data.cost.water},{name:this.translate.instant("POND_MOD.OTHER"),value:t.data.cost.other},{name:this.translate.instant("POND_MOD.COST_ACCOUTING"),value:t.data.cost.record.amounts}]}]}):this.message=t.error,this.loadingFlag.setResult(!0)})}presentCost(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:Pn,componentProps:{item:this.totalCost}})).present()})}upBlockProperty(){this.eventUp.emit(this.index)}downBlockProperty(){this.eventDown.emit(this.index)}removeBlock(){this.eventRemove.emit(this.index)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(c.p),h.Y36(a.IN),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-daily-cost-info"]],inputs:{enableSort:"enableSort",index:"index"},outputs:{eventUp:"eventUp",eventDown:"eventDown",eventRemove:"eventRemove"},features:[h.TTD],decls:12,vars:8,consts:[["mode","ios",3,"ngClass"],[1,"cost",3,"click"],["name","cash-outline",1,"icon-f"],["class","icon-detail","name","chevron-forward-outline",4,"ngIf"],["class","btnRemoveBlock",3,"click",4,"ngIf"],[4,"ngIf"],["class","ion-float-end",4,"ngIf"],["name","chevron-forward-outline",1,"icon-detail"],[1,"btnRemoveBlock",3,"click"],["size","small","color","light"],["name","close"],[1,"ion-text-center","total"],["color","danger",1,"total-number"],["echarts","",3,"options","merge"],[1,"ion-text-center"],["name","dots"],[1,"ion-float-end"],["size","small","color","tertiary",3,"click"],["name","chevron-up-circle-outline"],["name","chevron-down-circle-outline"]],template:function(t,e){1&t&&(h.TgZ(0,"div"),h.TgZ(1,"ion-card",0),h.TgZ(2,"ion-card-header",1),h.NdJ("click",function(t){return e.enableSort?t.stopPropagation():e.presentCost()}),h.TgZ(3,"ion-card-subtitle"),h._UZ(4,"ion-icon",2),h._uU(5),h.ALo(6,"translate"),h.YNc(7,Rn,1,0,"ion-icon",3),h.qZA(),h.YNc(8,kn,3,0,"ion-buttons",4),h.qZA(),h.YNc(9,Fn,13,13,"div",5),h.TgZ(10,"div"),h.YNc(11,Jn,5,0,"ion-buttons",6),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(1),h.Q6J("ngClass",e.enableSort?"jiggleBlock":""),h.xp6(4),h.hij(" ",h.lcZ(6,6,"COST")," "),h.xp6(2),h.Q6J("ngIf",!e.enableSort),h.xp6(1),h.Q6J("ngIf",e.enableSort),h.xp6(1),h.Q6J("ngIf",!e.enableSort),h.xp6(2),h.Q6J("ngIf",e.enableSort))},directives:[a.PM,n.mk,a.Zi,a.tO,a.gu,n.O5,a.Sm,a.YG,a.FN,a.yW,r._w,a.PQ],pipes:[g.X$,In.u],styles:["[_nghost-%COMP%]   .cost[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#d13438,#3dc2ff)}[_nghost-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#fff!important;padding-left:3em}[_nghost-%COMP%]   ion-icon.icon-f[_ngcontent-%COMP%]{font-size:2em;position:absolute;left:0;top:-.2em}[_nghost-%COMP%]   .total[_ngcontent-%COMP%]{margin:1em 0 0}[_nghost-%COMP%]   .total-number[_ngcontent-%COMP%]{font-size:2em;font-weight:bold}[_nghost-%COMP%]   .jiggleBlock[_ngcontent-%COMP%]{animation:jiggle .4s infinite;-webkit-animation:jiggle .4s infinite;-moz-animation-duration:.4s;-moz-animation-name:jiggle;-moz-animation-iteration-count:infinite;-webkit-transform:rotate(-1deg);-moz-transform:rotate(-1deg)}@keyframes jiggle{0%{transform:rotate(-1deg)}50%{transform:rotate(1deg)}}@-webkit-keyframes jiggle{0%{-webkit-transform:rotate(-1deg)}50%{-webkit-transform:rotate(1deg)}}[_nghost-%COMP%]   .btnRemoveBlock[_ngcontent-%COMP%]{position:absolute;top:0;right:0}[_nghost-%COMP%]   .disableEvent[_ngcontent-%COMP%]{pointer-events:none!important}"]}),t})();function Vn(t,e){1&t&&h._UZ(0,"ion-icon",17)}function jn(t,e){1&t&&h._UZ(0,"ion-icon",18)}const Hn=function(){return["company_manager","farm_manager","farm_operation","pond_manager","pond_operator"]};function Gn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",19),h.TgZ(1,"ion-button",3),h.NdJ("click",function(e){return h.CHM(t),h.oxw().presentPopoverMenu(e)}),h._UZ(2,"ion-icon",20),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.Q6J("appPermission",h.DdM(2,Hn))("currentPermission",t.pondService.permission)}}function Bn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-button",21),h.NdJ("click",function(){return h.CHM(t),h.oxw().saveProperty()}),h._uU(1),h.ALo(2,"translate"),h.qZA()}2&t&&(h.xp6(1),h.hij(" ",h.lcZ(2,1,"POND_MOD.SAVE")," "))}function zn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-refresher",22),h.NdJ("ionRefresh",function(e){return h.CHM(t),h.oxw().doRefresh(e)}),h._UZ(1,"ion-refresher-content"),h.qZA()}}function $n(t,e){1&t&&(h.TgZ(0,"div",23),h._UZ(1,"ion-spinner",24),h.qZA())}function Wn(t,e){if(1&t&&(h.TgZ(0,"ion-card",25),h.TgZ(1,"ion-card-content"),h.TgZ(2,"p"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.AsE("",h.lcZ(4,2,"POND_MOD.LAST_UPDATE")," ",t.lastTimeUpdate.fromNow(),"")}}function Xn(t,e){1&t&&(h.TgZ(0,"ion-card",26),h.TgZ(1,"ion-card-content"),h.TgZ(2,"p"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,1,"POND_MOD.HAVE_NOT_ENTERED")))}function Kn(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-chip",33),h.NdJ("click",function(e){return h.CHM(t),h.oxw(3).presentHealthUpdate(e)}),h.TgZ(1,"ion-label"),h._uU(2),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.Q6J("disabled",0==t.id),h.xp6(2),h.Oqu(t.name)}}const to=function(){return["company_manager","farm_manager","farm_operation","farm_lab","pond_manager","pond_operator"]};function eo(t,e){if(1&t&&(h.TgZ(0,"ion-card",25),h.TgZ(1,"ion-card-header",29),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",30),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA(),h.TgZ(6,"ion-card-content",31),h.YNc(7,Kn,3,2,"ion-chip",32),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.xp6(4),h.hij(" ",h.lcZ(5,4,"DISEASE.DISEASE")," "),h.xp6(2),h.Q6J("appPermission",h.DdM(6,to))("permissionAction",t.pondService.permission),h.xp6(1),h.Q6J("ngForOf",t.disease)}}function io(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h.TgZ(2,"p"),h.TgZ(3,"small"),h._uU(4),h.qZA(),h.qZA(),h.TgZ(5,"h3"),h._uU(6),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.xp6(4),h.Oqu(t.time),h.xp6(2),h.Oqu(t.message)}}function no(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-card",34),h.NdJ("click",function(){return h.CHM(t),h.oxw(2).presentAlert()}),h.TgZ(1,"ion-card-header"),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",35),h._uU(4),h.ALo(5,"translate"),h._UZ(6,"ion-icon",36),h.qZA(),h.qZA(),h.TgZ(7,"ion-list",37),h.YNc(8,io,7,2,"ion-item",38),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(2);h.xp6(4),h.hij(" ",h.lcZ(5,2,"WARNING")," "),h.xp6(4),h.Q6J("ngForOf",t.alertItems)}}function oo(t,e){1&t&&h._UZ(0,"app-pond-lab")}function so(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h.TgZ(2,"p"),h.TgZ(3,"small"),h._uU(4),h.qZA(),h.qZA(),h.TgZ(5,"h3"),h._uU(6),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.xp6(4),h.Oqu(t.vendor_name),h.xp6(2),h.Oqu(t.message)}}function ao(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-card",39),h.NdJ("click",function(){return h.CHM(t),h.oxw(2).presentSuggest()}),h.TgZ(1,"ion-card-header",40),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",41),h._uU(4),h.ALo(5,"translate"),h._UZ(6,"ion-icon",42),h.qZA(),h.qZA(),h.TgZ(7,"ion-list",43),h.YNc(8,so,7,2,"ion-item",38),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(2);h.xp6(4),h.hij(" ",h.lcZ(5,2,"SUGGEST")," "),h.xp6(4),h.Q6J("ngForOf",t.suggestItems)}}function ro(t,e){if(1&t&&(h.TgZ(0,"div"),h.YNc(1,eo,8,7,"ion-card",11),h.YNc(2,no,9,4,"ion-card",27),h.YNc(3,oo,1,0,"app-pond-lab",13),h.YNc(4,ao,9,4,"ion-card",28),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.Q6J("ngIf",(1==(null==t.pondService.pond?null:t.pondService.pond.warning)||t.disease.length>0)&&"pond"==t.pondService.pond.type),h.xp6(1),h.Q6J("ngIf",(null==t.alertItems?null:t.alertItems.length)>0&&"pond"==t.pondService.pond.type),h.xp6(1),h.Q6J("ngIf","pond"==t.pondService.pond.type),h.xp6(1),h.Q6J("ngIf",(null==t.suggestItems?null:t.suggestItems.length)>0&&"pond"==t.pondService.pond.type)}}function lo(t,e){1&t&&h._UZ(0,"ion-icon",36)}function co(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",56),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).removeBlock(e)}),h.TgZ(1,"ion-button",57),h._UZ(2,"ion-icon",58),h.qZA(),h.qZA()}}function uo(t,e){1&t&&(h.TgZ(0,"div",61),h._UZ(1,"ion-spinner",24),h.qZA())}function ho(t,e){1&t&&(h.TgZ(0,"div"),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&t&&(h.xp6(1),h.hij(" ",h.lcZ(2,1,"WEATHER_MOD.NO_WEATHER")," "))}function go(t,e){if(1&t&&(h.TgZ(0,"div"),h.TgZ(1,"div"),h.TgZ(2,"p"),h._uU(3),h.ALo(4,"translate"),h.TgZ(5,"ion-text",62),h._uU(6),h.TgZ(7,"sup"),h.TgZ(8,"small"),h._uU(9,"o"),h.qZA(),h.qZA(),h._uU(10,"C"),h.qZA(),h._uU(11),h.ALo(12,"translate"),h.TgZ(13,"ion-text",62),h._uU(14),h.TgZ(15,"sup"),h.TgZ(16,"small"),h._uU(17,"o"),h.qZA(),h.qZA(),h._uU(18,"C"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(19,"div"),h.TgZ(20,"p"),h._uU(21),h.ALo(22,"translate"),h.ALo(23,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw(5);h.xp6(3),h.hij("",h.lcZ(4,9,"WEATHER_MOD.WEATHER_TODAY")," "),h.xp6(2),h.Q6J("color",t.weatherData.temp>28?"danger":"success"),h.xp6(1),h.hij(" ",t.weatherData.temp,""),h.xp6(5),h.hij(", ",h.lcZ(12,11,"WEATHER_MOD.WEATHER_TODAY_MAX")," "),h.xp6(2),h.Q6J("color",t.weatherData.temp_max>28?"danger":"success"),h.xp6(1),h.hij(" ",t.weatherData.temp_max," "),h.xp6(7),h.lnq(" ",h.lcZ(22,13,"WEATHER_MOD.WEATHER_TODAY_MES")," ",t.weatherData.weather," ",h.lcZ(23,15,"WEATHER_MOD.WEATHER_TODAY_MES_END")," ")}}function po(t,e){if(1&t&&(h.TgZ(0,"ion-card-content",59),h.YNc(1,uo,2,0,"div",60),h.YNc(2,ho,3,3,"div",13),h.YNc(3,go,24,17,"div",13),h.qZA()),2&t){const t=h.oxw(4);h.xp6(1),h.Q6J("ngIf",t.loadingWeatherFlag.pending),h.xp6(1),h.Q6J("ngIf",!t.weatherData),h.xp6(1),h.Q6J("ngIf",t.weatherData)}}function mo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",63),h.TgZ(1,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).upBlockProperty(e)}),h._UZ(2,"ion-icon",65),h.qZA(),h.TgZ(3,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).downBlockProperty(e)}),h._UZ(4,"ion-icon",66),h.qZA(),h.qZA()}}function Zo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-card",49),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(3);return i.enableSort?e.stopPropagation():i.presentWeatherPredict()}),h.TgZ(1,"ion-card-header",50),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",51),h._uU(4),h.ALo(5,"translate"),h.YNc(6,lo,1,0,"ion-icon",52),h.qZA(),h.YNc(7,co,3,0,"ion-buttons",53),h.qZA(),h.YNc(8,po,4,3,"ion-card-content",54),h.TgZ(9,"div"),h.YNc(10,mo,5,0,"ion-buttons",55),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(3);h.Q6J("ngClass",t.enableSort?"jiggleBlock":""),h.xp6(4),h.hij(" ",h.lcZ(5,6,"WEATHER_MOD.TITLE")," "),h.xp6(2),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(2),h.Q6J("ngIf",t.enableSort)}}function fo(t,e){1&t&&h._UZ(0,"ion-icon",36)}function Ao(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",56),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).removeBlock(e)}),h.TgZ(1,"ion-button",57),h._UZ(2,"ion-icon",58),h.qZA(),h.qZA()}}function _o(t,e){1&t&&(h.TgZ(0,"ion-card-content",61),h.TgZ(1,"p",72),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.qZA()),2&t&&(h.xp6(2),h.Oqu(h.lcZ(3,1,"PHOTO_MOD.NOT_UPDATE_PHOTO")))}function vo(t,e){if(1&t&&(h.TgZ(0,"div",73),h._UZ(1,"img",74),h.qZA()),2&t){const t=h.oxw(5);h.xp6(1),h.Q6J("src",t.SITE_IMAGE+(null==t.todayItem?null:t.todayItem.image),h.LSH)}}function To(t,e){if(1&t&&(h.TgZ(0,"ion-card-content"),h.TgZ(1,"p"),h._uU(2),h.qZA(),h.qZA()),2&t){const t=h.oxw(5);h.xp6(2),h.Oqu(t.todayItem.description)}}function qo(t,e){if(1&t&&(h.TgZ(0,"div"),h.YNc(1,_o,4,3,"ion-card-content",60),h.YNc(2,vo,2,1,"div",71),h.YNc(3,To,3,1,"ion-card-content",13),h.qZA()),2&t){const t=h.oxw(4);h.xp6(1),h.Q6J("ngIf",!(null!=t.todayItem&&t.todayItem.image||t.enableSort)),h.xp6(1),h.Q6J("ngIf",null==t.todayItem?null:t.todayItem.image),h.xp6(1),h.Q6J("ngIf",null==t.todayItem?null:t.todayItem.description)}}function xo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-button",75),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(4);return i.enableSort?e.stopPropagation():i.openUploadImage()}),h._UZ(1,"ion-icon",76),h.qZA()}if(2&t){const t=h.oxw(4);h.Q6J("appPermission",h.DdM(2,to))("currentPermission",t.pondService.permission)}}function Oo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",63),h.TgZ(1,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).upBlockProperty(e)}),h._UZ(2,"ion-icon",65),h.qZA(),h.TgZ(3,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).downBlockProperty(e)}),h._UZ(4,"ion-icon",66),h.qZA(),h.qZA()}}function Do(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-card",67),h.TgZ(1,"ion-card-header",68),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(3);return i.enableSort?e.stopPropagation():i.openDailyPhoto()}),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",69),h._uU(4),h.ALo(5,"translate"),h.YNc(6,fo,1,0,"ion-icon",52),h.qZA(),h.YNc(7,Ao,3,0,"ion-buttons",53),h.qZA(),h.YNc(8,qo,4,3,"div",13),h.TgZ(9,"div"),h.YNc(10,xo,2,3,"ion-button",70),h.YNc(11,Oo,5,0,"ion-buttons",55),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(3);h.Q6J("ngClass",t.enableSort?"jiggleBlock":""),h.xp6(4),h.hij(" ",h.lcZ(5,7,"PHOTO_MOD.DAILY_PHOTO")," "),h.xp6(2),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(2),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",t.enableSort)}}function bo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",56),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).removeBlock(e)}),h.TgZ(1,"ion-button",57),h._UZ(2,"ion-icon",58),h.qZA(),h.qZA()}}function So(t,e){1&t&&(h.TgZ(0,"ion-row"),h._UZ(1,"ion-progress-bar",86),h.qZA())}const Co=function(t){return{color:t}};function yo(t,e){if(1&t&&(h.TgZ(0,"div",89),h.TgZ(1,"div",90),h.TgZ(2,"span",91),h._uU(3),h.qZA(),h.qZA(),h.TgZ(4,"div",90),h.TgZ(5,"b",92),h._uU(6),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw().$implicit,e=h.oxw().$implicit,i=h.oxw(5);h.xp6(1),h.Q6J("ngStyle",h.VKq(4,Co,i.calculateColor(null==e.value.indexs[t]||null==e.value.indexs[t].ui?null:e.value.indexs[t].ui.color))),h.xp6(2),h.hij(" ",null==e.value.indexs[t].ui?null:e.value.indexs[t].ui.label," "),h.xp6(1),h.Q6J("ngStyle",h.VKq(6,Co,i.calculateColor(null==e.value.indexs[t]||null==e.value.indexs[t].ui?null:e.value.indexs[t].ui.color))),h.xp6(2),h.Oqu(e.value.indexs[t].last.value)}}function No(t,e){if(1&t&&(h.TgZ(0,"ion-col",87),h.YNc(1,yo,7,8,"div",88),h.qZA()),2&t){const t=e.$implicit,i=h.oxw().$implicit;h.xp6(1),h.Q6J("ngIf",i.value.indexs[t].ui)}}function Eo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",3),h.NdJ("click",function(e){const i=h.CHM(t).$implicit,n=h.oxw(5);return n.enableSort?e.stopPropagation():n.presentPubDetail(i.value)}),h.TgZ(1,"ion-item"),h._UZ(2,"ion-icon",82),h.TgZ(3,"label"),h._uU(4),h.qZA(),h._UZ(5,"ion-icon",83),h.qZA(),h.TgZ(6,"ion-item"),h.TgZ(7,"small"),h._uU(8),h.qZA(),h.qZA(),h.TgZ(9,"ion-grid"),h.YNc(10,So,2,0,"ion-row",13),h.TgZ(11,"ion-row",84),h.YNc(12,No,2,1,"ion-col",85),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw(5);h.xp6(4),h.Oqu(t.value.name),h.xp6(4),h.Oqu(i.getMomentTime(t.value.last)),h.xp6(2),h.Q6J("ngIf",i.loadingDevice.pending),h.xp6(2),h.Q6J("ngForOf",t.value.listIndexLabel)}}function Mo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item",93),h.NdJ("click",function(e){const i=h.CHM(t).$implicit,n=h.oxw(5);return n.enableSort?e.stopPropagation():n.presentSubDetail(i.value)}),h._UZ(1,"ion-icon",94),h.TgZ(2,"label"),h._uU(3),h.qZA(),h._UZ(4,"ion-icon",83),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(3),h.Oqu(t.value.name)}}function Io(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item",93),h.NdJ("click",function(e){const i=h.CHM(t).$implicit,n=h.oxw(5);return n.enableSort?e.stopPropagation():n.presentFeedDetail(i.key)}),h._UZ(1,"ion-icon",95),h.TgZ(2,"label"),h._uU(3),h.qZA(),h._UZ(4,"ion-icon",83),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(3),h.Oqu(t.value.name)}}function wo(t,e){if(1&t&&(h.TgZ(0,"ion-list",43),h.YNc(1,Eo,13,4,"div",80),h.ALo(2,"keyvalue"),h.YNc(3,Mo,5,1,"ion-item",81),h.ALo(4,"keyvalue"),h.YNc(5,Io,5,1,"ion-item",81),h.ALo(6,"keyvalue"),h.qZA()),2&t){const t=h.oxw(4);h.xp6(1),h.Q6J("ngForOf",h.lcZ(2,3,t.pubs)),h.xp6(2),h.Q6J("ngForOf",h.lcZ(4,5,t.subs)),h.xp6(2),h.Q6J("ngForOf",h.lcZ(6,7,t.feedings))}}function Uo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",63),h.TgZ(1,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).upBlockProperty(e)}),h._UZ(2,"ion-icon",65),h.qZA(),h.TgZ(3,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).downBlockProperty(e)}),h._UZ(4,"ion-icon",66),h.qZA(),h.qZA()}}function Po(t,e){if(1&t&&(h.TgZ(0,"ion-card",67),h.TgZ(1,"ion-card-header",77),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",78),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.YNc(6,bo,3,0,"ion-buttons",53),h.qZA(),h.YNc(7,wo,7,9,"ion-list",79),h.TgZ(8,"div"),h.YNc(9,Uo,5,0,"ion-buttons",55),h.qZA(),h.qZA()),2&t){const t=h.oxw(3);h.Q6J("ngClass",t.enableSort?"jiggleBlock":""),h.xp6(4),h.hij(" ",h.lcZ(5,5,"DEVICE")," "),h.xp6(2),h.Q6J("ngIf",t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(2),h.Q6J("ngIf",t.enableSort)}}function Ro(t,e){1&t&&h._UZ(0,"ion-icon",36)}function ko(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",56),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).removeBlock(e)}),h.TgZ(1,"ion-button",57),h._UZ(2,"ion-icon",58),h.qZA(),h.qZA()}}function Yo(t,e){if(1&t&&(h.TgZ(0,"ion-list",37),h.TgZ(1,"ion-item"),h.TgZ(2,"ion-label"),h.TgZ(3,"h3"),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA(),h.TgZ(6,"span",99),h._uU(7),h.ALo(8,"number"),h.TgZ(9,"small"),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(12,"ion-item"),h.TgZ(13,"ion-label"),h.TgZ(14,"h3"),h._uU(15),h.ALo(16,"translate"),h.TgZ(17,"small"),h._uU(18),h.ALo(19,"number"),h.ALo(20,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(21,"span",99),h._uU(22),h.ALo(23,"number"),h.TgZ(24,"small"),h._uU(25,"g"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(26,"ion-item"),h.TgZ(27,"ion-label"),h.TgZ(28,"h3"),h._uU(29),h.ALo(30,"translate"),h.qZA(),h.qZA(),h.TgZ(31,"span",99),h._uU(32),h.TgZ(33,"small"),h._uU(34),h.ALo(35,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(36,"ion-item"),h.TgZ(37,"ion-label"),h.TgZ(38,"h3"),h._uU(39),h.ALo(40,"translate"),h.qZA(),h.qZA(),h.TgZ(41,"span",99),h._uU(42),h.ALo(43,"number"),h.TgZ(44,"small"),h._uU(45),h.ALo(46,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(47,"ion-item"),h.TgZ(48,"ion-label"),h.TgZ(49,"h3"),h._uU(50),h.ALo(51,"translate"),h.qZA(),h.qZA(),h.TgZ(52,"span",99),h._uU(53),h.qZA(),h.qZA(),h.TgZ(54,"ion-item"),h.TgZ(55,"ion-label"),h.TgZ(56,"h3"),h._uU(57,"FCR"),h.qZA(),h.qZA(),h.TgZ(58,"span",99),h._uU(59),h.ALo(60,"number"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw(4);h.xp6(4),h.Oqu(h.lcZ(5,16,"POND_MOD.OLD")),h.xp6(3),h.hij("",h.xi3(8,18,t.estimate.old,"0.0-1")," "),h.xp6(3),h.Oqu(h.lcZ(11,21,"POND_MOD.DAY")),h.xp6(5),h.hij("",h.lcZ(16,23,"POND_MOD.SIZE")," "),h.xp6(3),h.AsE("(",h.xi3(19,25,1e3/t.estimate.weight,"1.0-1")," ",h.lcZ(20,28,"PCS"),"/kg)"),h.xp6(4),h.hij("",h.xi3(23,30,t.estimate.weight,"1.0-1")," "),h.xp6(7),h.Oqu(h.lcZ(30,33,"POND_MOD.NUMBER_OF_ANIMALS")),h.xp6(3),h.hij("",t.estimate.quantity_pcs," "),h.xp6(2),h.Oqu(h.lcZ(35,35,"PCS")),h.xp6(5),h.Oqu(h.lcZ(40,37,"POND_MOD.QUANTITY")),h.xp6(3),h.hij("",h.xi3(43,39,t.estimate.quantity/1e3,"1.0-2")," "),h.xp6(3),h.Oqu(h.lcZ(46,42,"POND_MOD.TON")),h.xp6(5),h.Oqu(h.lcZ(51,44,"POND_MOD.FEED")),h.xp6(3),h.hij("",t.estimate.feed," "),h.xp6(6),h.Oqu(h.xi3(60,46,t.estimate.FCR,"1.0-2"))}}function Lo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",63),h.TgZ(1,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).upBlockProperty(e)}),h._UZ(2,"ion-icon",65),h.qZA(),h.TgZ(3,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).downBlockProperty(e)}),h._UZ(4,"ion-icon",66),h.qZA(),h.qZA()}}function Fo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-card",49),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(3);return i.enableSort?e.stopPropagation():i.presentEstimate()}),h.TgZ(1,"ion-card-header",96),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",97),h._uU(4),h.ALo(5,"translate"),h.YNc(6,Ro,1,0,"ion-icon",52),h.qZA(),h.YNc(7,ko,3,0,"ion-buttons",53),h.qZA(),h.YNc(8,Yo,61,49,"ion-list",98),h.TgZ(9,"div"),h.YNc(10,Lo,5,0,"ion-buttons",55),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(3);h.Q6J("ngClass",t.enableSort?"jiggleBlock":""),h.xp6(4),h.hij(" ",h.lcZ(5,6,"POND_MOD.ESTIMATE")," "),h.xp6(2),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(2),h.Q6J("ngIf",t.enableSort)}}function Jo(t,e){1&t&&h._UZ(0,"ion-icon",36)}function Qo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",56),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).removeBlock(e)}),h.TgZ(1,"ion-button",57),h._UZ(2,"ion-icon",58),h.qZA(),h.qZA()}}function Vo(t,e){1&t&&h._UZ(0,"ion-icon",110)}function jo(t,e){if(1&t&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"number"),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.Oqu(h.xi3(2,1,t.values[0],"1.0-1"))}}const Ho=function(t){return{"border-color":t}},Go=function(){return["company_manager","farm_manager","farm_operation","farm_lab","pond_operator","pond_manager"]};function Bo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",106),h.TgZ(1,"div",107),h.NdJ("click",function(e){const i=h.CHM(t).$implicit,n=h.oxw(5);return n.enableSort?e.stopPropagation():n.presentParameterUpdate(e,i)}),h.TgZ(2,"div",108),h.YNc(3,Vo,1,0,"ion-icon",109),h.YNc(4,jo,3,4,"span",13),h.qZA(),h.qZA(),h.TgZ(5,"div",90),h.TgZ(6,"small"),h.TgZ(7,"b"),h._uU(8),h.ALo(9,"translate"),h.ALo(10,"uppercase"),h.qZA(),h.qZA(),h.qZA(),h._UZ(11,"ion-ripple-effect"),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw(5);h.Q6J("ngStyle",h.VKq(12,Ho,t.colorStr)),h.xp6(1),h.Q6J("appPermission",h.DdM(14,Go))("permissionAction",i.pondService.permission),h.xp6(1),h.Q6J("ngStyle",h.VKq(15,Co,t.colorStr)),h.xp6(1),h.Q6J("ngIf",!t.values[0]||0==t.values[0]),h.xp6(1),h.Q6J("ngIf",t.values[0]&&0!=t.values[0]),h.xp6(1),h.Q6J("ngStyle",h.VKq(17,Co,t.colorStr)),h.xp6(3),h.Oqu(h.lcZ(9,8,h.lcZ(10,10,"POND_MOD.PARAM."+t.name)))}}function zo(t,e){if(1&t&&(h.TgZ(0,"div",104),h.YNc(1,Bo,12,19,"div",105),h.qZA()),2&t){const t=h.oxw(4);h.xp6(1),h.Q6J("ngForOf",t.pondService.trackingObjects)}}function $o(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",111),h.TgZ(1,"ion-button",112),h.NdJ("click",function(){return h.CHM(t),h.oxw(4).presentAlertParamsConfig()}),h._UZ(2,"ion-icon",113),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(4);h.xp6(1),h.Q6J("appPermission",h.DdM(5,to))("currentPermission",t.pondService.permission),h.xp6(2),h.hij(" ",h.lcZ(4,3,"SETTINGS")," ")}}function Wo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",63),h.TgZ(1,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).upBlockProperty(e)}),h._UZ(2,"ion-icon",65),h.qZA(),h.TgZ(3,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).downBlockProperty(e)}),h._UZ(4,"ion-icon",66),h.qZA(),h.qZA()}}function Xo(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-card",67),h.TgZ(1,"ion-card-header",100),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(3);return i.enableSort?e.stopPropagation():i.presentParameter()}),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",101),h._uU(4),h.ALo(5,"translate"),h.YNc(6,Jo,1,0,"ion-icon",52),h.qZA(),h.YNc(7,Qo,3,0,"ion-buttons",53),h.qZA(),h.YNc(8,zo,2,1,"div",102),h.YNc(9,$o,5,6,"div",103),h.TgZ(10,"div"),h.YNc(11,Wo,5,0,"ion-buttons",55),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(3);h.Q6J("ngClass",t.enableSort?"jiggleBlock":""),h.xp6(4),h.hij(" ",h.lcZ(5,7,"POND_MOD.ENVIROMENT")," "),h.xp6(2),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(2),h.Q6J("ngIf",t.enableSort)}}function Ko(t,e){1&t&&h._UZ(0,"ion-icon",36)}function ts(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",56),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).removeBlock(e)}),h.TgZ(1,"ion-button",57),h._UZ(2,"ion-icon",58),h.qZA(),h.qZA()}}function es(t,e){1&t&&h._UZ(0,"ion-icon",110)}function is(t,e){if(1&t&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"number"),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.Oqu(h.xi3(2,1,t.quantity,"1.0-1"))}}function ns(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",118),h.TgZ(1,"div",107),h.NdJ("click",function(e){const i=h.CHM(t).index,n=h.oxw(5);return n.enableSort?e.stopPropagation():n.presentFeedUpdate(e,i)}),h.TgZ(2,"div",92),h.YNc(3,es,1,0,"ion-icon",109),h.YNc(4,is,3,4,"span",13),h.qZA(),h.qZA(),h.TgZ(5,"div"),h.TgZ(6,"small"),h.TgZ(7,"b"),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA(),h.qZA(),h._UZ(10,"ion-ripple-effect"),h.qZA()}if(2&t){const t=e.$implicit,i=e.index,n=h.oxw(5);h.xp6(1),h.Q6J("appPermission",h.DdM(8,Go))("permissionAction",n.pondService.permission),h.xp6(2),h.Q6J("ngIf",!t.quantity||0==t.quantity),h.xp6(1),h.Q6J("ngIf",t.quantity&&0!=t.quantity),h.xp6(4),h.AsE("",h.lcZ(9,6,"POND_MOD.REPAST")," ",i+1,"")}}function os(t,e){if(1&t&&(h.TgZ(0,"div",104),h.YNc(1,ns,11,9,"div",117),h.qZA()),2&t){const t=h.oxw(4);h.xp6(1),h.Q6J("ngForOf",t.feed)}}function ss(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",111),h.TgZ(1,"ion-button",112),h.NdJ("click",function(){return h.CHM(t),h.oxw(4).presentAlertFeedConfig()}),h._UZ(2,"ion-icon",113),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(4);h.xp6(1),h.Q6J("appPermission",h.DdM(5,to))("currentPermission",t.pondService.permission),h.xp6(2),h.hij(" ",h.lcZ(4,3,"SETTINGS")," ")}}function as(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",63),h.TgZ(1,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).upBlockProperty(e)}),h._UZ(2,"ion-icon",65),h.qZA(),h.TgZ(3,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).downBlockProperty(e)}),h._UZ(4,"ion-icon",66),h.qZA(),h.qZA()}}function rs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-card",67),h.TgZ(1,"ion-card-header",114),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(3);return i.enableSort?e.stopPropagation():i.presentFeed()}),h.TgZ(2,"ion-card-subtitle"),h.TgZ(3,"span"),h._UZ(4,"ion-icon",115),h._uU(5),h.ALo(6,"translate"),h.qZA(),h.TgZ(7,"span"),h.TgZ(8,"span",116),h._uU(9),h.ALo(10,"uppercase"),h.ALo(11,"number"),h.qZA(),h.YNc(12,Ko,1,0,"ion-icon",52),h.qZA(),h.qZA(),h.YNc(13,ts,3,0,"ion-buttons",53),h.qZA(),h.YNc(14,os,2,1,"div",102),h.YNc(15,ss,5,6,"div",103),h.TgZ(16,"div"),h.YNc(17,as,5,0,"ion-buttons",55),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(3);h.Q6J("ngClass",t.enableSort?"jiggleBlock":""),h.xp6(5),h.hij(" ",h.lcZ(6,8,"POND_MOD.FEED")," "),h.xp6(4),h.hij("",h.lcZ(10,10,h.xi3(11,12,t.totalFeed,"1.0-1"))," kg"),h.xp6(3),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(2),h.Q6J("ngIf",t.enableSort)}}function ls(t,e){1&t&&h._UZ(0,"ion-icon",36)}function cs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",56),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).removeBlock(e)}),h.TgZ(1,"ion-button",57),h._UZ(2,"ion-icon",58),h.qZA(),h.qZA()}}function ds(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",123),h.TgZ(1,"div",107),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(5);return i.enableSort?e.stopPropagation():i.presentEnviromentUpdate(e)}),h.TgZ(2,"div",92),h.TgZ(3,"span"),h._uU(4),h.ALo(5,"number"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(6,"div"),h.TgZ(7,"small"),h.TgZ(8,"b"),h._uU(9),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw(5);h.xp6(1),h.Q6J("appPermission",h.DdM(7,Go))("permissionAction",i.pondService.permission),h.xp6(3),h.Oqu(h.xi3(5,4,t.quantity,"1.0-1")),h.xp6(5),h.Oqu(t.product_name)}}function us(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",124),h.TgZ(1,"div",107),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(5);return i.enableSort?e.stopPropagation():i.presentEnviromentUpdate(e)}),h.TgZ(2,"div",92),h._UZ(3,"ion-icon",110),h.qZA(),h.qZA(),h.TgZ(4,"div"),h.TgZ(5,"small"),h.TgZ(6,"b"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.qZA(),h.qZA(),h._UZ(9,"ion-ripple-effect"),h.qZA()}if(2&t){const t=h.oxw(5);h.xp6(1),h.Q6J("appPermission",h.DdM(5,Go))("permissionAction",t.pondService.permission),h.xp6(6),h.hij(" ",h.lcZ(8,3,"POND_MOD.NO_ITEM"),"")}}function hs(t,e){if(1&t&&(h.TgZ(0,"div",104),h.YNc(1,ds,10,8,"div",121),h.YNc(2,us,10,6,"div",122),h.qZA()),2&t){const t=h.oxw(4);h.xp6(1),h.Q6J("ngForOf",null==t.todayItem?null:t.todayItem.enviroment),h.xp6(1),h.Q6J("ngIf",!t.todayItem||!t.todayItem.enviroment||0==(null==t.todayItem.enviroment?null:t.todayItem.enviroment.length))}}function gs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",63),h.TgZ(1,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).upBlockProperty(e)}),h._UZ(2,"ion-icon",65),h.qZA(),h.TgZ(3,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).downBlockProperty(e)}),h._UZ(4,"ion-icon",66),h.qZA(),h.qZA()}}function ps(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-card",67),h.TgZ(1,"ion-card-header",119),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(3);return i.enableSort?e.stopPropagation():i.presentEnviroment()}),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",120),h._uU(4),h.ALo(5,"translate"),h.YNc(6,ls,1,0,"ion-icon",52),h.qZA(),h.YNc(7,cs,3,0,"ion-buttons",53),h.qZA(),h.YNc(8,hs,3,2,"div",102),h.TgZ(9,"div"),h.YNc(10,gs,5,0,"ion-buttons",55),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(3);h.Q6J("ngClass",t.enableSort?"jiggleBlock":""),h.xp6(4),h.hij(" ",h.lcZ(5,6,"POND_MOD.CHEMICAL_TREATMENT")," "),h.xp6(2),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(2),h.Q6J("ngIf",t.enableSort)}}function ms(t,e){1&t&&h._UZ(0,"ion-icon",36)}function Zs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",56),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).removeBlock(e)}),h.TgZ(1,"ion-button",57),h._UZ(2,"ion-icon",58),h.qZA(),h.qZA()}}function fs(t,e){if(1&t&&(h.TgZ(0,"ion-grid"),h.TgZ(1,"ion-row",84),h.TgZ(2,"ion-col",127),h.TgZ(3,"p"),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.TgZ(6,"ion-label",128),h._uU(7),h.ALo(8,"number"),h.qZA(),h.qZA(),h.TgZ(9,"ion-col",127),h.TgZ(10,"p"),h._uU(11),h.ALo(12,"translate"),h.qZA(),h.TgZ(13,"ion-label",129),h._uU(14),h.ALo(15,"number"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw(4);h.xp6(4),h.hij(" ",h.lcZ(5,4,"WEIGHT")," "),h.xp6(3),h.hij(" ",h.xi3(8,6,null==t.todayItem?null:t.todayItem.weight,"1.0-1")," g "),h.xp6(4),h.hij(" ",h.lcZ(12,9,"POND_MOD.LOSS")," "),h.xp6(3),h.hij(" ",h.xi3(15,11,(null==t.todayItem?null:t.todayItem.loss)*(null==t.todayItem?null:t.todayItem.weight)/1e3,"1.0-1")," kg ")}}function As(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-list",43),h.TgZ(1,"ion-item"),h.TgZ(2,"ion-label",130),h._uU(3),h.ALo(4,"translate"),h.TgZ(5,"p"),h._uU(6),h.qZA(),h.qZA(),h.TgZ(7,"ion-button",131),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(4);return i.enableSort?e.stopPropagation():i.presentHealthUpdate(e)}),h._UZ(8,"ion-icon",76),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(4);h.xp6(3),h.hij(" ",h.lcZ(4,4,"POND_MOD.DESEASE")," "),h.xp6(3),h.Oqu(null==t.todayItem?null:t.todayItem.note_health),h.xp6(1),h.Q6J("appPermission",h.DdM(6,to))("currentPermission",t.pondService.permission)}}function _s(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",63),h.TgZ(1,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).upBlockProperty(e)}),h._UZ(2,"ion-icon",65),h.qZA(),h.TgZ(3,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).downBlockProperty(e)}),h._UZ(4,"ion-icon",66),h.qZA(),h.qZA()}}function vs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-card",49),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(3);return i.enableSort?e.stopPropagation():i.presentHealth()}),h.TgZ(1,"ion-card-header",125),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",126),h._uU(4),h.ALo(5,"translate"),h.YNc(6,ms,1,0,"ion-icon",52),h.qZA(),h.YNc(7,Zs,3,0,"ion-buttons",53),h.qZA(),h.YNc(8,fs,16,14,"ion-grid",13),h.YNc(9,As,9,7,"ion-list",79),h.TgZ(10,"div"),h.YNc(11,_s,5,0,"ion-buttons",55),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(3);h.Q6J("ngClass",t.enableSort?"jiggleBlock":""),h.xp6(4),h.hij(" ",h.lcZ(5,7,"POND_MOD.HEALTH")," "),h.xp6(2),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(2),h.Q6J("ngIf",t.enableSort)}}function Ts(t,e){1&t&&h._UZ(0,"ion-icon",36)}function qs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",56),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).removeBlock(e)}),h.TgZ(1,"ion-button",57),h._UZ(2,"ion-icon",58),h.qZA(),h.qZA()}}function xs(t,e){if(1&t&&(h.TgZ(0,"ion-grid",135),h.TgZ(1,"ion-row",84),h.TgZ(2,"ion-col",127),h.TgZ(3,"p"),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.TgZ(6,"ion-label",128),h._uU(7),h.ALo(8,"number"),h.ALo(9,"translate"),h.qZA(),h.qZA(),h.TgZ(10,"ion-col",127),h.TgZ(11,"p"),h._uU(12),h.ALo(13,"translate"),h.qZA(),h.TgZ(14,"ion-label",136),h._uU(15),h.ALo(16,"number"),h.ALo(17,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw(4);h.Q6J("appPermission",h.DdM(22,to))("currentPermission",t.pondService.permission),h.xp6(4),h.hij(" ",h.lcZ(5,8,"POND_MOD.OTHER_INCOME")," "),h.xp6(3),h.AsE(" ",h.xi3(8,10,null==t.todayItem?null:t.todayItem.income,"1.0-1")," ",h.lcZ(9,13,"CURRENCY_S")," "),h.xp6(5),h.hij(" ",h.lcZ(13,15,"POND_MOD.OTHER_EXPENSE")," "),h.xp6(3),h.AsE(" ",h.xi3(16,17,null==t.todayItem?null:t.todayItem.cost_other,"1.0-1")," ",h.lcZ(17,20,"CURRENCY_S")," ")}}function Os(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-list",43),h.TgZ(1,"ion-item",135),h.TgZ(2,"ion-label",130),h._uU(3),h.ALo(4,"translate"),h.TgZ(5,"p"),h._uU(6),h.qZA(),h.qZA(),h.TgZ(7,"ion-button",137),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(4);return i.enableSort?e.stopPropagation():i.presentNoteUpdate(e)}),h._UZ(8,"ion-icon",76),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(4);h.xp6(1),h.Q6J("appPermission",h.DdM(6,to))("currentPermission",t.pondService.permission),h.xp6(2),h.hij(" ",h.lcZ(4,4,"NOTE")," "),h.xp6(3),h.Oqu(null==t.todayItem?null:t.todayItem.note_general)}}function Ds(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-buttons",63),h.TgZ(1,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).upBlockProperty(e)}),h._UZ(2,"ion-icon",65),h.qZA(),h.TgZ(3,"ion-button",64),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).index;return h.oxw(2).downBlockProperty(e)}),h._UZ(4,"ion-icon",66),h.qZA(),h.qZA()}}function bs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-card",49),h.NdJ("click",function(e){h.CHM(t);const i=h.oxw(3);return i.enableSort?e.stopPropagation():i.presentNote()}),h.TgZ(1,"ion-card-header",132),h.TgZ(2,"ion-card-subtitle"),h._UZ(3,"ion-icon",133),h._uU(4),h.ALo(5,"translate"),h.YNc(6,Ts,1,0,"ion-icon",52),h.qZA(),h.YNc(7,qs,3,0,"ion-buttons",53),h.qZA(),h.YNc(8,xs,18,23,"ion-grid",134),h.YNc(9,Os,9,7,"ion-list",79),h.TgZ(10,"div"),h.YNc(11,Ds,5,0,"ion-buttons",55),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(3);h.Q6J("ngClass",t.enableSort?"jiggleBlock":""),h.xp6(4),h.hij(" ",h.lcZ(5,7,"POND_MOD.NOTE")," "),h.xp6(2),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(1),h.Q6J("ngIf",!t.enableSort),h.xp6(2),h.Q6J("ngIf",t.enableSort)}}function Ss(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"app-pond-procedure",138),h.NdJ("eventUp",function(e){return h.CHM(t),h.oxw(3).upBlockProperty(e)})("eventDown",function(e){return h.CHM(t),h.oxw(3).downBlockProperty(e)})("eventRemove",function(e){return h.CHM(t),h.oxw(3).removeBlock(e)}),h.qZA()}if(2&t){const t=h.oxw().index,e=h.oxw(2);h.Q6J("enableSort",e.enableSort)("index",t)}}function Cs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"app-pond-todo-info",138),h.NdJ("eventUp",function(e){return h.CHM(t),h.oxw(3).upBlockProperty(e)})("eventDown",function(e){return h.CHM(t),h.oxw(3).downBlockProperty(e)})("eventRemove",function(e){return h.CHM(t),h.oxw(3).removeBlock(e)}),h.qZA()}if(2&t){const t=h.oxw().index,e=h.oxw(2);h.Q6J("enableSort",e.enableSort)("index",t)}}function ys(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"app-season-info",138),h.NdJ("eventUp",function(e){return h.CHM(t),h.oxw(3).upBlockProperty(e)})("eventDown",function(e){return h.CHM(t),h.oxw(3).downBlockProperty(e)})("eventRemove",function(e){return h.CHM(t),h.oxw(3).removeBlock(e)}),h.qZA()}if(2&t){const t=h.oxw().index,e=h.oxw(2);h.Q6J("enableSort",e.enableSort)("index",t)}}function Ns(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"app-treatment",138),h.NdJ("eventUp",function(e){return h.CHM(t),h.oxw(3).upBlockProperty(e)})("eventDown",function(e){return h.CHM(t),h.oxw(3).downBlockProperty(e)})("eventRemove",function(e){return h.CHM(t),h.oxw(3).removeBlock(e)}),h.qZA()}if(2&t){const t=h.oxw().index,e=h.oxw(2);h.Q6J("enableSort",e.enableSort)("index",t)}}const Es=function(){return["company_manager","farm_manager","farm_operation","keeper_manager","pond_operator"]};function Ms(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"app-daily-cost-info",139),h.NdJ("eventUp",function(e){return h.CHM(t),h.oxw(3).upBlockProperty(e)})("eventDown",function(e){return h.CHM(t),h.oxw(3).downBlockProperty(e)})("eventRemove",function(e){return h.CHM(t),h.oxw(3).removeBlock(e)}),h.qZA()}if(2&t){const t=h.oxw().index,e=h.oxw(2);h.Q6J("appPermission",h.DdM(4,Es))("currentPermission",e.pondService.permission)("enableSort",e.enableSort)("index",t)}}function Is(t,e){if(1&t&&(h.TgZ(0,"div"),h.YNc(1,Zo,11,8,"ion-card",45),h.YNc(2,Do,12,9,"ion-card",46),h.YNc(3,Po,10,7,"ion-card",46),h.YNc(4,Fo,11,8,"ion-card",45),h.YNc(5,Xo,12,9,"ion-card",46),h.YNc(6,rs,18,15,"ion-card",46),h.YNc(7,ps,11,8,"ion-card",46),h.YNc(8,vs,12,9,"ion-card",45),h.YNc(9,bs,12,9,"ion-card",45),h.YNc(10,Ss,1,2,"app-pond-procedure",47),h.YNc(11,Cs,1,2,"app-pond-todo-info",47),h.YNc(12,ys,1,2,"app-season-info",47),h.YNc(13,Ns,1,2,"app-treatment",47),h.YNc(14,Ms,1,5,"app-daily-cost-info",48),h.qZA()),2&t){const t=e.$implicit,i=h.oxw(2);h.xp6(1),h.Q6J("ngIf","weather"==t),h.xp6(1),h.Q6J("ngIf","photo"==t),h.xp6(1),h.Q6J("ngIf",i.showDevice&&"device"==t),h.xp6(1),h.Q6J("ngIf",i.estimate&&"estimate"==t),h.xp6(1),h.Q6J("ngIf",(null==i.pondService.trackingObjects?null:i.pondService.trackingObjects.length)&&"param"==t),h.xp6(1),h.Q6J("ngIf","feed"==t),h.xp6(1),h.Q6J("ngIf","enviroment"==t),h.xp6(1),h.Q6J("ngIf","health"==t),h.xp6(1),h.Q6J("ngIf","note"==t),h.xp6(1),h.Q6J("ngIf","procedure"==t),h.xp6(1),h.Q6J("ngIf","todo"==t),h.xp6(1),h.Q6J("ngIf","season"==t),h.xp6(1),h.Q6J("ngIf","water_treatment"==t),h.xp6(1),h.Q6J("ngIf","cost"==t)}}const ws=function(t){return{disabled:t,fallbackOnBody:!0,easing:"cubic-bezier(1, 0, 0, 1)"}};function Us(t,e){if(1&t&&(h.TgZ(0,"div",44),h.YNc(1,Is,15,14,"div",38),h.qZA()),2&t){const t=h.oxw();h.Q6J("sortablejs",t.propertyBlock)("sortablejsOptions",h.VKq(3,ws,!t.enableSort)),h.xp6(1),h.Q6J("ngForOf",t.propertyBlock)}}function Ps(t,e){if(1&t&&(h.TgZ(0,"div"),h.TgZ(1,"ion-card",25),h.TgZ(2,"ion-card-content",61),h.TgZ(3,"p",140),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.TgZ(6,"ion-button",141),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(4),h.Oqu(h.lcZ(5,5,"POND_MOD.THIS_POND_HAVE_NOT_SEASON")),h.xp6(2),h.MGl("routerLink","/pond/",t.pondService.pcode,"/season-create"),h.Q6J("appPermission",h.DdM(9,to))("currentPermission",t.pondService.permission),h.xp6(1),h.hij(" ",h.lcZ(8,7,"POND_MOD.SEASON_CREATE")," ")}}function Rs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",142),h.TgZ(1,"ion-button",143),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentInfo()}),h._UZ(2,"ion-icon",144),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.Q6J("appPermission",h.DdM(5,to))("currentPermission",t.pondService.permission),h.xp6(3),h.hij(" ",h.lcZ(4,3,"POND_MOD.SETTING_AND_CONFIG")," ")}}function ks(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-fab",145),h.TgZ(1,"ion-fab-button",146),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentSuggestAdd()}),h._UZ(2,"ion-icon",147),h.qZA(),h.qZA()}}let Ys=(()=>{class t{constructor(t,e,i,n,o,s,a,r,l,c,h,g,p,m,Z){this.modalController=t,this.pondService=e,this.toastService=i,this.route=n,this.translate=o,this.tour=s,this.iotService=a,this.afs=r,this.router=l,this.cd=c,this.dblocalService=h,this.service=g,this.geoLocation=p,this.popoverController=m,this.alertController=Z,this.loadingFlag=new d.E,this.componentLoaded=[],this.favorited=!1,this.feed=[],this.totalFeed=0,this.lastTimeUpdate=u(),this.noItem=!1,this.now=(new Date).valueOf()/1e3,this.showDevice=!1,this.devices=[],this.loadingDevice=new d.E,this.disease=[],this.SITE_IMAGE=Ce.bl.FILE_PATH,this.loadingWeatherFlag=new d.E,this.farmLocation={lng:0,lat:0},this.propertyBlock=[],this.enableSort=!1,this.arrSwap=["",""],this.keyBlock=["weather","device","photo","estimate","param","feed","enviroment","health","note","procedure","todo","season","cost","water_treatment"],this.labelBlock=["Th\u1eddi ti\u1ebft","Thi\u1ebft b\u1ecb","H\xecnh \u1ea3nh","Th\u1ed1ng k\xea","Ch\u1ec9 s\u1ed1 m\xf4i tr\u01b0\u1eddng","Cho \u0103n","H\xf3a ch\u1ea5t x\u1eed l\xfd","S\u1ee9c kh\u1ecfe","Ghi ch\xfa","Quy tr\xecnh nu\xf4i","C\u1ea7n l\xe0m","M\xf9a v\u1ee5","Chi ph\xed"],this.paramKey=["ph_am","ph_pm","oxy","temperature","nh3","no2","h2s","salinity","clarity","kh","ca","mg","orp","vibrio","algae"],this.pondService.reloadSeason$=new Se.X(0),this.labelBlock=[this.translate.instant("WEATHER_MOD.TITLE"),this.translate.instant("DEVICE"),this.translate.instant("PHOTO_MOD.DAILY_PHOTO"),this.translate.instant("POND_MOD.ESTIMATE"),this.translate.instant("POND_MOD.ENVIROMENT"),this.translate.instant("POND_MOD.FEED"),this.translate.instant("POND_MOD.CHEMICAL_TREATMENT"),this.translate.instant("POND_MOD.HEALTH"),this.translate.instant("POND_MOD.NOTE"),this.translate.instant("POND_MOD.PROCEDURE"),this.translate.instant("POND_MOD.TODO"),this.translate.instant("POND_MOD.SEASON"),this.translate.instant("POND_MOD.COST")]}ngOnInit(){return(0,l.mG)(this,void 0,void 0,function*(){this.pcode=this.route.snapshot.paramMap.get("id"),this.pondService.setCode(this.pcode),this.iotService.setPondCode(this.pcode),yield this.dblocalService.getLocalData(),this.checkDBLocal(),this.getPond(),this.loadAlerNow(),this.loadSuggestNow(),this.loadSeasonData(),this.pondService.reloadSeason$.subscribe(()=>{this.loadSeasonData()})})}doRefresh(t){this.getPond(),this.loadDevice(),this.loadAlerNow(),this.loadSuggestNow(),this.loadSeasonData(),this.loadWeather(),this.pondService.reloadSeason$.next(1),t.target.complete()}checkDBLocal(){var t;if(this.pondLocalIndex=this.dblocalService.ponds.findIndex(t=>t.infor.code===this.pcode),this.pondLocalIndex>=0){const e=this.dblocalService.farms.findIndex(t=>t.infor.id==this.dblocalService.ponds[this.pondLocalIndex].infor.farm_id);e>=0&&(this.farmLocation={lng:this.dblocalService.farms[e].infor.longitude,lat:this.dblocalService.farms[e].infor.latitude}),console.log(this.dblocalService.ponds[this.pondLocalIndex].infor),this.loadWeather(),this.pondService.setPond(this.dblocalService.ponds[this.pondLocalIndex].infor),this.pondService.setPermission(this.dblocalService.ponds[this.pondLocalIndex].infor.permission),this.favorited=this.dblocalService.ponds[this.pondLocalIndex].favorite,this.devices=null===(t=this.dblocalService.ponds[this.pondLocalIndex])||void 0===t?void 0:t.devices;let i=[],n=[];this.pubs={},this.subs={},this.feedings={},this.devices.forEach(t=>{"envisor"==t.type?(this.pubs[t.device_id_fb]={},i.push(t.device_id_fb),this.pubs[t.device_id_fb]=t):"cabinet"==t.type?(this.subs[t.device_id_fb]={},n.push(t.device_id_fb),this.subs[t.device_id_fb]=t):"feeding"==t.type&&(this.feedings[t.device_id_fb]={},this.feedings[t.device_id_fb]=t)}),0==i.length&&0==n.length&&0==Object.keys(this.feedings).length?this.loadDevice():(this.showDevice=!0,this.loadDataDevice(i))}else this.getPond(),this.favorited=!1}loadDevice(){return(0,l.mG)(this,void 0,void 0,function*(){let t=yield this.iotService.list().catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});if(t&&1==t.status){let e=[],i=[];this.pubs={},this.subs={},this.feedings={},this.devices=[],t.data.forEach(t=>{this.devices.push(t),"envisor"==t.type?(this.pubs[t.device_id_fb]={},e.push(t.device_id_fb),this.pubs[t.device_id_fb]=t):"cabinet"==t.type?(this.subs[t.device_id_fb]={},i.push(t.device_id_fb),this.subs[t.device_id_fb]=t):"feeding"==t.type&&(this.feedings[t.device_id_fb]={},this.feedings[t.device_id_fb]=t)}),this.showDevice=0!=e.length||0!=i.length||0!=Object.keys(this.feedings).length,this.pondLocalIndex>=0&&this.dblocalService.updateItem("ponds",{infor:this.pondService.pond,favorite:this.favorited,devices:this.devices},this.pondLocalIndex),this.loadDataDevice(e)}else t&&0==t.status&&this.toastService.warning(t.error)})}loadDataDevice(t){return(0,l.mG)(this,void 0,void 0,function*(){this.loadingDevice.setPending(!0);let e=0;if(t.length>0){const i=yield this.afs.collection("pub",e=>e.where("__name__","in",t)).get().toPromise();for(const n of i.docs){let i=n.id,o=yield n.ref.collection("factors").get();this.pubs[i].indexs={},this.pubs[i].listIndexLabel=[],this.pubs[i].last=0;for(const t of o.docs)console.log(i,":",t.data().name),this.pubs[i].indexs[t.data().name]={},this.pubs[i].listIndexLabel.push(t.data().name);this.pubs[i].listIndexLabel.sort(),n.ref.collection("factors").onSnapshot(t=>{t.forEach(t=>{let e=t.data();t.ref.collection("data").limit(1).orderBy("time","desc").onSnapshot(t=>{t.forEach(t=>{let n=t.data().time.toMillis();parseInt(n)>parseInt(this.pubs[i].last)&&(this.pubs[i].last=n),this.pubs[i].indexs[e.name].ui=e.ui,this.pubs[i].indexs[e.name].last=t.data()})})})}),e+=1,e==t.length&&(this.cd.detectChanges(),this.loadingDevice.setResult(!0))}}})}presentPubDetail(t){this.router.navigateByUrl("pond/"+this.pondService.pcode+"/pub/"+t.device_id_fb)}presentSubDetail(t){this.router.navigateByUrl("pond/"+this.pondService.pcode+"/sub/"+t.device_id_fb)}presentFeedDetail(t){this.router.navigateByUrl("pond/"+this.pondService.pcode+"/feed/"+t)}calculateColor(t){return t||"#244988"}ionViewDidEnter(){}ngOnDestroy(){this.pondService.destroy(),this.pondService.reloadSeason$.unsubscribe()}getPond(){this.pondService.loadPond().pipe().subscribe(t=>{0==t.status?this.toastService.warning(t.error):(this.pondService.setPond(t.data),(!t.permission||"keeper_manager"==t.permission)&&t.farm_lab&&(t.permission=t.farm_lab.permission),this.pondService.setPermission(t.permission),this.pondService.labPermission=t.farm_lab,t.data.in_lab&&(this.pondService.pondInLab=!0),console.log(this.pondService.pondInLab))},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}loadSeasonData(){this.pondService.loadToday().subscribe(t=>{if(t.start_season){this.pondService.seasonStart=!0,this.pondService.seasonStartTime=u(1e3*t.season.start_time),this.pondService.setTracking(t.season.tracking_factor,t.season.feed_no),this.seasonInfo=t.season,this.pondService.seasonInfo.seedQuantity=t.season.seed_quantity,this.propertyBlock=""!=this.seasonInfo.config_block?this.seasonInfo.config_block.split(","):this.keyBlock,console.log("response"),t.lastday.length>0?(this.readValueParamOfDay(t.lastday[0]),this.todayItem=t.lastday[0],this.SITE_IMAGE=Ce.bl.FILE_PATH,this.SITE_IMAGE+="/upload/season/"+this.seasonInfo.code+"/ge_image/",this.lastTimeUpdate=this.todayItem.edit_time>0?u(new Date(1e3*this.todayItem.edit_time)):this.todayItem.time>0?u(new Date(1e3*this.todayItem.time)):u()):(this.todayItem=this.pondService.createNotExistDay(),this.noItem=!0),t.estimate&&(this.processEstimate(t.estimate),this.estimateProcedure=t.estimate.procedure);let e=this.dblocalService.ponds.findIndex(t=>t.infor.code===this.pondService.pcode),i=this.pondService.pond;i.permission=this.pondService.permission,"undefined"!==this.seasonInfo?(i.seed_date=this.seasonInfo.seed_date,i.current_season=this.seasonInfo.code,i.start_time=this.seasonInfo.start_time):(i.seed_date=0,i.current_season="",i.start_time=0),e<0?(this.dblocalService.addItem("ponds",{infor:i,devices:this.devices}),this.pondLocalIndex=this.dblocalService.ponds.length):(this.pondLocalIndex=e,console.log(e),this.dblocalService.updateItem("ponds",{infor:i,favorite:this.favorited,devices:this.devices},e)),this.processFeed(),t.disease.length>0&&(this.disease=t.disease)}},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}readValueParamOfDay(t){this.pondService.trackingObjects.forEach((e,i)=>{this.pondService.trackingObjects[i].values.push(t[e.key])})}processFeed(){this.feed=[],this.totalFeed=0;for(let t=1;t<=this.pondService.numRepast;t++)this.feed.push([]);console.log(this.feed),this.todayItem.feed&&(console.log(this.todayItem.feed),this.todayItem.feed.forEach(t=>{let e=0;t.times<=this.feed.length&&(this.feed[t.times-1].quantity&&(e=this.feed[t.times-1].quantity),this.feed[t.times-1]={quantity:e+Number(t.quantity)*t.packing}),this.totalFeed+=+t.quantity*t.packing}))}processEstimate(t){this.estimate={},this.estimate.old=Math.round((this.now-this.seasonInfo.seed_date)/86400);let e=0;if(this.estimate.totalSeedWeight=t.sum.total_seed_weight>0?t.sum.total_seed_weight:+this.seasonInfo.seed_weight*(parseInt(this.seasonInfo.seed_quantity)-parseInt(t.sum.loss))/1e3,t.sum.feed_today=t.sum.feed_today?t.sum.feed_today:0,console.log(t),t.weight.length>0){if(e=u(this.lastTimeUpdate).diff(u(t.weight[0].date),"days"),0==e)this.estimate.weight=null!=t.weight[0].weight?t.weight[0].weight:this.seasonInfo.seed_weight,this.estimate.grow_speed=null!=t.procedure?t.procedure.grow_speed:0,console.log("jo:"+this.estimate.weight);else if(t.weight.length<2)this.estimate.grow_speed=(t.weight[0].weight-this.seasonInfo.seed_weight)/this.estimate.old,this.estimate.weight=this.estimate.grow_speed*e+parseInt(t.weight[0].weight),console.log(this.estimate.weight);else{let i=u(t.weight[0].date).diff(u(t.weight[1].date),"days");console.log(i),this.estimate.grow_speed=(t.weight[0].weight-t.weight[1].weight)/i,this.estimate.weight=this.estimate.grow_speed*e+parseInt(t.weight[0].weight),console.log(this.estimate.weight)}this.estimate.quantity_pcs=parseInt(this.seasonInfo.seed_quantity)-parseInt(t.sum.loss),this.estimate.quantity=parseInt(this.estimate.weight)*parseInt(this.estimate.quantity_pcs)/1e3,this.estimate.FCR=t.sum.feed_today/(this.estimate.quantity-this.estimate.totalSeedWeight),this.estimate.feed=parseInt(t.sum.feed_today),0==+this.estimate.grow_speed&&(this.estimate.grow_speed=(t.weight[0].weight-this.seasonInfo.seed_weight)/this.estimate.old)}else t.procedure?(this.estimate.grow_speed=t.procedure.grow_speed,this.estimate.weight=this.estimate.old<t.procedure.culture_day?this.estimate.grow_speed*this.estimate.old+parseFloat(this.seasonInfo.seed_weight):this.estimate.grow_speed*t.procedure.culture_day+parseFloat(this.seasonInfo.seed_weight)):(this.estimate.grow_speed=0,this.estimate.weight=this.seasonInfo.seed_weight),this.estimate.quantity_pcs=parseInt(this.seasonInfo.seed_quantity),this.estimate.quantity=parseFloat(this.estimate.weight)*parseInt(this.estimate.quantity_pcs)/1e3,this.estimate.FCR=t.sum.feed_today/(this.estimate.quantity-this.estimate.totalSeedWeight),this.estimate.feed=t.sum.feed_today;console.log(this.estimate)}presentEstimate(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:De,componentProps:{data:this.estimate,procedure:this.estimateProcedure,season:this.seasonInfo}})).present()})}presentInfo(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:Lt,componentProps:{subs:this.subs,pubs:this.pubs,feedings:this.feedings,showDevice:this.showDevice,pondLocalIndex:this.pondLocalIndex}});return t.onDidDismiss().then(t=>{}),yield t.present()})}presentAlert(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:f})).present()})}loadAlerNow(){this.loadingFlag.setPending(!0),this.pondService.getAlertNow().pipe().subscribe(t=>{t.error||(this.alertItems=t.data.map(t=>(t.time=u(1e3*t.add_time).fromNow(),t)),this.alertItems=this.alertItems.slice(0,3)),this.loadingFlag.setResult(!0)},t=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}presentSuggest(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:N})).present()})}loadSuggestNow(){this.loadingFlag.setPending(!0),this.pondService.getSuggestNow().pipe().subscribe(t=>{t.error||(this.suggestItems=t.data.map(t=>(t.time=u(1e3*t.add_time).fromNow(),t)),this.suggestItems=this.suggestItems.slice(0,3)),this.loadingFlag.setResult(!0)},t=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}presentParameter(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:S})).present()})}presentDisease(t,e){return(0,l.mG)(this,void 0,void 0,function*(){const i=yield this.modalController.create({component:be,componentProps:{timeStartStamp:this.seasonInfo.add_time,timeEndStamp:this.todayItem.time,item:e}});return i.onDidDismiss().then(e=>{e.data&&this.disease.splice(t,1)}),yield i.present()})}presentParameterUpdate(t,e){return(0,l.mG)(this,void 0,void 0,function*(){t.target&&t.stopPropagation();const i=yield this.modalController.create({component:T,componentProps:{factor:e}});return i.onDidDismiss().then(t=>{if(t.data){console.log(t.data),this.todayItem[e.key]=t.data.value;let i=this.pondService.trackingObjects.findIndex(t=>t.key==e.key);this.pondService.trackingObjects[i].values[0]=parseFloat(t.data.value.toString().replace(",",".")),this.lastTimeUpdate=u()}}),yield i.present()})}presentFeed(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:Q})).present()})}presentFeedUpdate(t,e){return(0,l.mG)(this,void 0,void 0,function*(){console.log(this.todayItem),t.target&&t.stopPropagation();const i=yield this.modalController.create({component:Kt,componentProps:{repast:e,item:this.todayItem}});return i.onDidDismiss().then(t=>{t.data&&t.data.date==u().format("YYYY-MM-DD")&&(this.totalFeed=0,console.log(t.data),t.data.repast.forEach((e,i)=>{let n=0;this.feed[i].quantity=0,e.feeds.forEach(t=>{n+=Number(t.quantity*t.packing),this.feed[i].quantity+=+t.quantity*t.packing}),this.totalFeed+=+n,console.log(this.feed[i]),this.converRepastToItem(t.data)}),this.lastTimeUpdate=u())}),yield i.present()})}converRepastToItem(t){let e=[];t.repast.forEach((t,i)=>{t.feeds.forEach(t=>{e.push({times:i+1,product_id:t.kind,quantity:t.quantity,type:1})})}),this.todayItem.feed=e,this.todayItem.blend=[],this.todayItem.date=t.date}presentEnviroment(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:G})).present()})}presentEnviromentUpdate(t){return(0,l.mG)(this,void 0,void 0,function*(){t.target&&t.stopPropagation();const e=yield this.modalController.create({component:oe,componentProps:{item:this.todayItem}});return e.onDidDismiss().then(t=>{t.data&&(Object.assign(this.todayItem,{enviroment:t.data}),this.lastTimeUpdate=u())}),yield e.present()})}presentHealth(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:tt})).present()})}presentHealthUpdate(t){return(0,l.mG)(this,void 0,void 0,function*(){t.target&&t.stopPropagation();const e=yield this.modalController.create({component:ce,componentProps:{item:this.todayItem,disease:this.disease}});return e.onDidDismiss().then(t=>{console.log(t.data),console.log(this.todayItem.date),t.data&&t.data.date==this.todayItem.date&&(this.todayItem.loss=t.data.loss,this.todayItem.weight=t.data.weight,this.todayItem.note_health=t.data.note,this.disease=[],console.log(t.data),t.data.disease.length>0?(t.data.disease.forEach(t=>{0==this.disease.filter(e=>e.disease_name==t.name).length&&this.disease.push({id:0,disease_id:t.id,name:t.name,processed:0})}),this.pondService.pond.warning=1):this.pondService.pond.warning=0,this.lastTimeUpdate=u())}),yield e.present()})}presentNote(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:_e})).present()})}presentNoteUpdate(t){return(0,l.mG)(this,void 0,void 0,function*(){t.target&&t.stopPropagation();const e=yield this.modalController.create({component:de,componentProps:{item:this.todayItem}});return e.onDidDismiss().then(t=>{t.data&&(this.todayItem.cost_other=t.data.cost,this.todayItem.income=t.data.income,this.todayItem.note_general=t.data.note,this.lastTimeUpdate=u())}),yield e.present()})}presentSuggestAdd(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:ge});return t.onDidDismiss().then(t=>{}),yield t.present()})}loadComponent(t){this.componentLoaded.push(!0),0==this.seasonInfo.procedure_id&&this.componentLoaded.push(!0),t.target.complete(),console.log(this.componentLoaded.length),this.componentLoaded.length>=4&&(t.target.disabled=!0)}addFavorite(){this.favorited?(this.dblocalService.removeFavorite(this.pondService.pond),this.favorited=!1,this.toastService.success(this.translate.instant("POND_MOD.FAVORITE_REMOVED"))):(this.dblocalService.addFavorite(this.pondService.pond),this.toastService.success(this.translate.instant("POND_MOD.FAVORITE_ADDED")),this.favorited=!0)}getMomentTime(t){return u(t).fromNow()}loadWeather(){this.farmLocation.lat&&this.farmLocation.lng?this.requestWeather():this.geoLocation.getCurrentPosition().then(t=>{this.farmLocation={lng:t.coords.longitude,lat:t.coords.latitude},this.requestWeather()}).catch(t=>{this.toastService.warning(this.translate.instant("ASSISTANT.NEED_PER_LOCALTION"))})}requestWeather(){this.loadingWeatherFlag.setPending(!0),this.service.getWeatherToday(this.farmLocation.lat,this.farmLocation.lng).pipe().subscribe(t=>{this.processWeatherData(t),this.loadingWeatherFlag.setResult(!0)},t=>{this.loadingWeatherFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}processWeatherData(t){this.weatherWeekData=t.daily;let e=t.daily[0];this.weatherData={temp:(e.temp.day-273.15).toFixed(2),temp_max:(e.temp.max-273.15).toFixed(2),weather:e.weather[0].description,icon:`http://openweathermap.org/img/w/${e.weather[0].icon}.png`}}presentWeatherPredict(){return(0,l.mG)(this,void 0,void 0,function*(){return this.weatherWeekData?yield(yield this.modalController.create({component:Me.J,componentProps:{data:this.weatherWeekData}})).present():void 0})}openUploadImage(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:Ee.a,cssClass:"my-custom-class",componentProps:{inforDaily:this.todayItem,scode:this.seasonInfo.code}});return t.onDidDismiss().then(t=>{t.data&&t.data.date==this.todayItem.date&&(this.todayItem.image=t.data.image?t.data.image:this.todayItem.image,this.todayItem.description=t.data.description,this.lastTimeUpdate=u())}),yield t.present()})}openDailyPhoto(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:Ne.F,cssClass:"my-custom-class",componentProps:{inforDaily:this.todayItem,scode:this.seasonInfo.code}})).present()})}presentPopoverMenu(t){return(0,l.mG)(this,void 0,void 0,function*(){const e=yield this.popoverController.create({component:we.A,cssClass:"my-custom-class",event:t,translucent:!0});yield e.present();const{data:i}=yield e.onDidDismiss();null!=i&&("setting"==i?this.presentInfo():"sort"==i?this.enableSort=!0:"add-item"==i&&this.presentAlertAddBlock())})}checkJson(t){return!!/^[\],:{}\s]*$/.test(t.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}removeBlock(t){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("POND_MOD.CONFIRM"),message:this.translate.instant("POND_MOD.CONFIRM_DELETE"),buttons:[{text:"NO",role:"cancel",cssClass:"secondary",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"OK",handler:()=>{this.propertyBlock.splice(t,1)}}]})).present()})}saveProperty(){this.pondService.updateConfigBlock(this.seasonInfo.code,{config:this.propertyBlock}).subscribe(t=>{1==t.status?(this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")),this.enableSort=!1,this.loadingFlag.setResult(!0)):(this.toastService.warning(t.error),this.enableSort=!1,this.propertyBlock=""!=this.seasonInfo.config_block?this.seasonInfo.config_block.split(","):this.keyBlock)},t=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}addProperty(t){this.propertyBlock.unshift(t),this.pondService.updateConfigBlock(this.seasonInfo.code,{config:this.propertyBlock}).subscribe(t=>{1==t.status?(this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")),this.loadingFlag.setResult(!0)):(this.toastService.warning(t.error),this.propertyBlock.splice(0,1))},t=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}upBlockProperty(t){if(0==t)return;let e=this.propertyBlock[t-1];this.propertyBlock[t-1]=this.propertyBlock[t],this.propertyBlock[t]=e,this.arrSwap=[this.propertyBlock[t-1],this.propertyBlock[t]]}downBlockProperty(t){if(t==this.propertyBlock.length-1)return;let e=this.propertyBlock[t+1];this.propertyBlock[t+1]=this.propertyBlock[t],this.propertyBlock[t]=e,this.arrSwap=[this.propertyBlock[t],this.propertyBlock[t+1]]}presentAlertAddBlock(){return(0,l.mG)(this,void 0,void 0,function*(){let t=[],e=this;this.keyBlock.forEach(function(i,n){!e.propertyBlock.includes(i)&&"water_treatment"!==i&&t.push({name:"radio"+n,type:"radio",label:e.labelBlock[n],value:i})}),0!=t.length?yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("POND_MOD.ADD_ITEM"),inputs:t,buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{t&&this.addProperty(t)}}]})).present():this.toastService.warning(this.translate.instant("POND_MOD.EMPTY_ITEM"))})}presentAlertParamsConfig(){return(0,l.mG)(this,void 0,void 0,function*(){let t=[];this.paramKey.forEach(e=>{t.push({name:e,type:"checkbox",label:this.translate.instant("POND_MOD.PARAM."+e.toUpperCase()),value:e,checked:!!this.pondService.trackingPamameters.includes(e)})}),yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("SETTINGS"),inputs:t,buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.pondService.updateConfigSeason("param",{listParam:t}).subscribe(e=>{1==e.status?(this.pondService.setTracking(this.getNewFactor(t),this.seasonInfo.feed_no),this.readValueParamOfDay(this.todayItem),this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS"))):this.toastService.warning(e.error)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}]})).present()})}getNewFactor(t){let e=t.join(",");for(let i=1;i<=this.seasonInfo.feed_no;i++)e+=",feed"+i;return","==e[0]&&(e=e.substring(1)),e}presentAlertFeedConfig(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("SETTINGS"),inputs:[{name:"feed_no",type:"number",id:"feed_no",value:this.seasonInfo.feed_no,placeholder:this.translate.instant("POND_MOD.REPAST")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.pondService.updateConfigSeason("feed",t).subscribe(e=>{1==e.status?(this.seasonInfo.feed_no=t.feed_no,this.pondService.setTracking(this.getNewFactor(this.pondService.trackingPamameters),this.seasonInfo.feed_no),this.processFeed(),this.readValueParamOfDay(this.todayItem),this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS"))):this.toastService.warning(e.error)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}]})).present()})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(A.k),h.Y36(s.gz),h.Y36(g.sK),h.Y36(Ue.M),h.Y36(Nt.d),h.Y36(Pe.ST),h.Y36(s.F0),h.Y36(h.sBO),h.Y36(nt.T),h.Y36(ye.F),h.Y36(Ie.b),h.Y36(a.Dh),h.Y36(a.Br))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond"]],viewQuery:function(t,e){if(1&t&&(h.Gf(a.ju,5),h.Gf(a.W2,5)),2&t){let t;h.iGM(t=h.CRH())&&(e.infiniteScroll=t.first),h.iGM(t=h.CRH())&&(e.content=t.first)}},decls:24,vars:14,consts:[["slot","start"],["text","","defaultHref","tabs/management"],["slot","end"],[3,"click"],["color","primary","slot","icon-only","name","star-outline",4,"ngIf"],["slot","icon-only","name","star",4,"ngIf"],["class","btnSort","slot","end",3,"appPermission","currentPermission",4,"ngIf"],[1,"title"],["slot","end","fill","clear",3,"click",4,"ngIf"],["slot","fixed",3,"ionRefresh",4,"ngIf"],["class","spiner-loading",4,"ngIf"],["mode","ios",4,"ngIf"],["mode","ios","color","secondary",4,"ngIf"],[4,"ngIf"],[3,"sortablejs","sortablejsOptions",4,"ngIf"],["class","ion-padding-bottom",3,"appPermission","currentPermission",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],["color","primary","slot","icon-only","name","star-outline"],["slot","icon-only","name","star"],["slot","end",1,"btnSort",3,"appPermission","currentPermission"],["slot","icon-only","ios","ellipsis-vertical","md","ellipsis-vertical"],["slot","end","fill","clear",3,"click"],["slot","fixed",3,"ionRefresh"],[1,"spiner-loading"],["name","dots"],["mode","ios"],["mode","ios","color","secondary"],["color","danger","mode","ios",3,"click",4,"ngIf"],["mode","ios",3,"click",4,"ngIf"],["color","warning"],["name","bug-outline",1,"icon-f"],[1,"ion-margin-top",3,"appPermission","permissionAction"],["outline","","color","danger",3,"disabled","click",4,"ngFor","ngForOf"],["outline","","color","danger",3,"disabled","click"],["color","danger","mode","ios",3,"click"],["name","warning-outline",1,"icon-f"],["name","chevron-forward-outline",1,"icon-detail"],["lines","none"],[4,"ngFor","ngForOf"],["mode","ios",3,"click"],["color","success"],["name","bulb-outline",1,"icon-f"],["color","primary","name","chevron-forward-outline",1,"icon-detail"],["lines","none","mode","ios"],[3,"sortablejs","sortablejsOptions"],["mode","ios",3,"ngClass","click",4,"ngIf"],["mode","ios",3,"ngClass",4,"ngIf"],[3,"enableSort","index","eventUp","eventDown","eventRemove",4,"ngIf"],[3,"appPermission","currentPermission","enableSort","index","eventUp","eventDown","eventRemove",4,"ngIf"],["mode","ios",3,"ngClass","click"],[1,"forcast"],["name","partly-sunny-outline",1,"icon-f"],["class","icon-detail","name","chevron-forward-outline",4,"ngIf"],["class","btnRemoveBlock",3,"click",4,"ngIf"],["class","ion-text-left ion-margin-top",4,"ngIf"],["class","ion-float-end",4,"ngIf"],[1,"btnRemoveBlock",3,"click"],["size","small","color","light"],["name","close"],[1,"ion-text-left","ion-margin-top"],["class","ion-text-center",4,"ngIf"],[1,"ion-text-center"],[3,"color"],[1,"ion-float-end"],["size","small","color","tertiary",3,"click"],["name","chevron-up-circle-outline"],["name","chevron-down-circle-outline"],["mode","ios",3,"ngClass"],[1,"photo",3,"click"],["name","camera-outline",1,"icon-f"],["class","ion-float-right","slot","end","shape","round","fill","clear","size","default",3,"appPermission","currentPermission","click",4,"ngIf"],["class","boxPhoto",4,"ngIf"],[1,"ion-padding-top"],[1,"boxPhoto"],[1,"photoDaily",3,"src"],["slot","end","shape","round","fill","clear","size","default",1,"ion-float-right",3,"appPermission","currentPermission","click"],["name","add-circle-outline","slot","icon-only"],[1,"device"],["name","hardware-chip-outline",1,"icon-f"],["lines","none","mode","ios",4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],["class","ion-margin-bottom",3,"click",4,"ngFor","ngForOf"],["src","assets/icon/envisor.svg","slot","start"],["slot","end","name","chevron-forward-outline"],[1,"ion-align-items-start"],["size","6","size-md","3","class","ion-text-center",4,"ngFor","ngForOf"],["type","indeterminate"],["size","6","size-md","3",1,"ion-text-center"],["class","box",4,"ngIf"],[1,"box"],[3,"ngStyle"],[1,"item-device"],[1,"value"],[1,"ion-margin-bottom",3,"click"],["src","assets/icon/cabinet.svg","slot","start"],["src","assets/icon/feeding.svg","slot","start"],[1,"estimate"],["name","medical-outline",1,"icon-f"],["lines","none",4,"ngIf"],["slot","end",1,"ion-margin"],[1,"param",3,"click"],["src","assets/icon/gauser.svg",1,"icon-f"],["class","block",4,"ngIf"],["class","ion-float-right",4,"ngIf"],[1,"block"],["class","elementBlock ion-activatable ripple-parent",3,"ngStyle",4,"ngFor","ngForOf"],[1,"elementBlock","ion-activatable","ripple-parent",3,"ngStyle"],[1,"detailElement",3,"appPermission","permissionAction","click"],[1,"value",3,"ngStyle"],["name","add-outline",4,"ngIf"],["name","add-outline"],[1,"ion-float-right"],["size","small","color","light",3,"appPermission","currentPermission","click"],["name","build"],[1,"feed",3,"click"],["src","assets/icon/fertilizer.svg",1,"icon-f"],[1,"totalResult"],["class","elementBlock styleFeed ion-activatable ripple-parent",4,"ngFor","ngForOf"],[1,"elementBlock","styleFeed","ion-activatable","ripple-parent"],[1,"enviro",3,"click"],["name","water-outline",1,"icon-f"],["class","elementBlock styleEnviro",4,"ngFor","ngForOf"],["class","elementBlock styleEnviro ion-activatable ripple-parent",4,"ngIf"],[1,"elementBlock","styleEnviro"],[1,"elementBlock","styleEnviro","ion-activatable","ripple-parent"],[1,"health"],["name","heart-outline",1,"icon-f"],["size","6","size-md","6",1,"ion-text-center"],["color","success",1,"labelBigSize"],["color","danger",1,"labelBigSize"],[1,"ion-text-wrap"],["slot","end","shape","round","fill","clear","size","default",3,"appPermission","currentPermission","click"],[1,"note"],["name","clipboard-outline",1,"icon-f"],[3,"appPermission","currentPermission",4,"ngIf"],[3,"appPermission","currentPermission"],["color","warning",1,"labelBigSize"],["slot","end","shape","round","fill","clear","size","default",3,"click"],[3,"enableSort","index","eventUp","eventDown","eventRemove"],[3,"appPermission","currentPermission","enableSort","index","eventUp","eventDown","eventRemove"],[1,"ion-padding"],["shape","round","color","primary",3,"routerLink","appPermission","currentPermission"],[1,"ion-padding-bottom",3,"appPermission","currentPermission"],["color","medium","expand","block","shape","round","fill","clear",3,"click"],["name","cog-outline","slot","start"],["vertical","bottom","horizontal","end","slot","fixed"],["color","secondary",3,"click"],["name","chatbubbles-outline"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.qZA(),h.TgZ(4,"ion-buttons",2),h.TgZ(5,"ion-button",3),h.NdJ("click",function(){return e.addFavorite()}),h.YNc(6,Vn,1,0,"ion-icon",4),h.YNc(7,jn,1,0,"ion-icon",5),h.qZA(),h.qZA(),h.YNc(8,Gn,3,3,"ion-buttons",6),h.TgZ(9,"ion-title",7),h._uU(10),h.qZA(),h.YNc(11,Bn,3,3,"ion-button",8),h.qZA(),h.qZA(),h.TgZ(12,"ion-content"),h.YNc(13,zn,2,0,"ion-refresher",9),h.TgZ(14,"div"),h.YNc(15,$n,2,0,"div",10),h.YNc(16,Wn,5,4,"ion-card",11),h.YNc(17,Xn,5,3,"ion-card",12),h.YNc(18,ro,5,4,"div",13),h.YNc(19,Us,2,5,"div",14),h.qZA(),h.TgZ(20,"div"),h.YNc(21,Ps,9,10,"div",13),h.qZA(),h.YNc(22,Rs,5,6,"div",15),h.YNc(23,ks,3,0,"ion-fab",16),h.qZA()),2&t&&(h.xp6(6),h.Q6J("ngIf",!e.favorited),h.xp6(1),h.Q6J("ngIf",e.favorited),h.xp6(1),h.Q6J("ngIf",!e.enableSort),h.xp6(2),h.Oqu(null==e.pondService||null==e.pondService.pond?null:e.pondService.pond.name),h.xp6(1),h.Q6J("ngIf",e.enableSort),h.xp6(2),h.Q6J("ngIf",!e.enableSort),h.xp6(2),h.Q6J("ngIf",e.loadingFlag.pending),h.xp6(1),h.Q6J("ngIf",!e.noItem&&e.pondService.seasonStart),h.xp6(1),h.Q6J("ngIf",e.noItem),h.xp6(1),h.Q6J("ngIf",e.pondService.seasonStart),h.xp6(1),h.Q6J("ngIf",e.pondService.seasonStart),h.xp6(2),h.Q6J("ngIf",!e.pondService.seasonStart&&!e.loadingFlag.pending),h.xp6(1),h.Q6J("ngIf",!e.enableSort),h.xp6(1),h.Q6J("ngIf","pond_expert"==e.pondService.permission))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,a.YG,n.O5,a.wd,a.W2,a.gu,ve.l,a.nJ,a.Wo,a.PQ,a.PM,a.FN,a.Zi,a.tO,n.sg,a.hM,a.Q$,a.q_,a.Ie,Re.r,ke.QN,n.mk,a.yW,a.jY,a.Nd,a.X7,a.wI,n.PC,a.H$,ei,mi,En,Mn.f,Qn,a.YI,s.rH,a.IJ,a.W4],pipes:[g.X$,n.Nd,n.JJ,n.gd],styles:["[_nghost-%COMP%]   h6[_ngcontent-%COMP%]{padding:20px}[_nghost-%COMP%]   ion-col[_ngcontent-%COMP%]{-webkit-padding-end:2px!important;padding-inline-end:2px!important;-webkit-padding-start:2px!important;padding-inline-start:2px!important}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1rem}[_nghost-%COMP%]   .item-device[_ngcontent-%COMP%]{font-size:small;text-transform:uppercase}[_nghost-%COMP%]   .unit-device[_ngcontent-%COMP%]{font-size:65%;font-family:Atomic}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{height:100%;margin-bottom:1em}[_nghost-%COMP%]   .value[_ngcontent-%COMP%]{font-family:Atomic}[_nghost-%COMP%]   .device[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#FF8C00,#3dc2ff)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#498205,#3dc2ff)}[_nghost-%COMP%]   .note[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#ffb900,#3dc2ff)}[_nghost-%COMP%]   .feed[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#ca5010,#3dc2ff)}[_nghost-%COMP%]   .feed[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{display:flex;justify-content:space-between}[_nghost-%COMP%]   .feed[_ngcontent-%COMP%]   .totalResult[_ngcontent-%COMP%]{font-size:1rem}[_nghost-%COMP%]   .cost[_ngcontent-%COMP%]{background-color:#ffcdd2!important}[_nghost-%COMP%]   .param[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#00cc6a,#3dc2ff)}[_nghost-%COMP%]   .enviro[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#00B294,#3dc2ff)}[_nghost-%COMP%]   .estimate[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#767676,#3dc2ff)}[_nghost-%COMP%]   .forcast[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#ec2727,#f0de0a)}[_nghost-%COMP%]   .photo[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#0042cc,#75afe9)}[_nghost-%COMP%]   .boxPhoto[_ngcontent-%COMP%]{width:100%;padding:20px 20px 0}[_nghost-%COMP%]   .photoDaily[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .labelBigSize[_ngcontent-%COMP%]{font-size:1.5rem}[_nghost-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#fff!important;padding-left:3em}[_nghost-%COMP%]   ion-icon.icon-f[_ngcontent-%COMP%]{font-size:2em;position:absolute;left:0;top:-.2em}[_nghost-%COMP%]   .jiggleBlock[_ngcontent-%COMP%]{animation:jiggle .4s infinite,myMoveUp .5s;-webkit-animation:jiggle .4s infinite,myMoveUp .5s;-moz-animation-duration:.4s,myMoveUp .5s;-moz-animation-name:jiggle;-moz-animation-iteration-count:infinite,myMoveUp .5s;-webkit-transform:rotate(-1deg);-moz-transform:rotate(-1deg)}@keyframes jiggle{0%{transform:rotate(-1deg)}50%{transform:rotate(1deg)}}@-webkit-keyframes jiggle{0%{-webkit-transform:rotate(-1deg)}50%{-webkit-transform:rotate(1deg)}}[_nghost-%COMP%]   .btnRemoveBlock[_ngcontent-%COMP%]{position:absolute;top:0;right:0}[_nghost-%COMP%]   .disableEvent[_ngcontent-%COMP%]{pointer-events:none!important}[_nghost-%COMP%]   .moveUp[_ngcontent-%COMP%]{-webkit-animation:myMoveUp;animation:myMoveUp;-webkit-animation-duration:.5s;animation-duration:.5s}@-webkit-keyframes myMoveUp{0%{top:65px}to{top:0px}}@keyframes myMoveUp{0%{top:65px}to{top:0px}}[_nghost-%COMP%]   .moveDown[_ngcontent-%COMP%]{-webkit-animation:myMoveUp;animation:myMoveUp;-webkit-animation-duration:.5s;animation-duration:.5s}@-webkit-keyframes myMoveDown{0%{bottom:65px}to{bottom:0px}}@keyframes myMoveDown{0%{bottom:65px}to{bottom:0px}}[_nghost-%COMP%]   .btnSort[_ngcontent-%COMP%]{display:flex!important}[_nghost-%COMP%]   .block[_ngcontent-%COMP%]{padding-left:16px;overflow:auto;white-space:nowrap;margin-bottom:16px;margin-top:16px}[_nghost-%COMP%]   .block[_ngcontent-%COMP%]   .elementBlock[_ngcontent-%COMP%]{margin:5px;width:100%;border-radius:16px;display:inline-block;position:relative;max-height:95px;max-width:95px;text-align:center;padding-top:5px;padding-bottom:5px;border-style:solid;border-width:1px}[_nghost-%COMP%]   .block[_ngcontent-%COMP%]   .detailElement[_ngcontent-%COMP%]{border-radius:16px;max-width:200px;max-height:120px;font-size:2rem}[_nghost-%COMP%]   .block[_ngcontent-%COMP%]   .dailyOld[_ngcontent-%COMP%]{position:absolute;bottom:0%;padding:5px;border-radius:0 16px;background-color:#fff}[_nghost-%COMP%]   .block[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:16px}[_nghost-%COMP%]   .block[_ngcontent-%COMP%]   .styleFeed[_ngcontent-%COMP%]{color:#ca5010;border-color:#ca5010}[_nghost-%COMP%]   .block[_ngcontent-%COMP%]   .styleEnviro[_ngcontent-%COMP%]{color:#00b294;border-color:#00b294}[_nghost-%COMP%]   .block[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   ion-ripple-effect[_ngcontent-%COMP%]{border-radius:16px}"]}),t})();function Ls(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label",10),h.TgZ(2,"h3"),h._uU(3),h.qZA(),h.TgZ(4,"p"),h._uU(5),h.ALo(6,"translate"),h.ALo(7,"translate"),h.TgZ(8,"sup"),h._uU(9,"2"),h.qZA(),h.qZA(),h.TgZ(10,"p"),h._uU(11),h.qZA(),h.qZA(),h._UZ(12,"ion-radio",11),h.qZA()),2&t){const t=e.$implicit;h.xp6(3),h.Oqu(t.name),h.xp6(2),h.lnq("",h.lcZ(6,6,"POND_MOD.DENSITY")," ",t.density," ",h.lcZ(7,8,"POND_MOD.ANIMAL"),"/m"),h.xp6(6),h.Oqu(t.description),h.xp6(1),h.s9C("value",t.id)}}function Fs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-list"),h.TgZ(1,"ion-radio-group",8),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().radioChange(e)}),h.YNc(2,Ls,13,10,"ion-item",9),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(2),h.Q6J("ngForOf",t.data)}}function Js(t,e){1&t&&(h.TgZ(0,"div",5),h.TgZ(1,"ion-text",12),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.qZA()),2&t&&(h.xp6(2),h.hij(" ",h.lcZ(3,1,"POND_MOD.NOT_YET")," "))}let Qs=(()=>{class t{constructor(t){this.modalCtrl=t}ngOnInit(){}dismiss(){this.modalCtrl.dismiss()}save(){this.procedureIdSelected&&this.modalCtrl.dismiss({id:this.procedureIdSelected})}radioChange(t){this.procedureIdSelected=t.detail.value}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-procedure-list"]],inputs:{data:"data",species:"species"},decls:20,vars:13,consts:[["slot","start"],[3,"click"],["name","close","slot","icon-only"],["slot","end"],[3,"disabled","click"],[1,"ion-text-center"],[4,"ngIf"],["class","ion-text-center",4,"ngIf"],[3,"ionChange"],[4,"ngFor","ngForOf"],[1,"ion-text-wrap"],["slot","start",3,"value"],["color","medium"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h.TgZ(3,"ion-button",1),h.NdJ("click",function(){return e.dismiss()}),h._UZ(4,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(5,"ion-title"),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"ion-buttons",3),h.TgZ(9,"ion-button",4),h.NdJ("click",function(){return e.save()}),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(12,"ion-content"),h._UZ(13,"ion-searchbar"),h.TgZ(14,"div",5),h.TgZ(15,"i"),h._uU(16),h.ALo(17,"translate"),h.qZA(),h.qZA(),h.YNc(18,Fs,3,1,"ion-list",6),h.YNc(19,Js,4,3,"div",7),h.qZA()),2&t&&(h.xp6(6),h.Oqu(h.lcZ(7,7,"POND_MOD.CHOOSE_PROCEDURE")),h.xp6(3),h.Q6J("disabled",!e.procedureIdSelected),h.xp6(1),h.hij(" ",h.lcZ(11,9,"POND_MOD.SELECT")," "),h.xp6(6),h.AsE("",h.lcZ(17,11,"POND_MOD.PROCEDURE")," ",null==e.species?null:e.species.name,""),h.xp6(2),h.Q6J("ngIf",e.data),h.xp6(1),h.Q6J("ngIf",!((null==e.data?null:e.data.length)>0)))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,a.VI,a.j9,n.O5,a.q_,a.se,a.QI,n.sg,a.Ie,a.Q$,a.B7,a.U5,a.yW],pipes:[g.X$],styles:[""]}),t})();var Vs=i(6099);const js=["slides"];function Hs(t,e){if(1&t&&(h.TgZ(0,"ion-select-option",34),h._uU(1),h.qZA()),2&t){const t=e.$implicit;h.Q6J("value",t.species_id),h.xp6(1),h.Oqu(t.name)}}function Gs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",25),h.TgZ(1,"ion-item",26),h.TgZ(2,"ion-label"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h._UZ(5,"ion-datetime",27),h.ALo(6,"translate"),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"ion-item",26),h.TgZ(9,"ion-label",15),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.TgZ(12,"ion-select",28),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().selectSpecies(e.detail.value)}),h.ALo(13,"translate"),h.YNc(14,Hs,2,2,"ion-select-option",29),h.qZA(),h.qZA(),h.TgZ(15,"ion-item",26),h.TgZ(16,"ion-label",15),h._uU(17),h.ALo(18,"translate"),h.qZA(),h.TgZ(19,"ion-select",30),h.ALo(20,"translate"),h.TgZ(21,"ion-select-option",31),h._uU(22),h.ALo(23,"translate"),h.qZA(),h.TgZ(24,"ion-select-option",32),h._uU(25),h.ALo(26,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(27,"ion-item",26),h.TgZ(28,"ion-label",15),h._uU(29),h.ALo(30,"translate"),h.qZA(),h.TgZ(31,"ion-input",33),h.NdJ("ionChange",function(e){return h.CHM(t),h.oxw().formatCost(e)}),h.qZA(),h.qZA(),h.TgZ(32,"p",8),h._uU(33),h.ALo(34,"translate"),h.qZA(),h.TgZ(35,"ion-button",24),h.NdJ("click",function(){return h.CHM(t),h.oxw(),h.MAs(9).slideNext()}),h._uU(36),h.ALo(37,"translate"),h._UZ(38,"ion-icon",12),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(3),h.Oqu(h.lcZ(4,18,"POND_MOD.SEASON_CREATE_DATE")),h.xp6(2),h.Q6J("displayFormat",h.lcZ(6,20,"FORMAT_DATE_MOMENT"))("placeholder",h.lcZ(7,22,"SELECT_DATE"))("min",t.minDate.format("YYYY-MM-DD"))("max",t.maxDate.format("YYYY-MM-DD")),h.xp6(5),h.Oqu(h.lcZ(11,24,"SPECIES")),h.xp6(2),h.s9C("value",t.form.value.form1.species),h.Q6J("placeholder",h.lcZ(13,26,"POND_MOD.SELECT_SPECIES")),h.xp6(2),h.Q6J("ngForOf",t.species),h.xp6(3),h.Oqu(h.lcZ(18,28,"POND_MOD.TYPE_SEASON")),h.xp6(2),h.Q6J("placeholder",h.lcZ(20,30,"POND_MOD.SELECT_TYPE_SEASON")),h.xp6(3),h.Oqu(h.lcZ(23,32,"POND_MOD.TYPE_SEASON_INTENSIVE")),h.xp6(3),h.Oqu(h.lcZ(26,34,"POND_MOD.TYPE_SEASON_EXTENSIVE")),h.xp6(4),h.Oqu(h.lcZ(30,36,"POND_MOD.PREPARED_CODE")),h.xp6(2),h.Q6J("value",t.numberFormatCost.fakeView),h.xp6(2),h.hij(" ",h.lcZ(34,38,"POND_MOD.NOTE_PREPARE")," "),h.xp6(2),h.Q6J("disabled",t.form.controls.form1.invalid),h.xp6(1),h.hij(" ",h.lcZ(37,40,"NEXT")," ")}}function Bs(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item",26),h.TgZ(1,"ion-label"),h.TgZ(2,"ion-text",35),h.TgZ(3,"h3"),h._uU(4),h.qZA(),h.qZA(),h.TgZ(5,"p",36),h._uU(6),h.ALo(7,"translate"),h.ALo(8,"translate"),h.TgZ(9,"sup"),h._uU(10,"2"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(11,"ion-button",37),h.NdJ("click",function(){return h.CHM(t),h.oxw().procedueIndexSelected=-1}),h._UZ(12,"ion-icon",38),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(4),h.Oqu(t.procedures[t.procedueIndexSelected].name),h.xp6(2),h.lnq("",h.lcZ(7,4,"POND_MOD.DENSITY")," ",t.procedures[t.procedueIndexSelected].density," ",h.lcZ(8,6,"POND_MOD.ANIMAL"),"/m")}}function zs(t,e){1&t&&(h.TgZ(0,"div",39),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&t&&(h.xp6(1),h.hij(" ",h.lcZ(2,1,"CROP_MOD.MAX_FEED_PER_DAY_RANGE")," "))}function $s(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-col",40),h.TgZ(1,"ion-item"),h.TgZ(2,"ion-label",35),h._uU(3),h.ALo(4,"translate"),h.ALo(5,"uppercase"),h.qZA(),h.TgZ(6,"ion-checkbox",41),h.NdJ("ionChange",function(){const e=h.CHM(t).index;return h.oxw().removeParam(e)}),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.Q6J("@flyInOut","in"),h.xp6(3),h.Oqu(h.lcZ(4,5,h.lcZ(5,7,"POND_MOD.PARAM."+t.name))),h.xp6(3),h.s9C("formControlName",t.key),h.Q6J("ngModel",!0)("checked",!0)}}let Ws=(()=>{class t{constructor(t,e,i,n,s,a,r,l){this._navCtr=t,this.modalController=e,this._formBuilder=i,this.pondService=n,this.toastService=s,this.translate=a,this.alertController=r,this.dbLocalService=l,this.numberFormatCost=new it.y(""),this.saving=new d.E,this.trackingString="",this.trackingGeneralObjects=[],this.trackingAdvanceObjects=[],this.trackingAll=[],this.trackingSelected=[],this.trackingFormsGen={},this.trackingFormsAdv={},this.countTracking=0,this.dateForm=new o.NI(u().format("YYYY-MM-DD")),this.maxDate=u(),this.minDate=u().subtract(180,"days"),this.procedueIndexSelected=-1,Vs.Cs.forEach(t=>{this.trackingFormsGen[t]=new o.NI;let e=(new Vs.hz).mapByKey(t);this.trackingGeneralObjects.push(new Vs.d2(t,e.name,e.colorCls,e.colorStr,e.unit,e.max,e.min))}),Vs.SV.forEach(t=>{this.trackingFormsAdv[t]=new o.NI;let e=(new Vs.hz).mapByKey(t);this.trackingAdvanceObjects.push(new Vs.d2(t,e.name,e.colorCls,e.colorStr,e.unit,e.max,e.min))}),this.trackingAll=this.trackingGeneralObjects.concat(this.trackingAdvanceObjects),this.form=this._formBuilder.group({form1:this._formBuilder.group({date:this.dateForm,species:["",o.kI.required],type_season:["intensive",o.kI.required],cost:["",o.kI.required]}),form2:this._formBuilder.group({procedure:[""]}),form3:this._formBuilder.group({repast:["",[o.kI.required,o.kI.min(0),o.kI.max(10)]]}),form4:this._formBuilder.group(Object.assign(this.trackingFormsGen,this.trackingFormsAdv))})}ngOnInit(){this.getSeason()}save(){console.log(this.form.value),this.trackingSelected.forEach(t=>{this.trackingString+=t.key+","}),this.saving.setPending(!0);let t={pid:this.pondService.pond.id,tracking_factor:this.trackingString,date:u(this.form.value.form1.date).unix(),feed_no:this.form.value.form3.repast,procedure:0,species:this.form.value.form1.species,type_season:this.form.value.form1.type_season,prepare_cost:this.form.value.form1.cost};this.procedueIndexSelected>=0&&(t.procedure=this.procedures[this.procedueIndexSelected].id),this.pondService.saveSeason(t).subscribe(e=>{if(e.error||1!=e.status)this.toastService.warning(e.message),this.saving.setResult(!1);else{let i=this.dbLocalService.ponds.findIndex(t=>t.infor.code===this.pondService.pcode);if(i>=0){let n={infor:this.pondService.pond,devices:[]};n.infor.current_season=e.season_code,n.infor.species_id=parseInt(this.speciesSelected.id),n.infor.species=this.speciesSelected.name,n.infor.start_time=t.date,this.dbLocalService.updateItem("ponds",n,i)}this.pondService.seasonStart=!1,this.pondService.reloadSeason$.next(1),this.saving.setResult(!0),this._navCtr.pop()}},()=>{this.translate.get("CONNECT_ERROR").subscribe(t=>{this.toastService.danger(t)}),this.saving.setResult(!1)})}openProcedureList(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:Qs,componentProps:{data:this.procedures_filtered,species:this.speciesSelected}});return t.onDidDismiss().then(t=>{console.log(t),t.data&&(this.procedueIndexSelected=this.procedures.findIndex(e=>e.id===t.data.id),console.log(this.procedures),console.log(this.procedueIndexSelected))}),yield t.present()})}formatCost(t){this.numberFormatCost.setValue(t.detail.value)}getSeason(){this.pondService.reqSeason().subscribe(t=>{1==t.status?(console.log(t),this.species=t.data.species,this.procedures=t.data.procedures,t.data.species.filter(t=>!0===t.recently).map(t=>{this.selectSpecies(t.species_id),console.log("helo"),this.form.get("form1.species").patchValue(t.species_id),this.form.get("form2.procedure").setValue(t.procedure_id),this.procedueIndexSelected=this.procedures.findIndex(e=>e.id===t.procedure_id)})):this.toastService.warning(t.message)},()=>{this.translate.get("CONNECT_ERROR").subscribe(t=>{this.toastService.danger(t)})})}selectSpecies(t){console.log(t),this.species.filter(e=>e.id==t).map(t=>{this.form.get("form3.repast").setValue(t.no_feeding),t.tracking_factor.split(",").forEach(t=>{let e=this.trackingAll.findIndex(e=>e.key===t);e>-1&&(this.trackingSelected.push(this.trackingAll[e]),this.trackingAll.splice(e,1))})}),this.procedures_filtered=this.procedures.filter(e=>{if(e.species_id==t)return e}),this.speciesSelected=this.species[this.species.findIndex(e=>e.id===t)]}addParam(){return(0,l.mG)(this,void 0,void 0,function*(){let t=[];this.trackingAll.forEach(e=>{t.push({name:e.name,label:this.translate.instant("POND_MOD.PARAM."+e.name.toUpperCase()),type:"checkbox",value:e.key})}),yield(yield this.alertController.create({header:this.translate.instant("POND_MOD.INDEX"),inputs:t,buttons:[{text:this.translate.instant("OPTION.CANCEL"),role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{if(console.log(t),!t)return!1;t.forEach(t=>{let e=this.trackingAll.findIndex(e=>e.key===t);this.trackingSelected.push(this.trackingAll[e]),this.trackingAll.splice(e,1)})}}]})).present()})}removeParam(t){let e=this.trackingSelected[t];this.trackingSelected.splice(t,1),this.trackingAll.push(e)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.SH),h.Y36(a.IN),h.Y36(o.qu),h.Y36(c.p),h.Y36(A.k),h.Y36(g.sK),h.Y36(a.Br),h.Y36(nt.T))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-season-create"]],viewQuery:function(t,e){if(1&t&&h.Gf(js,5),2&t){let t;h.iGM(t=h.CRH())&&(e.slides=t.first)}},decls:62,vars:42,consts:[["slot","start"],["text","","defaultHref","tabs"],[3,"formGroup"],["slides",""],["class","w-100 ion-padding","formGroupName","form1",4,"ngIf"],["formGroupName","form2",1,"w-100","ion-padding"],["color","primary","fill","outline","shape","round",3,"click"],["lines","inset",4,"ngIf"],[1,"tip"],["shape","round","fill","clear",3,"click"],["slot","start","name","arrow-back"],["shape","round",3,"click"],["slot","end","name","arrow-forward"],[1,"w-100","ion-padding"],["lines","inset","formGroupName","form3"],["position","floating"],["type","number","min","0","max","6","inputmode","numeric","formControlName","repast"],["class","text-form-dirty",4,"ngIf"],["lines","none"],["slot","end","size","small","fill","clear",3,"click"],["slot","start","name","add"],["formGroupName","form4"],["size","6",4,"ngFor","ngForOf"],[1,"ion-padding"],["shape","round",3,"disabled","click"],["formGroupName","form1",1,"w-100","ion-padding"],["lines","inset"],["formControlName","date",3,"displayFormat","placeholder","min","max"],["formControlName","species","okText","Ok","cancelText","Dismiss",3,"value","placeholder","ionChange"],[3,"value",4,"ngFor","ngForOf"],["formControlName","type_season","okText","Ok","cancelText","Dismiss",3,"placeholder"],["value","intensive"],["value","extensive"],["formControlName","cost","inputmode","numeric",3,"value","ionChange"],[3,"value"],["color","primary"],[1,"p-info"],["slot","end","fill","clear","color","medium",3,"click"],["slot","icon-only","name","remove-circle-outline"],[1,"text-form-dirty"],["size","6"],["slot","end",3,"formControlName","ngModel","checked","ionChange"]],template:function(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.qZA(),h.TgZ(4,"ion-title"),h._uU(5),h.ALo(6,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(7,"ion-content",2),h.TgZ(8,"ion-slides",null,3),h.TgZ(10,"ion-slide"),h.YNc(11,Gs,39,42,"div",4),h.qZA(),h.TgZ(12,"ion-slide"),h.TgZ(13,"div",5),h.TgZ(14,"ion-button",6),h.NdJ("click",function(){return e.openProcedureList()}),h._uU(15),h.ALo(16,"translate"),h.qZA(),h.YNc(17,Bs,13,8,"ion-item",7),h.TgZ(18,"p",8),h._uU(19),h.ALo(20,"translate"),h.qZA(),h.TgZ(21,"ion-button",9),h.NdJ("click",function(){return h.CHM(t),h.MAs(9).slidePrev()}),h._UZ(22,"ion-icon",10),h._uU(23),h.ALo(24,"translate"),h.qZA(),h.TgZ(25,"ion-button",11),h.NdJ("click",function(){return h.CHM(t),h.MAs(9).slideNext()}),h._uU(26),h.ALo(27,"translate"),h._UZ(28,"ion-icon",12),h.qZA(),h.qZA(),h.qZA(),h.TgZ(29,"ion-slide"),h.TgZ(30,"div",13),h.TgZ(31,"h1"),h._uU(32),h.ALo(33,"translate"),h.qZA(),h.TgZ(34,"p",8),h._uU(35),h.ALo(36,"translate"),h.qZA(),h.TgZ(37,"ion-item",14),h.TgZ(38,"ion-label",15),h._uU(39),h.ALo(40,"translate"),h.qZA(),h._UZ(41,"ion-input",16),h.YNc(42,zs,3,3,"div",17),h.qZA(),h.TgZ(43,"ion-item",18),h.TgZ(44,"ion-label"),h._uU(45),h.ALo(46,"translate"),h.qZA(),h.TgZ(47,"ion-button",19),h.NdJ("click",function(){return e.addParam()}),h._UZ(48,"ion-icon",20),h._uU(49),h.ALo(50,"translate"),h.qZA(),h.qZA(),h.TgZ(51,"ion-grid",21),h.TgZ(52,"ion-row"),h.YNc(53,$s,7,9,"ion-col",22),h.qZA(),h.qZA(),h.TgZ(54,"div",23),h.TgZ(55,"ion-button",9),h.NdJ("click",function(){return h.CHM(t),h.MAs(9).slidePrev()}),h._UZ(56,"ion-icon",10),h._uU(57),h.ALo(58,"translate"),h.qZA(),h.TgZ(59,"ion-button",24),h.NdJ("click",function(){return e.save()}),h._uU(60),h.ALo(61,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA()}2&t&&(h.xp6(5),h.Oqu(h.lcZ(6,18,"POND_MOD.SEASON_CREATE")),h.xp6(2),h.Q6J("formGroup",e.form),h.xp6(4),h.Q6J("ngIf",e.species&&e.species.length),h.xp6(4),h.hij("",h.lcZ(16,20,"POND_MOD.SELECT_PROCEDURE")," "),h.xp6(2),h.Q6J("ngIf",-1!=e.procedueIndexSelected),h.xp6(2),h.hij(" ",h.lcZ(20,22,"POND_MOD.NOTE_ADD_PRO")," "),h.xp6(4),h.hij(" ",h.lcZ(24,24,"BACK")," "),h.xp6(3),h.hij("",h.lcZ(27,26,"NEXT")," "),h.xp6(6),h.Oqu(h.lcZ(33,28,"POND_MOD.CAREFUL")),h.xp6(3),h.hij(" ",h.lcZ(36,30,"POND_MOD.NOTE_CAREFUL")," "),h.xp6(4),h.Oqu(h.lcZ(40,32,"POND_MOD.MAX_FEED")),h.xp6(3),h.Q6J("ngIf",e.form.get("form3.repast").invalid&&(e.form.get("form3.repast").dirty||e.form.get("form3.repast").touched)),h.xp6(3),h.hij(" ",h.lcZ(46,34,"POND_MOD.WATER_QUANLITY_INDEX")," "),h.xp6(4),h.hij(" ",h.lcZ(50,36,"POND_MOD.ADD")," "),h.xp6(4),h.Q6J("ngForOf",e.trackingSelected),h.xp6(4),h.hij("",h.lcZ(58,38,"BACK")," "),h.xp6(2),h.Q6J("disabled",e.form.invalid),h.xp6(1),h.Oqu(h.lcZ(61,40,"CONFIRM")))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,a.wd,a.W2,o.JL,o.sg,a.Hr,a.A$,n.O5,o.x0,a.YG,a.gu,a.Ie,a.Q$,a.pK,a.as,o.JJ,o.u,a.jY,a.Nd,n.sg,a.x4,a.QI,a.t9,a.n0,a.j9,a.yW,a.wI,a.nz,a.w],pipes:[g.X$,n.gd],styles:["[_nghost-%COMP%]   ion-slides[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   ion-slides[_ngcontent-%COMP%]   .w-100[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   ion-slides[_ngcontent-%COMP%]   .tip[_ngcontent-%COMP%]{font-size:.6em;font-style:italic;padding:10px}[_nghost-%COMP%]   ion-slides[_ngcontent-%COMP%]   .p-info[_ngcontent-%COMP%]{padding:5px 0}"],data:{animation:[(0,Ft.X$)("flyInOut",[(0,Ft.SB)("in",(0,Ft.oB)({width:"100%",transform:"translateX(0)",opacity:1})),(0,Ft.eR)("void => *",[(0,Ft.oB)({width:0,transform:"translateX(50px)",opacity:0}),(0,Ft.jt)(300)]),(0,Ft.eR)("* => void",[(0,Ft.ru)([(0,Ft.jt)("0.3s ease",(0,Ft.oB)({transform:"translateX(50px)",width:10})),(0,Ft.jt)("0.3s 0.2s ease",(0,Ft.oB)({opacity:0}))])])])]}}),t})();var Xs=i(24879),Ks=i(66031),ta=i(54438),ea=i(53306);function ia(t,e){1&t&&(h.TgZ(0,"div",6),h._UZ(1,"ion-spinner",7),h.qZA())}function na(t,e){if(1&t&&(h.TgZ(0,"ion-list",8),h.TgZ(1,"ion-item"),h.TgZ(2,"ion-label"),h.TgZ(3,"h3"),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.TgZ(6,"p"),h._uU(7),h.ALo(8,"date"),h.ALo(9,"translate"),h.ALo(10,"date"),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(12,"ion-item"),h.TgZ(13,"ion-label"),h.TgZ(14,"h3"),h._uU(15),h.ALo(16,"translate"),h.qZA(),h.TgZ(17,"p"),h._uU(18),h.qZA(),h.qZA(),h.qZA(),h.TgZ(19,"ion-item"),h.TgZ(20,"ion-label"),h.TgZ(21,"h3"),h._uU(22),h.ALo(23,"translate"),h.qZA(),h.TgZ(24,"p"),h._uU(25),h.ALo(26,"number"),h.TgZ(27,"sup"),h._uU(28,"3"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(29,"ion-item"),h.TgZ(30,"ion-label"),h.TgZ(31,"h3"),h._uU(32),h.ALo(33,"translate"),h.qZA(),h.TgZ(34,"p"),h._uU(35),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(4),h.Oqu(h.lcZ(5,11,"POND_MOD.SEASON")),h.xp6(3),h.AsE("",h.xi3(8,13,1e3*(null==t.itemData.season?null:t.itemData.season.start_time),h.lcZ(9,16,"FORMAT_DATE"))," - ",h.xi3(10,18,1e3*(null==t.itemData.season?null:t.itemData.season.end_time),h.lcZ(11,21,"FORMAT_DATE"))," "),h.xp6(8),h.Oqu(h.lcZ(16,23,"POND_MOD.FARM")),h.xp6(3),h.Oqu(t.itemData.farm.name),h.xp6(4),h.Oqu(h.lcZ(23,25,"POND_MOD.POND")),h.xp6(3),h.lnq("",t.itemData.pond.name,": ",h.xi3(26,27,t.itemData.pond.area,".0-2")," x ",t.itemData.pond.deep," m"),h.xp6(7),h.Oqu(h.lcZ(33,30,"POND_MOD.STOCKING")),h.xp6(3),h.Oqu(t.itemData.species.name)}}function oa(t,e){if(1&t&&(h.TgZ(0,"ion-item-group"),h.TgZ(1,"ion-item-divider"),h.TgZ(2,"ion-label"),h._uU(3),h.ALo(4,"translate"),h.ALo(5,"date"),h.ALo(6,"translate"),h.qZA(),h.qZA(),h.TgZ(7,"ion-item"),h.TgZ(8,"ion-label"),h.TgZ(9,"h3"),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.TgZ(12,"p",11),h._uU(13),h.ALo(14,"number"),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.TgZ(16,"ion-item"),h.TgZ(17,"ion-label"),h.TgZ(18,"h3"),h._uU(19),h.ALo(20,"translate"),h.qZA(),h.qZA(),h.TgZ(21,"p",11),h._uU(22),h.ALo(23,"number"),h.ALo(24,"translate"),h.qZA(),h.qZA(),h.TgZ(25,"ion-item"),h.TgZ(26,"ion-label"),h.TgZ(27,"h3"),h._uU(28),h.ALo(29,"translate"),h.qZA(),h.qZA(),h.TgZ(30,"p",11),h._uU(31),h.ALo(32,"number"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.xp6(3),h.AsE(" ",h.lcZ(4,10,"POND_MOD.SEED")," ",h.xi3(5,12,1e3*t.seed_date,h.lcZ(6,15,"FORMAT_DATE"))," "),h.xp6(7),h.Oqu(h.lcZ(11,17,"POND_MOD.QUANTITY")),h.xp6(3),h.AsE("",h.xi3(14,19,t.seed_quantity,".0-2")," ",h.lcZ(15,22,"POND_MOD.ANIMAL"),""),h.xp6(6),h.Oqu(h.lcZ(20,24,"POND_MOD.SIZE")),h.xp6(3),h.AsE("",h.xi3(23,26,t.seed_weight,".0-2")," gr/",h.lcZ(24,29,"PCS"),""),h.xp6(6),h.Oqu(h.lcZ(29,31,"POND_MOD.TOTAL")),h.xp6(3),h.hij("",h.xi3(32,33,t.seed_weight*t.seed_quantity/1e3,".0-2")," kg")}}function sa(t,e){if(1&t&&(h.TgZ(0,"ion-item-group"),h.TgZ(1,"ion-item-divider"),h.TgZ(2,"ion-label"),h._uU(3),h.ALo(4,"translate"),h.ALo(5,"date"),h.ALo(6,"translate"),h.qZA(),h.qZA(),h.TgZ(7,"ion-item"),h.TgZ(8,"ion-label"),h.TgZ(9,"h3"),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.TgZ(12,"p",11),h._uU(13),h.ALo(14,"number"),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.TgZ(16,"ion-item"),h.TgZ(17,"ion-label"),h.TgZ(18,"h3"),h._uU(19),h.ALo(20,"translate"),h.qZA(),h.qZA(),h.TgZ(21,"p",11),h._uU(22),h.ALo(23,"number"),h.ALo(24,"translate"),h.qZA(),h.qZA(),h.TgZ(25,"ion-item"),h.TgZ(26,"ion-label"),h.TgZ(27,"h3"),h._uU(28,"FCR"),h.qZA(),h.qZA(),h.TgZ(29,"p",11),h._uU(30),h.qZA(),h.qZA(),h.TgZ(31,"ion-item"),h.TgZ(32,"ion-label"),h.TgZ(33,"h3"),h._uU(34),h.ALo(35,"translate"),h.qZA(),h.qZA(),h.TgZ(36,"p",11),h._uU(37),h.ALo(38,"number"),h.qZA(),h.qZA(),h.TgZ(39,"ion-item"),h.TgZ(40,"ion-label"),h.TgZ(41,"h3"),h._uU(42),h.ALo(43,"translate"),h.qZA(),h.qZA(),h.TgZ(44,"p",11),h.TgZ(45,"ion-text",12),h._uU(46),h.ALo(47,"number"),h.qZA(),h._uU(48),h.ALo(49,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.xp6(3),h.AsE(" ",h.lcZ(4,14,"POND_MOD.MOVING")," ",h.xi3(5,16,1e3*t.add_time,h.lcZ(6,19,"FORMAT_DATE"))," "),h.xp6(7),h.Oqu(h.lcZ(11,21,"POND_MOD.QUANTITY")),h.xp6(3),h.AsE("",h.xi3(14,23,t.quantity_individual,".0-2")," ",h.lcZ(15,26,"POND_MOD.ANIMAL"),""),h.xp6(6),h.Oqu(h.lcZ(20,28,"POND_MOD.SIZE")),h.xp6(3),h.AsE("",h.xi3(23,30,t.weight,".0-2")," gr/",h.lcZ(24,33,"PCS"),""),h.xp6(8),h.hij(" ",t.fcr," "),h.xp6(4),h.Oqu(h.lcZ(35,35,"POND_MOD.TOTAL")),h.xp6(3),h.hij("",h.xi3(38,37,t.quantity_kg,".0-2")," kg"),h.xp6(5),h.Oqu(h.lcZ(43,40,"POND_MOD.TRANS_COST")),h.xp6(4),h.Oqu(h.xi3(47,42,t.move_cost,".0-3")),h.xp6(2),h.hij(" ",h.lcZ(49,45,"CURRENCY_S")," ")}}function aa(t,e){if(1&t&&(h.TgZ(0,"ion-list",8),h.TgZ(1,"ion-list-header",9),h.TgZ(2,"ion-label"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.YNc(5,oa,33,36,"ion-item-group",10),h.YNc(6,sa,50,47,"ion-item-group",10),h.TgZ(7,"ion-item-divider"),h.TgZ(8,"ion-label"),h._uU(9),h.ALo(10,"translate"),h.qZA(),h.qZA(),h.TgZ(11,"ion-item"),h.TgZ(12,"ion-label"),h.TgZ(13,"h3"),h._uU(14),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.TgZ(16,"p",11),h._uU(17),h.ALo(18,"number"),h.ALo(19,"translate"),h.qZA(),h.qZA(),h.TgZ(20,"ion-item"),h.TgZ(21,"ion-label"),h.TgZ(22,"h3"),h._uU(23),h.ALo(24,"translate"),h.qZA(),h.qZA(),h.TgZ(25,"p",11),h._uU(26),h.ALo(27,"number"),h.ALo(28,"translate"),h.TgZ(29,"sup"),h._uU(30,"2"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(31,"ion-item"),h.TgZ(32,"ion-label"),h.TgZ(33,"h3"),h._uU(34),h.ALo(35,"translate"),h.qZA(),h.qZA(),h.TgZ(36,"p",11),h._uU(37),h.ALo(38,"number"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.Oqu(h.lcZ(4,12,"POND_MOD.STOCKING")),h.xp6(2),h.Q6J("ngForOf",t.itemData.seed_list),h.xp6(1),h.Q6J("ngForOf",t.moveIn),h.xp6(3),h.hij(" ",h.lcZ(10,14,"POND_MOD.SUM")," "),h.xp6(5),h.Oqu(h.lcZ(15,16,"POND_MOD.QUANTITY")),h.xp6(3),h.AsE("",h.xi3(18,18,t.seedQuantity,".0-2")," ",h.lcZ(19,21,"POND_MOD.ANIMAL"),""),h.xp6(6),h.Oqu(h.lcZ(24,23,"POND_MOD.DENSITY")),h.xp6(3),h.AsE("",h.xi3(27,25,t.seedQuantity/t.itemData.pond.area,".0-2")," ",h.lcZ(28,28,"PCS"),"/m"),h.xp6(8),h.Oqu(h.lcZ(35,30,"POND_MOD.TOTAL")),h.xp6(3),h.hij("",h.xi3(38,32,t.seedWeight/1e3,".0-2")," kg")}}function ra(t,e){if(1&t&&(h.TgZ(0,"ion-item-group"),h.TgZ(1,"ion-item-divider"),h.TgZ(2,"ion-label"),h._uU(3),h.ALo(4,"translate"),h.ALo(5,"date"),h.ALo(6,"translate"),h.qZA(),h.qZA(),h.TgZ(7,"ion-item"),h.TgZ(8,"ion-label"),h.TgZ(9,"h3"),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.TgZ(12,"p",11),h._uU(13),h.ALo(14,"number"),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.TgZ(16,"ion-item"),h.TgZ(17,"ion-label"),h.TgZ(18,"h3"),h._uU(19),h.ALo(20,"translate"),h.qZA(),h.qZA(),h.TgZ(21,"p",11),h._uU(22),h.ALo(23,"number"),h.ALo(24,"translate"),h.ALo(25,"number"),h.ALo(26,"translate"),h.qZA(),h.qZA(),h.TgZ(27,"ion-item"),h.TgZ(28,"ion-label"),h.TgZ(29,"h3"),h._uU(30),h.ALo(31,"translate"),h.qZA(),h.qZA(),h.TgZ(32,"p",11),h._uU(33),h.ALo(34,"number"),h.ALo(35,"translate"),h.qZA(),h.qZA(),h.TgZ(36,"ion-item"),h.TgZ(37,"ion-label"),h.TgZ(38,"h3"),h._uU(39),h.ALo(40,"translate"),h.qZA(),h.qZA(),h.TgZ(41,"p",11),h._uU(42),h.ALo(43,"number"),h.ALo(44,"translate"),h.qZA(),h.qZA(),h.TgZ(45,"ion-item"),h.TgZ(46,"ion-label"),h.TgZ(47,"h3"),h._uU(48),h.ALo(49,"translate"),h.qZA(),h.qZA(),h.TgZ(50,"p",11),h._uU(51),h.ALo(52,"number"),h.qZA(),h.qZA(),h.TgZ(53,"ion-item"),h.TgZ(54,"ion-label"),h.TgZ(55,"h3"),h._uU(56,"FCR"),h.qZA(),h.qZA(),h.TgZ(57,"p",11),h._uU(58),h.qZA(),h.qZA(),h.TgZ(59,"ion-item"),h.TgZ(60,"ion-label"),h.TgZ(61,"h3"),h._uU(62),h.ALo(63,"translate"),h.qZA(),h.qZA(),h.TgZ(64,"p",11),h.TgZ(65,"ion-text",12),h._uU(66),h.ALo(67,"number"),h.qZA(),h._uU(68),h.ALo(69,"translate"),h.qZA(),h.qZA(),h.TgZ(70,"ion-item"),h.TgZ(71,"ion-label"),h.TgZ(72,"h3"),h._uU(73),h.ALo(74,"translate"),h.qZA(),h.qZA(),h.TgZ(75,"p",11),h.TgZ(76,"ion-text",12),h._uU(77),h.ALo(78,"number"),h.qZA(),h._uU(79),h.ALo(80,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit,i=h.oxw(2);h.xp6(3),h.AsE(" ",h.lcZ(4,25,"POND_MOD.HARVEST")," ",h.xi3(5,27,1e3*t.harvest_date,h.lcZ(6,30,"FORMAT_DATE"))," "),h.xp6(7),h.Oqu(h.lcZ(11,32,"POND_MOD.CULTURE_PEROID")),h.xp6(3),h.AsE("",h.xi3(14,34,(t.harvest_date-(null==i.itemData.season?null:i.itemData.season.seed_date))/86400,".0-0")," ",h.lcZ(15,37,"DAYS")," "),h.xp6(6),h.Oqu(h.lcZ(20,39,"POND_MOD.AVERAGE_SIZE")),h.xp6(3),h.HOy("",h.xi3(23,41,t.harvest_size,".0-2")," gr/",h.lcZ(24,44,"PCS")," (",h.xi3(25,46,1e3/t.harvest_size,".0-2")," ",h.lcZ(26,49,"PCS"),"/kg)"),h.xp6(8),h.Oqu(h.lcZ(31,51,"POND_MOD.PRICE")),h.xp6(3),h.AsE("",h.xi3(34,53,t.harvest_price,".0-2")," ",h.lcZ(35,56,"CURRENCY_S"),"/kg"),h.xp6(6),h.Oqu(h.lcZ(40,58,"POND_MOD.QUANTITY")),h.xp6(3),h.AsE("",h.xi3(43,60,1e3*t.harvest_quantity/t.harvest_size,".0-0")," ",h.lcZ(44,63,"PCS")," "),h.xp6(6),h.Oqu(h.lcZ(49,65,"POND_MOD.BIOMASS")),h.xp6(3),h.hij("",h.xi3(52,67,t.harvest_quantity,".0-2")," kg"),h.xp6(7),h.hij(" ",t.fcr," "),h.xp6(4),h.Oqu(h.lcZ(63,70,"CROP_MOD.HARVEST_COST")),h.xp6(4),h.Oqu(h.xi3(67,72,t.harvest_cost,".0-3")),h.xp6(2),h.hij(" ",h.lcZ(69,75,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(74,77,"POND_MOD.PRICE_PRODUCTION")),h.xp6(4),h.Oqu(h.xi3(78,79,t.cost/t.harvest_quantity,".0-0")),h.xp6(2),h.hij(" ",h.lcZ(80,82,"CURRENCY_S"),"/kg ")}}function la(t,e){if(1&t&&(h.TgZ(0,"ion-item-group"),h.TgZ(1,"ion-item-divider"),h.TgZ(2,"ion-label"),h._uU(3),h.ALo(4,"translate"),h.ALo(5,"date"),h.ALo(6,"translate"),h.qZA(),h.qZA(),h.TgZ(7,"ion-item"),h.TgZ(8,"ion-label"),h.TgZ(9,"h3"),h._uU(10),h.ALo(11,"translate"),h.qZA(),h.qZA(),h.TgZ(12,"p",11),h._uU(13),h.ALo(14,"number"),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.TgZ(16,"ion-item"),h.TgZ(17,"ion-label"),h.TgZ(18,"h3"),h._uU(19),h.ALo(20,"translate"),h.qZA(),h.qZA(),h.TgZ(21,"p",11),h._uU(22),h.ALo(23,"number"),h.ALo(24,"translate"),h.qZA(),h.qZA(),h.TgZ(25,"ion-item"),h.TgZ(26,"ion-label"),h.TgZ(27,"h3"),h._uU(28),h.ALo(29,"translate"),h.qZA(),h.qZA(),h.TgZ(30,"p",11),h._uU(31),h.ALo(32,"number"),h.ALo(33,"translate"),h.qZA(),h.qZA(),h.TgZ(34,"ion-item"),h.TgZ(35,"ion-label"),h.TgZ(36,"h3"),h._uU(37),h.ALo(38,"translate"),h.qZA(),h.qZA(),h.TgZ(39,"p",11),h._uU(40),h.ALo(41,"number"),h.qZA(),h.qZA(),h.TgZ(42,"ion-item"),h.TgZ(43,"ion-label"),h.TgZ(44,"h3"),h._uU(45,"FCR"),h.qZA(),h.qZA(),h.TgZ(46,"p",11),h._uU(47),h.qZA(),h.qZA(),h.TgZ(48,"ion-item"),h.TgZ(49,"ion-label"),h.TgZ(50,"h3"),h._uU(51),h.ALo(52,"translate"),h.qZA(),h.qZA(),h.TgZ(53,"p",11),h.TgZ(54,"ion-text",12),h._uU(55),h.ALo(56,"number"),h.qZA(),h._uU(57),h.ALo(58,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit,i=h.oxw(2);h.xp6(3),h.AsE(" ",h.lcZ(4,17,"POND_MOD.MOVING")," ",h.xi3(5,19,1e3*t.add_time,h.lcZ(6,22,"FORMAT_DATE"))," "),h.xp6(7),h.Oqu(h.lcZ(11,24,"POND_MOD.CULTURE_PEROID")),h.xp6(3),h.AsE("",h.xi3(14,26,(t.add_time-(null==i.itemData.season?null:i.itemData.season.seed_date))/86400,".0-0")," ",h.lcZ(15,29,"DAYS")," "),h.xp6(6),h.Oqu(h.lcZ(20,31,"POND_MOD.QUANTITY")),h.xp6(3),h.AsE("",h.xi3(23,33,t.quantity_individual,".0-0")," ",h.lcZ(24,36,"POND_MOD.ANIMAL"),""),h.xp6(6),h.Oqu(h.lcZ(29,38,"POND_MOD.SIZE")),h.xp6(3),h.AsE("",h.xi3(32,40,t.weight,".0-2")," gr/",h.lcZ(33,43,"PCS"),""),h.xp6(6),h.Oqu(h.lcZ(38,45,"POND_MOD.BIOMASS")),h.xp6(3),h.hij("",h.xi3(41,47,t.quantity_kg,".0-2")," kg"),h.xp6(7),h.hij(" ",t.fcr," "),h.xp6(4),h.Oqu(h.lcZ(52,50,"POND_MOD.TRANS_COST")),h.xp6(4),h.Oqu(h.xi3(56,52,t.move_cost,".0-3")),h.xp6(2),h.hij(" ",h.lcZ(58,55,"CURRENCY_S")," ")}}function ca(t,e){if(1&t&&(h.TgZ(0,"ion-list",8),h.TgZ(1,"ion-list-header",9),h.TgZ(2,"ion-label"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.YNc(5,ra,81,84,"ion-item-group",10),h.YNc(6,la,59,57,"ion-item-group",10),h.TgZ(7,"ion-item-divider"),h.TgZ(8,"ion-label"),h._uU(9),h.ALo(10,"translate"),h.qZA(),h.qZA(),h.TgZ(11,"ion-item"),h.TgZ(12,"ion-label"),h.TgZ(13,"h3"),h._uU(14),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.TgZ(16,"span",11),h._uU(17),h.ALo(18,"number"),h.qZA(),h.qZA(),h.TgZ(19,"ion-item"),h.TgZ(20,"ion-label"),h.TgZ(21,"h3"),h._uU(22),h.ALo(23,"translate"),h.qZA(),h.qZA(),h.TgZ(24,"p",11),h._uU(25),h.ALo(26,"number"),h.ALo(27,"translate"),h.qZA(),h.qZA(),h.TgZ(28,"ion-item"),h.TgZ(29,"ion-label"),h.TgZ(30,"h3"),h._uU(31),h.ALo(32,"translate"),h.qZA(),h.qZA(),h.TgZ(33,"p",11),h._uU(34),h.ALo(35,"number"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.Oqu(h.lcZ(4,11,"POND_MOD.HARVEST")),h.xp6(2),h.Q6J("ngForOf",t.itemData.harvest_list),h.xp6(1),h.Q6J("ngForOf",t.moveOut),h.xp6(3),h.hij(" ",h.lcZ(10,13,"POND_MOD.SUM")," "),h.xp6(5),h.Oqu(h.lcZ(15,15,"POND_MOD.SURVIVAL_PERCENTAGE")),h.xp6(3),h.hij(" ",h.xi3(18,17,100*t.harvestQuantity/t.seedQuantity,".0-1")," %"),h.xp6(5),h.Oqu(h.lcZ(23,20,"POND_MOD.QUANTITY")),h.xp6(3),h.AsE("",h.xi3(26,22,t.harvestQuantity,".0-2")," ",h.lcZ(27,25,"PCS")," "),h.xp6(6),h.Oqu(h.lcZ(32,27,"POND_MOD.BIOMASS")),h.xp6(3),h.hij("",h.xi3(35,29,t.harvestQuantity*(null==t.itemData.season?null:t.itemData.season.harvest_size)/1e3,".0-2")," kg")}}function da(t,e){if(1&t&&(h.TgZ(0,"ion-list",8),h.TgZ(1,"ion-list-header",9),h.TgZ(2,"ion-label"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.TgZ(5,"ion-item"),h.TgZ(6,"ion-label"),h.TgZ(7,"h3"),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA(),h.TgZ(10,"p",11),h._uU(11),h.ALo(12,"number"),h.qZA(),h.qZA(),h.TgZ(13,"ion-item"),h.TgZ(14,"ion-label"),h.TgZ(15,"h3"),h._uU(16,"FCR"),h.qZA(),h.qZA(),h.TgZ(17,"p",11),h._uU(18),h.ALo(19,"number"),h.qZA(),h.qZA(),h.TgZ(20,"ion-item"),h.TgZ(21,"ion-label"),h.TgZ(22,"h3"),h._uU(23),h.ALo(24,"translate"),h.qZA(),h.qZA(),h.TgZ(25,"p",11),h._uU(26),h.ALo(27,"number"),h.ALo(28,"translate"),h.qZA(),h.qZA(),h.TgZ(29,"ion-item"),h.TgZ(30,"ion-label"),h.TgZ(31,"h3"),h._uU(32),h.ALo(33,"translate"),h.qZA(),h.qZA(),h.TgZ(34,"p",11),h._uU(35),h.ALo(36,"number"),h.ALo(37,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.Oqu(h.lcZ(4,10,"POND_MOD.FEED")),h.xp6(5),h.Oqu(h.lcZ(9,12,"POND_MOD.TOTAL_FEED")),h.xp6(3),h.hij("",h.xi3(12,14,null==t.itemData.season?null:t.itemData.season.total_feed,".0-2")," kg"),h.xp6(7),h.hij(" ",h.xi3(19,17,(null==t.itemData?null:t.itemData.season.total_feed)/(((null==t.itemData?null:t.itemData.season.seed_quantity)-(null==t.itemData?null:t.itemData.season.total_loss))*((null==t.itemData?null:t.itemData.season.current_weight)-(null==t.itemData?null:t.itemData.season.seed_weight))/1e3),".0-2")," "),h.xp6(5),h.Oqu(h.lcZ(24,20,"POND_MOD.AVERAGE_GROWTH")),h.xp6(3),h.AsE("",h.xi3(27,22,null==t.itemData.season?null:t.itemData.season.grow_rate,"1.0-2")," gr/",h.lcZ(28,25,"DAY"),""),h.xp6(6),h.Oqu(h.lcZ(33,27,"POND_MOD.LOSS")),h.xp6(3),h.AsE("",h.xi3(36,29,null==t.itemData.season?null:t.itemData.season.total_loss,"1.0-0")," ",h.lcZ(37,32,"PCS"),"")}}function ua(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-list",8),h.TgZ(1,"ion-list-header",9),h.TgZ(2,"ion-label"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.TgZ(5,"ion-item",13),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentCostOtherList()}),h.TgZ(6,"ion-label"),h.TgZ(7,"h3"),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA(),h.TgZ(10,"p",11),h.TgZ(11,"ion-text",14),h._uU(12),h.ALo(13,"number"),h.qZA(),h._uU(14),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(3),h.Oqu(h.lcZ(4,4,"POND_MOD.OTHER_INCOME")),h.xp6(5),h.Oqu(h.lcZ(9,6,"POND_MOD.SEASON")),h.xp6(4),h.Oqu(h.xi3(13,8,null==t.itemData.cost?null:t.itemData.cost.income,".0-2")),h.xp6(2),h.hij(" ",h.lcZ(15,11,"CURRENCY_S")," ")}}function ha(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-list",8),h.TgZ(1,"ion-list-header",9),h.TgZ(2,"ion-label"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.TgZ(5,"ion-item"),h.TgZ(6,"ion-label"),h.TgZ(7,"h3"),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA(),h.TgZ(10,"p",11),h.TgZ(11,"ion-text",12),h._uU(12),h.ALo(13,"number"),h.qZA(),h._uU(14),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.TgZ(16,"ion-item",13),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentMaterialList("feed")}),h.TgZ(17,"ion-label"),h.TgZ(18,"h3"),h._uU(19),h.ALo(20,"translate"),h.qZA(),h.qZA(),h.TgZ(21,"p",11),h.TgZ(22,"ion-text",12),h._uU(23),h.ALo(24,"number"),h.qZA(),h._uU(25),h.ALo(26,"translate"),h.qZA(),h.qZA(),h.TgZ(27,"ion-item",13),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentMaterialList("blend")}),h.TgZ(28,"ion-label"),h.TgZ(29,"h3"),h._uU(30),h.ALo(31,"translate"),h.qZA(),h.qZA(),h.TgZ(32,"p",11),h.TgZ(33,"ion-text",12),h._uU(34),h.ALo(35,"number"),h.qZA(),h._uU(36),h.ALo(37,"translate"),h.qZA(),h.qZA(),h.TgZ(38,"ion-item",13),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentMaterialList("enviro")}),h.TgZ(39,"ion-label"),h.TgZ(40,"h3"),h._uU(41),h.ALo(42,"translate"),h.qZA(),h.qZA(),h.TgZ(43,"p",11),h.TgZ(44,"ion-text",12),h._uU(45),h.ALo(46,"number"),h.qZA(),h._uU(47),h.ALo(48,"translate"),h.qZA(),h.qZA(),h.TgZ(49,"ion-item",13),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentExchangeList()}),h.TgZ(50,"ion-label"),h.TgZ(51,"h3"),h._uU(52),h.ALo(53,"translate"),h.qZA(),h.qZA(),h.TgZ(54,"p",11),h.TgZ(55,"ion-text",12),h._uU(56),h.ALo(57,"number"),h.qZA(),h._uU(58),h.ALo(59,"translate"),h.qZA(),h.qZA(),h.TgZ(60,"ion-item"),h.TgZ(61,"ion-label"),h.TgZ(62,"h3"),h._uU(63),h.ALo(64,"translate"),h.qZA(),h.qZA(),h.TgZ(65,"p",11),h.TgZ(66,"ion-text",12),h._uU(67),h.ALo(68,"number"),h.qZA(),h._uU(69),h.ALo(70,"translate"),h.qZA(),h.qZA(),h.TgZ(71,"ion-item"),h.TgZ(72,"ion-label"),h.TgZ(73,"h3"),h._uU(74),h.ALo(75,"translate"),h.qZA(),h.qZA(),h.TgZ(76,"p",11),h.TgZ(77,"ion-text",12),h._uU(78),h.ALo(79,"number"),h.qZA(),h._uU(80),h.ALo(81,"translate"),h.qZA(),h.qZA(),h.TgZ(82,"ion-item"),h.TgZ(83,"ion-label"),h.TgZ(84,"h3"),h._uU(85),h.ALo(86,"translate"),h.qZA(),h.qZA(),h.TgZ(87,"p",11),h.TgZ(88,"ion-text",12),h._uU(89),h.ALo(90,"number"),h.qZA(),h._uU(91),h.ALo(92,"translate"),h.qZA(),h.qZA(),h.TgZ(93,"ion-item",13),h.NdJ("click",function(){return h.CHM(t),h.oxw().presentCostOtherList()}),h.TgZ(94,"ion-label"),h.TgZ(95,"h3"),h._uU(96),h.ALo(97,"translate"),h.qZA(),h.qZA(),h.TgZ(98,"p",11),h.TgZ(99,"ion-text",12),h._uU(100),h.ALo(101,"number"),h.qZA(),h._uU(102),h.ALo(103,"translate"),h.qZA(),h.qZA(),h.TgZ(104,"ion-item"),h.TgZ(105,"ion-label"),h.TgZ(106,"h3"),h._uU(107),h.ALo(108,"translate"),h.qZA(),h.qZA(),h.TgZ(109,"p",11),h.TgZ(110,"ion-text",12),h._uU(111),h.ALo(112,"number"),h.qZA(),h._uU(113),h.ALo(114,"translate"),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(3),h.Oqu(h.lcZ(4,31,"POND_MOD.COST")),h.xp6(5),h.Oqu(h.lcZ(9,33,"POND_MOD.COST_SEED")),h.xp6(4),h.Oqu(h.xi3(13,35,null==t.itemData.cost?null:t.itemData.cost.seed,".0-2")),h.xp6(2),h.hij(" ",h.lcZ(15,38,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(20,40,"POND_MOD.COST_FEED")),h.xp6(4),h.Oqu(h.xi3(24,42,null==t.itemData.cost?null:t.itemData.cost.feed,".0-2")),h.xp6(2),h.hij(" ",h.lcZ(26,45,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(31,47,"POND_MOD.COST_FEED_SUPPLEMENT")),h.xp6(4),h.Oqu(h.xi3(35,49,null==t.itemData.cost?null:t.itemData.cost.blend,".0-2")),h.xp6(2),h.hij(" ",h.lcZ(37,52,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(42,54,"POND_MOD.COST_WATER_TREATMENT")),h.xp6(4),h.Oqu(h.xi3(46,56,null==t.itemData.cost?null:t.itemData.cost.enviro,".0-2")),h.xp6(2),h.hij(" ",h.lcZ(48,59,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(53,61,"POND_MOD.WATER_TREAMENT")),h.xp6(4),h.Oqu(h.xi3(57,63,null==t.itemData.cost?null:t.itemData.cost.water,".0-2")),h.xp6(2),h.hij(" ",h.lcZ(59,66,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(64,68,"POND_MOD.COST_DEPRECIATION")),h.xp6(4),h.Oqu(h.xi3(68,70,null==t.itemData.cost?null:t.itemData.cost.pond,".0-2")),h.xp6(2),h.hij(" ",h.lcZ(70,73,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(75,75,"POND_MOD.COST_ACCOUTING")),h.xp6(4),h.Oqu(h.xi3(79,77,null==t.itemData.cost?null:t.itemData.cost.moneyout,".0-2")),h.xp6(2),h.hij(" ",h.lcZ(81,80,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(86,82,"POND_MOD.COST_PREPARE")),h.xp6(4),h.Oqu(h.xi3(90,84,null==t.itemData.season?null:t.itemData.season.prepare_cost,".0-2")),h.xp6(2),h.hij(" ",h.lcZ(92,87,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(97,89,"POND_MOD.COST_OTHER")),h.xp6(4),h.Oqu(h.xi3(101,91,null==t.itemData.cost?null:t.itemData.cost.other,".0-2")),h.xp6(2),h.hij(" ",h.lcZ(103,94,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(108,96,"POND_MOD.PRICE_PRODUCTION")),h.xp6(4),h.Oqu(h.xi3(112,98,t.getProductionCost(),".0-0")),h.xp6(2),h.hij(" ",h.lcZ(114,101,"CURRENCY_S"),"/kg ")}}function ga(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h.TgZ(2,"h3"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.TgZ(5,"p",11),h.TgZ(6,"ion-text",9),h._uU(7),h.ALo(8,"number"),h.qZA(),h._uU(9),h.ALo(10,"translate"),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.xp6(3),h.Oqu(h.lcZ(4,3,"POND_MOD.MOVING")),h.xp6(4),h.Oqu(h.xi3(8,5,t.costMoveOut,".0-3")),h.xp6(2),h.hij(" ",h.lcZ(10,8,"CURRENCY_S")," ")}}function pa(t,e){if(1&t&&(h.TgZ(0,"ion-list",8),h.TgZ(1,"ion-list-header",9),h.TgZ(2,"ion-label"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.qZA(),h.TgZ(5,"ion-item"),h.TgZ(6,"ion-label"),h.TgZ(7,"h3"),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA(),h.TgZ(10,"p",11),h.TgZ(11,"ion-text",12),h._uU(12),h.ALo(13,"number"),h.qZA(),h._uU(14),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.TgZ(16,"ion-item"),h.TgZ(17,"ion-label"),h.TgZ(18,"h3"),h._uU(19),h.ALo(20,"translate"),h.qZA(),h.qZA(),h.TgZ(21,"p",11),h.TgZ(22,"ion-text",9),h._uU(23),h.ALo(24,"number"),h.qZA(),h._uU(25),h.ALo(26,"translate"),h.qZA(),h.qZA(),h.YNc(27,ga,11,10,"ion-item",15),h.TgZ(28,"ion-item"),h.TgZ(29,"ion-label"),h.TgZ(30,"h3"),h._uU(31),h.ALo(32,"translate"),h.qZA(),h.qZA(),h.TgZ(33,"p",11),h.TgZ(34,"ion-text"),h.TgZ(35,"strong"),h._uU(36),h.ALo(37,"number"),h.qZA(),h.qZA(),h._uU(38),h.ALo(39,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.Oqu(h.lcZ(4,11,"POND_MOD.SUMMARY")),h.xp6(5),h.Oqu(h.lcZ(9,13,"POND_MOD.TOTAL_COST")),h.xp6(4),h.Oqu(h.xi3(13,15,null==t.itemData.cost?null:t.itemData.cost.total,".0-2")),h.xp6(2),h.hij(" ",h.lcZ(15,18,"CURRENCY_S")," "),h.xp6(5),h.Oqu(h.lcZ(20,20,"POND_MOD.REVENUE")),h.xp6(4),h.Oqu(h.xi3(24,22,null==t.itemData.season?null:t.itemData.season.revenue,".0-3")),h.xp6(2),h.hij(" ",h.lcZ(26,25,"CURRENCY_S")," "),h.xp6(2),h.Q6J("ngIf",0!=t.costMoveOut),h.xp6(4),h.Oqu(h.lcZ(32,27,"POND_MOD.PROFIT")),h.xp6(5),h.Oqu(h.xi3(37,29,null==t.itemData.season?null:t.itemData.season.profit,".0-3")),h.xp6(2),h.hij(" ",h.lcZ(39,32,"CURRENCY_S")," ")}}let ma=(()=>{class t{constructor(t,e,i,n,o){this.modalController=t,this.toastService=e,this.pondService=i,this.translate=n,this.route=o,this.code="",this.loadingFlag=new d.E,this.seedQuantity=0,this.seedWeight=0,this.harvestQuantity=0,this.costMoveOut=0,this.moveIn=[],this.moveOut=[]}ngOnInit(){this.code=this.route.snapshot.paramMap.get("code"),this.loadSeason()}loadSeason(){this.loadingFlag.setPending(!0),this.pondService.reqSeasonDetail(this.code).subscribe(t=>{1==t.status?(this.itemData=t.data,t.data.seed_list.forEach(t=>{this.seedQuantity+=parseInt(t.seed_quantity),this.seedWeight+=parseInt(t.seed_quantity)*parseInt(t.seed_weight)}),t.data.moved_list.forEach(t=>{t.to_season_code==this.code?(console.log(t),this.seedQuantity+=parseInt(t.quantity_individual),this.seedWeight+=parseInt(t.quantity_individual)*parseFloat(t.weight),this.moveIn.push(t)):(this.harvestQuantity+=parseInt(t.quantity_individual),this.costMoveOut+=parseInt(t.cost),this.moveOut.push(t))}),t.data.harvest_list.forEach(t=>{this.harvestQuantity+=1e3*t.harvest_quantity/t.harvest_size})):this.toastService.warning(t.message),this.loadingFlag.setResult(!0)},()=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}presentMaterialList(t){var e;return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:Ks.O,componentProps:{type:t,code:this.code,time:null===(e=this.itemData.season)||void 0===e?void 0:e.start_time}})).present()})}presentCostOtherList(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:ta.Z,componentProps:{code:this.code}})).present()})}getProductionCost(){var t=0,e=0;return this.itemData.harvest_list.forEach(i=>{t+=+i.cost,e+=+i.harvest_quantity}),t/e}presentExchangeList(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:ea.V,componentProps:{code:this.code}})).present()})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(A.k),h.Y36(c.p),h.Y36(g.sK),h.Y36(s.gz))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-season-detail"]],inputs:{item:"item"},decls:21,vars:13,consts:[["slot","start"],["text","","defaultHref","tabs/management"],["class","spiner-loading",4,"ngIf"],[1,"ion-padding","ion-text-center"],[3,"src"],["lines","none",4,"ngIf"],[1,"spiner-loading"],["name","dots"],["lines","none"],["color","primary"],[4,"ngFor","ngForOf"],["slot","end"],["color","danger"],["detail","true",3,"click"],["color","success"],[4,"ngIf"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.qZA(),h.TgZ(4,"ion-title"),h._uU(5),h.ALo(6,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(7,"ion-content"),h.YNc(8,ia,2,0,"div",2),h.TgZ(9,"div",3),h.TgZ(10,"div"),h._UZ(11,"img",4),h.qZA(),h.TgZ(12,"span"),h._uU(13),h.qZA(),h.qZA(),h.YNc(14,na,36,32,"ion-list",5),h.YNc(15,aa,39,35,"ion-list",5),h.YNc(16,ca,36,32,"ion-list",5),h.YNc(17,da,38,34,"ion-list",5),h.YNc(18,ua,16,13,"ion-list",5),h.YNc(19,ha,115,103,"ion-list",5),h.YNc(20,pa,40,34,"ion-list",5),h.qZA()),2&t&&(h.xp6(5),h.Oqu(h.lcZ(6,11,"CROP")),h.xp6(3),h.Q6J("ngIf",e.loadingFlag.pending),h.xp6(3),h.Q6J("src","https://chart.googleapis.com/chart?chs=120x120&cht=qr&chl=crop:"+e.code+"&choe=UTF-8",h.LSH),h.xp6(2),h.hij("#",e.code,""),h.xp6(1),h.Q6J("ngIf",e.itemData),h.xp6(1),h.Q6J("ngIf",e.itemData),h.xp6(1),h.Q6J("ngIf",e.itemData),h.xp6(1),h.Q6J("ngIf",e.itemData),h.xp6(1),h.Q6J("ngIf",e.itemData&&e.itemData.cost&&e.itemData.cost.income),h.xp6(1),h.Q6J("ngIf",e.itemData&&e.itemData.cost),h.xp6(1),h.Q6J("ngIf",e.itemData&&0!=e.itemData.season.profit))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,a.wd,a.W2,n.O5,a.PQ,a.q_,a.Ie,a.Q$,a.yh,n.sg,a.rH,a.Ub,a.yW],pipes:[g.X$,n.uU,n.JJ],styles:[""]}),t})();function Za(t,e){1&t&&(h.TgZ(0,"div",7),h._UZ(1,"ion-spinner",8),h.qZA())}function fa(t,e){if(1&t&&(h.TgZ(0,"p",14),h._uU(1),h.ALo(2,"date"),h.ALo(3,"translate"),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.Oqu(h.xi3(2,1,1e3*t.end_time,h.lcZ(3,4,"FORMAT_DATE")))}}function Aa(t,e){1&t&&(h.TgZ(0,"p",14),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"POND_MOD.NOT_YET")))}function _a(t,e){if(1&t&&(h.TgZ(0,"ion-col",9),h.TgZ(1,"ion-card",10),h.TgZ(2,"ion-item",11),h.TgZ(3,"ion-label"),h.TgZ(4,"h2"),h._uU(5),h.ALo(6,"date"),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"p"),h._uU(9),h.qZA(),h.qZA(),h.qZA(),h.TgZ(10,"ion-item",12),h.TgZ(11,"ion-label"),h.TgZ(12,"h3"),h._uU(13),h.ALo(14,"translate"),h.qZA(),h.qZA(),h.YNc(15,fa,4,6,"p",13),h.YNc(16,Aa,3,3,"p",13),h.qZA(),h.TgZ(17,"ion-item",12),h.TgZ(18,"ion-label"),h.TgZ(19,"h3"),h._uU(20),h.ALo(21,"translate"),h.qZA(),h.qZA(),h.TgZ(22,"p",14),h._uU(23),h.ALo(24,"number"),h.qZA(),h.qZA(),h.TgZ(25,"ion-item",12),h.TgZ(26,"ion-label"),h.TgZ(27,"h3"),h._uU(28),h.ALo(29,"translate"),h.qZA(),h.qZA(),h.TgZ(30,"p",14),h._uU(31),h.ALo(32,"number"),h.ALo(33,"translate"),h.qZA(),h.qZA(),h.TgZ(34,"ion-item",12),h.TgZ(35,"ion-label"),h.TgZ(36,"h3"),h._uU(37),h.ALo(38,"translate"),h.qZA(),h.qZA(),h.TgZ(39,"p",14),h._uU(40),h.ALo(41,"number"),h.ALo(42,"number"),h.ALo(43,"translate"),h.qZA(),h.qZA(),h.TgZ(44,"ion-item",12),h.TgZ(45,"ion-label"),h.TgZ(46,"h3"),h._uU(47),h.ALo(48,"translate"),h.qZA(),h.qZA(),h.TgZ(49,"p",14),h._uU(50),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.xp6(1),h.Q6J("routerLink",t.code),h.xp6(4),h.Oqu(h.xi3(6,17,1e3*t.start_time,h.lcZ(7,20,"FORMAT_DATE"))),h.xp6(4),h.Oqu(t.species_name),h.xp6(4),h.Oqu(h.lcZ(14,22,"POND_MOD.HARVEST")),h.xp6(2),h.Q6J("ngIf",t.end_time>0),h.xp6(1),h.Q6J("ngIf",0==t.end_time),h.xp6(4),h.Oqu(h.lcZ(21,24,"POND_MOD.QUANTITY")),h.xp6(3),h.hij("",h.xi3(24,26,t.harvest_quantity,"1.0-0")," kg"),h.xp6(5),h.Oqu(h.lcZ(29,29,"POND_MOD.PRICE")),h.xp6(3),h.AsE("",h.xi3(32,31,t.harvest_price,"1.0-0")," ",h.lcZ(33,34,"CURRENCY_S"),""),h.xp6(6),h.Oqu(h.lcZ(38,36,"POND_MOD.SIZE")),h.xp6(3),h.lnq("",h.xi3(41,38,t.harvest_size,"1.0-0"),"g (",h.xi3(42,41,1e3/t.harvest_size,"1.0-0"),"",h.lcZ(43,44,"PCS"),"/kg)"),h.xp6(7),h.Oqu(h.lcZ(48,46,"POND_MOD.SEASON_CODE")),h.xp6(3),h.hij("#",t.code,"")}}function va(t,e){1&t&&(h.TgZ(0,"div"),h.TgZ(1,"ion-card",15),h.TgZ(2,"ion-card-content",16),h.TgZ(3,"p",17),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(4),h.Oqu(h.lcZ(5,1,"POND_MOD.EMPTY_HIS")))}function Ta(t,e){if(1&t&&(h.TgZ(0,"div"),h.YNc(1,Za,2,0,"div",3),h.TgZ(2,"ion-grid"),h.TgZ(3,"ion-row"),h.TgZ(4,"ion-col",4),h.TgZ(5,"ion-card"),h.TgZ(6,"ion-card-header"),h.TgZ(7,"ion-card-title"),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.qZA(),h._UZ(10,"div",5),h.qZA(),h.qZA(),h.qZA(),h.TgZ(11,"ion-row"),h.YNc(12,_a,51,48,"ion-col",6),h.qZA(),h.qZA(),h.YNc(13,va,6,3,"div",2),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.Q6J("ngIf",t.loadingFlag.pending),h.xp6(7),h.Oqu(h.lcZ(9,6,"ANALYTICS")),h.xp6(2),h.Q6J("loading",t.view)("options",t.options),h.xp6(2),h.Q6J("ngForOf",t.seasons),h.xp6(1),h.Q6J("ngIf",0==(null==t.seasons?null:t.seasons.length)&&t.loadingFlag.result)}}let qa=(()=>{class t{constructor(t,e,i,n,o){this.modalController=t,this.pondService=e,this.toastService=i,this.translate=n,this.route=o,this.loadingFlag=new d.E,this.options={},this.view=!1}ngOnInit(){this.pondService.pcode||this.pondService.setCode(this.route.snapshot.paramMap.get("id")),this.getHistoryDate()}ionViewDidEnter(){this.view=!0}getHistoryDate(){this.loadingFlag.setPending(!0),this.pondService.getHistory().subscribe(t=>{1==t.status?(this.seasons=t.data,console.log(this.seasons),this.seasons=t.data,this.initChart()):this.toastService.warning(t.message),this.loadingFlag.setResult(!0)},()=>{this.loadingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}initChart(){this.options={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["S\u1ed1 l\u01b0\u1ee3ng","Gi\xe1","C\u1ee1"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01]},yAxis:{type:"category",data:[]},series:[{name:this.translate.instant("COMPANY_MOD.QUANTITY")+"("+this.translate.instant("POND_MOD.TON")+")",type:"bar",data:[]},{name:this.translate.instant("POND_MOD.PRICE")+"("+this.translate.instant("POND_MOD.THOUSAND")+")",type:"bar",data:[]},{name:this.translate.instant("POND_MOD.SIZE")+"("+this.translate.instant("POND_MOD.UNIT_SEED")+")",type:"bar",data:[]}]},this.seasons.forEach(t=>{t.species_name&&(this.options.yAxis.data.push(this.shortString(t.species_name)+" ("+u(new Date(1e3*t.date)).format("DD/MM")+")"),this.options.series[2].data.push(t.harvest_size))}),console.log(this.options.dataset)}shortString(t){let e="",i=t.split(" ");for(var n=0;n<i.length;n++)e+=i[n][0].toUpperCase();return e}presentSeason(t){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:ma,componentProps:{item:t}})).present()})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(c.p),h.Y36(A.k),h.Y36(g.sK),h.Y36(s.gz))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pond-history"]],decls:9,vars:4,consts:[["slot","start"],["text","","defaultHref","tabs/management"],[4,"ngIf"],["class","spiner-loading",4,"ngIf"],["size","12"],["echarts","",3,"loading","options"],["size","12","size-sm","6",4,"ngFor","ngForOf"],[1,"spiner-loading"],["name","dots"],["size","12","size-sm","6"],[3,"routerLink"],["lines","full","detail","true"],["lines","none"],["slot","end",4,"ngIf"],["slot","end"],["mode","ios"],[1,"ion-text-center"],[1,"ion-padding"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.qZA(),h.TgZ(4,"ion-title"),h._uU(5),h.ALo(6,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(7,"ion-content"),h.YNc(8,Ta,14,8,"div",2),h.qZA()),2&t&&(h.xp6(5),h.Oqu(h.lcZ(6,2,"POND_MOD.HISTORY")),h.xp6(3),h.Q6J("ngIf",e.view))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,a.wd,a.W2,n.O5,a.jY,a.Nd,a.wI,a.PM,a.Zi,a.gZ,r._w,n.sg,a.PQ,a.YI,s.rH,a.Ie,a.Q$,a.FN],pipes:[g.X$,n.uU,n.JJ],styles:[""]}),t})();var xa=i(54373),Oa=i(3571);let Da=(()=>{class t{constructor(t,e){this.modalController=t,this.translate=e}ngOnInit(){this.max=u(this.max).format("YYYY-MM-DD"),this.day=this.max}close(){this.modalController.dismiss()}save(){this.modalController.dismiss(new Date(this.day).getTime())}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-choose-delete"]],inputs:{max:"max"},decls:18,vars:11,consts:[["slot","end"],[3,"click"],["name","close"],["displayFormat","DD MM YYYY","placeholder","Select Date",3,"ngModel","max","ngModelChange"],[1,"ion-text-center"],["shape","round","expand","full",3,"click"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-buttons",0),h.TgZ(6,"ion-button",1),h.NdJ("click",function(){return e.close()}),h._UZ(7,"ion-icon",2),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"ion-item"),h.TgZ(10,"ion-label"),h._uU(11),h.ALo(12,"translate"),h.qZA(),h.TgZ(13,"ion-datetime",3),h.NdJ("ngModelChange",function(t){return e.day=t}),h.qZA(),h.qZA(),h.TgZ(14,"div",4),h.TgZ(15,"ion-button",5),h.NdJ("click",function(){return e.save()}),h._uU(16),h.ALo(17,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,5,"DEVICE_MOD.REMOVE_DATA")),h.xp6(8),h.Oqu(h.lcZ(12,7,"DEVICE_MOD.REMOVE_FROM_DATE")),h.xp6(2),h.Q6J("ngModel",e.day)("max",e.max),h.xp6(3),h.hij(" ",h.lcZ(17,9,"SAVE")," "))},directives:[a.Gu,a.sr,a.wd,a.Sm,a.YG,a.gu,a.W2,a.Ie,a.Q$,a.x4,a.QI,o.JJ,o.On],pipes:[g.X$],styles:[""]}),t})();function ba(t,e){1&t&&h._UZ(0,"ion-progress-bar",8)}function Sa(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label"),h._uU(2),h.qZA(),h.TgZ(3,"ion-buttons",0),h.TgZ(4,"ion-button",1),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw().presentChooseDelete(e)}),h._UZ(5,"ion-icon",9),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(2),h.Oqu(t.label)}}let Ca=(()=>{class t{constructor(t,e,i,n){this.modalController=t,this.afs=e,this.toastService=i,this.translate=n,this.loading=new d.E,this.arrItem=[],this.day=7}ngOnInit(){for(let t in this.justItem){let e=this.justItem[t];e.key=t,this.arrItem.push(e)}}close(){this.modalController.dismiss()}presentChooseDelete(t){return(0,l.mG)(this,void 0,void 0,function*(){const e=yield this.modalController.create({component:Da,cssClass:"my-custom-class",componentProps:{max:new Date}});return e.onDidDismiss().then(e=>{void 0!==e.data&&this.deleteData(e.data,t)}),yield e.present()})}deleteData(t,e){t=new Date(t);let i=this.afs.firestore.batch(),n=0;this.loading.setPending(!0),this.afs.collection("pub").doc(this.id).collection("factors").doc(e.key).collection("data",e=>e.orderBy("time","desc").where("time","<",t)).get().forEach(t=>{0==t.docs.length&&(this.loading.setResult(!1),this.toastService.warning(this.translate.instant("DEVICE_MOD.DATA_NULL"))),t.forEach(e=>{i.delete(e.ref),n+=1,e.id==t.docs[t.docs.length-1].id&&i.commit().then(t=>{this.loading.setResult(!0),this.toastService.success(this.translate.instant("DEVICE_MOD.REMOVE_DATA_SUCCESS"))}).catch(t=>{this.loading.setResult(!1),this.toastService.danger(this.translate.instant("DEVICE_MOD.REMOVE_DATA_UNSUCCESS"))}),499==n&&(i.commit(),i=this.afs.firestore.batch(),n=0)})})}save(){this.modalController.dismiss(this.day)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(Pe.ST),h.Y36(A.k),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-filter-delete"]],inputs:{justItem:"justItem",id:"id"},decls:19,vars:11,consts:[["slot","end"],[3,"click"],["name","close"],["type","indeterminate",4,"ngIf"],[2,"padding","15px"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],["shape","round","expand","full",3,"click"],["type","indeterminate"],["name","trash"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-buttons",0),h.TgZ(6,"ion-button",1),h.NdJ("click",function(){return e.close()}),h._UZ(7,"ion-icon",2),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(8,ba,1,0,"ion-progress-bar",3),h.TgZ(9,"ion-content"),h.TgZ(10,"p",4),h.TgZ(11,"b"),h._uU(12),h.ALo(13,"translate"),h.qZA(),h.qZA(),h.YNc(14,Sa,6,1,"ion-item",5),h.TgZ(15,"div",6),h.TgZ(16,"ion-button",7),h.NdJ("click",function(){return e.save()}),h._uU(17),h.ALo(18,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,5,"DEVICE_MOD.DATA")),h.xp6(5),h.Q6J("ngIf",e.loading.pending),h.xp6(4),h.Oqu(h.lcZ(13,7,"DEVICE_MOD.CHOOSE_INDEX")),h.xp6(2),h.Q6J("ngForOf",e.arrItem),h.xp6(3),h.hij(" ",h.lcZ(18,9,"SAVE")," "))},directives:[a.Gu,a.sr,a.wd,a.Sm,a.YG,a.gu,n.O5,a.W2,n.sg,a.X7,a.Ie,a.Q$],pipes:[g.X$],styles:[""]}),t})();var ya=i(50384);function Na(t,e){1&t&&h._UZ(0,"ion-progress-bar",15)}let Ea=(()=>{class t{constructor(t,e,i,n,s){this.modalController=t,this.toastService=e,this.alertController=i,this.iotService=n,this.translate=s,this.list=[],this.loading=new d.E,this.form=new o.cw({condition:new o.NI("",o.kI.required),value:new o.NI("",o.kI.required)})}ngOnInit(){this.form.setValue({condition:this.config[this.index].conditions[this.indexCondition].condition,value:this.config[this.index].conditions[this.indexCondition].value})}close(){this.modalController.dismiss()}presentConfirmRemove(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",message:this.translate.instant("DEVICE_MOD.CONFIRM_REMOVE_CONDITION"),buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"Okay",handler:()=>{this.remove()}}]})).present()})}remove(){this.iotService.removeConditionPub(this.deviceId,this.config[this.index].id,this.config[this.index].conditions[this.indexCondition].id).subscribe(t=>{if(1==t.status){this.toastService.success(this.translate.instant("DEVICE_MOD.REMOVE_CONFITION_CUCCESS"));let t=this.form.value;t.type="remove",this.modalController.dismiss(t)}else this.toastService.warning(this.translate.instant("DEVICE_MOD.REMOVE_DATA_UNSUCCESS"))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}save(){this.iotService.updateConditonPub(this.deviceId,this.config[this.index].id,this.config[this.index].conditions[this.indexCondition].id,this.form.value).subscribe(t=>{if(1==t.status){this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS"));let t=this.form.value;t.type="update",this.modalController.dismiss(t)}else this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS"))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(A.k),h.Y36(a.Br),h.Y36(Nt.d),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-config-value"]],inputs:{config:"config",deviceId:"deviceId",index:"index",indexCondition:"indexCondition"},decls:47,vars:41,consts:[["slot","start"],[3,"click"],["name","close"],["slot","end","fill","clear",3,"click"],["type","indeterminate",4,"ngIf"],[3,"formGroup"],["formControlName","condition","okText","Okay","cancelText","Dismiss"],["value",">"],["value",">="],["value","<"],["value","<="],["value","="],["slot","end","formControlName","value","type","number"],[1,"ion-text-center"],["size","small","color","medium","shape","round",3,"click"],["type","indeterminate"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-buttons",0),h.TgZ(6,"ion-button",1),h.NdJ("click",function(){return e.close()}),h._UZ(7,"ion-icon",2),h.qZA(),h.qZA(),h.TgZ(8,"ion-button",3),h.NdJ("click",function(){return e.save()}),h._uU(9," L\u01b0u "),h.qZA(),h.qZA(),h.qZA(),h.YNc(10,Na,1,0,"ion-progress-bar",4),h.TgZ(11,"ion-content"),h.TgZ(12,"ion-card",5),h.TgZ(13,"ion-list"),h.TgZ(14,"ion-item"),h.TgZ(15,"ion-label"),h._uU(16),h.ALo(17,"translate"),h.qZA(),h.TgZ(18,"ion-select",6),h.TgZ(19,"ion-select-option",7),h._uU(20),h.ALo(21,"translate"),h.qZA(),h.TgZ(22,"ion-select-option",8),h._uU(23),h.ALo(24,"translate"),h.ALo(25,"translate"),h.ALo(26,"translate"),h.qZA(),h.TgZ(27,"ion-select-option",9),h._uU(28),h.ALo(29,"translate"),h.qZA(),h.TgZ(30,"ion-select-option",10),h._uU(31),h.ALo(32,"translate"),h.ALo(33,"translate"),h.ALo(34,"translate"),h.qZA(),h.TgZ(35,"ion-select-option",11),h._uU(36),h.ALo(37,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(38,"ion-item"),h.TgZ(39,"ion-label"),h._uU(40),h.ALo(41,"translate"),h.qZA(),h._UZ(42,"ion-input",12),h.qZA(),h.qZA(),h.qZA(),h.TgZ(43,"div",13),h.TgZ(44,"ion-button",14),h.NdJ("click",function(){return e.presentConfirmRemove()}),h._uU(45),h.ALo(46,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,15,"DEVICE_MOD.CONFIG_CONDITION")),h.xp6(7),h.Q6J("ngIf",e.loading.pending),h.xp6(2),h.Q6J("formGroup",e.form),h.xp6(4),h.Oqu(h.lcZ(17,17,"DEVICE_MOD.CHOOSE_CONDITION")),h.xp6(4),h.Oqu(h.lcZ(21,19,"DEVICE_MOD.GREATER_THAN")),h.xp6(3),h.lnq("",h.lcZ(24,21,"DEVICE_MOD.GREATER_THAN")," ",h.lcZ(25,23,"DEVICE_MOD.OR")," ",h.lcZ(26,25,"DEVICE_MOD.SAME"),""),h.xp6(5),h.Oqu(h.lcZ(29,27,"DEVICE_MOD.LESS_THAN")),h.xp6(3),h.lnq("",h.lcZ(32,29,"DEVICE_MOD.LESS_THAN")," ",h.lcZ(33,31,"DEVICE_MOD.OR")," ",h.lcZ(34,33,"DEVICE_MOD.SAME"),""),h.xp6(5),h.Oqu(h.lcZ(37,35,"DEVICE_MOD.SAME")),h.xp6(4),h.Oqu(h.lcZ(41,37,"DEVICE_MOD.VALUE_WARNING")),h.xp6(5),h.Oqu(h.lcZ(46,39,"DEVICE_MOD.REMOVE")))},directives:[a.Gu,a.sr,a.wd,a.Sm,a.YG,a.gu,n.O5,a.W2,a.PM,o.JL,o.sg,a.q_,a.Ie,a.Q$,a.t9,a.QI,o.JJ,o.u,a.n0,a.pK,a.as,a.X7],pipes:[g.X$],styles:[""]}),t})();var Ma=i(3520),Ia=i(89858),wa=i(42812),Ua=i(19486),Pa=i(49829);function Ra(t,e){1&t&&h._UZ(0,"ion-progress-bar",11)}function ka(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-button",17),h.NdJ("click",function(){const e=h.CHM(t).index,i=h.oxw().index;return h.oxw().openConfigValue(i,e)}),h._uU(1),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw().$implicit;h.xp6(1),h.lnq("",i.label,"",t.condition,"",t.value,"")}}function Ya(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label",12),h.TgZ(2,"ion-text",13),h.TgZ(3,"h3"),h._uU(4),h.qZA(),h.qZA(),h.TgZ(5,"ion-button",14),h.NdJ("click",function(){const e=h.CHM(t).index;return h.oxw().openAddConfigValue(e)}),h._UZ(6,"ion-icon",15),h.qZA(),h.YNc(7,ka,2,3,"ion-button",16),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw();h.xp6(2),h.Q6J("ngStyle",i.calculateColor(t.color)),h.xp6(2),h.Oqu(t.label),h.xp6(3),h.Q6J("ngForOf",t.conditions)}}let La=(()=>{class t{constructor(t,e,i,n,o,s,a,r,l){this.modalController=t,this.alertController=e,this.afs=i,this.authService=n,this.fns=o,this.afAuth=s,this.toastService=a,this.iotService=r,this.translate=l,this.loading=new d.E}ngOnInit(){return(0,l.mG)(this,void 0,void 0,function*(){let t=yield this.iotService.getInforDevice(this.id).catch(t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});t&&1==t.status?(this.config=t.data.peripherals,this.device_infor.setting=t.data.setting,this.device_infor.third_app_setting=t.data.third_app_setting?t.data.third_app_setting:{},this.device_infor.setting||(this.device_infor.setting={phone_alert:0,send_data:1,alert_offline:1,alert_factor:1})):t&&0==t.status&&this.toastService.warning(t.error)})}close(){this.modalController.dismiss()}calculateColor(t){return{color:t}}saveConfigPhone(t){t!=this.device_infor.setting.phone_alert&&this.actionSaveConfigPhone(t)}actionSaveConfigPhone(t){return(0,l.mG)(this,void 0,void 0,function*(){this.loading.setPending(!0),console.log(this.device_infor);let e={phone_alert:t,send_data:this.device_infor.setting.send_data,alert_offline:this.device_infor.setting.alert_offline,alert_factor:this.device_infor.setting.alert_factor};const i=yield this.iotService.updateSetting(this.id,e).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});i&&1==i.status?(this.device_infor.setting.phone_alert=e.phone_alert,this.loading.setResult(!0),this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS"))):i&&0==i.status&&(this.loading.setResult(!1),this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")))})}changeConfigSendData(){return(0,l.mG)(this,void 0,void 0,function*(){this.loading.setPending(!0),(yield this.authService.checkTkFb(this.iotService.pcode,this.afAuth))?this.fns.httpsCallable("saveConfig")({deviceId:this.id,send_data:!this.infor.config.send_data,warn_phone:this.infor.config.warn_phone}).subscribe(t=>{this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")),this.loading.setResult(!0),this.infor.config.send_data=!this.infor.config.send_data},()=>{this.loading.setResult(!1),this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS"))}):(this.loading.setResult(!1),this.toastService.warning(this.translate.instant("DEVICE_MOD.AUTH_FAILED")))})}openConfigValue(t,e){return(0,l.mG)(this,void 0,void 0,function*(){const i=yield this.modalController.create({component:Ea,cssClass:"my-custom-class",componentProps:{config:this.config,deviceId:this.id,index:t,indexCondition:e}});return i.onDidDismiss().then(i=>{void 0!==i.data&&("update"==i.data.type?this.config[t].conditions[e]={label:this.config[t].label,condition:i.data.condition,value:i.data.value}:this.config[t].conditions.splice(e,1))}),yield i.present()})}openAddConfigValue(t){return(0,l.mG)(this,void 0,void 0,function*(){const e=yield this.modalController.create({component:Ia.F,cssClass:"my-custom-class",componentProps:{config:this.config,deviceId:this.id,index:t}});return e.onDidDismiss().then(e=>{void 0!==e.data&&this.config[t].conditions.push({label:this.config[t].label,condition:e.data.condition,value:e.data.value})}),yield e.present()})}openConfigWifi(){var t;return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:Ma.i,cssClass:"my-custom-class",componentProps:{id:this.device_infor.device_id_fb,type:"envisor",name:null===(t=this.device_infor)||void 0===t?void 0:t.name}})).present()})}configPhone(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("DEVICE_MOD.SETTING"),inputs:[{name:"phone",type:"number",placeholder:this.translate.instant("AUTH.PHONE_NUMBER"),value:this.device_infor.setting.phone_alert}],buttons:[{text:"Cancel",role:"cancel",cssClass:"headerAlert",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.saveConfigPhone(t.phone)}}]})).present()})}presentUpdateDevice(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("DEVICE_MOD.UPDATE_INFOR"),inputs:[{name:"name",type:"text",value:this.device_infor.name,placeholder:this.translate.instant("DEVICE_MOD.NAME")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.saveDevice(t)}}]})).present()})}saveDevice(t){return(0,l.mG)(this,void 0,void 0,function*(){if(t.name!=this.device_infor.name){let e=yield this.iotService.update(t.name,this.device_infor.id).catch(t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});e&&1==e.status?(this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")),this.device_infor.name=t.name):e&&0==e.status&&this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS"))}})}updateSetting(t,e){return(0,l.mG)(this,void 0,void 0,function*(){let i={phone_alert:this.device_infor.setting.phone_alert,send_data:this.device_infor.setting.send_data,alert_offline:this.device_infor.setting.alert_offline,alert_factor:this.device_infor.setting.alert_factor};console.log(i),i[e]=1==i[e]?0:1,console.log(i),this.loading.setPending(!0);const n=yield this.iotService.updateSetting(this.id,i).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loading.setResult(!1),t.target.checked=0==i[e]});n&&1==n.status?(this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")),this.device_infor.setting[e]=i[e],console.log(this.device_infor.setting),this.loading.setResult(!0)):n&&0==n.status&&(this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")),this.loading.setResult(!0),t.target.checked=0==i[e])})}configAutoRecord(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:wa.u,cssClass:"my-custom-class",componentProps:{config:this.device_infor.third_app_setting?this.device_infor.third_app_setting:{},deviceId:this.id}});return t.onDidDismiss().then(t=>{void 0!==t.data&&(this.device_infor.third_app_setting.mode_data=t.data.mode_data)}),yield t.present()})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(a.Br),h.Y36(Pe.ST),h.Y36(ya.e),h.Y36(Ua.l4),h.Y36(Pa.zQ),h.Y36(A.k),h.Y36(Nt.d),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-setting"]],inputs:{id:"id",device_infor:"device_infor"},decls:83,vars:48,consts:[["slot","end"],[3,"click"],["slot","icon-only","name","close"],["type","indeterminate",4,"ngIf"],["lines","inset"],["name","calculator-outline","slot","start"],["slot","end","fill","clear",3,"click"],["name","create"],[4,"ngFor","ngForOf"],[3,"innerHTML"],["mode","ios",3,"checked","click"],["type","indeterminate"],[1,"ion-text-wrap"],[3,"ngStyle"],["shape","round","type","small","fill","outline","expand","block",1,"ion-float-right",3,"click"],["name","add","fill","clear"],["class","ion-float-left","shape","round","type","small","fill","outline","expand","block",3,"click",4,"ngFor","ngForOf"],["shape","round","type","small","fill","outline","expand","block",1,"ion-float-left",3,"click"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-buttons",0),h.TgZ(6,"ion-button",1),h.NdJ("click",function(){return e.close()}),h._UZ(7,"ion-icon",2),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(8,Ra,1,0,"ion-progress-bar",3),h.TgZ(9,"ion-content"),h.TgZ(10,"ion-list",4),h.TgZ(11,"ion-item"),h._UZ(12,"ion-icon",5),h.TgZ(13,"ion-label"),h.TgZ(14,"h3"),h._uU(15),h.ALo(16,"translate"),h.qZA(),h.TgZ(17,"p"),h._uU(18),h.qZA(),h.qZA(),h.TgZ(19,"ion-button",6),h.NdJ("click",function(){return e.presentUpdateDevice()}),h._UZ(20,"ion-icon",7),h.qZA(),h.qZA(),h.TgZ(21,"ion-list-header"),h.TgZ(22,"ion-label"),h._uU(23),h.ALo(24,"translate"),h.qZA(),h.qZA(),h.YNc(25,Ya,8,3,"ion-item",8),h.qZA(),h.TgZ(26,"ion-list"),h.TgZ(27,"ion-list-header"),h.TgZ(28,"ion-label"),h._uU(29),h.ALo(30,"translate"),h.qZA(),h.qZA(),h.TgZ(31,"ion-item"),h.TgZ(32,"ion-label"),h.TgZ(33,"ion-text"),h._uU(34),h.ALo(35,"translate"),h.qZA(),h._UZ(36,"p",9),h.qZA(),h.TgZ(37,"ion-button",6),h.NdJ("click",function(){return e.configAutoRecord()}),h._UZ(38,"ion-icon",7),h.qZA(),h.qZA(),h.TgZ(39,"ion-item"),h.TgZ(40,"ion-label"),h._uU(41),h.ALo(42,"translate"),h.qZA(),h.TgZ(43,"ion-button",6),h.NdJ("click",function(){return e.openConfigWifi()}),h._UZ(44,"ion-icon",7),h.qZA(),h.qZA(),h.TgZ(45,"ion-item"),h.TgZ(46,"ion-label"),h._uU(47),h.ALo(48,"translate"),h.qZA(),h.TgZ(49,"ion-toggle",10),h.NdJ("click",function(t){return e.updateSetting(t,"send_data")}),h.qZA(),h.qZA(),h.TgZ(50,"ion-item"),h.TgZ(51,"ion-label"),h._uU(52),h.ALo(53,"translate"),h.qZA(),h.TgZ(54,"ion-toggle",10),h.NdJ("click",function(t){return e.updateSetting(t,"alert_offline")}),h.qZA(),h.qZA(),h.TgZ(55,"ion-item"),h.TgZ(56,"ion-label"),h._uU(57),h.ALo(58,"translate"),h.qZA(),h.TgZ(59,"ion-toggle",10),h.NdJ("click",function(t){return e.updateSetting(t,"alert_factor")}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(60,"ion-list"),h.TgZ(61,"ion-list-header"),h.TgZ(62,"ion-label"),h._uU(63),h.ALo(64,"translate"),h.qZA(),h.qZA(),h.TgZ(65,"ion-item"),h.TgZ(66,"ion-label"),h._uU(67),h.ALo(68,"translate"),h.qZA(),h.TgZ(69,"ion-note",0),h._uU(70),h.qZA(),h.qZA(),h.TgZ(71,"ion-item"),h.TgZ(72,"ion-label"),h._uU(73,"Firmware"),h.qZA(),h.TgZ(74,"ion-note",0),h._uU(75,"1.1"),h.qZA(),h.qZA(),h.TgZ(76,"ion-item"),h.TgZ(77,"ion-label"),h._uU(78),h.ALo(79,"translate"),h.qZA(),h.TgZ(80,"ion-note",0),h._uU(81),h.ALo(82,"date"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,21,"DEVICE_MOD.SETTING_DEVICE")),h.xp6(5),h.Q6J("ngIf",e.loading.pending),h.xp6(7),h.Oqu(h.lcZ(16,23,"DEVICE_MOD.NAME")),h.xp6(3),h.Oqu(null==e.device_infor?null:e.device_infor.name),h.xp6(5),h.Oqu(h.lcZ(24,25,"WARNING")),h.xp6(2),h.Q6J("ngForOf",e.config),h.xp6(4),h.Oqu(h.lcZ(30,27,"DEVICE_MOD.SETTING")),h.xp6(5),h.Oqu(h.lcZ(35,29,"DEVICE_MOD.AUTO_RECORD")),h.xp6(2),h.Q6J("innerHTML",e.device_infor.third_app_setting?e.device_infor.third_app_setting.mode_data:"no",h.oJD),h.xp6(5),h.Oqu(h.lcZ(42,31,"DEVICE_MOD.CONFIG_CONNECT")),h.xp6(6),h.Oqu(h.lcZ(48,33,"DEVICE_MOD.NO_SEND_DATA")),h.xp6(2),h.Q6J("checked",1==+(null==e.device_infor||null==e.device_infor.setting?null:e.device_infor.setting.send_data)),h.xp6(3),h.Oqu(h.lcZ(53,35,"DEVICE_MOD.OFFINE_WARNING")),h.xp6(2),h.Q6J("checked",1==+(null==e.device_infor||null==e.device_infor.setting?null:e.device_infor.setting.alert_offline)),h.xp6(3),h.Oqu(h.lcZ(58,37,"DEVICE_MOD.WARNING_OVER")),h.xp6(2),h.Q6J("checked",1==+(null==e.device_infor||null==e.device_infor.setting?null:e.device_infor.setting.alert_factor)),h.xp6(4),h.Oqu(h.lcZ(64,39,"DEVICE_MOD.INFOR")),h.xp6(4),h.Oqu(h.lcZ(68,41,"DEVICE_MOD.VER")),h.xp6(3),h.Oqu(null==e.device_infor?null:e.device_infor.version),h.xp6(8),h.Oqu(h.lcZ(79,43,"DEVICE_MOD.ACTIVE")),h.xp6(3),h.Oqu(h.xi3(82,45,1e3*(null==e.device_infor?null:e.device_infor.add_time),"MM.dd.yyyy")))},directives:[a.Gu,a.sr,a.wd,a.Sm,a.YG,a.gu,n.O5,a.W2,a.q_,a.Ie,a.Q$,a.yh,n.sg,a.yW,a.ho,a.w,a.uN,a.X7,n.PC],pipes:[g.X$,n.uU],styles:[""]}),t})();const Fa=["lineCanvas"];function Ja(t,e){1&t&&h._UZ(0,"ion-progress-bar",13)}function Qa(t,e){if(1&t&&(h.TgZ(0,"div"),h.TgZ(1,"div",16),h._uU(2),h.qZA(),h.TgZ(3,"div",17),h._uU(4),h.qZA(),h.qZA()),2&t){const t=h.oxw().$implicit,e=h.oxw();h.xp6(1),h.Q6J("ngStyle",e.calculateColor(null==e.justItem[t]?null:e.justItem[t].color)),h.xp6(1),h.hij(" ",e.justItem[t].label," "),h.xp6(1),h.Q6J("ngStyle",e.calculateColor(null==e.justItem[t]?null:e.justItem[t].color)),h.xp6(1),h.hij(" ",null==e.justItem[t]?null:e.justItem[t].value," ")}}function Va(t,e){if(1&t&&(h.TgZ(0,"ion-col",14),h.YNc(1,Qa,5,4,"div",15),h.qZA()),2&t){const t=e.$implicit,i=h.oxw();h.xp6(1),h.Q6J("ngIf",i.justItem[t].value&&i.justItem[t].label)}}function ja(t,e){if(1&t&&h._UZ(0,"div",18),2&t){const t=h.oxw();h.Q6J("options",t.optionChartsAll)("merge",t.mergesAll)}}let Ha=(()=>{class t{constructor(t,e,i,n,o,s,a,r,l){this.modalController=t,this.route=e,this.afs=i,this.pondService=n,this.toastService=o,this.alertController=s,this.cd=a,this.iotService=r,this.translate=l,this.optionCharts={},this.optionChartsAll={},this.merges={},this.mergesAll={},this.datasets=[],this.justItem={},this.seleted=3,this.loading=new d.E,this.loadStatis=new Se.X(1),this.show=!1,this.dataOption={},this.startRange=7,this.limitLoadDate=new Date}ngOnInit(){return(0,l.mG)(this,void 0,void 0,function*(){this.id=this.route.snapshot.paramMap.get("device_id"),yield this.loadRangeBar()})}ionViewWillEnter(){this.getInfor()}setMergeAll(t,e){this.mergesAll=this.optionChartsAll,this.mergesAll.series[t].data.push(e)}setOptionChartAll(t){let e=[],i=[];for(let n in t)e.length<3&&e.push({type:"value",boundaryGap:[0,"100%"],splitLine:{show:!1},show:0==e.length,position:e.length%2==0?"left":"right",offset:0}),i.push({name:n,type:"line",smooth:!0,symbol:"none",yAxisIndex:"orp"==n?2:"rtd"==n?1:0,data:t[n].data,itemStyle:{color:1==this.isColor(t[n].color.substring(1))?t[n].color:"#244988"}});return this.mergesAll={series:i},this.optionChartsAll={tooltip:{trigger:"axis",formatter:function(t){let e={};t.forEach(t=>{t.seriesName in e||(e[t.seriesName]='<p><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:'+t.color+'"></span>'+t.seriesName+" : "+t.data.value[1]+"<br/></p>")});let i="<p>"+u(t[0].value[0]).format("HH:mm YYYY-MM-DD")+"</p>";for(let n in e)i+=e[n];return i},position:["50%","50%"]},color:["#000000"],title:{left:"center",text:"Bi\u1ec3u \u0111\u1ed3"},grid:{left:"0%",right:"12px",bottom:"12%",containLabel:!0},xAxis:{type:"time"},yAxis:e,dataZoom:[{type:"inside",start:0,end:100},{start:0,end:10,type:"inside",handleIcon:"M512 512m-208 0a6.5 6.5 0 1 0 416 0 6.5 6.5 0 1 0-416 0Z M512 192C335.264 192 192 335.264 192 512c0 176.736 143.264 320 320 320s320-143.264 320-320C832 335.264 688.736 192 512 192zM512 800c-159.072 0-288-128.928-288-288 0-159.072 128.928-288 288-288s288 128.928 288 288C800 671.072 671.072 800 512 800z",handleSize:"100%",handleStyle:{color:"#fff",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2}}],series:i},this.optionChartsAll}setOptionChart(t,e,i,n){return{tooltip:{trigger:"axis",position:["50%","50%"]},color:["#000000"],title:{left:"center",text:t,textStyle:{color:1==this.isColor(e.substring(1))?e:"#244988"}},grid:{left:"2%",right:"5%",bottom:"12%",containLabel:!0},xAxis:[{type:"category",data:i,boundaryGap:!1}],yAxis:[{type:"value",boundaryGap:[0,"100%"]}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:10,type:"inside",handleIcon:"M512 512m-208 0a6.5 6.5 0 1 0 416 0 6.5 6.5 0 1 0-416 0Z M512 192C335.264 192 192 335.264 192 512c0 176.736 143.264 320 320 320s320-143.264 320-320C832 335.264 688.736 192 512 192zM512 800c-159.072 0-288-128.928-288-288 0-159.072 128.928-288 288-288s288 128.928 288 288C800 671.072 671.072 800 512 800z",handleSize:"100%",handleStyle:{color:"#fff",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2}}],series:[{name:t,type:"line",smooth:!0,symbol:"none",sampling:"average",data:n,itemStyle:{color:1==this.isColor(e.substring(1))?e:"#244988"},areaStyle:{color:new Oa.graphic.LinearGradient(0,0,0,1,[{offset:0,color:1==this.isColor(e.substring(1))?e:"#3c7ae4"},{offset:1,color:1==this.isColor(e.substring(1))?e:"#3c7ae4"}])}}]}}isColor(t){return"string"==typeof t&&6===t.length&&!isNaN(Number("0x"+t))}loadRangeBar(){return(0,l.mG)(this,void 0,void 0,function*(){let t=0,e=u();const i=yield this.afs.collection("pub").doc(this.id).collection("factors").get().toPromise();let n=0,o=7;yield i.forEach(i=>(0,l.mG)(this,void 0,void 0,function*(){n+=1;const s=i.id;i.data(),yield(yield this.afs.collection("pub").doc(this.id).collection("factors").doc(s).collection("data",t=>t.orderBy("time","asc").limit(1)).get().toPromise()).forEach(i=>(0,l.mG)(this,void 0,void 0,function*(){n-=1,i.data().time.toMillis()>t&&(t=i.data().time.toMillis(),this.startRange=e.diff(u(t),"days"),o=this.startRange-this.startRange%7==this.startRange?this.startRange-7:this.startRange-this.startRange%7),0==n&&(this.seleted=o)}))}))})}getInfor(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.iotService.get(this.id).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});t&&1==t.status?this.deviceInfor=t.data:t&&0==t.status&&this.toastService.warning(t.error)})}getData(t){return(0,l.mG)(this,void 0,void 0,function*(){this.loading.setPending(!0),this.dataOption={},this.optionChartsAll={};let e=new Date(u(this.limitLoadDate).subtract(t,"days").toDate()),i=new Date(u(e).add(7,"days").toDate());i.getTime()>this.limitLoadDate.getTime()&&(i=this.limitLoadDate),this.afs.collection("pub").doc(this.id).collection("factors").get().forEach(t=>(0,l.mG)(this,void 0,void 0,function*(){let n=t.docs.length,o=0;yield t.forEach(t=>(0,l.mG)(this,void 0,void 0,function*(){const s=t.id,a=t.data();this.dataOption[a.name]={},this.dataOption[a.name].x=[],this.dataOption[a.name].title=a.ui.label,this.dataOption[a.name].color=a.ui?a.ui.color:"#244988",this.dataOption[a.name].data=[],yield this.afs.collection("pub").doc(this.id).collection("factors").doc(s).collection("data",t=>t.where("time",">=",e).where("time","<",i).orderBy("time","asc")).get().subscribe(t=>(0,l.mG)(this,void 0,void 0,function*(){this.datasets.includes(a.name)||this.datasets.push(a.name),this.justItem[a.name]={},this.justItem[a.name].label=a.ui.label,this.justItem[a.name].color=a.ui?a.ui.color:"#244988";let i=e.getTime();yield t.forEach(t=>{let e=u(t.data().time.toMillis()).format("HH:00:00 YYYY-MM-DD"),n=new Date(e).getTime();i!=n&&(this.dataOption[a.name].x.push(e),this.dataOption[a.name].data.push({value:[new Date(e),t.data().value]}),this.justItem[a.name].value=t.data().value,this.justItem[a.name].lastTime=t.data().time.toMillis(),i=n)}),o+=1,o==n&&(this.loadStatis.next(0),this.loading.setResult(!0),this.datasets.sort(),this.setOptionChartAll(this.dataOption))}))}))})),this.loadStatis.subscribe(t=>{0==t&&(this.limitLoadDate=new Date(u(this.limitLoadDate).subtract(this.startRange-this.seleted).toDate()),this.afs.collection("pub").doc(this.id).collection("factors").get().forEach(t=>{t.forEach(t=>{const e=t.id,i=t.data();this.afs.collection("pub").doc(this.id).collection("factors").doc(e).collection("data",t=>t.orderBy("time","desc").limit(1)).stateChanges(["added"]).subscribe(t=>{t.reverse().map(t=>{i.name in this.justItem||(this.justItem[i.name]={}),this.justItem[i.name].color=void 0!==i.ui.color?i.ui.color:"#244988",this.justItem[i.name].value=t.payload.doc.data().value,this.justItem[i.name].lastTime=t.payload.doc.data().time.toMillis();let e=this.optionChartsAll.series.findIndex(t=>t.name===i.name);-1!=e&&this.optionChartsAll.series[e].data.push({value:[new Date(u(t.payload.doc.data().time.toMillis()).format("HH:mm YYYY-MM-DD")),t.payload.doc.data().value]}),this.mergesAll={series:this.optionChartsAll.series}})})})}))})})}add(){this.optionCharts.do.xAxis[0].data.push(u().format("MMMM Do YYYY, h:mm:ss a")),this.optionCharts.do.series[0].data.push(5)}filterData(){return(0,l.mG)(this,void 0,void 0,function*(){})}presentSetting(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:La,componentProps:{id:this.id,device_infor:this.deviceInfor}})).present()})}presentChooseDelete(t){return(0,l.mG)(this,void 0,void 0,function*(){const e=yield this.modalController.create({component:Da,cssClass:"my-custom-class",componentProps:{max:this.justItem[t].lastTime}});return e.onDidDismiss().then(e=>{void 0!==e.data&&this.deleteData(e.data,t)}),yield e.present()})}presentFilterDelete(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:Ca,cssClass:"my-custom-class",componentProps:{justItem:this.justItem,id:this.id}});return t.onDidDismiss().then(t=>{void 0!==t.data&&(this.seleted=t.data,this.getData(this.startRange-this.seleted))}),yield t.present()})}deleteData(t,e){t=new Date(t),console.log(t);let i=this.afs.firestore.batch(),n=0;this.afs.collection("pub").doc(this.id).collection("factors").doc(e).collection("data",e=>e.orderBy("time","desc").where("time","<",t)).get().forEach(t=>{0==t.docs.length&&this.toastService.warning(this.translate.instant("DEVICE_MOD.DATA_NULL")),t.forEach(e=>{console.log(e.ref),i.delete(e.ref),n+=1,e.id==t.docs[t.docs.length-1].id&&i.commit().then(t=>{this.getData(this.startRange-this.seleted),this.toastService.success(this.translate.instant("DEVICE_MOD.REMOVE_DATA_SUCCESS"))}).catch(t=>{this.toastService.warning(this.translate.instant("DEVICE_MOD.REMOVE_DATA_UNSUCCESS"))}),499==n&&(i.commit(),i=this.afs.firestore.batch(),n=0)})})}calculateColor(t){return{color:t}}numberEffect(t){}ionViewDidEnter(){this.show=!0}setRangeDay(){this.getData(this.startRange-this.seleted)}getLabelDayRange(){let t=new Date(u(this.limitLoadDate).subtract(this.startRange-this.seleted,"days").toDate()),e=new Date(u(t).add(7,"days").toDate());return e.getTime()>this.limitLoadDate.getTime()&&(e=this.limitLoadDate),"T\u1eeb "+u(t).format("DD-MM-YYYY")+" \u0111\u1ebfn "+u(e).format("DD-MM-YYYY")}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(s.gz),h.Y36(Pe.ST),h.Y36(c.p),h.Y36(A.k),h.Y36(a.Br),h.Y36(h.sBO),h.Y36(Nt.d),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pub-device"]],viewQuery:function(t,e){if(1&t&&h.Gf(Fa,7),2&t){let t;h.iGM(t=h.CRH())&&(e.chartRef=t.first)}},decls:24,vars:14,consts:[["slot","start"],["text","","defaultHref","tabs/management"],["color","tb"],["slot","end"],["color","danger","slot","end",3,"click"],[3,"disabled","click"],["slot","icon-only","name","cog-outline"],["type","indeterminate",4,"ngIf"],["size","6","size-md","3","class","ion-text-center ion-margin-top",4,"ngFor","ngForOf"],["style","margin-top: 12px;","echarts","",3,"options","merge",4,"ngIf"],["lines","none"],["min","0","step","7","snaps","true","color","primary",3,"max","ngClass","ngModel","ngModelChange","ionChange"],[1,"ion-text-center"],["type","indeterminate"],["size","6","size-md","3",1,"ion-text-center","ion-margin-top"],[4,"ngIf"],[1,"title","ion-text-uppercase",3,"ngStyle"],[1,"f-value",3,"ngStyle"],["echarts","",2,"margin-top","12px",3,"options","merge"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.qZA(),h.TgZ(4,"ion-title",2),h._uU(5),h.ALo(6,"translate"),h.qZA(),h.TgZ(7,"ion-buttons",3),h.TgZ(8,"ion-button",4),h.NdJ("click",function(){return e.presentFilterDelete()}),h._uU(9),h.ALo(10,"translate"),h.qZA(),h.TgZ(11,"ion-button",5),h.NdJ("click",function(){return e.presentSetting()}),h._UZ(12,"ion-icon",6),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(13,"ion-content"),h.YNc(14,Ja,1,0,"ion-progress-bar",7),h.TgZ(15,"ion-grid"),h.TgZ(16,"ion-row"),h.YNc(17,Va,2,1,"ion-col",8),h.qZA(),h.qZA(),h.YNc(18,ja,1,2,"div",9),h.TgZ(19,"ion-list",10),h.TgZ(20,"ion-item"),h.TgZ(21,"ion-range",11),h.NdJ("ngModelChange",function(t){return e.seleted=t})("ionChange",function(){return e.setRangeDay()}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(22,"p",12),h._uU(23),h.qZA(),h.qZA()),2&t&&(h.xp6(5),h.Oqu(h.lcZ(6,10,"DEVICE_MOD.ENVISOR")),h.xp6(4),h.Oqu(h.lcZ(10,12,"DEVICE_MOD.REMOVE")),h.xp6(2),h.Q6J("disabled",!e.iotService.checkPermission(e.pondService.permission)),h.xp6(3),h.Q6J("ngIf",e.loading.pending),h.xp6(3),h.Q6J("ngForOf",e.datasets),h.xp6(1),h.Q6J("ngIf",e.show),h.xp6(3),h.Q6J("max",e.startRange-7)("ngClass",e.loading.pending?"disableSelect":"")("ngModel",e.seleted),h.xp6(2),h.Oqu(e.getLabelDayRange()))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,a.wd,a.YG,a.gu,a.W2,n.O5,a.jY,a.Nd,n.sg,a.q_,a.Ie,a.I_,a.QI,n.mk,o.JJ,o.On,a.X7,a.wI,n.PC,r._w],pipes:[g.X$],styles:['.f-value[_ngcontent-%COMP%]{font-size:2em;font-family:Atomic}.icon-title[_ngcontent-%COMP%]:before{content:"";height:2px;background:#244988;width:10%;margin-right:12px;display:inline-block;vertical-align:middle}.icon-title[_ngcontent-%COMP%]:after{content:"";height:2px;background:#244988;width:10%;margin-left:12px;display:inline-block;vertical-align:middle}.title[_ngcontent-%COMP%]{font-size:.8em}.disableSelect[_ngcontent-%COMP%]{pointer-events:none}']}),t})(),Ga=(()=>{class t{constructor(t,e,i,n,o,s){this.modalController=t,this.iotService=e,this.alertController=i,this.toastService=n,this.pondService=o,this.translate=s,this.loading=new d.E}ngOnInit(){console.log(this.device),this.device.setting||(this.device.setting={phone_alert:0,alert_control:1,alert_offline:1,automatic:1})}close(){this.modalController.dismiss()}presentUpdateDevice(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("DEVICE_MOD.UPDATE_INFOR"),inputs:[{name:"name",type:"text",value:this.device.name,placeholder:this.translate.instant("DEVICE_MOD.NAME")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.saveDevice(t)}}]})).present()})}saveDevice(t){return(0,l.mG)(this,void 0,void 0,function*(){const e=yield this.iotService.update(t.name,this.device.id).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});e&&1==e.status?(this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")),this.device.name=t.name):e&&0==e.status&&this.toastService.warning(e.messages)})}presentConfigWifi(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:Ma.i,cssClass:"my-custom-class",componentProps:{ssid:this.id+"_"+this.version}})).present()})}updateSetting(t,e){return(0,l.mG)(this,void 0,void 0,function*(){let i={phone_alert:this.device.setting.phone_alert,alert_control:this.device.setting.alert_control,alert_offline:this.device.setting.alert_offline,automatic:this.device.setting.automatic};i[e]=1==i[e]?0:1;const n=yield this.iotService.updateSetting(this.device.id,i).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),t.target.checked=0==i[e]});n&&1==n.status?(this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")),this.device.setting[e]=i[e]):n&&0==n.status&&(this.toastService.warning(n.errors),t.target.checked=0==i[e])})}updatePhoneSetting(t){return(0,l.mG)(this,void 0,void 0,function*(){let e=this.device.setting;e.phone_alert=t;const i=yield this.iotService.updateSetting(this.device.id,e).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});i&&1==i.status?(this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")),this.device.setting.phone_alert=e.phone_alert):i&&0==i.status&&this.toastService.warning(i.errors)})}presentUpdatePhone(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("DEVICE_MOD.UPDATE_INFOR"),inputs:[{name:"phone",type:"text",value:this.device.setting.phone_alert,placeholder:this.translate.instant("DEVICE_MOD.NAME")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.updatePhoneSetting(t.phone)}}]})).present()})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(Nt.d),h.Y36(a.Br),h.Y36(A.k),h.Y36(c.p),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-settings"]],inputs:{device:"device",id:"id",version:"version"},decls:83,vars:37,consts:[["slot","end"],[3,"click"],["slot","icon-only","name","close"],["name","calculator-outline","slot","start"],[2,"color","#244988"],["slot","end","mode","ios","fill","clear",3,"disabled","click"],["name","create"],["name","wifi-outline","slot","start"],["name","call-outline","slot","start"],["name","aperture-outline","slot","start"],["mode","ios","slot","end",3,"checked","click"],["name","alert-circle-outline","slot","start"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-buttons",0),h.TgZ(6,"ion-button",1),h.NdJ("click",function(){return e.close()}),h._UZ(7,"ion-icon",2),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"ion-list"),h.TgZ(10,"ion-list-header"),h.TgZ(11,"ion-label"),h._uU(12),h.ALo(13,"translate"),h.qZA(),h.qZA(),h.TgZ(14,"ion-item"),h._UZ(15,"ion-icon",3),h.TgZ(16,"ion-label"),h.TgZ(17,"h3",4),h._uU(18),h.ALo(19,"translate"),h.qZA(),h.TgZ(20,"p"),h._uU(21),h.qZA(),h.qZA(),h.TgZ(22,"ion-button",5),h.NdJ("click",function(){return e.presentUpdateDevice()}),h._UZ(23,"ion-icon",6),h.qZA(),h.qZA(),h.TgZ(24,"ion-item"),h._UZ(25,"ion-icon",7),h.TgZ(26,"ion-label"),h.TgZ(27,"h3",4),h._uU(28),h.ALo(29,"translate"),h.qZA(),h.qZA(),h.TgZ(30,"ion-button",5),h.NdJ("click",function(){return e.presentConfigWifi()}),h._UZ(31,"ion-icon",6),h.qZA(),h.qZA(),h.TgZ(32,"ion-item"),h._UZ(33,"ion-icon",8),h.TgZ(34,"ion-label"),h.TgZ(35,"h3",4),h._uU(36),h.ALo(37,"translate"),h.qZA(),h.TgZ(38,"p"),h._uU(39),h.qZA(),h.qZA(),h.TgZ(40,"ion-button",5),h.NdJ("click",function(){return e.presentUpdatePhone()}),h._UZ(41,"ion-icon",6),h.qZA(),h.qZA(),h.TgZ(42,"ion-item"),h._UZ(43,"ion-icon",9),h.TgZ(44,"ion-label"),h.TgZ(45,"h3",4),h._uU(46,"T\u1ef1 \u0111\u1ed9ng"),h.qZA(),h.qZA(),h.TgZ(47,"ion-toggle",10),h.NdJ("click",function(t){return e.updateSetting(t,"automatic")}),h.qZA(),h.qZA(),h.TgZ(48,"ion-item"),h._UZ(49,"ion-icon",11),h.TgZ(50,"ion-label"),h.TgZ(51,"h3",4),h._uU(52,"C\u1ea3nh b\xe1o \u0111i\u1ec1u khi\u1ec3n"),h.qZA(),h.qZA(),h.TgZ(53,"ion-toggle",10),h.NdJ("click",function(t){return e.updateSetting(t,"alert_control")}),h.qZA(),h.qZA(),h.TgZ(54,"ion-item"),h._UZ(55,"ion-icon",11),h.TgZ(56,"ion-label"),h.TgZ(57,"h3",4),h._uU(58,"C\u1ea3nh b\xe1o offline"),h.qZA(),h.qZA(),h.TgZ(59,"ion-toggle",10),h.NdJ("click",function(t){return e.updateSetting(t,"alert_offline")}),h.qZA(),h.qZA(),h.qZA(),h.TgZ(60,"ion-list"),h.TgZ(61,"ion-list-header"),h.TgZ(62,"ion-label"),h._uU(63),h.ALo(64,"translate"),h.qZA(),h.qZA(),h.TgZ(65,"ion-item"),h.TgZ(66,"ion-label"),h._uU(67),h.ALo(68,"translate"),h.qZA(),h.TgZ(69,"ion-text",0),h._uU(70),h.qZA(),h.qZA(),h.TgZ(71,"ion-item"),h.TgZ(72,"ion-label"),h._uU(73,"Firmware"),h.qZA(),h.TgZ(74,"ion-text",0),h._uU(75,"1.1"),h.qZA(),h.qZA(),h.TgZ(76,"ion-item"),h.TgZ(77,"ion-label"),h._uU(78),h.ALo(79,"translate"),h.qZA(),h.TgZ(80,"ion-text",0),h._uU(81),h.ALo(82,"date"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,18,"DEVICE_MOD.CONFIG_CABINET")),h.xp6(9),h.Oqu(h.lcZ(13,20,"DEVICE_MOD.SETTING")),h.xp6(6),h.Oqu(h.lcZ(19,22,"DEVICE_MOD.NAME")),h.xp6(3),h.Oqu(null==e.device?null:e.device.name),h.xp6(1),h.Q6J("disabled",!e.iotService.checkPermission(e.pondService.permission)),h.xp6(6),h.Oqu(h.lcZ(29,24,"DEVICE_MOD.CONFIG_CONNECT")),h.xp6(2),h.Q6J("disabled",!e.iotService.checkPermission(e.pondService.permission)),h.xp6(6),h.Oqu(h.lcZ(37,26,"DEVICE_MOD.PHONE")),h.xp6(3),h.Oqu(null==e.device?null:e.device.setting.phone_alert),h.xp6(1),h.Q6J("disabled",!e.iotService.checkPermission(e.pondService.permission)),h.xp6(7),h.Q6J("checked",e.device.setting.automatic),h.xp6(6),h.Q6J("checked",e.device.setting.alert_control),h.xp6(6),h.Q6J("checked",e.device.setting.alert_offline),h.xp6(4),h.Oqu(h.lcZ(64,28,"DEVICE_MOD.INFOR")),h.xp6(4),h.Oqu(h.lcZ(68,30,"DEVICE_MOD.VER")),h.xp6(3),h.Oqu(e.version),h.xp6(8),h.Oqu(h.lcZ(79,32,"DEVICE_MOD.ACTIVE")),h.xp6(3),h.Oqu(h.xi3(82,34,1e3*e.device.add_time,"MM.dd.yyyy")))},directives:[a.Gu,a.sr,a.wd,a.Sm,a.YG,a.gu,a.W2,a.q_,a.yh,a.Q$,a.Ie,a.ho,a.w,a.yW],pipes:[g.X$,n.uU],styles:[""]}),t})();function Ba(t,e){if(1&t&&(h.TgZ(0,"ion-select-option",16),h._uU(1),h.qZA()),2&t){const t=e.$implicit;h.Q6J("value",t.device_id_fb),h.xp6(1),h.Oqu(t.name)}}function za(t,e){if(1&t&&(h.TgZ(0,"ion-select-option",16),h._uU(1),h.qZA()),2&t){const t=e.$implicit;h.Q6J("value",t.id),h.xp6(1),h.Oqu(t.label)}}function $a(t,e){if(1&t&&(h.TgZ(0,"ion-select",17),h.YNc(1,za,2,2,"ion-select-option",5),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.Q6J("ngForOf",t.deviceSeleted.peripherals)}}let Wa=(()=>{class t{constructor(t,e,i,n,s){this.modalController=t,this.afs=e,this.iotService=i,this.translate=n,this.toastService=s,this.form=new o.cw({condition:new o.NI("",o.kI.required),value:new o.NI("",o.kI.required),peripheral_source_id:new o.NI("",o.kI.required),peripheral_target_id:new o.NI("",o.kI.required),envisorId:new o.NI("")})}ngOnInit(){this.form.patchValue({peripheral_target_id:this.peripheral_target_id})}close(){this.modalController.dismiss()}getListIndex(t){return(0,l.mG)(this,void 0,void 0,function*(){const e=yield this.iotService.getInforDevice(t).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});e&&e.status?this.deviceSeleted=e.data:e&&!e.status&&this.toastService.warning("Thi\u1ebft b\u1ecb kh\xf4ng t\u1ed3n t\u1ea1i")})}save(){let t=this.form.value,e=this.deviceSeleted.peripherals.findIndex(t=>t.id===this.form.value.peripheral_source_id);console.log(e),t.device_name=this.deviceSeleted.name,t.color=this.deviceSeleted.peripherals[e].color,t.label=this.deviceSeleted.peripherals[e].label,this.modalController.dismiss(t)}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(Pe.ST),h.Y36(Nt.d),h.Y36(g.sK),h.Y36(A.k))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-add-condition"]],inputs:{listDevices:"listDevices",peripheral_target_id:"peripheral_target_id"},decls:55,vars:49,consts:[["slot","end"],[3,"click"],["name","close"],[3,"formGroup"],["formControlName","envisorId",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["formControlName","peripheral_source_id",4,"ngIf"],["formControlName","condition"],["value",">"],["value",">="],["value","<"],["value","<="],["value","="],["type","number","formControlName","value","slot","end"],[2,"text-align","center"],["expand","small",3,"disabled","click"],[3,"value"],["formControlName","peripheral_source_id"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-buttons",0),h.TgZ(6,"ion-button",1),h.NdJ("click",function(){return e.close()}),h._UZ(7,"ion-icon",2),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(8,"ion-content"),h.TgZ(9,"ion-list"),h.TgZ(10,"form",3),h.TgZ(11,"ion-item"),h.TgZ(12,"ion-label"),h._uU(13),h.ALo(14,"translate"),h.qZA(),h.TgZ(15,"ion-select",4),h.NdJ("ionChange",function(t){return e.getListIndex(t.detail.value)}),h.YNc(16,Ba,2,2,"ion-select-option",5),h.qZA(),h.qZA(),h.TgZ(17,"ion-item"),h.TgZ(18,"ion-label"),h._uU(19),h.ALo(20,"translate"),h.qZA(),h.YNc(21,$a,2,1,"ion-select",6),h.qZA(),h.TgZ(22,"ion-item"),h.TgZ(23,"ion-label"),h._uU(24),h.ALo(25,"translate"),h.qZA(),h.TgZ(26,"ion-select",7),h.TgZ(27,"ion-select-option",8),h._uU(28),h.ALo(29,"translate"),h.qZA(),h.TgZ(30,"ion-select-option",9),h._uU(31),h.ALo(32,"translate"),h.ALo(33,"translate"),h.ALo(34,"translate"),h.qZA(),h.TgZ(35,"ion-select-option",10),h._uU(36),h.ALo(37,"translate"),h.qZA(),h.TgZ(38,"ion-select-option",11),h._uU(39),h.ALo(40,"translate"),h.ALo(41,"translate"),h.ALo(42,"translate"),h.qZA(),h.TgZ(43,"ion-select-option",12),h._uU(44),h.ALo(45,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(46,"ion-item"),h.TgZ(47,"ion-label"),h._uU(48),h.ALo(49,"translate"),h.qZA(),h._UZ(50,"ion-input",13),h.qZA(),h.qZA(),h.qZA(),h.TgZ(51,"div",14),h.TgZ(52,"ion-button",15),h.NdJ("click",function(){return e.save()}),h._uU(53),h.ALo(54,"translate"),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,19,"DEVICE_MOD.CONFIG_CONDITION")),h.xp6(7),h.Q6J("formGroup",e.form),h.xp6(3),h.Oqu(h.lcZ(14,21,"DEVICE_MOD.CHOOSE_DEVICE")),h.xp6(3),h.Q6J("ngForOf",e.listDevices),h.xp6(3),h.Oqu(h.lcZ(20,23,"DEVICE_MOD.CHOOSE_INDEX")),h.xp6(2),h.Q6J("ngIf",e.deviceSeleted),h.xp6(3),h.Oqu(h.lcZ(25,25,"DEVICE_MOD.CONFIG_CONDITION")),h.xp6(4),h.Oqu(h.lcZ(29,27,"DEVICE_MOD.GREATER_THAN")),h.xp6(3),h.lnq("",h.lcZ(32,29,"DEVICE_MOD.GREATER_THAN")," ",h.lcZ(33,31,"DEVICE_MOD.OR")," ",h.lcZ(34,33,"DEVICE_MOD.SAME"),""),h.xp6(5),h.Oqu(h.lcZ(37,35,"DEVICE_MOD.LESS_THAN")),h.xp6(3),h.lnq("",h.lcZ(40,37,"DEVICE_MOD.LESS_THAN")," ",h.lcZ(41,39,"DEVICE_MOD.OR")," ",h.lcZ(42,41,"DEVICE_MOD.SAME"),""),h.xp6(5),h.Oqu(h.lcZ(45,43,"DEVICE_MOD.SAME")),h.xp6(4),h.Oqu(h.lcZ(49,45,"DEVICE_MOD.VALUE")),h.xp6(4),h.Q6J("disabled",e.form.invalid),h.xp6(1),h.Oqu(h.lcZ(54,47,"DEVICE_MOD.ADD")))},directives:[a.Gu,a.sr,a.wd,a.Sm,a.YG,a.gu,a.W2,a.q_,o._Y,o.JL,o.sg,a.Ie,a.Q$,a.t9,a.QI,o.JJ,o.u,n.sg,n.O5,a.n0,a.pK,a.as],pipes:[g.X$],styles:[""]}),t})();var Xa=i(38800);function Ka(t,e){1&t&&h._UZ(0,"ion-progress-bar",11)}function tr(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label",12),h.TgZ(2,"p"),h.TgZ(3,"ion-text"),h.TgZ(4,"span"),h.TgZ(5,"b"),h._uU(6),h.qZA(),h.qZA(),h._uU(7," | "),h.TgZ(8,"span",13),h._uU(9),h.qZA(),h._uU(10),h.qZA(),h.qZA(),h.qZA(),h.TgZ(11,"ion-button",5),h.NdJ("click",function(){const e=h.CHM(t),i=e.$implicit,n=e.index;return h.oxw().removeCondition(i,n)}),h._UZ(12,"ion-icon",14),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw();h.xp6(6),h.Oqu(t.peripheral_source.device_name),h.xp6(2),h.Q6J("ngStyle",i.calculateColor(t.peripheral_source.color)),h.xp6(1),h.Oqu(t.peripheral_source.label),h.xp6(1),h.AsE(" ",t.condition," ",t.value,"")}}function er(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-label",12),h.TgZ(2,"ion-text",15),h._uU(3),h.ALo(4,"translate"),h.ALo(5,"translate"),h.qZA(),h.qZA(),h.TgZ(6,"ion-button",5),h.NdJ("click",function(){const e=h.CHM(t).index;return h.oxw().changeStatusTimer(e)}),h._UZ(7,"ion-icon",16),h.qZA(),h.TgZ(8,"ion-button",5),h.NdJ("click",function(){const e=h.CHM(t).index;return h.oxw().editTimer(e)}),h._UZ(9,"ion-icon",6),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit;h.xp6(2),h.Q6J("color",0==t.enable?"dark":"success"),h.xp6(1),h.HOy("",h.lcZ(4,6,"DEVICE_MOD.FROM")," ",t.start," ",h.lcZ(5,8,"DEVICE_MOD.TO")," ",t.end,""),h.xp6(4),h.Q6J("color",0==t.enable?"dark":"success")}}let ir=(()=>{class t{constructor(t,e,i,n,s,a,r,l,c,u,h,g){this.modalController=t,this.alertController=e,this.afs=i,this.authService=n,this.fns=s,this.afAuth=a,this.toastService=r,this.iotService=l,this.router=c,this.pickerController=u,this.cd=h,this.translate=g,this.loading=new d.E,this.listConditions=[],this.listDevices=[],this.listPond=[],this.isAddDevice=!1,this.isAddCondition=!1,this.isAddTimer=!1,this.listDeviceInPond={},this.form=new o.cw({device_id:new o.NI("",o.kI.required),condition:new o.NI("",o.kI.required),value:new o.NI("",o.kI.required),label:new o.NI("",o.kI.required)}),this.minStart=40,this.minEnd=50,this.hourStart=23,this.hourEnd=23,this.listLabel=[],this.listTimer=[]}ngOnInit(){this.listTimer=this.infor.timers,console.log(this.listTimer),this.getListDeviceInPond()}getListDeviceInPond(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.iotService.list().catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});t&&1==t.status?(t.data.forEach(t=>{"envisor"==t.type&&this.listDevices.push(t)}),this.getListCondition()):t&&0==t.status&&this.toastService.warning(t.error)})}getListCondition(){return(0,l.mG)(this,void 0,void 0,function*(){this.iotService.getListCondition(this.infor.id,this.sub_id).subscribe(t=>{t.status?(this.listConditions=t.data,console.log(this.listConditions)):this.toastService.warning(t.errors)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})})}convertTimer(t){let e=parseInt((t/100).toString()),i=t-100*e;return e.toString()+":"+i.toString()}changeStatus(){return(0,l.mG)(this,void 0,void 0,function*(){this.loading.setPending(!0),(yield this.authService.checkTkFb(this.iotService.pcode,this.afAuth))?this.fns.httpsCallable("saveContactorConfig")({deviceId:this.sub_id,contactorId:this.infor.id,automatic:this.item.config.contactors&&this.infor.id in this.item.config.contactors&&"automatic"in this.item.config.contactors[this.infor.id]?!this.item.config.contactors[this.infor.id].automatic:0}).subscribe(t=>{this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SETTING")),this.item.config.contactors[this.infor.id].automatic=!this.item.config.contactors[this.infor.id].automatic,this.loading.setResult(!0)}):(this.toastService.warning(this.translate.instant("DEVICE_MOD.AUTH_FAILED")),this.loading.setResult(!1))})}actionAddDevice(){return(0,l.mG)(this,void 0,void 0,function*(){let t=[];for(let e in this.listDeviceInPond)t.push({name:this.listDeviceInPond[e].name,type:"radio",label:this.listDeviceInPond[e].name,value:this.listDeviceInPond[e]});t[0].checked=!0,yield(yield this.alertController.create({cssClass:"my-custom-class",header:"Radio",inputs:t,buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.addDevice(t)}}]})).present()})}addDevice(t){return(0,l.mG)(this,void 0,void 0,function*(){this.listDevices.filter(e=>e.device_id==t.device_id_fb).length>0?(this.toastService.warning(this.translate.instant("DEVICE_MOD.DEVICE_EXIST")),this.isAddDevice=!1):(this.loading.setPending(!0),(yield this.authService.checkTkFb(this.iotService.pcode,this.afAuth))?this.fns.httpsCallable("addContactorCondition")({deviceId:this.sub_id,contactorId:this.infor.id,pubId:t.device_id_fb,conditions:{}}).subscribe(t=>{this.toastService.success(this.translate.instant("DEVICE_MOD.ADDED_DEVICE")),this.isAddDevice=!1,this.loading.setResult(!0)}):this.toastService.warning(this.translate.instant("DEVICE_MOD.AUTH_FAILED")))})}removeDevice(t,e){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"X\xe1c nh\u1eadn x\xf3a",message:this.translate.instant("DEVICE_MOD.CONFIRM_REMOVE_DEVICE"),buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"Okay",handler:()=>{this.loading.setPending(!0),this.handleRemove(t,e)}}]})).present()})}handleRemove(t,e){return(0,l.mG)(this,void 0,void 0,function*(){(yield this.authService.checkTkFb(this.iotService.pcode,this.afAuth))?this.fns.httpsCallable("deleteContactorCondition")({deviceId:this.sub_id,contactorId:this.infor.id,conditionId:t.condition_id}).subscribe(i=>{if(this.loading.setResult(!0),this.toastService.success(this.translate.instant("DEVICE_MOD.REMOVE_SUCCESS")),this.listDevices.splice(e,1),this.listDevices.length>0){let e=[];for(let i=0;i<this.listConditions.length;i++)this.listConditions[i].pub_id!=t.device_id&&e.push(this.listConditions[i]);this.listConditions=e}else this.listConditions=[]}):this.toastService.warning(this.translate.instant("DEVICE_MOD.AUTH_FAILED"))})}close(){this.modalController.dismiss()}actionAddCondition(){return(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:Wa,cssClass:"my-custom-class",componentProps:{listDevices:this.listDevices,peripheral_target_id:this.infor.id}});return t.onDidDismiss().then(t=>{void 0!==t.data&&this.addCondition(t.data)}),yield t.present()})}actionAddTimer(){this.isAddTimer=!this.isAddTimer}removeCondition(t,e){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("DEVICE_MOD.NOTI_REMOVE"),message:this.translate.instant("DEVICE_MOD.CONFIRM_REMOVE_CONDITION"),buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"Okay",handler:()=>{this.handleRemoveCondition(t,e)}}]})).present()})}handleRemoveCondition(t,e){return(0,l.mG)(this,void 0,void 0,function*(){this.iotService.removeCondition(t.peripheral_target.id,t.peripheral_target.device_id,t.id).subscribe(t=>{t.status?(this.listConditions.splice(e,1),this.toastService.success(this.translate.instant("DEVICE_MOD.REMOVE_CONFITION_CUCCESS"))):this.toastService.warning(this.translate.instant("DEVICE_MOD.AUTH_FAILED"))},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})})}addCondition(t){return(0,l.mG)(this,void 0,void 0,function*(){this.loading.setPending(!0),this.iotService.addCondition(this.infor.id,this.sub_id,t).subscribe(e=>{e.status?(this.listConditions.push({peripheral_source:{device_name:t.device_name,color:t.color,label:t.label},condition:t.condition,value:t.value}),this.loading.setResult(!0),this.toastService.success(this.translate.instant("DEVICE_MOD.ADDED_DEVICE"))):(this.loading.setResult(!0),this.toastService.warning(this.translate.instant("DEVICE_MOD.AUTH_FAILED")))},()=>{this.loading.setResult(!1),this.toastService.success(this.translate.instant("ERROR_CONNECT"))})})}getListIndex(t){this.listLabel=[],this.afs.collection("pub").doc(this.listDevices[t].device_id).collection("factors").snapshotChanges().forEach(e=>{e.map(e=>{this.listLabel.push({id:e.payload.doc.id,pub_id:this.listDevices[t].device_id,name:e.payload.doc.data().ui.label})})})}presentUpdateName(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("DEVICE_MOD.UPDATE_INFOR"),inputs:[{name:"name",type:"text",value:this.infor.name,placeholder:this.translate.instant("DEVICE_MOD.NAME")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.handleUpdateName(t)}}]})).present()})}handleUpdateName(t){return(0,l.mG)(this,void 0,void 0,function*(){this.loading.setPending(!0),this.iotService.updateNameContactor(this.infor.id,this.sub_id,t).subscribe(e=>{e.status?(this.infor.name=t.name,this.loading.setResult(!0),this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS"))):(this.loading.setResult(!0),this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")))},()=>{this.loading.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})})}openPicker(t,e){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.pickerController.create({columns:this.getColumns(t),buttons:[{text:"Cancel",role:"cancel"},{text:"Confirm",handler:t=>{console.log(t),1==e?this.hourStart=t.col.value:2==e?this.minStart=t.col.value:3==e?this.hourEnd=t.col.value:this.minEnd=t.col.value}}]})).present()})}getColumns(t){return[{name:"col",options:this.getColumnOptions(t)}]}getColumnOptions(t){let e=[];for(let i=0;i<t;i++)e.push(i<10?{text:"0"+i,value:i}:{text:i,value:i});return e}addTimer(){return(0,l.mG)(this,void 0,void 0,function*(){if(this.hourEnd==this.hourStart&&this.minEnd==this.minStart)this.toastService.warning(this.translate.instant("DEVICE_MOD.DUPLICATE_TIMER"));else if(1==this.checkTimer()){let t=[];this.listTimer.forEach(e=>{t.push({start:{h:parseInt((parseInt(e.start)/100).toString()),m:e.start%100},end:{h:parseInt((parseInt(e.end)/100).toString()),m:e.end%100}})}),t.push({start:{h:this.hourStart,m:this.minStart},end:{h:this.hourEnd,m:this.minEnd}}),this.isAddTimer=!1,this.loading.setPending(!0),(yield this.authService.checkTkFb(this.iotService.pcode,this.afAuth))?this.fns.httpsCallable("updateContactorTimer")({deviceId:this.sub_id,contactorId:this.infor.id,timer:t}).subscribe(t=>{this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")),this.loading.setResult(!0),this.loading.setResult(!0),this.cd.detectChanges()}):(this.loading.setResult(!1),this.toastService.danger(this.translate.instant("DEVICE_MOD.AUTH_FAILED")))}else this.toastService.warning(this.translate.instant("DEVICE_MOD.EXIST_TIMER"))})}checkTimer(){let t=100*this.hourStart+this.minStart,e=100*this.hourEnd+this.minEnd,i=!0;return this.listTimer.forEach(n=>{t>=n.start&&e<=n.end&&1==n.enable&&(i=!1)}),console.log(i),i}changeStatusTimer(t){return(0,l.mG)(this,void 0,void 0,function*(){let e={start:this.listTimer[t].start,end:this.listTimer[t].end,index:t+1,enable:0==this.listTimer[t].enable?1:0};this.loading.setPending(!0),this.iotService.updateTimer(this.infor.id,this.sub_id,e).subscribe(i=>{i.status?(this.loading.setResult(!0),this.listTimer[t].enable=e.enable,this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS"))):(this.loading.setResult(!0),this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS")))},()=>{this.loading.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})})}actionRemoveTimer(t){return(0,l.mG)(this,void 0,void 0,function*(){let e=[];this.listTimer.forEach(t=>{e.push({start:{h:parseInt(t.time_start.split(":")[0]),m:parseInt(t.time_start.split(":")[1])},end:{h:parseInt(t.time_end.split(":")[0]),m:parseInt(t.time_end.split(":")[1])}})}),e.splice(t,1),this.isAddTimer=!1,this.loading.setPending(!0),(yield this.authService.checkTkFb(this.iotService.pcode,this.afAuth))?this.fns.httpsCallable("updateContactorTimer")({deviceId:this.sub_id,contactorId:this.infor.id,timer:e}).subscribe(e=>{this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")),this.loading.setResult(!0),this.cd.detectChanges(),this.listTimer.splice(t,1)}):(this.loading.setResult(!1),this.toastService.warning(this.translate.instant("DEVICE_MOD.AUTH_FAILED")))})}calculateColor(t){return{color:t}}editTimer(t){return(0,l.mG)(this,void 0,void 0,function*(){const e=yield this.modalController.create({component:Xa.K,cssClass:"my-custom-class",componentProps:{listTimer:this.listTimer,index:t,deviceId:this.sub_id,contactorId:this.infor.id}});return e.onDidDismiss().then(e=>{void 0!==e.data&&(e.data.start_int=e.data.start,e.data.start=this.convertTime(e.data.start),e.data.end_int=e.data.end,e.data.end=this.convertTime(e.data.end),this.listTimer[t]=e.data)}),yield e.present()})}convertTime(t){let e=(t/100).toFixed(0),i=t-100*parseInt(e);return(parseInt(e)<10?"0":"")+e+":"+(i<10?"0":"")+i+":00"}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(a.Br),h.Y36(Pe.ST),h.Y36(ya.e),h.Y36(Ua.l4),h.Y36(Pa.zQ),h.Y36(A.k),h.Y36(Nt.d),h.Y36(s.F0),h.Y36(a.up),h.Y36(h.sBO),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-item"]],inputs:{infor:"infor",sub_id:"sub_id"},decls:36,vars:16,consts:[["slot","end"],[3,"click"],["name","close"],["type","indeterminate",4,"ngIf"],["lines","inset"],["slot","end","fill","clear",3,"click"],["name","create"],[4,"ngFor","ngForOf"],["lines","none"],["slot","icon-only","name","add"],["color","tb"],["type","indeterminate"],[1,"ion-text-wrap"],[3,"ngStyle"],["name","remove-circle"],["slot","start",3,"color"],["name","power-outline",3,"color"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-title"),h._uU(3),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-buttons",0),h.TgZ(6,"ion-button",1),h.NdJ("click",function(){return e.close()}),h._UZ(7,"ion-icon",2),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(8,Ka,1,0,"ion-progress-bar",3),h.TgZ(9,"ion-content"),h.TgZ(10,"ion-list",4),h.TgZ(11,"ion-item-group"),h.TgZ(12,"ion-list-header"),h.TgZ(13,"ion-label"),h._uU(14),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.TgZ(16,"ion-item"),h.TgZ(17,"ion-label"),h._uU(18),h.qZA(),h.TgZ(19,"ion-button",5),h.NdJ("click",function(){return e.presentUpdateName()}),h._UZ(20,"ion-icon",6),h.qZA(),h.qZA(),h.TgZ(21,"ion-list-header"),h.TgZ(22,"ion-label"),h._uU(23),h.ALo(24,"translate"),h.qZA(),h.qZA(),h.YNc(25,tr,13,5,"ion-item",7),h.TgZ(26,"ion-item",8),h.TgZ(27,"ion-button",5),h.NdJ("click",function(){return e.actionAddCondition()}),h._UZ(28,"ion-icon",9),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(29,"ion-list",4),h.TgZ(30,"ion-list-header"),h.TgZ(31,"ion-label",10),h._uU(32),h.ALo(33,"translate"),h.qZA(),h.qZA(),h.TgZ(34,"ion-item-group"),h.YNc(35,er,10,10,"ion-item",7),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Oqu(h.lcZ(4,8,"DEVICE_MOD.SETTING_DEVICE")),h.xp6(5),h.Q6J("ngIf",e.loading.pending),h.xp6(6),h.Oqu(h.lcZ(15,10,"DEVICE_MOD.NAME")),h.xp6(4),h.Oqu(null==e.infor?null:e.infor.name),h.xp6(5),h.Oqu(h.lcZ(24,12,"DEVICE_MOD.CONDITION_ON")),h.xp6(2),h.Q6J("ngForOf",e.listConditions),h.xp6(7),h.Oqu(h.lcZ(33,14,"DEVICE_MOD.TIMER")),h.xp6(3),h.Q6J("ngForOf",e.listTimer))},directives:[a.Gu,a.sr,a.wd,a.Sm,a.YG,a.gu,n.O5,a.W2,a.q_,a.Ub,a.yh,a.Q$,a.Ie,n.sg,a.X7,a.yW,n.PC],pipes:[g.X$],styles:[""]}),t})();function nr(t,e){1&t&&h._UZ(0,"ion-progress-bar",8)}function or(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div"),h.TgZ(1,"ion-item"),h.TgZ(2,"ion-text",19),h._UZ(3,"b",20),h.qZA(),h.qZA(),h.TgZ(4,"ion-item"),h.TgZ(5,"ion-button",21),h.NdJ("click",function(){const e=h.CHM(t).$implicit;return h.oxw(2).itemSetting(e.value)}),h._UZ(6,"ion-icon",22),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.TgZ(9,"ion-toggle",23),h.NdJ("click",function(e){const i=h.CHM(t).$implicit;return h.oxw(2).deviceStatusChange(e,i.key)}),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=e.$implicit,i=h.oxw(2);h.xp6(3),h.Q6J("innerHTML",""==t.value.name?"Ch\u01b0a \u0111\u1eb7t t\xean":t.value.name,h.oJD),h.xp6(2),h.Q6J("disabled",!i.iotService.checkPermission(i.pondService.permission)||!i.status$),h.xp6(2),h.hij(" ",h.lcZ(8,6,"DEVICE_MOD.SETTING")," "),h.xp6(2),h.s9C("id",t.id),h.Q6J("disabled",!i.iotService.checkPermission(i.pondService.permission)||!i.status$||i.processToggle.pending)("checked",i.childDevices[t.key].value)}}function sr(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",24),h.TgZ(2,"ion-label",25),h.TgZ(3,"p"),h.TgZ(4,"span"),h.TgZ(5,"ion-text",26),h._uU(6),h.qZA(),h.qZA(),h.qZA(),h.TgZ(7,"ion-text",27),h.TgZ(8,"small"),h._uU(9),h.ALo(10,"translate"),h.ALo(11,"date"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit,i=h.oxw(2);h.xp6(1),h.Q6J("color",i.checkStatusLog(t.logs)?"success":"dark"),h.xp6(5),h.Oqu(t.log),h.xp6(3),h.AsE("",h.lcZ(10,4,"DEVICE_MOD.AT")," ",h.xi3(11,6,t.time.toMillis(),"yyyy/MM/dd h:mm:ss a"),"")}}function ar(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div"),h.TgZ(1,"ion-card",9),h.TgZ(2,"ion-list",10),h.TgZ(3,"ion-item"),h.TgZ(4,"ion-buttons",11),h.TgZ(5,"ion-button"),h._UZ(6,"ion-icon",12),h.qZA(),h.qZA(),h.qZA(),h.TgZ(7,"ion-item"),h.TgZ(8,"h3",11),h._uU(9),h.qZA(),h.qZA(),h.TgZ(10,"div"),h.TgZ(11,"div",13),h._UZ(12,"ion-spinner",14),h.qZA(),h.YNc(13,or,10,8,"div",15),h.ALo(14,"keyvalue"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(15,"ion-list",16),h.TgZ(16,"ion-list-header"),h.TgZ(17,"ion-label"),h._uU(18),h.ALo(19,"translate"),h.qZA(),h.qZA(),h.YNc(20,sr,12,9,"ion-item",15),h.TgZ(21,"ion-infinite-scroll",17),h.NdJ("ionInfinite",function(e){return h.CHM(t),h.oxw().loadMoreLogs(e)}),h._UZ(22,"ion-infinite-scroll-content",18),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(6),h.Q6J("color",t.status$?"success":"medium"),h.xp6(3),h.Oqu(null==t.device?null:t.device.name),h.xp6(2),h.Q6J("ngClass",!t.processToggle.pending&&t.status$?"hiddenProcessToggle":""),h.xp6(2),h.Q6J("ngForOf",h.lcZ(14,6,t.childDevices)),h.xp6(5),h.Oqu(h.lcZ(19,8,"DEVICE_MOD.LOG")),h.xp6(2),h.Q6J("ngForOf",t.logs)}}let rr=(()=>{class t{constructor(t,e,i,n,o,s,a,r,l,c,u,h){this.modalController=t,this.route=e,this.afs=i,this.toastService=n,this.authService=o,this.fns=s,this.afAuth=a,this.iotService=r,this.alertController=l,this.router=c,this.pondService=u,this.translate=h,this.version="",this.lastTimeLogs=new Date,this.numLoadRecord=10,this.logs=[],this.loading=new d.E,this.processToggle=new d.E,this.loadingLogs=new d.E}ngOnInit(){return(0,l.mG)(this,void 0,void 0,function*(){this.id=this.route.snapshot.paramMap.get("device_id"),yield this.getDevice(),this.getLogs(),this.subcriceInit()})}presentSetting(){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:Ga,componentProps:{device:this.device,id:this.id,version:this.version}})).present()})}itemSetting(t){return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:ir,componentProps:{infor:t,sub_id:this.id}})).present()})}subcriceInit(){this.afs.collection("sub").doc(this.id).collection("logs",t=>t.orderBy("time","desc").limit(1)).stateChanges(["added"]).subscribe(t=>{t.map(t=>{const e=t.payload.doc.data();this.logs.length>0&&!u(e.time.toMillis()).isSame(this.logs[0].time.toMillis())&&this.logs.unshift(e)})}),this.afs.collection("sub").doc(this.id).valueChanges().subscribe(t=>{this.status$=t.online}),this.afs.collection("sub").doc(this.id).get().forEach(t=>{this.version=t.data().info.firmware_version});for(let t in this.childDevices)this.afs.collection("sub").doc(this.id).collection("contactors").doc(t).valueChanges().subscribe(e=>{this.childDevices[t].value!=e.value&&(this.childDevices[t].value=e.value)})}update(t,e){return this.afs.collection("sub").doc(this.id).collection("contactors").doc(e).update({value:t})}getDevice(){return(0,l.mG)(this,void 0,void 0,function*(){this.loading.setPending(!0);const t=yield this.iotService.getInforDevice(this.id).catch(()=>{this.loading.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});t&&t.status?(this.device=t.data,this.childDevices={},this.device.peripherals.forEach(t=>{this.childDevices[t.firestore_id]=t,this.childDevices[t.firestore_id].value=0,t.timers&&Array.isArray(t.timers)&&8==t.timers.length&&(this.childDevices[t.firestore_id].timers=t.timers)})):t&&!t.status&&this.toastService.warning(t.errors.description);const e=yield this.iotService.get(this.id).catch(t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});e&&e.status?(this.device.name=e.data.name,this.device.add_time=e.data.add_time):t&&!t.status&&this.toastService.warning(t.error.message),this.loading.setResult(!1)})}presentUpdateDevice(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("DEVICE_MOD.UPDATE_INFOR"),inputs:[{name:"device_name",type:"text",value:this.device.device_name,placeholder:this.translate.instant("DEVICE_MOD.NAME")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.saveDevice(t)}}]})).present()})}saveDevice(t){return(0,l.mG)(this,void 0,void 0,function*(){const e=yield this.iotService.update(this.device.name,this.device.id).catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});e&&1==e.status?(this.toastService.success(this.translate.instant("DEVICE_MOD.UPDATE_SUCCESS")),this.device.device_name=t.device_name):e&&0==e.status&&this.toastService.warning(e.error)})}presentConfigWifi(){var t;return(0,l.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:Ma.i,cssClass:"my-custom-class",componentProps:{id:this.id,type:"cabinet",name:null===(t=this.device)||void 0===t?void 0:t.name}})).present()})}checkStatusLog(t){return!!t&&"b\u1eadt"==t.split(" ")[0].toLowerCase()}deviceStatusChange(t,e){let i={contactorId:e,value:this.childDevices[e].value?0:1,name:this.childDevices[e].name};this.processToggle.setPending(!0),this.iotService.changeStatusContactor(i,this.childDevices[e].id,this.id).subscribe(n=>{1==n.status?(this.processToggle.setResult(!0),this.childDevices[e].value=i.value,this.toastService.success("\u0110\xe3 "+(this.childDevices[e].value?"M\u1edf":"T\u1eaft")+" thi\u1ebft b\u1ecb")):(this.processToggle.setResult(!0),t.target.checked=!!this.childDevices[e].value,this.toastService.warning("Kh\xf4ng th\u1ec3 th\u1ef1c hi\u1ec7n"))},()=>{this.processToggle.setResult(!1),t.target.checked=!!this.childDevices[e].value,this.toastService.warning("Kh\xf4ng th\u1ec3 th\u1ef1c hi\u1ec7n [2]")})}loadMoreLogs(t){this.getLogs(),setTimeout(()=>{console.log("Done"),t.target.complete()},500)}getLogs(){this.afs.collection("sub").doc(this.id).collection("logs",t=>t.orderBy("time","desc").where("time","<=",this.lastTimeLogs).limit(this.numLoadRecord)).get().subscribe(t=>{t.forEach(t=>{this.lastTimeLogs=new Date(t.data().time.toMillis()),this.logs.push(t.data())})})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(a.IN),h.Y36(s.gz),h.Y36(Pe.ST),h.Y36(A.k),h.Y36(ya.e),h.Y36(Ua.l4),h.Y36(Pa.zQ),h.Y36(Nt.d),h.Y36(a.Br),h.Y36(s.F0),h.Y36(c.p),h.Y36(g.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-sub-device"]],decls:13,vars:6,consts:[["slot","start"],["text","","defaultHref","tabs/management"],["slot","end"],["color","primary",3,"disabled","click"],["slot","icon-only","name","cog-outline"],[1,"ion-padding"],["type","indeterminate",4,"ngIf"],[4,"ngIf"],["type","indeterminate"],[2,"padding-bottom","12px","padding-top","12px"],["lines","none",1,"box-cabinet"],[2,"margin","0 auto"],["name","ellipse",3,"color"],[1,"ion-text-center",3,"ngClass"],["name","lines-small","mode","ios"],[4,"ngFor","ngForOf"],["lines","none"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","dots"],["color","tb"],[3,"innerHTML"],["slot","start","color","primary","fill","clear",3,"disabled","click"],["name","cog","slot","start"],["mode","ios","slot","end",3,"disabled","id","checked","click"],["name","power-outline",1,"ion-margin-end",3,"color"],[1,"ion-text-wrap"],["color","primary"],["color","medium"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.qZA(),h.TgZ(4,"ion-title"),h._uU(5),h.ALo(6,"translate"),h.qZA(),h.TgZ(7,"ion-buttons",2),h.TgZ(8,"ion-button",3),h.NdJ("click",function(){return e.presentSetting()}),h._UZ(9,"ion-icon",4),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(10,"ion-content",5),h.YNc(11,nr,1,0,"ion-progress-bar",6),h.YNc(12,ar,23,10,"div",7),h.qZA()),2&t&&(h.xp6(5),h.Oqu(h.lcZ(6,4,"DEVICE_MOD.CABINET")),h.xp6(3),h.Q6J("disabled",!e.iotService.checkPermission(e.pondService.permission)),h.xp6(3),h.Q6J("ngIf",e.loading.pending),h.xp6(1),h.Q6J("ngIf",!e.loading.pending))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,a.wd,a.YG,a.gu,a.W2,n.O5,a.X7,a.PM,a.q_,a.Ie,n.mk,a.PQ,n.sg,a.yh,a.Q$,a.ju,a.MB,a.yW,a.ho,a.w],pipes:[g.X$,n.Nd,n.uU],styles:[".hiddenProcessToggle[_ngcontent-%COMP%]{opacity:0}"]}),t})();var lr=i(24023),cr=i(84267),dr=i(97905),ur=i(59865),hr=i(38739),gr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,l.ZT)(e,t),Object.defineProperty(e.prototype,"convertFileSrc",{get:function(){return(0,hr.J2)(this,"convertFileSrc")},set:function(t){(0,hr.Iq)(this,"convertFileSrc",t)},enumerable:!1,configurable:!0}),e.pluginName="WebView",e.plugin="cordova-plugin-ionic-webview",e.pluginRef="window.Ionic.WebView",e.repo="https://github.com/ionic-team/cordova-plugin-ionic-webview",e.platforms=["Android","iOS"],e.install="ionic cordova plugin add cordova-plugin-ionic-webview",e.\u0275fac=function(){var t;return function(i){return(t||(t=h.n5z(e)))(i||e)}}(),e.\u0275prov=h.Yz7({token:e,factory:function(t){return e.\u0275fac(t)}}),e}(hr.KY),pr=i(10740),mr=i(49246);const Zr=[{path:"",children:[{path:"season-create",component:Ws},{path:"season-seed",component:yi},{path:"history",component:qa},{path:"history/:code",component:ma},{path:"",component:Ys},{path:"pub/:device_id",component:Ha},{path:"sub/:device_id",component:rr},{path:"feed/:device_id",component:mr.C}]}];let fr=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({providers:[M.o,ut.n,Ye.d,ue.$,pr.B,dr.K,ur.y,cr.V1,gr],imports:[[n.ez,o.u5,a.Pc,r.Ns,o.UX,s.Bz.forChild(Zr),g.aw.forChild(),Xs.Ud,xa.i,lr.E,ke.bQ,se.tP]]}),t})()},66341:function(t,e,i){i.d(e,{n:function(){return a}});var n=i(88002),o=i(15189),s=i(37716);let a=(()=>{class t{constructor(t){this.reqAPIService=t,this.urlApi="/manager/farm-api"}searchMember(t){return this.reqAPIService.get("/user/list-api-mobie?action=get-user&key="+t).pipe((0,n.U)(t=>t.data))}searchExpert(t){return this.reqAPIService.get("/user/list-api-mobie?action=get-expert&key="+t).pipe((0,n.U)(t=>t.data))}getSitePath(){return this.reqAPIService.FILE_PATH}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(o.$))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac}),t})()},22923:function(t,e,i){i.d(e,{d:function(){return r}});var n=i(88002),o=i(26215),s=i(15189),a=i(37716);let r=(()=>{class t{constructor(t){this.reqAPIService=t,this.urlApi="/manager/store-api-mobie",this.NEW_URL_API="/manager/warehouse-api",this.changeDataStore=!1,this.onLoaded$=new o.X(0)}destroy(){this.fcode=null,this.store=null}setFarmCode(t){this.fcode=t}getFarmCode(){return this.fcode}setStoreCode(t){this.wcode=t}getStoreCode(){return this.wcode}setStore(t){this.store=t}getStore(){return this.store}itemChanged(t,e){void 0!==this.store[t]&&Object.assign(this.store[t],e)}getApiStore(t="",e="",i=""){let o;return o=""===i?this.NEW_URL_API+"?action="+t+"&wcode="+this.wcode+e:`/${i}?action=`+t+e,this.reqAPIService.get(o).pipe((0,n.U)(t=>t))}sendPost(t="",e={},i="",o=""){let s;return s=""===o?this.NEW_URL_API+"?action="+t+"&wcode="+this.wcode+i:`/${o}?action=`+t+i,this.reqAPIService.post(s,e).pipe((0,n.U)(t=>t))}sendPostWithFile(t="",e={},i="",n=""){return this.reqAPIService.postApiWithFile(t,e,"&wcode="+this.wcode+i,this.NEW_URL_API)}postEdit(t,e){return this.reqAPIService.post(this.urlApi+"?action=edit-product-private&fcode="+this.fcode+"&id="+t,e)}}return t.\u0275fac=function(e){return new(e||t)(a.LFG(s.$))},t.\u0275prov=a.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},69814:function(t,e,i){i.d(e,{F:function(){return l}});var n=i(15189),o=i(92340),s=i(88002),a=i(37716),r=i(81780);let l=(()=>{class t{constructor(t,e){this.reqAPIService=t,this.translate=e,this.farmextApi="/manager/disease-neighboor-api",this.farmextWall="/manager/wall-api",this.tepbacApi="/farmext/update-api",this.weatherPath="http://api.openweathermap.org/data/2.5/onecall"}listDisease(){return this.reqAPIService.get(this.farmextApi)}listUpdate(t,e){return this.reqAPIService.postOutSiteNoneToken(o.h_.SITE_PATH+this.tepbacApi+"&action=list&page="+t,e)}getPriceHistory(t){return this.reqAPIService.getOutSite(o.h_.SITE_PATH+this.tepbacApi+"&action=get-price&sid="+t)}searchSpecies(t){return this.reqAPIService.getOutSite(o.h_.SITE_PATH+this.tepbacApi+"&action=search-species&keyword="+t).pipe((0,s.U)(t=>t.data))}loadAnalyze(t){return this.reqAPIService.post(this.farmextWall+"?action=analyze",t)}loadReport(t){return this.reqAPIService.post(this.farmextWall+"?action=report",t)}getWeatherToday(t,e){return this.reqAPIService.getOutSiteNoneToken(this.weatherPath+"?lat="+t+"&lon="+e+"&appid=9d7acdb5a0b7977b5dbd5dddf54c1fb4&lang="+this.translate.currentLang)}getWeather(t,e){return this.reqAPIService.getOutSiteNoneToken(this.weatherPath+"?lat="+t+"&lon="+e+"&appid=9d7acdb5a0b7977b5dbd5dddf54c1fb4&lang="+this.translate.currentLang).toPromise()}getWeatherYesterday(t,e,i){return this.reqAPIService.getOutSiteNoneToken(this.weatherPath+"?/timemachine?dt="+t+"&lat="+e+"&lon="+i+"&appid=9d7acdb5a0b7977b5dbd5dddf54c1fb4&lang="+this.translate.currentLang).toPromise()}}return t.\u0275fac=function(e){return new(e||t)(a.LFG(n.$),a.LFG(r.sK))},t.\u0275prov=a.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);