"use strict";(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[3677],{54395:function(t,e,i){i.d(e,{b:function(){return s}});var n=i(77393),o=i(33637);function s(t,e=o.P){return i=>i.lift(new a(t,e))}class a{constructor(t,e){this.dueTime=t,this.scheduler=e}call(t,e){return e.subscribe(new r(t,this.dueTime,this.scheduler))}}class r extends n.L{constructor(t,e,i){super(t),this.dueTime=e,this.scheduler=i,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(l,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:t}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}}clearDebounce(){const t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}function l(t){t.debouncedNext()}},73473:function(t,e,i){i.d(e,{l:function(){return o}});var n=i(37716);let o=(()=>{class t{constructor(t){this.el=t,this.permissionsCanShow=[],this.el.nativeElement.style.visibility="hidden",this.el.nativeElement.style.display="none"}set PermissionsShow(t){this.permissionsCanShow=t}set CurrentPermisson(t){this.currentPermission=t,this.setShow()}set PermissionAction(t){this.currentPermission=t,this.setPointEvents()}ngOnInit(){}setShow(){this.permissionsCanShow.includes(this.currentPermission)?(this.el.nativeElement.style.visibility="visible",this.el.nativeElement.style.display="block"):(this.el.nativeElement.style.visibility="hidden",this.el.nativeElement.style.display="none")}setPointEvents(){this.el.nativeElement.style.visibility="visible",this.el.nativeElement.style.display="block",this.el.nativeElement.style["pointer-events"]=this.permissionsCanShow.includes(this.currentPermission)?"visible":"none"}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(n.SBq))},t.\u0275dir=n.lG2({type:t,selectors:[["","appPermission",""]],inputs:{PermissionsShow:["appPermission","PermissionsShow"],CurrentPermisson:["currentPermission","CurrentPermisson"],PermissionAction:["permissionAction","PermissionAction"]}}),t})()},51937:function(t,e,i){i.d(e,{D:function(){return r}});var n=i(76329),o=i(15189),s=i(88002),a=i(37716);let r=(()=>{class t{constructor(t){this.reqAPIService=t,this.urlApi="/manager/farm-api",this.urlApiAdress="/manager/address-api",this.reload$=new n.BehaviorSubject(0),this.numberOfPonds=0}setCode(t){this.fcode=t}setFarm(t){this.farm=t,this.permission=t.permission}loadPonds(){return this.reqAPIService.get("/manager/farm-api-mobie?fcode="+this.fcode+"&action=get-item-pond").pipe((0,s.U)(t=>t))}listAddress(t){return this.reqAPIService.get(this.urlApiAdress+"?action=listUnit&id="+t)}loadFarm(){return this.reqAPIService.get("/manager/farm-api-info?fcode="+this.fcode).pipe((0,s.U)(t=>(this.setFarm(t.data),t)))}getSeting(){return this.reqAPIService.get("/manager/farm-api-mobie?action=get-farm-setting&fcode="+this.fcode).pipe((0,s.U)(t=>t))}updatePrivate(t){return this.reqAPIService.post("/manager/farm-api-mobie?action=add-farm-setting&fcode="+this.fcode,t).pipe((0,s.U)(t=>t))}removePermission(t,e){return this.reqAPIService.get("/manager/farm-api-mobie?action=remove-manager&fcode="+this.fcode+"&user_id="+t+"&position="+e).pipe((0,s.U)(t=>t))}updateFarm(t){return this.reqAPIService.post("/manager/farm-edit-api-mobie?action=edit&fcode="+this.fcode,t).pipe((0,s.U)(t=>t))}destroyValue(){this.farm=null,this.fcode=null,this.permission=null,this.numberOfPonds=null}getSpecies(){return this.reqAPIService.get("/manager/farm-create-api?action=get-species").pipe((0,s.U)(t=>t))}insertPond(t){return this.reqAPIService.post("/manager/farm-api-mobie?action=add-pond&fcode="+this.fcode,t).pipe((0,s.U)(t=>t))}insertOnePond(t){return this.reqAPIService.post("/manager/farm-api-mobie?action=add-a-pond&fcode="+this.fcode,t).pipe((0,s.U)(t=>t))}loadReport(){return this.reqAPIService.get("/manager/farm-api-report?fcode="+this.fcode)}listStore(){return this.reqAPIService.get("/manager/farm-api-mobie?fcode="+this.fcode+"&action=list-store")}}return t.\u0275fac=function(e){return new(e||t)(a.LFG(o.$))},t.\u0275prov=a.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},83677:function(t,e,i){i.r(e),i.d(e,{MoneyPageModule:function(){return Nt}});var n=i(38583),o=i(90665),s=i(13619),a=i(47063),r=i(64762),l=i(16738),d=i(51937),c=i(27887),u=i(62014),m=i(19228),p=i(54395),h=i(87519),g=i(49038),f=i(84267),Z=i(37716),A=i(84465),_=i(81780),v=i(82196),y=i(25375);function b(t,e){if(1&t&&(Z.TgZ(0,"ion-select-option",30),Z._uU(1),Z.qZA()),2&t){const t=Z.oxw().$implicit;Z.Q6J("value",t.id),Z.xp6(1),Z.Oqu(t.name)}}function C(t,e){if(1&t&&(Z.TgZ(0,"div"),Z.YNc(1,b,2,2,"ion-select-option",29),Z.qZA()),2&t){const t=e.$implicit,i=Z.oxw(2);Z.xp6(1),Z.Q6J("ngIf",t.type==i.addForm.value.type&&4!=+t.id)}}function T(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-item",7),Z.TgZ(1,"ion-label"),Z._uU(2),Z.ALo(3,"translate"),Z.qZA(),Z.TgZ(4,"ion-select",26),Z.YNc(5,C,2,1,"div",27),Z.qZA(),Z.TgZ(6,"ion-buttons",3),Z.TgZ(7,"ion-button",1),Z.NdJ("click",function(){return Z.CHM(t),Z.oxw().presentAddGroup()}),Z._UZ(8,"ion-icon",28),Z.qZA(),Z.qZA(),Z.qZA()}if(2&t){const t=Z.oxw();Z.xp6(2),Z.Oqu(Z.lcZ(3,2,"MONEY_MOD.GROUP")),Z.xp6(3),Z.Q6J("ngForOf",t.listCategory)}}function x(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-button",33),Z.NdJ("click",function(){return Z.CHM(t),Z.oxw(2).resetBillId()}),Z._uU(1),Z.ALo(2,"number"),Z._UZ(3,"ion-icon",34),Z.qZA()}if(2&t){const t=Z.oxw(2);Z.xp6(1),Z.AsE(" ",""!=t.billSeleted.customer_name?t.billSeleted.customer_name:"None"," | ",Z.lcZ(2,2,t.billSeleted.amounts-t.billSeleted.amounts_payed)," ")}}function S(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-button",1),Z.NdJ("click",function(){return Z.CHM(t),Z.oxw(2).presentChooseBill()}),Z._UZ(1,"ion-icon",28),Z.qZA()}}function F(t,e){if(1&t&&(Z.TgZ(0,"ion-item",7),Z.TgZ(1,"ion-label"),Z._uU(2),Z.ALo(3,"translate"),Z.qZA(),Z.YNc(4,x,4,4,"ion-button",31),Z.TgZ(5,"ion-buttons",3),Z.YNc(6,S,2,0,"ion-button",32),Z.qZA(),Z.qZA()),2&t){const t=Z.oxw();Z.xp6(2),Z.Oqu(Z.lcZ(3,3,"MONEY_MOD.BILL_PAY")),Z.xp6(2),Z.Q6J("ngIf",t.billSeleted),Z.xp6(2),Z.Q6J("ngIf",!t.billSeleted)}}function q(t,e){if(1&t&&(Z.TgZ(0,"ion-select-option",30),Z._uU(1),Z.qZA()),2&t){const t=e.$implicit;Z.s9C("value",t.code),Z.xp6(1),Z.Oqu(t.name)}}function O(t,e){1&t&&Z._UZ(0,"ion-icon",38)}function N(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-chip",36),Z.NdJ("click",function(e){const i=Z.CHM(t),n=i.$implicit,o=i.index,s=Z.oxw(2);return"farm"==n.type?e.stopPropagation():s.removePond(o)}),Z.TgZ(1,"ion-label"),Z._uU(2),Z.qZA(),Z.YNc(3,O,1,0,"ion-icon",37),Z.qZA()}if(2&t){const t=e.$implicit;Z.xp6(2),Z.Oqu(t.name),Z.xp6(1),Z.Q6J("ngIf","farm"!=t.type)}}function D(t,e){if(1&t&&(Z.TgZ(0,"ion-item",7),Z.TgZ(1,"div"),Z.YNc(2,N,4,2,"ion-chip",35),Z.qZA(),Z.qZA()),2&t){const t=Z.oxw();Z.xp6(2),Z.Q6J("ngForOf",t.pondSeleted)}}function Y(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-item",7),Z.TgZ(1,"ion-label",20),Z._uU(2),Z.ALo(3,"translate"),Z.ALo(4,"translate"),Z.qZA(),Z.TgZ(5,"ion-input",39),Z.NdJ("ionFocus",function(){Z.CHM(t);const e=Z.oxw();return e.numberFormatCost.realValue?e.numberFormatCostPayed.setValue(e.numberFormatCost.realValue):""})("ionChange",function(e){return Z.CHM(t),Z.oxw().numberFormatCostPayed.setValue(e.detail.value)}),Z.qZA(),Z.qZA()}if(2&t){const t=Z.oxw();Z.xp6(2),Z.AsE("",Z.lcZ(3,3,"MONEY_MOD.AMOUNT_PAYED")," (",Z.lcZ(4,5,"CURRENCY_S"),")"),Z.xp6(3),Z.Q6J("value",t.numberFormatCostPayed.fakeView)}}function E(t,e){1&t&&(Z.TgZ(0,"ion-item",7),Z.TgZ(1,"ion-text",40),Z._uU(2," Chi ph\xed \u0111\xe3 tr\u1ea3 lu\xf4n nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng chi ph\xed "),Z.qZA(),Z.qZA())}function M(t,e){1&t&&(Z.TgZ(0,"ion-item",7),Z.TgZ(1,"ion-label",20),Z._uU(2),Z.ALo(3,"translate"),Z.qZA(),Z._UZ(4,"ion-input",41),Z.qZA()),2&t&&(Z.xp6(2),Z.Oqu(Z.lcZ(3,1,"MONEY_MOD.CUSTOMER")))}function I(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-item"),Z.TgZ(1,"ion-text"),Z._uU(2),Z.qZA(),Z.TgZ(3,"ion-button",33),Z.NdJ("click",function(){const e=Z.CHM(t).$implicit;return Z.oxw(2).setCustomerName(e.customer_name)}),Z._uU(4),Z.ALo(5,"translate"),Z.qZA(),Z.qZA()}if(2&t){const t=e.$implicit;Z.xp6(2),Z.hij(" ",t.customer_name," "),Z.xp6(2),Z.hij(" ",Z.lcZ(5,2,"SELECT")," ")}}function U(t,e){if(1&t&&(Z.TgZ(0,"ion-list",42),Z.YNc(1,I,6,4,"ion-item",27),Z.qZA()),2&t){const t=Z.oxw();Z.xp6(1),Z.Q6J("ngForOf",t.listCustomer)}}function w(t,e){1&t&&(Z.TgZ(0,"div"),Z._UZ(1,"ion-spinner",43),Z.qZA())}let P=(()=>{class t{constructor(t,e,i,n,s,a,r,d,m,p){this.modalController=t,this.farmService=e,this.toastService=i,this.navParams=n,this.moneyService=s,this.translate=a,this.alertController=r,this.actionSheetController=d,this.camera=m,this.settingService=p,this.maxDate=l(),this.minDate=l().subtract(180,"days"),this.savingFlag=new c.E,this.numberFormatCost=new u.y(""),this.numberFormatCostPayed=new u.y(""),this.addForm=new o.cw({type:new o.NI("out",o.kI.required),typeAdd:new o.NI("farm",o.kI.required),title:new o.NI("",o.kI.required),amounts:new o.NI("",[o.kI.required]),amounts_payed:new o.NI(""),today:new o.NI(l().format("YYYY-MM-DD"),o.kI.required),accounting_by:new o.NI(""),group_id:new o.NI(""),customer_name:new o.NI("")}),this.pondSeleted=[{name:this.translate.instant("COST")+" "+this.translate.instant("FARM"),code:"",type:"farm"}],this.listCategory=[],this.listCustomer=[],this.dataUpload={path:"",name:"",base:"",file:null}}ngOnInit(){this.getListPond(),this.getListCategories(),this.addForm.get("customer_name").valueChanges.pipe((0,p.b)(300),(0,h.x)()).subscribe(t=>{this.getListCustomer()})}getListCustomer(){this.listCustomer=[],this.moneyService.searchCustomer(this.addForm.value.customer_name,this.addForm.value.type).subscribe(t=>{1==t.status&&(this.listCustomer=t.data.filter(t=>t.customer_name!=this.addForm.value.customer_name),console.log(this.listCustomer))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}setCustomerName(t){this.addForm.patchValue({customer_name:t})}getListPond(){this.farmService.loadPonds().pipe().subscribe(t=>{0==t.status?this.toastService.warning(t.error):this.listPond=t.data},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}getListCategories(){this.moneyService.getCategories().subscribe(t=>{if(1==t.status)for(let e in t.data)t.data[e].id=e,this.listCategory.push(t.data[e])})}add(){let t=new FormData;t.append("type",this.addForm.value.type),t.append("typeAdd",this.addForm.value.typeAdd),this.pondSeleted.forEach(e=>{t.append("ponds[]",e.code)}),t.append("title",this.addForm.value.title),t.append("amounts",this.numberFormatCost.realValue.toString()),t.append("amounts_payed",this.numberFormatCostPayed.realValue.toString()),t.append("today",l(this.addForm.value.today).unix().toString()),t.append("fcode",this.fcode),t.append("accounting_by",this.addForm.value.accounting_by),t.append("group_id",this.addForm.value.group_id),t.append("bill_id",this.billSeleted&&4==+this.addForm.value.group_id?this.billSeleted.id:0),t.append("customer_name",this.addForm.value.customer_name),t.append("is_debt",this.settingService.showDebt?"1":"0"),this.dataUpload.file&&t.append("image",this.dataUpload.file),this.savingFlag.setPending(!0),this.moneyService.add(t).subscribe(e=>{0==e.status?this.toastService.warning(e.error):(this.toastService.success(this.translate.instant("FARM_MOD.NOTI_ADD_BUDGET")),this.modalController.dismiss(t)),this.savingFlag.setResult(!0)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.savingFlag.setResult(!1)})}chooseType(t){var e="";"farm"==t.detail.value?this.pondSeleted=[{name:this.translate.instant("COST")+" "+this.translate.instant("FARM"),code:"",type:"farm"}]:"all_area"==t.detail.value?(e="area",this.pondSeleted=this.listPond.reduce((e,i)=>(i.area>0&&e.push({name:i.name,code:i.code,type:t.detail.value}),e),[])):"all_seed"==t.detail.value?(e="seed",this.pondSeleted=this.listPond.reduce((e,i)=>(i.seed_quantity>0&&e.push({name:i.name,code:i.code,type:t.detail.value}),e),[])):"all_feed"==t.detail.value?(e="feed",this.pondSeleted=this.listPond.reduce((e,i)=>(i.current_season&&e.push({name:i.name,code:i.code,type:t.detail.value}),e),[])):"all_same"==t.detail.value?(e="same",this.pondSeleted=this.listPond.reduce((e,i)=>(i.current_season&&e.push({name:i.name,code:i.code,type:t.detail.value}),e),[]),console.log(this.pondSeleted)):(this.pondSeleted.findIndex(t=>"all_area"==t.type||"all_feed"==t.type||"all_seed"==t.type||"all_same"==t.type||"farm"==t.type)>=0&&(this.pondSeleted=[]),this.pondSeleted.push(this.listPond[this.listPond.findIndex(e=>e.code===t.detail.value)])),this.addForm.patchValue({accounting_by:e})}removePond(t){this.pondSeleted.length>1&&this.pondSeleted.splice(t,1)}presentAddGroup(){return(0,r.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("ADD")+" "+this.translate.instant("MONEY_MOD.GROUP"),inputs:[{name:"name",type:"text",placeholder:this.translate.instant("MONEY_MOD.GROUP")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.moneyService.addCategory({name:t.name,type:this.addForm.value.type}).subscribe(e=>{1==e.status?(this.listCategory.push({name:t.name,type:this.addForm.value.type,id:e.data}),this.addForm.patchValue({group_id:e.data}),this.toastService.success(this.translate.instant("SHOP.CART.ADDRESS.ADD_SUCCESS"))):(this.toastService.warning(e.error),this.filterNameCategory(t.name))},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}]})).present()})}filterNameCategory(t){const e=this.listCategory.find(e=>e.name===t.toString()&&4!=+e.id&&e.type==this.addForm.value.type);console.log(e),e&&this.addForm.patchValue({group_id:e.id})}presentChooseBill(){return(0,r.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:g.u,componentProps:{type:this.addForm.value.type}});return t.onDidDismiss().then(t=>{const e=t.data;e&&(this.billSeleted=e,this.addForm.patchValue({customer_name:this.billSeleted.customer_name,amounts:this.billSeleted.amounts-this.billSeleted.amounts_payed}))}),yield t.present()})}resetBillId(){this.billSeleted=null}resetType(){this.addForm.patchValue({group_id:""})}}return t.\u0275fac=function(e){return new(e||t)(Z.Y36(a.IN),Z.Y36(d.D),Z.Y36(A.k),Z.Y36(a.X1),Z.Y36(m.r),Z.Y36(_.sK),Z.Y36(a.Br),Z.Y36(a.BX),Z.Y36(f.V1),Z.Y36(v.R))},t.\u0275cmp=Z.Xpm({type:t,selectors:[["app-money-add"]],inputs:{fcode:"fcode"},decls:79,vars:78,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],[3,"data","toUpload"],[3,"formGroup"],["lines","inset"],["formControlName","today",3,"displayFormat","min","max"],["type","text","formControlName","type","interface","action-sheet",3,"ionChange"],["value","in"],["value","out"],["lines","inset",4,"ngIf"],["type","text","formControlName","typeAdd",3,"ionChange"],["value","farm"],["value","all_area"],["value","all_feed"],["value","all_seed"],["value","all_same"],[3,"value",4,"ngFor","ngForOf"],["position","floating"],["type","tel","inputmode","decimal","formControlName","amounts",3,"value","ionChange"],["type","text","formControlName","title"],["lines","none",4,"ngIf"],[1,"ion-text-center"],[4,"ngIf"],["type","text","formControlName","group_id","interface","action-sheet"],[4,"ngFor","ngForOf"],["slot","icon-only","name","add-circle"],[3,"value",4,"ngIf"],[3,"value"],["slot","end",3,"click",4,"ngIf"],[3,"click",4,"ngIf"],["slot","end",3,"click"],["slot","icon-only","name","close-circle"],["color","success",3,"click",4,"ngFor","ngForOf"],["color","success",3,"click"],["name","close-circle",4,"ngIf"],["name","close-circle"],["type","tel","inputmode","decimal","formControlName","amounts_payed",3,"value","ionFocus","ionChange"],["color","danger"],["formControlName","customer_name"],["lines","none"],["name","dots"]],template:function(t,e){1&t&&(Z.TgZ(0,"ion-header"),Z.TgZ(1,"ion-toolbar"),Z.TgZ(2,"ion-buttons",0),Z.TgZ(3,"ion-button",1),Z.NdJ("click",function(){return e.modalController.dismiss(!1)}),Z._UZ(4,"ion-icon",2),Z.qZA(),Z.qZA(),Z.TgZ(5,"ion-title"),Z._uU(6),Z.ALo(7,"translate"),Z.qZA(),Z.TgZ(8,"ion-buttons",3),Z.TgZ(9,"ion-button",4),Z.NdJ("click",function(){return e.add()}),Z._uU(10),Z.ALo(11,"translate"),Z.qZA(),Z.qZA(),Z.qZA(),Z.qZA(),Z.TgZ(12,"ion-content"),Z.TgZ(13,"app-image-picker",5),Z.NdJ("toUpload",function(t){return e.dataUpload=t}),Z.qZA(),Z.TgZ(14,"ion-list"),Z.TgZ(15,"form",6),Z.TgZ(16,"ion-item",7),Z.TgZ(17,"ion-label"),Z._uU(18),Z.ALo(19,"translate"),Z.qZA(),Z._UZ(20,"ion-datetime",8),Z.ALo(21,"translate"),Z.qZA(),Z.TgZ(22,"ion-item",7),Z.TgZ(23,"ion-label"),Z._uU(24),Z.ALo(25,"translate"),Z.qZA(),Z.TgZ(26,"ion-select",9),Z.NdJ("ionChange",function(){return e.resetType()}),Z.TgZ(27,"ion-select-option",10),Z._uU(28),Z.ALo(29,"translate"),Z.qZA(),Z.TgZ(30,"ion-select-option",11),Z._uU(31),Z.ALo(32,"translate"),Z.qZA(),Z.qZA(),Z.qZA(),Z.YNc(33,T,9,4,"ion-item",12),Z.YNc(34,F,7,5,"ion-item",12),Z.TgZ(35,"ion-item",7),Z.TgZ(36,"ion-label"),Z._uU(37),Z.ALo(38,"translate"),Z.ALo(39,"translate"),Z.qZA(),Z.TgZ(40,"ion-select",13),Z.NdJ("ionChange",function(t){return e.chooseType(t)}),Z.TgZ(41,"ion-select-option",14),Z._uU(42),Z.ALo(43,"translate"),Z.ALo(44,"translate"),Z.qZA(),Z.TgZ(45,"ion-select-option",15),Z._uU(46),Z.ALo(47,"translate"),Z.qZA(),Z.TgZ(48,"ion-select-option",16),Z._uU(49),Z.ALo(50,"translate"),Z.ALo(51,"translate"),Z.qZA(),Z.TgZ(52,"ion-select-option",17),Z._uU(53),Z.ALo(54,"translate"),Z.ALo(55,"translate"),Z.qZA(),Z.TgZ(56,"ion-select-option",18),Z._uU(57),Z.ALo(58,"translate"),Z.ALo(59,"translate"),Z.qZA(),Z.YNc(60,q,2,2,"ion-select-option",19),Z.qZA(),Z.qZA(),Z.YNc(61,D,3,1,"ion-item",12),Z.TgZ(62,"ion-item",7),Z.TgZ(63,"ion-label",20),Z._uU(64),Z.ALo(65,"translate"),Z.ALo(66,"translate"),Z.qZA(),Z.TgZ(67,"ion-input",21),Z.NdJ("ionChange",function(t){return e.numberFormatCost.setValue(t.detail.value)}),Z.qZA(),Z.qZA(),Z.YNc(68,Y,6,7,"ion-item",12),Z.YNc(69,E,3,0,"ion-item",12),Z.TgZ(70,"ion-item",7),Z.TgZ(71,"ion-label",20),Z._uU(72),Z.ALo(73,"translate"),Z.qZA(),Z._UZ(74,"ion-textarea",22),Z.qZA(),Z.YNc(75,M,5,3,"ion-item",12),Z.qZA(),Z.qZA(),Z.YNc(76,U,2,1,"ion-list",23),Z.TgZ(77,"div",24),Z.YNc(78,w,2,0,"div",25),Z.qZA(),Z.qZA()),2&t&&(Z.xp6(6),Z.Oqu(Z.lcZ(7,36,"FARM_MOD.ADD_BUDGET")),Z.xp6(3),Z.Q6J("disabled",e.addForm.invalid||e.savingFlag.pending||e.numberFormatCost.realValue<=0||e.numberFormatCostPayed.realValue<0||0==e.pondSeleted.length||e.numberFormatCost.realValue<e.numberFormatCostPayed.realValue),Z.xp6(1),Z.hij(" ",Z.lcZ(11,38,"FARM_MOD.SAVE")," "),Z.xp6(3),Z.Q6J("data",e.dataUpload),Z.xp6(2),Z.Q6J("formGroup",e.addForm),Z.xp6(3),Z.Oqu(Z.lcZ(19,40,"FARM_MOD.DATE")),Z.xp6(2),Z.Q6J("displayFormat",Z.lcZ(21,42,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD")),Z.xp6(4),Z.Oqu(Z.lcZ(25,44,"FARM_MOD.SELECT")),Z.xp6(4),Z.Oqu(Z.lcZ(29,46,"FARM_MOD.INCOME")),Z.xp6(3),Z.Oqu(Z.lcZ(32,48,"FARM_MOD.EXPENSE")),Z.xp6(2),Z.Q6J("ngIf",e.settingService.showDebt),Z.xp6(1),Z.Q6J("ngIf",4==+e.addForm.value.group_id&&e.settingService.showDebt),Z.xp6(3),Z.AsE(" ",Z.lcZ(38,50,"FARM"),"/",Z.lcZ(39,52,"POND")," "),Z.xp6(5),Z.AsE("",Z.lcZ(43,54,"COST")," ",Z.lcZ(44,56,"FARM"),""),Z.xp6(4),Z.hij("",Z.lcZ(47,58,"MONEY_MOD.EQUALLY_DIVIDED")," m2"),Z.xp6(3),Z.AsE("",Z.lcZ(50,60,"MONEY_MOD.EQUALLY_DIVIDED")," ",Z.lcZ(51,62,"POND_MOD.FEED"),""),Z.xp6(4),Z.AsE("",Z.lcZ(54,64,"MONEY_MOD.EQUALLY_DIVIDED")," ",Z.lcZ(55,66,"POND_MOD.SEED"),""),Z.xp6(4),Z.AsE("",Z.lcZ(58,68,"MONEY_MOD.EQUALLY_DIVIDED")," ",Z.lcZ(59,70,"POND"),""),Z.xp6(3),Z.Q6J("ngForOf",e.listPond),Z.xp6(1),Z.Q6J("ngIf",e.pondSeleted.length>0),Z.xp6(3),Z.AsE("",Z.lcZ(65,72,"MONEY_MOD.AMOUNT")," (",Z.lcZ(66,74,"CURRENCY_S"),")"),Z.xp6(3),Z.Q6J("value",e.numberFormatCost.fakeView),Z.xp6(1),Z.Q6J("ngIf",e.settingService.showDebt),Z.xp6(1),Z.Q6J("ngIf",e.numberFormatCost.realValue<e.numberFormatCostPayed.realValue),Z.xp6(3),Z.Oqu(Z.lcZ(73,76,"MONEY_MOD.NOTE")),Z.xp6(3),Z.Q6J("ngIf",e.settingService.showDebt),Z.xp6(1),Z.Q6J("ngIf",e.settingService.showDebt),Z.xp6(2),Z.Q6J("ngIf",e.savingFlag.pending))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,y.k,a.q_,o._Y,o.JL,o.sg,a.Ie,a.Q$,a.x4,a.QI,o.JJ,o.u,a.t9,a.n0,n.O5,n.sg,a.pK,a.j9,a.g2,a.hM,a.yW,a.PQ],pipes:[_.X$,n.JJ],styles:[""]}),t})();var L=i(92340);function R(t,e){1&t&&(Z.TgZ(0,"ion-text",3),Z.TgZ(1,"b"),Z._uU(2),Z.ALo(3,"translate"),Z.qZA(),Z.qZA()),2&t&&(Z.xp6(2),Z.Oqu(Z.lcZ(3,1,"FARM_MOD.INCOME")))}function J(t,e){1&t&&(Z.TgZ(0,"ion-text",3),Z.TgZ(1,"b"),Z._uU(2),Z.ALo(3,"translate"),Z.qZA(),Z.qZA()),2&t&&(Z.xp6(2),Z.Oqu(Z.lcZ(3,1,"FARM_MOD.EXPENSE")))}function k(t,e){if(1&t&&(Z.TgZ(0,"ion-select-option",21),Z._uU(1),Z.qZA()),2&t){const t=Z.oxw().$implicit;Z.Q6J("value",t.id),Z.xp6(1),Z.Oqu(t.name)}}function Q(t,e){if(1&t&&(Z.TgZ(0,"div"),Z.YNc(1,k,2,2,"ion-select-option",20),Z.qZA()),2&t){const t=e.$implicit,i=Z.oxw(2);Z.xp6(1),Z.Q6J("ngIf",t.type==i.editForm.value.type&&4!=+t.id)}}function V(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-item",7),Z.TgZ(1,"ion-label"),Z._uU(2),Z.ALo(3,"translate"),Z.qZA(),Z.TgZ(4,"ion-select",17),Z.YNc(5,Q,2,1,"div",18),Z.qZA(),Z.TgZ(6,"ion-buttons",3),Z.TgZ(7,"ion-button",1),Z.NdJ("click",function(){return Z.CHM(t),Z.oxw().presentAddGroup()}),Z._UZ(8,"ion-icon",19),Z.qZA(),Z.qZA(),Z.qZA()}if(2&t){const t=Z.oxw();Z.xp6(2),Z.Oqu(Z.lcZ(3,2,"MONEY_MOD.GROUP")),Z.xp6(3),Z.Q6J("ngForOf",t.listCategory)}}function G(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-button",24),Z.NdJ("click",function(){return Z.CHM(t),Z.oxw(2).resetBillId()}),Z._uU(1),Z.ALo(2,"number"),Z._UZ(3,"ion-icon",25),Z.qZA()}if(2&t){const t=Z.oxw(2);Z.xp6(1),Z.AsE(" ",""!=t.billSeleted.customer_name?t.billSeleted.customer_name:"None"," | ",Z.lcZ(2,2,t.billSeleted.amounts-t.billSeleted.amounts_payed)," ")}}function B(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-button",1),Z.NdJ("click",function(){return Z.CHM(t),Z.oxw(2).presentChooseBill()}),Z._UZ(1,"ion-icon",19),Z.qZA()}}function $(t,e){if(1&t&&(Z.TgZ(0,"ion-item",7),Z.TgZ(1,"ion-label"),Z._uU(2),Z.ALo(3,"translate"),Z.qZA(),Z.YNc(4,G,4,4,"ion-button",22),Z.TgZ(5,"ion-buttons",3),Z.YNc(6,B,2,0,"ion-button",23),Z.qZA(),Z.qZA()),2&t){const t=Z.oxw();Z.xp6(2),Z.Oqu(Z.lcZ(3,3,"MONEY_MOD.BILL_PAY")),Z.xp6(2),Z.Q6J("ngIf",t.billSeleted),Z.xp6(2),Z.Q6J("ngIf",!t.billSeleted)}}function H(t,e){if(1&t&&(Z.TgZ(0,"ion-select-option",21),Z._uU(1),Z.qZA()),2&t){const t=e.$implicit;Z.s9C("value",t.code),Z.xp6(1),Z.Oqu(t.name)}}function j(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-chip",29),Z.NdJ("click",function(){const e=Z.CHM(t).index;return Z.oxw(3).removePond(e)}),Z.TgZ(1,"ion-label"),Z._uU(2),Z.qZA(),Z._UZ(3,"ion-icon",30),Z.qZA()}if(2&t){const t=e.$implicit;Z.xp6(2),Z.Oqu(null==t?null:t.name)}}function X(t,e){if(1&t&&(Z.TgZ(0,"ion-item",7),Z.TgZ(1,"div"),Z.YNc(2,j,4,1,"ion-chip",28),Z.qZA(),Z.qZA()),2&t){const t=Z.oxw(2);Z.xp6(2),Z.Q6J("ngForOf",t.pondSeleted)}}function K(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"div"),Z.TgZ(1,"ion-item",7),Z.TgZ(2,"ion-label"),Z._uU(3),Z.ALo(4,"translate"),Z.qZA(),Z.TgZ(5,"ion-select",26),Z.NdJ("ionChange",function(e){return Z.CHM(t),Z.oxw().chooseTypeAll(e)}),Z.YNc(6,H,2,2,"ion-select-option",27),Z.qZA(),Z.qZA(),Z.YNc(7,X,3,1,"ion-item",10),Z.qZA()}if(2&t){const t=Z.oxw();Z.xp6(3),Z.hij(" ",Z.lcZ(4,3,"POND")," "),Z.xp6(3),Z.Q6J("ngForOf",t.listPond),Z.xp6(1),Z.Q6J("ngIf",t.pondSeleted.length>0)}}function W(t,e){if(1&t&&(Z.TgZ(0,"ion-select-option",21),Z._uU(1),Z.qZA()),2&t){const t=e.$implicit;Z.s9C("value",t.code),Z.xp6(1),Z.Oqu(t.name)}}function z(t,e){if(1&t&&(Z.TgZ(0,"ion-chip",34),Z.TgZ(1,"ion-label"),Z._uU(2),Z.qZA(),Z.qZA()),2&t){const t=e.$implicit;Z.xp6(2),Z.Oqu(null==t?null:t.name)}}function tt(t,e){if(1&t&&(Z.TgZ(0,"ion-item",7),Z.TgZ(1,"div"),Z.YNc(2,z,3,1,"ion-chip",33),Z.qZA(),Z.qZA()),2&t){const t=Z.oxw(2);Z.xp6(2),Z.Q6J("ngForOf",t.pondSeleted)}}function et(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"div"),Z.TgZ(1,"ion-item",7),Z.TgZ(2,"ion-label"),Z._uU(3),Z.ALo(4,"translate"),Z.ALo(5,"translate"),Z.qZA(),Z.TgZ(6,"ion-select",31),Z.NdJ("ionChange",function(e){return Z.CHM(t),Z.oxw().chooseType(e)}),Z.TgZ(7,"ion-select-option",32),Z._uU(8),Z.ALo(9,"translate"),Z.ALo(10,"translate"),Z.qZA(),Z.YNc(11,W,2,2,"ion-select-option",27),Z.qZA(),Z.qZA(),Z.YNc(12,tt,3,1,"ion-item",10),Z.qZA()}if(2&t){const t=Z.oxw();Z.xp6(3),Z.AsE(" ",Z.lcZ(4,7,"FARM"),"/",Z.lcZ(5,9,"POND")," "),Z.xp6(3),Z.Q6J("value",t.pondSeleted[0].code),Z.xp6(2),Z.AsE("",Z.lcZ(9,11,"COST")," ",Z.lcZ(10,13,"FARM"),""),Z.xp6(3),Z.Q6J("ngForOf",t.listPond),Z.xp6(1),Z.Q6J("ngIf",t.pondSeleted.length>0)}}function it(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-item",7),Z.TgZ(1,"ion-label",12),Z._uU(2),Z.ALo(3,"translate"),Z.ALo(4,"translate"),Z.qZA(),Z.TgZ(5,"ion-input",35),Z.NdJ("ionFocus",function(){Z.CHM(t);const e=Z.oxw();return e.numberFormatCostPayed.setValue(e.numberFormatCost.realValue)})("ionChange",function(e){return Z.CHM(t),Z.oxw().numberFormatCostPayed.setValue(e.detail.value)}),Z.qZA(),Z.qZA()}if(2&t){const t=Z.oxw();Z.xp6(2),Z.AsE("",Z.lcZ(3,3,"MONEY_MOD.AMOUNT_PAYED")," (",Z.lcZ(4,5,"CURRENCY_S"),")"),Z.xp6(3),Z.Q6J("value",t.numberFormatCostPayed.fakeView)}}function nt(t,e){1&t&&(Z.TgZ(0,"ion-item",7),Z.TgZ(1,"ion-text",36),Z._uU(2," Chi ph\xed \u0111\xe3 tr\u1ea3 lu\xf4n nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng chi ph\xed "),Z.qZA(),Z.qZA())}function ot(t,e){1&t&&(Z.TgZ(0,"ion-item",7),Z.TgZ(1,"ion-label",12),Z._uU(2),Z.ALo(3,"translate"),Z.qZA(),Z._UZ(4,"ion-input",37),Z.qZA()),2&t&&(Z.xp6(2),Z.Oqu(Z.lcZ(3,1,"MONEY_MOD.CUSTOMER")))}function st(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-item"),Z.TgZ(1,"ion-text"),Z._uU(2),Z.qZA(),Z.TgZ(3,"ion-button",24),Z.NdJ("click",function(){const e=Z.CHM(t).$implicit;return Z.oxw(2).setCustomerName(e.customer_name)}),Z._uU(4),Z.ALo(5,"translate"),Z.qZA(),Z.qZA()}if(2&t){const t=e.$implicit;Z.xp6(2),Z.hij(" ",t.customer_name," "),Z.xp6(2),Z.hij(" ",Z.lcZ(5,2,"SELECT")," ")}}function at(t,e){if(1&t&&(Z.TgZ(0,"ion-list",38),Z.YNc(1,st,6,4,"ion-item",18),Z.qZA()),2&t){const t=Z.oxw();Z.xp6(1),Z.Q6J("ngForOf",t.listCustomer)}}function rt(t,e){1&t&&(Z.TgZ(0,"div"),Z._UZ(1,"ion-spinner",39),Z.qZA())}let lt=(()=>{class t{constructor(t,e,i,n,s,a,r,d,m){this.modalController=t,this.farmService=e,this.toastService=i,this.navParams=n,this.moneyService=s,this.translate=a,this.alertController=r,this.actionSheetController=d,this.settingService=m,this.maxDate=l(),this.minDate=l().subtract(180,"days"),this.savingFlag=new c.E,this.numberFormatCost=new u.y(""),this.numberFormatCostPayed=new u.y(""),this.editForm=new o.cw({type:new o.NI("out",o.kI.required),typeAdd:new o.NI("farm",o.kI.required),title:new o.NI("",o.kI.required),amounts:new o.NI("",[o.kI.required]),amounts_payed:new o.NI(""),today:new o.NI(l().format("YYYY-MM-DD"),o.kI.required),accounting_by:new o.NI(""),group_id:new o.NI(""),customer_name:new o.NI("")}),this.listCategory=[],this.pondSeleted=[{name:this.translate.instant("COST")+" "+this.translate.instant("FARM"),code:"",type:"farm"}],this.listCustomer=[],this.dataUpload={path:"",name:"",base:"",file:null},this.PATH_FILE=L.bl.FILE_PATH}ngOnInit(){return(0,r.mG)(this,void 0,void 0,function*(){yield this.getListPond(),yield this.getListCategories(),yield this.getBill(),this.buildForm(),this.editForm.get("customer_name").valueChanges.pipe((0,p.b)(300),(0,h.x)()).subscribe(t=>{this.getListCustomer()})})}getListCustomer(){this.listCustomer=[],this.moneyService.searchCustomer(this.editForm.value.customer_name,this.editForm.value.type).subscribe(t=>{1==t.status&&(this.listCustomer=t.data.filter(t=>t.customer_name!=this.editForm.value.customer_name))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}setCustomerName(t){this.editForm.patchValue({customer_name:t})}getListCategories(){return(0,r.mG)(this,void 0,void 0,function*(){const t=yield this.moneyService.getCategories().toPromise();if(t&&1==t.status)for(let e in t.data)t.data[e].id=e,this.listCategory.push(t.data[e])})}buildForm(){if(console.log(this.data),this.editForm.patchValue({type:this.data.cr,typeAdd:0==this.data.pond_id?"farm":this.data.pond_id,title:this.data.title,amounts:this.data.amounts,amounts_payed:this.data.amounts_payed,group_id:this.data.group_id,today:l(1e3*this.data.add_time).format("YYYY-MM-DD"),accounting_by:this.data.accounting_by,customer_name:this.data.customer_name}),this.data.image&&(this.dataUpload.path=this.PATH_FILE+"/upload/"+this.data.image),this.data.pond_id&&"NULL"!==this.data.pond_id){let t=this.listPond.find(t=>t.code===this.data.pond_id);this.pondSeleted=[{name:null==t?void 0:t.name,code:null==t?void 0:t.code,type:""}]}else this.pondSeleted=[{name:this.translate.instant("COST")+" "+this.translate.instant("FARM"),code:"",type:"farm"}];this.data.code&&(this.editForm.patchValue({typeAdd:"all_"+this.data.accounting_by,accounting_by:this.data.accounting_by}),this.moneyService.getGroup(this.data.code,this.data.cr).subscribe(t=>{if(1==t.status){let e=0,i=0;this.pondSeleted=t.data.reduce((t,e)=>{let i=this.listPond.find(t=>t.code===e.pond_id);return i&&t.push({name:i.name,code:i.code,type:"all"}),t},[]),t.data.forEach(t=>{e+=+t.amounts,i+=+t.amounts_payed}),this.editForm.patchValue({amounts:e,amounts_payed:i})}}))}getListPond(){return(0,r.mG)(this,void 0,void 0,function*(){const t=yield this.farmService.loadPonds().toPromise().catch(()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))});0==+t.status?this.toastService.warning(t.error):this.listPond=t.data,console.log(this.listPond)})}chooseTypeAll(t){this.pondSeleted.find(e=>e.code===t.detail.value)||this.pondSeleted.push(this.listPond.find(e=>e.code===t.detail.value))}chooseType(t){if(0==t.detail.value)this.pondSeleted=[{name:this.translate.instant("COST")+" "+this.translate.instant("FARM"),code:"",type:"farm"}];else{let e=this.listPond.find(e=>e.code===t.detail.value);e&&(this.pondSeleted=[{name:e.name,code:e.code,type:""}])}}removePond(t){this.pondSeleted.length>1&&this.pondSeleted.splice(t,1)}edit(){let t=new FormData;t.append("id",this.data.id),t.append("type",this.editForm.value.type),t.append("typeAdd",this.editForm.value.typeAdd),this.pondSeleted.forEach(e=>{t.append("ponds[]",e.code)}),t.append("pond_id",this.pondSeleted[0].code),t.append("group_id",this.editForm.value.group_id),t.append("title",this.editForm.value.title),t.append("amounts",this.numberFormatCost.realValue.toString()),t.append("amounts_payed",this.numberFormatCostPayed.realValue.toString()),t.append("today",l(this.editForm.value.today).unix().toString()),t.append("fcode",this.fcode),t.append("accounting_by",this.editForm.value.accounting_by),t.append("bill_id",this.billSeleted&&4==+this.editForm.value.group_id?this.billSeleted.id:0),t.append("customer_name",this.editForm.value.customer_name),t.append("is_debt",this.settingService.showDebt?"1":"0"),this.dataUpload.file&&t.append("image",this.dataUpload.file),this.pondSeleted.map(t=>t.code),l(this.editForm.value.today).unix(),this.savingFlag.setStart(!0);var e="edit";["all_feed","all_seed","all_area","all_same"].includes(this.editForm.value.typeAdd)&&(e="editGroup"),this.moneyService[e](t).pipe().subscribe(e=>{0==e.status?this.toastService.warning(e.error):(this.toastService.success(this.translate.instant("MONEY_MOD.NOTI_EDIT")),this.modalController.dismiss(t)),this.savingFlag.setResult(!0)},()=>{this.savingFlag.setResult(!1),this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}getBill(){0==+this.data.bill_id||4!=+this.data.group_id||this.moneyService.getBill(this.data.bill_id,this.data.cr).subscribe(t=>{1==t.status?this.billSeleted=t.data:this.toastService.warning(t.error)},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}presentChooseBill(){return(0,r.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:g.u,componentProps:{type:this.editForm.value.type,bill_id:this.data.id}});return t.onDidDismiss().then(t=>{const e=t.data;e&&(this.billSeleted=e,this.editForm.patchValue({customer_name:this.billSeleted.customer_name,amounts:this.billSeleted.amounts-this.billSeleted.amounts_payed}))}),yield t.present()})}resetBillId(){this.billSeleted=null}presentAddGroup(){return(0,r.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("ADD")+" "+this.translate.instant("MONEY_MOD.GROUP"),inputs:[{name:"name",type:"text",placeholder:this.translate.instant("MONEY_MOD.GROUP")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.moneyService.addCategory({name:t.name,type:this.editForm.value.type}).subscribe(e=>{1==e.status?(this.listCategory.push({name:t.name,type:this.editForm.value.type,id:e.data}),this.editForm.patchValue({group_id:e.data}),this.toastService.success(this.translate.instant("SHOP.CART.ADDRESS.ADD_SUCCESS"))):(this.toastService.warning(e.error),this.filterNameCategory(t.name))},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}]})).present()})}filterNameCategory(t){const e=this.listCategory.find(e=>e.name===t);console.log(e),e&&this.editForm.patchValue({group_id:e.id})}resetType(){this.editForm.patchValue({group_id:""})}}return t.\u0275fac=function(e){return new(e||t)(Z.Y36(a.IN),Z.Y36(d.D),Z.Y36(A.k),Z.Y36(a.X1),Z.Y36(m.r),Z.Y36(_.sK),Z.Y36(a.Br),Z.Y36(a.BX),Z.Y36(v.R))},t.\u0275cmp=Z.Xpm({type:t,selectors:[["app-money-edit"]],inputs:{fcode:"fcode",data:"data"},decls:49,vars:42,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],[3,"data","toUpload"],[3,"formGroup"],["lines","inset"],["formControlName","today",3,"displayFormat","min","max"],["slot","end",4,"ngIf"],["lines","inset",4,"ngIf"],[4,"ngIf"],["position","floating"],["type","tel","inputmode","decimal","formControlName","amounts",3,"disabled","value","ionChange"],["type","text","formControlName","title"],["lines","none",4,"ngIf"],[1,"ion-text-center"],["type","text","formControlName","group_id","interface","action-sheet"],[4,"ngFor","ngForOf"],["slot","icon-only","name","add-circle"],[3,"value",4,"ngIf"],[3,"value"],["slot","end",3,"click",4,"ngIf"],[3,"click",4,"ngIf"],["slot","end",3,"click"],["slot","icon-only","name","close-circle"],["type","text",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["color","success",3,"click",4,"ngFor","ngForOf"],["color","success",3,"click"],["name","close-circle"],["type","text",3,"value","ionChange"],["value",""],["color","success",4,"ngFor","ngForOf"],["color","success"],["type","tel","inputmode","decimal","formControlName","amounts_payed",3,"value","ionFocus","ionChange"],["color","danger"],["formControlName","customer_name"],["lines","none"],["name","dots"]],template:function(t,e){1&t&&(Z.TgZ(0,"ion-header"),Z.TgZ(1,"ion-toolbar"),Z.TgZ(2,"ion-buttons",0),Z.TgZ(3,"ion-button",1),Z.NdJ("click",function(){return e.modalController.dismiss(!1)}),Z._UZ(4,"ion-icon",2),Z.qZA(),Z.qZA(),Z.TgZ(5,"ion-title"),Z._uU(6),Z.ALo(7,"translate"),Z.qZA(),Z.TgZ(8,"ion-buttons",3),Z.TgZ(9,"ion-button",4),Z.NdJ("click",function(){return e.edit()}),Z._uU(10),Z.ALo(11,"translate"),Z.qZA(),Z.qZA(),Z.qZA(),Z.qZA(),Z.TgZ(12,"ion-content"),Z.TgZ(13,"app-image-picker",5),Z.NdJ("toUpload",function(t){return e.dataUpload=t}),Z.qZA(),Z.TgZ(14,"ion-list"),Z.TgZ(15,"form",6),Z.TgZ(16,"ion-item",7),Z.TgZ(17,"ion-label"),Z._uU(18),Z.ALo(19,"translate"),Z.qZA(),Z._UZ(20,"ion-datetime",8),Z.ALo(21,"translate"),Z.qZA(),Z.TgZ(22,"ion-item",7),Z.TgZ(23,"ion-label"),Z._uU(24),Z.ALo(25,"translate"),Z.qZA(),Z.YNc(26,R,4,3,"ion-text",9),Z.YNc(27,J,4,3,"ion-text",9),Z.qZA(),Z.YNc(28,V,9,4,"ion-item",10),Z.YNc(29,$,7,5,"ion-item",10),Z.YNc(30,K,8,5,"div",11),Z.YNc(31,et,13,15,"div",11),Z.TgZ(32,"ion-item",7),Z.TgZ(33,"ion-label",12),Z._uU(34),Z.ALo(35,"translate"),Z.ALo(36,"translate"),Z.qZA(),Z.TgZ(37,"ion-input",13),Z.NdJ("ionChange",function(t){return e.numberFormatCost.setValue(t.detail.value)}),Z.qZA(),Z.qZA(),Z.YNc(38,it,6,7,"ion-item",10),Z.YNc(39,nt,3,0,"ion-item",10),Z.TgZ(40,"ion-item",7),Z.TgZ(41,"ion-label",12),Z._uU(42),Z.ALo(43,"translate"),Z.qZA(),Z._UZ(44,"ion-textarea",14),Z.qZA(),Z.YNc(45,ot,5,3,"ion-item",10),Z.qZA(),Z.qZA(),Z.YNc(46,at,2,1,"ion-list",15),Z.TgZ(47,"div",16),Z.YNc(48,rt,2,0,"div",11),Z.qZA(),Z.qZA()),2&t&&(Z.xp6(6),Z.Oqu(Z.lcZ(7,26,"MONEY_MOD.EDIT")),Z.xp6(3),Z.Q6J("disabled",e.editForm.invalid||e.numberFormatCost.realValue<e.numberFormatCostPayed.realValue||e.numberFormatCost.realValue<=0||e.numberFormatCostPayed.realValue<0||e.savingFlag.pending),Z.xp6(1),Z.hij(" ",Z.lcZ(11,28,"FARM_MOD.SAVE")," "),Z.xp6(3),Z.Q6J("data",e.dataUpload),Z.xp6(2),Z.Q6J("formGroup",e.editForm),Z.xp6(3),Z.Oqu(Z.lcZ(19,30,"FARM_MOD.DATE")),Z.xp6(2),Z.Q6J("displayFormat",Z.lcZ(21,32,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD")),Z.xp6(4),Z.Oqu(Z.lcZ(25,34,"MONEY_MOD.SELECT")),Z.xp6(2),Z.Q6J("ngIf","in"==e.editForm.value.type),Z.xp6(1),Z.Q6J("ngIf","out"==e.editForm.value.type),Z.xp6(1),Z.Q6J("ngIf",4!=+e.editForm.value.group_id&&e.settingService.showDebt),Z.xp6(1),Z.Q6J("ngIf",4==+e.editForm.value.group_id&&e.settingService.showDebt),Z.xp6(1),Z.Q6J("ngIf",("all_feed"==e.editForm.value.typeAdd||"all_seed"==e.editForm.value.typeAdd||"all_area"==e.editForm.value.typeAdd||"all_same"==e.editForm.value.typeAdd)&&""==e.data.alias),Z.xp6(1),Z.Q6J("ngIf","all_feed"!=e.editForm.value.typeAdd&&"all_seed"!=e.editForm.value.typeAdd&&"all_area"!=e.editForm.value.typeAdd&&"all_same"!=e.editForm.value.typeAdd&&""==e.data.alias&&4!=+e.editForm.value.group_id),Z.xp6(3),Z.AsE("",Z.lcZ(35,36,"MONEY_MOD.AMOUNT")," (",Z.lcZ(36,38,"CURRENCY_S"),")"),Z.xp6(3),Z.Q6J("disabled",""!=e.data.alias)("value",e.numberFormatCost.fakeView),Z.xp6(1),Z.Q6J("ngIf",e.settingService.showDebt),Z.xp6(1),Z.Q6J("ngIf",e.numberFormatCost.realValue<e.numberFormatCostPayed.realValue),Z.xp6(3),Z.Oqu(Z.lcZ(43,40,"MONEY_MOD.NOTE")),Z.xp6(3),Z.Q6J("ngIf",e.settingService.showDebt),Z.xp6(1),Z.Q6J("ngIf",e.settingService.showDebt),Z.xp6(2),Z.Q6J("ngIf",e.savingFlag.pending))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,y.k,a.q_,o._Y,o.JL,o.sg,a.Ie,a.Q$,a.x4,a.QI,o.JJ,o.u,n.O5,a.pK,a.j9,a.g2,a.yW,a.t9,n.sg,a.n0,a.hM,a.PQ],pipes:[_.X$,n.JJ],styles:[""]}),t})(),dt=(()=>{class t{constructor(t,e){this.modalController=t,this.translate=e,this.searchForm=new o.cw({keyword:new o.NI("",o.kI.required),type:new o.NI("out",o.kI.required)}),this.dateRangeStart=l().subtract(3,"days").format("YYYY-MM-DD"),this.dateRangeEnd=l().format("YYYY-MM-DD"),this.maxDate=l(),this.minDate=l().subtract(180,"days")}ngOnInit(){this.params&&this.searchForm.setValue({keyword:this.params.keyword,type:this.params.type}),this.params&&this.params.timeFrom&&(this.dateRangeStart=l(1e3*this.params.timeFrom).format("YYYY-MM-DD")),this.params&&this.params.timeTo&&(this.dateRangeEnd=l(1e3*this.params.timeTo).format("YYYY-MM-DD"))}onChangeDateStart(t){this.dateRangeStart=t.detail.value}onChangeDateEnd(t){this.dateRangeEnd=t.detail.value}search(){let t={type:this.searchForm.value.type,keyword:this.searchForm.value.keyword?this.searchForm.value.keyword:"",timeFrom:l(this.dateRangeStart).valueOf()/1e3,timeTo:l(this.dateRangeEnd).endOf("day").valueOf()/1e3};this.modalController.dismiss(t)}}return t.\u0275fac=function(e){return new(e||t)(Z.Y36(a.IN),Z.Y36(_.sK))},t.\u0275cmp=Z.Xpm({type:t,selectors:[["app-money-search"]],inputs:{params:"params"},decls:42,vars:35,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-text-center"],[1,"ion-padding"],[3,"formGroup"],["lines","inset"],["formControlName","type","interface","action-sheet"],["value","in"],["value","out"],[3,"displayFormat","min","max","value","ionChange"],["type","text","formControlName","keyword",3,"placeholder"],[1,"ion-padding","ion-text-center"],["shape","round",3,"click"]],template:function(t,e){1&t&&(Z.TgZ(0,"ion-header"),Z.TgZ(1,"ion-toolbar"),Z.TgZ(2,"ion-buttons",0),Z.TgZ(3,"ion-button",1),Z.NdJ("click",function(){return e.modalController.dismiss(!1)}),Z._UZ(4,"ion-icon",2),Z.qZA(),Z.qZA(),Z._UZ(5,"ion-title"),Z.qZA(),Z.qZA(),Z.TgZ(6,"ion-content"),Z.TgZ(7,"div",3),Z.TgZ(8,"h1",4),Z._uU(9),Z.ALo(10,"translate"),Z.qZA(),Z.qZA(),Z.TgZ(11,"form",5),Z.TgZ(12,"ion-list"),Z.TgZ(13,"ion-item",6),Z.TgZ(14,"ion-label"),Z._uU(15),Z.ALo(16,"translate"),Z.qZA(),Z.TgZ(17,"ion-select",7),Z.TgZ(18,"ion-select-option",8),Z._uU(19),Z.ALo(20,"translate"),Z.qZA(),Z.TgZ(21,"ion-select-option",9),Z._uU(22),Z.ALo(23,"translate"),Z.qZA(),Z.qZA(),Z.qZA(),Z.TgZ(24,"ion-item",6),Z.TgZ(25,"ion-label"),Z._uU(26),Z.ALo(27,"translate"),Z.qZA(),Z.TgZ(28,"ion-datetime",10),Z.NdJ("ionChange",function(t){return e.onChangeDateStart(t)}),Z.ALo(29,"translate"),Z.qZA(),Z.qZA(),Z.TgZ(30,"ion-item",6),Z.TgZ(31,"ion-label"),Z._uU(32),Z.ALo(33,"translate"),Z.qZA(),Z.TgZ(34,"ion-datetime",10),Z.NdJ("ionChange",function(t){return e.onChangeDateEnd(t)}),Z.ALo(35,"translate"),Z.qZA(),Z.qZA(),Z.TgZ(36,"ion-item",6),Z._UZ(37,"ion-input",11),Z.qZA(),Z.qZA(),Z.qZA(),Z.TgZ(38,"div",12),Z.TgZ(39,"ion-button",13),Z.NdJ("click",function(){return e.search()}),Z._uU(40),Z.ALo(41,"translate"),Z.qZA(),Z.qZA(),Z.qZA()),2&t&&(Z.xp6(9),Z.hij(" ",Z.lcZ(10,17,"MONEY_MOD.FILTER_BUDGET")," "),Z.xp6(2),Z.Q6J("formGroup",e.searchForm),Z.xp6(4),Z.Oqu(Z.lcZ(16,19,"MONEY_MOD.SELECT")),Z.xp6(4),Z.Oqu(Z.lcZ(20,21,"FARM_MOD.INCOME")),Z.xp6(3),Z.Oqu(Z.lcZ(23,23,"FARM_MOD.EXPENSE")),Z.xp6(4),Z.Oqu(Z.lcZ(27,25,"FARM_MOD.FROM")),Z.xp6(2),Z.Q6J("displayFormat",Z.lcZ(29,27,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeStart),Z.xp6(4),Z.Oqu(Z.lcZ(33,29,"FARM_MOD.TO")),Z.xp6(2),Z.Q6J("displayFormat",Z.lcZ(35,31,"FORMAT_DATE_MOMENT"))("min",e.dateRangeStart)("max",e.maxDate.format("YYYY-MM-DD"))("value",e.dateRangeEnd),Z.xp6(3),Z.Q6J("placeholder",e.translate.instant("FARM_MOD.KEYWORDS")),Z.xp6(3),Z.Oqu(Z.lcZ(41,33,"FARM_MOD.SEARCH")))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.gu,a.wd,a.W2,o._Y,o.JL,o.sg,a.q_,a.Ie,a.Q$,a.t9,a.QI,o.JJ,o.u,a.n0,a.x4,a.pK,a.j9],pipes:[_.X$],styles:[""]}),t})();var ct=i(60271),ut=i(7115),mt=i(71239),pt=i(73473);function ht(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-fab-button",11),Z.NdJ("click",function(){return Z.CHM(t),Z.oxw().presentCustomer()}),Z._UZ(1,"ion-icon",12),Z.qZA()}}function gt(t,e){1&t&&(Z.TgZ(0,"div",16),Z._UZ(1,"ion-spinner",17),Z.qZA())}function ft(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-card",20),Z.NdJ("click",function(){return Z.CHM(t),Z.oxw(3).presentCorrectFund()}),Z.TgZ(1,"ion-item",21),Z.TgZ(2,"ion-text"),Z._uU(3," Ti\u1ec1n m\u1eb7t "),Z.qZA(),Z.TgZ(4,"ion-text",2),Z._uU(5),Z.ALo(6,"number"),Z.qZA(),Z.qZA(),Z.TgZ(7,"ion-item",21),Z.TgZ(8,"ion-text"),Z._uU(9," D\u01b0 \u0111\u1ea7u "),Z.qZA(),Z.TgZ(10,"ion-text",2),Z._uU(11),Z.ALo(12,"number"),Z.qZA(),Z.qZA(),Z.TgZ(13,"ion-item",21),Z.TgZ(14,"ion-text"),Z._uU(15," D\u01b0 cu\u1ed1i "),Z.qZA(),Z.TgZ(16,"ion-text",2),Z._uU(17),Z.ALo(18,"number"),Z.qZA(),Z.qZA(),Z.TgZ(19,"ion-item",21),Z.TgZ(20,"ion-text",2),Z._uU(21),Z.ALo(22,"number"),Z.qZA(),Z.qZA(),Z.qZA()}if(2&t){const t=Z.oxw(3);Z.xp6(5),Z.hij(" ",Z.lcZ(6,4,null==t.fundInfor?null:t.fundInfor.current)," \u0111 "),Z.xp6(6),Z.hij(" ",Z.lcZ(12,6,t.fundInfor.total_in-t.fundInfor.total_out)," \u0111 "),Z.xp6(6),Z.hij(" ",Z.lcZ(18,8,t.fundInfor.current)," \u0111 "),Z.xp6(4),Z.hij(" ",Z.lcZ(22,10,t.fundInfor.current-(t.fundInfor.total_in-t.fundInfor.total_out))," \u0111 ")}}function Zt(t,e){1&t&&Z._UZ(0,"ion-icon",28)}function At(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"ion-item",24),Z.NdJ("click",function(){const e=Z.CHM(t),i=e.$implicit,n=e.index,o=Z.oxw().$implicit;return Z.oxw(3).presentActionSheet(o,i,n)}),Z.TgZ(1,"h1",25),Z._uU(2),Z.qZA(),Z.TgZ(3,"ion-label"),Z.TgZ(4,"p"),Z.YNc(5,Zt,1,0,"ion-icon",26),Z._uU(6),Z.qZA(),Z.TgZ(7,"ion-text"),Z.TgZ(8,"small"),Z._uU(9),Z.qZA(),Z.qZA(),Z.qZA(),Z.TgZ(10,"ion-text",27),Z._uU(11),Z.ALo(12,"number"),Z.qZA(),Z.qZA()}if(2&t){const t=e.$implicit;Z.xp6(2),Z.hij(" ",t.day," "),Z.xp6(3),Z.Q6J("ngIf",1==+t.confirm),Z.xp6(1),Z.hij(" ",t.date," "),Z.xp6(3),Z.hij(" ",t.title," "),Z.xp6(1),Z.Q6J("color","out"==t.cr?"danger":"primary"),Z.xp6(1),Z.hij(" ",Z.lcZ(12,6,t.amounts_payed)," \u0111 ")}}function _t(t,e){if(1&t&&(Z.TgZ(0,"ion-card",22),Z.YNc(1,At,13,8,"ion-item",23),Z.qZA()),2&t){const t=e.$implicit,i=Z.oxw(3);Z.xp6(1),Z.Q6J("ngForOf",i.moneyOb[t])}}function vt(t,e){1&t&&(Z.TgZ(0,"div"),Z.TgZ(1,"ion-item",21),Z.TgZ(2,"ion-label"),Z.TgZ(3,"p"),Z._uU(4),Z.ALo(5,"translate"),Z.qZA(),Z.qZA(),Z.qZA(),Z.qZA()),2&t&&(Z.xp6(4),Z.Oqu(Z.lcZ(5,1,"FARM_MOD.EMPTY")))}function yt(t,e){if(1&t&&(Z.TgZ(0,"ion-list"),Z.YNc(1,ft,23,12,"ion-card",18),Z.YNc(2,_t,2,1,"ion-card",19),Z.YNc(3,vt,6,3,"div",10),Z.qZA()),2&t){const t=Z.oxw(2);Z.xp6(1),Z.Q6J("ngIf",t.settingService.showDebt),Z.xp6(1),Z.Q6J("ngForOf",t.labelKey),Z.xp6(1),Z.Q6J("ngIf",0==t.moneys.length)}}function bt(t,e){if(1&t){const t=Z.EpF();Z.TgZ(0,"div"),Z.YNc(1,gt,2,0,"div",13),Z.YNc(2,yt,4,3,"ion-list",10),Z.TgZ(3,"ion-infinite-scroll",14),Z.NdJ("ionInfinite",function(e){return Z.CHM(t),Z.oxw().loadMore(e)}),Z._UZ(4,"ion-infinite-scroll-content",15),Z.qZA(),Z.qZA()}if(2&t){const t=Z.oxw();Z.xp6(1),Z.Q6J("ngIf",t.loadingFlag.pending),Z.xp6(1),Z.Q6J("ngIf",t.loadingFlag.result)}}const Ct=function(){return["company_manager","farm_manager","keeper_manager"]};let Tt=(()=>{class t{constructor(t,e,i,n,o,s,a,r,l,d){this.modalController=t,this.route=e,this.farmService=i,this.moneyService=n,this.toastService=o,this.dbLocalService=s,this.alertController=a,this.translate=r,this.actionSheetController=l,this.settingService=d,this.loadingFlag=new c.E,this.moneys=[],this.moneys_filter=[],this.isFilterAdvice=!1,this.isNull=!0,this.disableLoad=!1,this.view=!1,this.page=1,this.moneyOb={},this.labelKey=[],this.fundInfor={}}ngOnInit(){return(0,r.mG)(this,void 0,void 0,function*(){this.fcode=this.route.snapshot.paramMap.get("id"),console.log(this.fcode),this.moneyService.setCode(this.fcode),this.farmService.setCode(this.fcode),this.getList()})}ionViewDidEnter(){this.view=!0}getList(){this.loadingFlag.setPending(!0),this.moneyService.loadMoney(this.page).pipe().subscribe(t=>{0==t.status?(this.toastService.warning(t.error),this.loadingFlag.setResult(!1)):(this.isNull=!1,this.loadingFlag.setResult(!0),1==this.page&&(this.fundInfor=t.fund),this.moneys=t.data,this.processList(t.data),this.processCurrentFund())},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loadingFlag.setResult(!1)})}processList(t){t.forEach(t=>{t.date="thg "+l(1e3*t.add_time).format("M YYYY, dddd"),t.day=l(1e3*t.add_time).format("D");let e=l(1e3*t.add_time).format("MM-YYYY");this.moneyOb[e]?this.moneyOb[e].push(t):(this.labelKey.push(e),this.moneyOb[e]=[t])})}processCurrentFund(){let t=l().format("MM-YYYY");this.fundInfor.current=this.fundInfor.total_in-this.fundInfor.total_out;var e=0;this.moneyOb[t]&&this.moneyOb[t].forEach(t=>{1==+t.confirm&&("out"==t.cr?this.fundInfor.current-=t.amounts_payed:(this.fundInfor.current+=+t.amounts_payed,4!=t.group_id&&1==t.confirm&&(e+=+t.amounts_payed)))}),console.log(e)}loadMore(t){setTimeout(()=>{console.log("Done"),t.target.complete()},500),!this.disableLoad&&(this.page+=1,this.filterParams||this.getList())}presentAdd(){return(0,r.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:P,componentProps:{fcode:this.fcode}});return t.onDidDismiss().then(t=>{t.data&&(this.resetData(),this.getList())}),yield t.present()})}presentAlertDelete(t,e){return(0,r.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("MONEY_MOD.DELETE"),message:t.title+" ["+t.amounts+"]",buttons:[{text:this.translate.instant("OPTION.OK"),handler:()=>{this.delete({fcode:this.fcode,cr:t.cr,item:t.id},e)}},{text:this.translate.instant("OPTION.CANCEL"),role:"cancel",cssClass:"secondary"}]})).present()})}presentEdit(t,e){return(0,r.mG)(this,void 0,void 0,function*(){const e=yield this.modalController.create({component:lt,componentProps:{fcode:this.fcode,data:t}});return e.onDidDismiss().then(t=>{t.data&&(this.resetData(),this.getList())}),yield e.present()})}presentSearch(){return(0,r.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:dt,componentProps:{params:this.filterParams}});return t.onDidDismiss().then(t=>{const e=t.data;e&&(this.filterParams=e,this.filterAdvice(e))}),yield t.present()})}filterAdvice(t){this.loadingFlag.setPending(!0),this.moneyService.search(t).pipe().subscribe(t=>{0==t.status?(this.toastService.warning(t.error),this.loadingFlag.setResult(!1)):(this.isNull=!1,this.loadingFlag.setResult(!0),this.resetData(),this.fundInfor.total_in=t.fund?t.fund.total_in:0,this.fundInfor.total_out=t.fund?t.fund.total_out:0,this.processList(t.data))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loadingFlag.setResult(!1)})}filter(t){const e=t.target.value;this.moneys_filter=this.moneys.filter(t=>t.title.toLowerCase().indexOf(e.toLowerCase())>-1)}resetFilter(){this.getList(),this.isFilterAdvice=!1,this.filterParams=null}delete(t,e){this.moneyService.delete(t).pipe().subscribe(t=>{0==t.status?this.toastService.warning(t.message):(this.toastService.success(this.translate.instant("FARM_MOD.NOTI_DEL_BUDGET")),this.resetData(),this.getList())})}presentActionSheet(t,e,i){return(0,r.mG)(this,void 0,void 0,function*(){console.log(e);let n=[{text:this.translate.instant("EDIT"),icon:"pencil",handler:()=>{this.presentEdit(e,i)}},{text:this.translate.instant("DELETE"),role:"destructive",icon:"trash",handler:()=>{this.presentAlertDelete(e,i)}},{text:this.translate.instant("CANCEL"),icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}];if("company_manager"===this.farmService.permission&&this.settingService.showDebt){let o=1==+e.confirm?0:1;n.unshift({text:this.translate.instant(1==+e.confirm?"UNCONFIRM":"CONFIRM"),icon:1==+e.confirm?"checkbox":"checkbox-outline",handler:()=>{this.moneyService.confirmMoney(e.id,e.cr,this.dbLocalService.company.code,o).subscribe(e=>{1==e.status?(this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS")),this.moneyOb[t][i].confirm=o,console.log(this.moneyOb[t][i]),this.processCurrentFund()):this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS"))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loadingFlag.setResult(!1)})}})}let o=this.moneys.filter(t=>4==+t.group_id&&+t.bill_id==+e.id&&1==+t.confirm&&t.cr===e.cr).reduce((t,e)=>t+ +e.amounts_payed,0);""==e.code&&4!=e.group_id&&+e.amounts_payed<+e.amounts&&e.amounts-e.amounts_payed-o>0&&this.settingService.showDebt&&n.unshift({text:this.translate.instant("MONEY_MOD.PAY"),icon:"wallet",handler:()=>{this.presentAlertPayDebt(e)}});const s=yield this.actionSheetController.create({header:"Actions",cssClass:"my-custom-class",buttons:n});yield s.present();const{role:a}=yield s.onDidDismiss();console.log("onDidDismiss resolved with role",a)})}presentEstimate(){return(0,r.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:ct.u})).present()})}resetData(){this.moneyOb={},this.labelKey=[],this.fundInfor={},this.page=1}presentCorrectFund(){return(0,r.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"Ch\u1ec9nh ti\u1ec1n m\u1eb7t",inputs:[{name:"value",type:"number",placeholder:"S\u1ed1 ti\u1ec1n \u0111\xfang"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{this.moneyService.updateFund(this.fcode,t.value-this.fundInfor.current).subscribe(t=>{1==t.status?(this.toastService.success(this.translate.instant("WALL.UPDATE_SUCCESS")),this.resetData(),this.getList()):this.toastService.warning(this.translate.instant("DEVICE_MOD.UPDATE_UNSUCCESS"))},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}]})).present()})}presentCustomer(){return(0,r.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:ut.D})).present()})}presentAlertPayDebt(t){return(0,r.mG)(this,void 0,void 0,function*(){let e=this.moneys.filter(e=>4==+e.group_id&&+e.bill_id==+t.id&&1==+e.confirm&&e.cr==t.cr).reduce((t,e)=>t+ +e.amounts_payed,0);console.log(this.moneys.filter(t=>684==+t.bill_id&&4==+t.group_id)),yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.translate.instant("MONEY_MOD.PAY"),inputs:[{name:"date",type:"date",min:l(1e3*t.add_time).format("YYYY-MM-DD"),max:l().format("YYYY-MM-DD"),value:l().format("YYYY-MM-DD")},{name:"amounts",type:"text",id:"name2-id",value:t.amounts-t.amounts_payed-e,placeholder:this.translate.instant("MONEY_MOD.AMOUNT")}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:e=>{if(parseInt(e.amounts)<=0)return void this.translate.instant("DEVICE_MOD.INVALID_NUMBER");const i={id:null,type:t.cr,typeAdd:"farm",title:this.translate.instant("MONEY_MOD.PAY")+" bill #"+t.id,amounts:e.amounts,amounts_payed:e.amounts,today:l(e.date).unix(),fcode:this.fcode,accounting_by:t.accounting_by,group_id:4,bill_id:t.id,customer_name:t.customer_name,code:"",alias:"",confirm:0,cr:t.cr,date:"thg "+l(e.date).format("M YYYY, dddd"),day:l(e.date).format("D")};let n=new FormData;for(let t in i)n.append(t,i[t]);this.moneyService.add(n).subscribe(t=>{0==t.status?this.toastService.warning(t.error):(this.toastService.success(this.translate.instant("FARM_MOD.NOTI_ADD_BUDGET")),i.id=t.item_id,console.log(i),l(t.date).format("MM-YYYY"),this.resetData(),this.getList())},()=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}]})).present()})}}return t.\u0275fac=function(e){return new(e||t)(Z.Y36(a.IN),Z.Y36(s.gz),Z.Y36(d.D),Z.Y36(m.r),Z.Y36(A.k),Z.Y36(mt.T),Z.Y36(a.Br),Z.Y36(_.sK),Z.Y36(a.BX),Z.Y36(v.R))},t.\u0275cmp=Z.Xpm({type:t,selectors:[["app-money"]],decls:18,vars:8,consts:[["slot","start"],["text","","defaultHref","tabs/management"],["slot","end"],[3,"appPermission","currentPermission","click"],["name","stats-chart-outline"],[3,"click"],["name","filter-outline","slot","icon-only"],["vertical","bottom","horizontal","end","slot","fixed"],["color","warning",3,"click",4,"ngIf"],["name","create"],[4,"ngIf"],["color","warning",3,"click"],["name","person"],["class","spiner-loading",4,"ngIf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","dots"],[1,"spiner-loading"],["name","dots"],["class","ion-padding-top ion-padding-bottom",3,"click",4,"ngIf"],["class","ion-padding-top ion-padding-bottom",4,"ngFor","ngForOf"],[1,"ion-padding-top","ion-padding-bottom",3,"click"],["lines","none"],[1,"ion-padding-top","ion-padding-bottom"],["lines","none","detail","",3,"click",4,"ngFor","ngForOf"],["lines","none","detail","",3,"click"],[1,"ion-margin-end"],["name","checkmark-circle-outline","color","success",4,"ngIf"],["slot","end",3,"color"],["name","checkmark-circle-outline","color","success"]],template:function(t,e){1&t&&(Z.TgZ(0,"ion-header"),Z.TgZ(1,"ion-toolbar"),Z.TgZ(2,"ion-buttons",0),Z._UZ(3,"ion-back-button",1),Z.qZA(),Z.TgZ(4,"ion-title"),Z._uU(5),Z.ALo(6,"translate"),Z.qZA(),Z.TgZ(7,"ion-buttons",2),Z.TgZ(8,"ion-button",3),Z.NdJ("click",function(){return e.presentEstimate()}),Z._UZ(9,"ion-icon",4),Z.qZA(),Z.TgZ(10,"ion-button",5),Z.NdJ("click",function(){return e.presentSearch()}),Z._UZ(11,"ion-icon",6),Z.qZA(),Z.qZA(),Z.qZA(),Z.qZA(),Z.TgZ(12,"ion-content"),Z.TgZ(13,"ion-fab",7),Z.YNc(14,ht,2,0,"ion-fab-button",8),Z.TgZ(15,"ion-fab-button",5),Z.NdJ("click",function(){return e.presentAdd()}),Z._UZ(16,"ion-icon",9),Z.qZA(),Z.qZA(),Z.YNc(17,bt,5,2,"div",10),Z.qZA()),2&t&&(Z.xp6(5),Z.Oqu(Z.lcZ(6,5,"FARM_MOD.BUDGET")),Z.xp6(3),Z.Q6J("appPermission",Z.DdM(7,Ct))("currentPermission",e.farmService.permission),Z.xp6(6),Z.Q6J("ngIf",e.settingService.showDebt),Z.xp6(3),Z.Q6J("ngIf",e.view))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,a.wd,a.YG,pt.l,a.gu,a.W2,a.IJ,n.O5,a.W4,a.ju,a.MB,a.PQ,a.q_,n.sg,a.PM,a.Ie,a.yW,a.Q$],pipes:[_.X$,n.JJ],styles:[""]}),t})();var xt=i(54373),St=i(56209),Ft=i(59865),qt=i(24023);const Ot=[{path:"",component:Tt}];let Nt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Z.oAB({type:t}),t.\u0275inj=Z.cJS({providers:[f.V1,Ft.y],imports:[[n.ez,o.u5,o.UX,a.Pc,s.Bz.forChild(Ot),_.aw.forChild(),xt.i,St.Ns,qt.E]]}),t})()}}]);