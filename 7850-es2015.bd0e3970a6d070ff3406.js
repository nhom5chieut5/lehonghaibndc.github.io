"use strict";(self.webpackChunkFarmext2=self.webpackChunkFarmext2||[]).push([[7850],{19228:function(t,e,i){i.d(e,{r:function(){return r}});var o=i(15189),n=i(88002),s=i(37716);let r=(()=>{class t{constructor(t){this.reqAPIService=t,this.urlApi="/manager/money-api-mobie",this.urlApiNew="/manager/finance-api"}setCode(t){this.fcode=t,console.log(this.fcode)}loadMoney(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=list&page="+t).pipe((0,n.U)(t=>t))}search(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=search&keyword="+t.keyword+"&type="+t.type+"&timeFrom="+t.timeFrom+"&timeTo="+t.timeTo+"&page=0&numRow=20").pipe((0,n.U)(t=>t))}quickSearch(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=quick-search&type="+t.type+"&keyword="+t.keyword).pipe((0,n.U)(t=>t))}add(t){return this.reqAPIService.postApiWithFile("add",t,"&fcode="+this.fcode,this.urlApiNew)}edit(t){return this.reqAPIService.postApiWithFile("edit",t,"&fcode="+this.fcode+"&item="+t.get("id")+"&cr="+t.get("type"),this.urlApiNew)}editGroup(t){return this.reqAPIService.postApiWithFile("editTypeAll",t,"&fcode="+this.fcode+"&item="+t.get("id")+"&cr="+t.get("type"),this.urlApiNew)}delete(t){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=detele&item="+t.item+"&cr="+t.cr)}getAnalyst(t){return this.reqAPIService.post(this.urlApiNew+"?fcode="+this.fcode+"&action=analyst",t)}getGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=getItemByCode&code="+t+"&cr="+e)}getCategories(){return this.reqAPIService.get(this.urlApiNew+"?fcode="+this.fcode+"&action=listCategory")}confirmMoney(t,e,i,o){return this.reqAPIService.get(this.urlApiNew+"?action=confirm&ccode="+i+"&cr="+e+"&id="+t+"&confirm="+o)}updateFund(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=updateFund&fcode="+t+"&value="+e)}addCategory(t){return this.reqAPIService.post(this.urlApiNew+"?action=addCategory&fcode="+this.fcode,t)}searchCustomer(t,e){return this.reqAPIService.post(this.urlApiNew+"?action=searchCustomer&fcode="+this.fcode,{name:t,type:e})}getBill(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=get&fcode="+this.fcode+"&type="+e+"&id="+t)}getCustomers(){return this.reqAPIService.get(this.urlApiNew+"?action=getCustomers&fcode="+this.fcode)}getACustomer(t){return this.reqAPIService.get(this.urlApiNew+"?action=getACustomer&fcode="+this.fcode+"&customer_slug="+t)}getDebtCustomer(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtCustomer&type="+e+"&fcode="+this.fcode+"&customer_slug="+t)}addMultiDebtRecord(t){return this.reqAPIService.post(this.urlApiNew+"?action=addMultiDebt&fcode="+this.fcode,t)}getBillByAlias(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getByAlias&fcode="+this.fcode+"&alias="+t+"&type="+e)}getListMoneyByGroup(){return this.reqAPIService.get(this.urlApiNew+"?action=getListMoneyByGroup&fcode="+this.fcode)}getDetailByGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDetailByGroup&fcode="+this.fcode+"&group="+t+"&type="+e)}getDebtByGroup(t,e){return this.reqAPIService.get(this.urlApiNew+"?action=getDebtByGroup&type="+e+"&fcode="+this.fcode+"&group="+t)}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(o.$))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},97850:function(t,e,i){i.r(e),i.d(e,{StorePageModule:function(){return yt}});var o=i(38583),n=i(90665),s=i(13619),r=i(47063),a=i(64762),l=i(51937),c=i(22923),u=i(96351),d=i(37716),p=i(92652),g=i(81780);let m=(()=>{class t{constructor(t,e,i,o,n){this.modalController=t,this.route=e,this.router=i,this.farmService=o,this.storeService=n}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");void 0===t?this.router.navigateByUrl("tabs"):(this.farmService.setCode(t),this.storeService.setFarmCode(t))}presentReportStore(){return(0,a.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:u.E})).present()})}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(r.IN),d.Y36(s.gz),d.Y36(s.F0),d.Y36(l.D),d.Y36(c.d))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-store"]],decls:12,vars:3,consts:[["slot","start"],["text","","defaultHref","tabs/management"],["slot","end"],[3,"click"],["slot","icon-only","name","stats-chart-outline"]],template:function(t,e){1&t&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-buttons",0),d._UZ(3,"ion-back-button",1),d.qZA(),d.TgZ(4,"ion-title"),d._uU(5),d.ALo(6,"translate"),d.qZA(),d.TgZ(7,"ion-buttons",2),d.TgZ(8,"ion-button",3),d.NdJ("click",function(){return e.presentReportStore()}),d._UZ(9,"ion-icon",4),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(10,"ion-content"),d._UZ(11,"app-store-list"),d.qZA()),2&t&&(d.xp6(5),d.Oqu(d.lcZ(6,1,"WAREHOUSE_MOD.TITLE")))},directives:[r.Gu,r.sr,r.Sm,r.oU,r.cs,r.wd,r.YG,r.gu,r.W2,p.z],pipes:[g.X$],styles:[""]}),t})();var h=i(27887),Z=i(28049),A=i(16738),f=i(54395),q=i(87519),T=i(62014),b=i(19228),_=i(92340),x=i(84465),v=i(82196),O=i(25375);function S(t,e){if(1&t&&(d.TgZ(0,"div",18),d.TgZ(1,"ion-text",19),d._uU(2),d.qZA(),d.qZA()),2&t){const t=d.oxw();d.xp6(2),d.Oqu(t.message)}}function E(t,e){1&t&&(d.TgZ(0,"div",20),d._UZ(1,"ion-spinner",21),d.qZA())}function U(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"ion-item",22),d.TgZ(1,"ion-label",23),d._uU(2),d.ALo(3,"translate"),d.TgZ(4,"ion-text",19),d._uU(5),d.ALo(6,"translate"),d.ALo(7,"number"),d.ALo(8,"translate"),d.qZA(),d.qZA(),d.TgZ(9,"ion-input",24),d.NdJ("ionFocus",function(){return d.CHM(t),d.oxw().setAmountPayed()})("ionChange",function(e){return d.CHM(t),d.oxw().numberFormatPayed.setValue(e.detail.value)}),d.qZA(),d.qZA()}if(2&t){const t=d.oxw();d.xp6(2),d.Oqu(d.lcZ(3,5,"MONEY_MOD.PAYED")),d.xp6(3),d.lnq("(",d.lcZ(6,7,"WAREHOUSE_MOD.TOTAL_COST")," ",d.xi3(7,9,t.totalCost,"1.0-1"),"",d.lcZ(8,12,"CURRENCY_S"),")"),d.xp6(4),d.Q6J("value",t.numberFormatPayed.fakeView)}}function w(t,e){1&t&&(d.TgZ(0,"ion-item",22),d.TgZ(1,"ion-text",19),d._uU(2," Chi ph\xed \u0111\xe3 tr\u1ea3 lu\xf4n nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng chi ph\xed "),d.qZA(),d.qZA())}function y(t,e){1&t&&(d.TgZ(0,"ion-item",22),d.TgZ(1,"ion-label",23),d._uU(2),d.ALo(3,"translate"),d.qZA(),d._UZ(4,"ion-input",25),d.qZA()),2&t&&(d.xp6(2),d.Oqu(d.lcZ(3,1,"MONEY_MOD.CUSTOMER")))}function I(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"ion-item"),d.TgZ(1,"ion-text"),d._uU(2),d.qZA(),d.TgZ(3,"ion-button",28),d.NdJ("click",function(){const e=d.CHM(t).$implicit;return d.oxw(2).setCustomerName(e.customer_name)}),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.qZA()}if(2&t){const t=e.$implicit;d.xp6(2),d.hij(" ",t.customer_name," "),d.xp6(2),d.hij(" ",d.lcZ(5,2,"SELECT")," ")}}function C(t,e){if(1&t&&(d.TgZ(0,"ion-list",26),d.YNc(1,I,6,4,"ion-item",27),d.qZA()),2&t){const t=d.oxw();d.xp6(1),d.Q6J("ngForOf",t.listCustomer)}}function D(t,e){if(1&t&&(d.TgZ(0,"ion-select-option",43),d._uU(1),d.qZA()),2&t){const t=e.$implicit;d.Q6J("value",t.product_id),d.xp6(1),d.AsE("",t.name," - ",t.manufacturer_name,"")}}function N(t,e){if(1&t&&(d.TgZ(0,"small"),d._uU(1),d.qZA()),2&t){const t=d.oxw().index,e=d.oxw();d.xp6(1),d.hij("(",e.rowsImplement[t],")")}}function F(t,e){if(1&t&&(d.TgZ(0,"small"),d._uU(1),d.qZA()),2&t){const t=d.oxw().index,e=d.oxw();d.xp6(1),d.hij("/",e.rowsImplement[t],"")}}function R(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"ion-row",29),d.TgZ(1,"ion-col",30),d.TgZ(2,"ion-button",31),d.NdJ("click",function(){const e=d.CHM(t).index;return d.oxw().removeRow(e)}),d._UZ(3,"ion-icon",32),d.qZA(),d.qZA(),d.TgZ(4,"ion-col",33),d.TgZ(5,"ion-item"),d.TgZ(6,"ion-label",23),d._uU(7),d.ALo(8,"translate"),d.qZA(),d.TgZ(9,"ion-select",34),d.NdJ("ionChange",function(e){const i=d.CHM(t).index;return d.oxw().productChange(e,i)}),d.YNc(10,D,2,3,"ion-select-option",35),d.qZA(),d.qZA(),d.qZA(),d.TgZ(11,"ion-col",36),d.TgZ(12,"ion-item"),d.TgZ(13,"ion-label",23),d._uU(14),d.ALo(15,"translate"),d.YNc(16,N,2,1,"small",37),d.qZA(),d._UZ(17,"ion-input",38),d.qZA(),d.qZA(),d.TgZ(18,"ion-col",39),d.TgZ(19,"ion-item"),d.TgZ(20,"ion-label",23),d._uU(21),d.ALo(22,"translate"),d.YNc(23,F,2,1,"small",37),d.qZA(),d._UZ(24,"ion-input",40),d.qZA(),d.qZA(),d.TgZ(25,"ion-col",41),d.TgZ(26,"ion-item"),d.TgZ(27,"ion-label",42),d._uU(28),d.ALo(29,"translate"),d.qZA(),d.TgZ(30,"span"),d.TgZ(31,"ion-text",19),d._uU(32),d.ALo(33,"number"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA()}if(2&t){const t=e.$implicit,i=e.index,o=d.oxw();d.s9C("formGroupName",i),d.xp6(7),d.Oqu(d.lcZ(8,9,"WAREHOUSE_MOD.PRODUCT")),d.xp6(3),d.Q6J("ngForOf",o.products),d.xp6(4),d.hij("",d.lcZ(15,11,"WAREHOUSE_MOD.QUANTITY")," "),d.xp6(2),d.Q6J("ngIf",o.rowsImplement[i]),d.xp6(5),d.hij("",d.lcZ(22,13,"WAREHOUSE_MOD.PRICE")," "),d.xp6(2),d.Q6J("ngIf",o.rowsImplement[i]),d.xp6(5),d.Oqu(d.lcZ(29,15,"WAREHOUSE_MOD.VALUE")),d.xp6(4),d.Oqu(d.xi3(33,17,t.value.quantity*t.value.price,"1.0-0"))}}let Y=(()=>{class t{constructor(t,e,i,o,s,r,a){this.modalCtrl=t,this._fb=e,this.storeService=i,this.toastService=o,this.translate=s,this.moneyService=r,this.settingService=a,this.loadingFlag=new h.E,this.products=[],this.totalCost=0,this.saveLoading=new h.E,this.maxDate=A(),this.minDate=A().subtract(100,"days"),this.alowEdit=!0,this.message="",this.billForm=this._fb.group({detail:this._fb.group({bill_code:[""],date:[A().format("YYYY-MM-DD"),n.kI.required],vendor:[""],transporter:[""],amounts_payed:[""],customer:[""]}),rows:this._fb.array([])}),this.rowsImplement=[""],this.dataUpload={path:"",name:"",base:"",file:null},this.listCustomer=[],this.numberFormatPayed=new T.y("")}ngOnInit(){this.storeService.getStore()?this.products=this.storeService.getStore():this.storeService.getApiStore("get").subscribe(t=>{1==t.status&&(this.storeService.setStore(t.data.list),this.products=this.storeService.getStore())}),this.billForm.controls.detail.get("customer").valueChanges.pipe((0,f.b)(300),(0,q.x)()).subscribe(t=>{this.getListCustomer()}),this.getImportBill(this.bill),this.fcode=this.storeService.getFarmCode(),this.moneyService.setCode(this.fcode.toString()),this.rows.valueChanges.subscribe(()=>{this.rows.invalid||(this.totalCost=0,this.rows.value.forEach(t=>{this.totalCost+=t.price*t.quantity}))}),this.getBill()}getListCustomer(){this.listCustomer=[],this.moneyService.searchCustomer(this.billForm.value.detail.customer,"").subscribe(t=>{1==t.status&&(this.listCustomer=t.data.filter(t=>t.customer_name!=this.billForm.value.detail.customer),console.log(this.listCustomer))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}setCustomerName(t){this.billForm.controls.detail.patchValue({customer:t})}setAmountPayed(){this.numberFormatPayed.setValue(this.totalCost)}get rows(){return this.billForm.get("rows")}getImportBill(t){this.loadingFlag.setPending(!0),this.storeService.getApiStore("import-bills",`&id=${t.id}`).subscribe(t=>{if(0!==t.status&&t.data){const e=t.data.import_bills;this.setBillDetail(t.data.bill),this.buildRow(e)}else this.toastService.warning(t.error);this.loadingFlag.setResult(!0)},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loadingFlag.setResult(!1)})}setBillDetail(t){this.billForm.controls.detail.patchValue({date:t.date,bill_code:t.bill_code,vendor:t.vendor,transporter:t.vendor}),t.image&&(this.dataUpload.path=_.bl.FILE_PATH+"/upload/"+t.image),("0000-00-00"==t.date||A().diff(A(t.date),"days")>3)&&(this.alowEdit=!1,this.message=this.translate.instant("WAREHOUSE_MOD.MAX_3_DAY"))}addRow(){if(this.rows.length>=5)return!1;let t=this._fb.group({id:["",n.kI.required],date:[""],pack:[1],quantity:["",[n.kI.required,n.kI.min(0)]],price:["",[n.kI.required,n.kI.min(0)]]});this.rows.push(t)}buildRow(t){t.forEach(t=>{let e=this._fb.group({id:[t.id,n.kI.required],date:[t.date],pack:[1],quantity:[t.quantity,[n.kI.required,n.kI.min(0)]],price:[t.price,[n.kI.required,n.kI.min(0)]]});this.rows.push(e)})}removeRow(t){this.rows.removeAt(t),this.rowsImplement.splice(t,1)}submit(){if(this.saveLoading.setPending(!0),this.billForm.valid){let t={bill_code:this.billForm.value.detail.bill_code,date:A(this.billForm.value.detail.date).valueOf()/1e3,vendor:this.billForm.value.detail.vendor,transporter:this.billForm.value.detail.transporter,customer:this.billForm.value.detail.customer,amounts_payed:this.numberFormatPayed.realValue,is_debt:this.settingService.showDebt?1:0},e=new FormData;for(let i in t)e.append(i,t[i]);this.dataUpload.file&&e.append("image",this.dataUpload.file),this.billForm.value.rows.forEach(function(t,i){e.append("row["+i+"][id]",t.id),e.append("row["+i+"][pack]",t.pack),e.append("row["+i+"][price]",t.price),e.append("row["+i+"][quantity]",t.quantity)}),this.storeService.sendPostWithFile("import-bills-edit",e,`&id=${this.bill.id}`).subscribe(e=>{e.error||"1"!=e.status?this.toastService.warning(e.error):(this.toastService.success(e.message),this.modalCtrl.dismiss({tongtien:this.totalCost,date:t.date}))},t=>{this.toastService.danger(this.translate.instant("WAREHOUSE_MOD.ERROR_HANDLE"))})}}productChange(t,e){let i=this.products[this.products.findIndex(e=>e.product_id==t.target.value)];this.rowsImplement[e]=i.unit}getBill(){return(0,a.mG)(this,void 0,void 0,function*(){const t=yield this.moneyService.getBillByAlias("store_import_"+this.bill.id,"out").toPromise();t&&1==+t.status&&(this.numberFormatPayed.setValue(t.data.amounts_payed),this.billForm.controls.detail.patchValue({amounts_payed:this.numberFormatPayed.fakeView,customer:t.data.customer_name}),t.data.image&&(this.dataUpload.path=_.bl.FILE_PATH+"/upload/"+t.data.image))})}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(r.IN),d.Y36(n.qu),d.Y36(c.d),d.Y36(x.k),d.Y36(g.sK),d.Y36(b.r),d.Y36(v.R))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-store-bill-edit"]],inputs:{bill:"bill"},decls:36,vars:28,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],["color","primary",3,"disabled","click"],[3,"formGroup"],[3,"data","toUpload"],["class","ion-text-center ion-padding",4,"ngIf"],["class","spiner-loading",4,"ngIf"],["formGroupName","detail"],["formControlName","date",3,"displayFormat","min","max"],["lines","inset",4,"ngIf"],["lines","none",4,"ngIf"],["formGroupName","rows"],["class","align-items-center",3,"formGroupName",4,"ngFor","ngForOf"],[1,"ion-text-center"],["shape","round","fill","outline","size","small","color","primary",3,"disabled","click"],["name","add","slot","start"],[1,"ion-text-center","ion-padding"],["color","danger"],[1,"spiner-loading"],["name","dots"],["lines","inset"],["position","floating"],["formControlName","amounts_payed","type","tel","inputmode","numeric",3,"value","ionFocus","ionChange"],["formControlName","customer"],["lines","none"],[4,"ngFor","ngForOf"],["slot","end",3,"click"],[1,"align-items-center",3,"formGroupName"],["size","2"],["fill","clear","color","medium",3,"click"],["name","remove-circle-outline","slot","icon-only"],["size","10"],["formControlName","id",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["size","5","offset","2"],[4,"ngIf"],["type","tel","inputmode","decimal","formControlName","quantity"],["size","5"],["type","tel","inputmode","decimal","formControlName","price"],["size","10","offset","2"],["position","stacked"],[3,"value"]],template:function(t,e){1&t&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-buttons",0),d.TgZ(3,"ion-button",1),d.NdJ("click",function(){return e.modalCtrl.dismiss()}),d._UZ(4,"ion-icon",2),d.qZA(),d.qZA(),d.TgZ(5,"ion-title"),d._uU(6),d.ALo(7,"translate"),d.qZA(),d.TgZ(8,"ion-buttons",3),d.TgZ(9,"ion-button",4),d.NdJ("click",function(){return e.submit()}),d._uU(10),d.ALo(11,"translate"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(12,"ion-content",5),d.TgZ(13,"app-image-picker",6),d.NdJ("toUpload",function(t){return e.dataUpload=t}),d.qZA(),d.YNc(14,S,3,1,"div",7),d.YNc(15,E,2,0,"div",8),d.TgZ(16,"ion-grid"),d.TgZ(17,"div",9),d.TgZ(18,"ion-item"),d.TgZ(19,"ion-label"),d._uU(20),d.ALo(21,"translate"),d.qZA(),d._UZ(22,"ion-datetime",10),d.ALo(23,"translate"),d.qZA(),d.YNc(24,U,10,14,"ion-item",11),d.YNc(25,w,3,0,"ion-item",11),d.YNc(26,y,5,3,"ion-item",11),d.qZA(),d.YNc(27,C,2,1,"ion-list",12),d.TgZ(28,"div",13),d.YNc(29,R,34,20,"ion-row",14),d.TgZ(30,"ion-row"),d.TgZ(31,"ion-col",15),d.TgZ(32,"ion-button",16),d.NdJ("click",function(){return e.addRow()}),d._UZ(33,"ion-icon",17),d._uU(34),d.ALo(35,"translate"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&t&&(d.xp6(6),d.Oqu(d.lcZ(7,18,"WAREHOUSE_MOD.EDIT_BILL")),d.xp6(3),d.Q6J("disabled",e.billForm.invalid||!e.alowEdit||e.saveLoading.pending||e.totalCost<e.numberFormatPayed.realValue),d.xp6(1),d.hij(" ",d.lcZ(11,20,"WAREHOUSE_MOD.SAVE")," "),d.xp6(2),d.Q6J("formGroup",e.billForm),d.xp6(1),d.Q6J("data",e.dataUpload),d.xp6(1),d.Q6J("ngIf",e.message),d.xp6(1),d.Q6J("ngIf",e.loadingFlag.pending),d.xp6(5),d.Oqu(d.lcZ(21,22,"WAREHOUSE_MOD.DATE_ADDED")),d.xp6(2),d.Q6J("displayFormat",d.lcZ(23,24,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD")),d.xp6(2),d.Q6J("ngIf",e.settingService.showDebt),d.xp6(1),d.Q6J("ngIf",e.totalCost<e.numberFormatPayed.realValue&&e.settingService.showDebt),d.xp6(1),d.Q6J("ngIf",e.settingService.showDebt),d.xp6(1),d.Q6J("ngIf",e.settingService.showDebt),d.xp6(2),d.Q6J("ngForOf",e.rows.controls),d.xp6(3),d.Q6J("disabled",e.rows.length>=5),d.xp6(2),d.hij(" ",d.lcZ(35,26,"WAREHOUSE_MOD.ADD_ROW")," "))},directives:[r.Gu,r.sr,r.Sm,r.YG,r.gu,r.wd,r.W2,n.JL,n.sg,O.k,o.O5,r.jY,n.x0,r.Ie,r.Q$,r.x4,r.QI,n.JJ,n.u,o.sg,r.Nd,r.wI,r.yW,r.PQ,r.pK,r.j9,r.q_,r.t9,r.n0],pipes:[g.X$,o.JJ],styles:[""]}),t})();function M(t,e){1&t&&(d.TgZ(0,"div",6),d._UZ(1,"ion-spinner",7),d.qZA())}function L(t,e){if(1&t&&d._UZ(0,"img",8),2&t){const t=d.oxw();d.Q6J("src",t.billDetail.image,d.LSH)}}function J(t,e){if(1&t&&(d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label"),d.TgZ(2,"p"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"h3"),d._uU(6),d.qZA(),d.qZA(),d.qZA()),2&t){const t=d.oxw(2);d.xp6(3),d.Oqu(d.lcZ(4,2,"WAREHOUSE_MOD.VENDOR")),d.xp6(3),d.Oqu(t.billDetail.vendor)}}function P(t,e){if(1&t&&(d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label"),d.TgZ(2,"p"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"h3"),d._uU(6),d.qZA(),d.qZA(),d.qZA()),2&t){const t=d.oxw(2);d.xp6(3),d.Oqu(d.lcZ(4,2,"WAREHOUSE_MOD.SHIP_BY")),d.xp6(3),d.Oqu(t.billDetail.trasporter)}}function k(t,e){if(1&t&&(d.TgZ(0,"ion-list"),d.TgZ(1,"ion-list-header"),d.TgZ(2,"ion-label"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA(),d.TgZ(5,"ion-item"),d.TgZ(6,"ion-label"),d.TgZ(7,"p"),d._uU(8),d.ALo(9,"translate"),d.qZA(),d.TgZ(10,"h3"),d._uU(11),d.qZA(),d.qZA(),d.qZA(),d.TgZ(12,"ion-item"),d.TgZ(13,"ion-label"),d.TgZ(14,"p"),d._uU(15),d.ALo(16,"translate"),d.qZA(),d.TgZ(17,"h3"),d._uU(18),d.ALo(19,"date"),d.ALo(20,"translate"),d.qZA(),d.qZA(),d.qZA(),d.YNc(21,J,7,4,"ion-item",5),d.YNc(22,P,7,4,"ion-item",5),d.TgZ(23,"ion-item"),d.TgZ(24,"ion-label"),d.TgZ(25,"p"),d._uU(26),d.ALo(27,"translate"),d.qZA(),d.TgZ(28,"h3"),d._uU(29),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&t){const t=d.oxw();d.xp6(3),d.Oqu(d.lcZ(4,9,"WAREHOUSE_MOD.INFOR")),d.xp6(5),d.Oqu(d.lcZ(9,11,"WAREHOUSE_MOD.CODE")),d.xp6(3),d.Oqu(t.billDetail.code),d.xp6(4),d.Oqu(d.lcZ(16,13,"WAREHOUSE_MOD.DATE")),d.xp6(3),d.Oqu(d.xi3(19,15,t.billDetail.date,d.lcZ(20,18,"FORMAT_DATE"))),d.xp6(3),d.Q6J("ngIf",t.billDetail.vendor),d.xp6(1),d.Q6J("ngIf",t.billDetail.trasporter),d.xp6(4),d.Oqu(d.lcZ(27,20,"WAREHOUSE_MOD.TIME_RECORD")),d.xp6(3),d.Oqu(t.billDetail.moment.fromNow())}}function H(t,e){if(1&t&&(d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label"),d.TgZ(2,"h3"),d._uU(3),d.qZA(),d.TgZ(4,"p"),d._uU(5),d.ALo(6,"number"),d.qZA(),d.qZA(),d.TgZ(7,"span",10),d._uU(8),d.ALo(9,"number"),d.qZA(),d.qZA()),2&t){const t=e.$implicit;d.xp6(3),d.Oqu(null==t?null:t.name),d.xp6(2),d.lnq("",d.xi3(6,5,t.price,"1.0-0")," \u0111 x ",t.quantity," ",t.unit,""),d.xp6(3),d.Oqu(d.xi3(9,8,t.price*t.quantity,"1.0-0"))}}function W(t,e){if(1&t&&(d.TgZ(0,"ion-list"),d.TgZ(1,"ion-list-header"),d.TgZ(2,"ion-label"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA(),d.YNc(5,H,10,11,"ion-item",9),d.TgZ(6,"ion-item"),d.TgZ(7,"ion-label"),d._uU(8),d.ALo(9,"translate"),d.qZA(),d.TgZ(10,"span",10),d._uU(11),d.ALo(12,"number"),d.qZA(),d.qZA(),d.TgZ(13,"ion-item"),d.TgZ(14,"ion-label"),d._uU(15),d.ALo(16,"translate"),d.qZA(),d.TgZ(17,"span",10),d._uU(18),d.ALo(19,"number"),d.qZA(),d.qZA(),d.qZA()),2&t){const t=d.oxw();d.xp6(3),d.Oqu(d.lcZ(4,6,"WAREHOUSE_MOD.DETAIL")),d.xp6(2),d.Q6J("ngForOf",t.rows),d.xp6(3),d.Oqu(d.lcZ(9,8,"WAREHOUSE_MOD.TOTAL")),d.xp6(3),d.Oqu(d.xi3(12,10,t.total,"1.0-0")),d.xp6(4),d.Oqu(d.lcZ(16,13,"MONEY_MOD.PAYED")),d.xp6(3),d.Oqu(d.xi3(19,15,t.total_payed,"1.0-0"))}}let Q=(()=>{class t{constructor(t,e,i,o){this.modalCtrl=t,this.storeService=e,this.translate=i,this.moneyService=o,this.loadingFlag=new h.E,this.products=[],this.message="",this.rows=[],this.total=0,this.total_payed=0}ngOnInit(){this.storeService.getStore()?this.products=this.storeService.getStore():this.storeService.getApiStore("productAllForWeb").subscribe(t=>{1==t.status&&(this.storeService.setStore(t.data.products),this.products=this.storeService.getStore())}),this.getBill(),this.getImportBill(this.bill)}getImportBill(t){this.loadingFlag.setPending(!0),this.storeService.getApiStore("import-bills",`&id=${t.id}`).subscribe(t=>{0!==t.status&&t.data?(this.prepareRows(t.data.import_bills),this.billDetail=t.data.bill,this.billDetail.dateFormat=A(t.data.bill.date),this.billDetail.moment=A(1e3*t.data.bill.add_time),t.data.bill.image&&(this.billDetail.image=_.bl.FILE_PATH+"/upload/"+t.data.bill.image)):this.message=t.error,this.loadingFlag.setResult(!0)},t=>{this.message=this.translate.instant("ERROR_CONNECT"),this.loadingFlag.setResult(!1)})}prepareRows(t){t.forEach(t=>{this.total=this.total+t.quantity*t.price;let e=this.products.findIndex(e=>e.id==t.id),i=t;i.name=e>=0?this.products[e].name:"\u0110\xe3 x\xf3a",i.unit=e>=0?this.products[e].unit:"",this.rows.push(i)})}getBill(){return(0,a.mG)(this,void 0,void 0,function*(){const t=yield this.moneyService.getBillByAlias("store_import_"+this.bill.id,"out").toPromise();t&&1==+t.status&&(this.total_payed=t.data.amounts_payed)})}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(r.IN),d.Y36(c.d),d.Y36(g.sK),d.Y36(b.r))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-store-bill-detail"]],inputs:{bill:"bill"},decls:13,vars:7,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["class","spiner-loading",4,"ngIf"],[3,"src",4,"ngIf"],[4,"ngIf"],[1,"spiner-loading"],["name","dots"],[3,"src"],[4,"ngFor","ngForOf"],["slot","end"]],template:function(t,e){1&t&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-buttons",0),d.TgZ(3,"ion-button",1),d.NdJ("click",function(){return e.modalCtrl.dismiss()}),d._UZ(4,"ion-icon",2),d.qZA(),d.qZA(),d.TgZ(5,"ion-title"),d._uU(6),d.ALo(7,"translate"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(8,"ion-content"),d.YNc(9,M,2,0,"div",3),d.YNc(10,L,1,1,"img",4),d.YNc(11,k,30,22,"ion-list",5),d.YNc(12,W,20,18,"ion-list",5),d.qZA()),2&t&&(d.xp6(6),d.Oqu(d.lcZ(7,5,"WAREHOUSE_MOD.BILL_IMPORT")),d.xp6(3),d.Q6J("ngIf",e.loadingFlag.pending),d.xp6(1),d.Q6J("ngIf",e.billDetail.image),d.xp6(1),d.Q6J("ngIf",e.loadingFlag.result),d.xp6(1),d.Q6J("ngIf",e.loadingFlag.result))},directives:[r.Gu,r.sr,r.Sm,r.YG,r.gu,r.wd,r.W2,o.O5,r.PQ,r.q_,r.yh,r.Q$,r.Ie,o.sg],pipes:[g.X$,o.uU,o.JJ],styles:[""]}),t})();function B(t,e){1&t&&(d.TgZ(0,"div",6),d._UZ(1,"ion-spinner",7),d.qZA())}function G(t,e){if(1&t&&(d.TgZ(0,"ion-item"),d.TgZ(1,"ion-text"),d._uU(2),d.qZA(),d.TgZ(3,"ion-text",15),d._uU(4),d.qZA(),d.qZA()),2&t){const t=e.$implicit;d.xp6(2),d.Oqu(t.name),d.xp6(2),d.AsE("",t.quantity," ",t.unit,"")}}function $(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"ion-card",8),d.NdJ("click",function(){const e=d.CHM(t),i=e.$implicit,o=e.index;return d.oxw(2).presentMenu(i,o)}),d.TgZ(1,"ion-card-content"),d.TgZ(2,"ion-list",9),d.TgZ(3,"ion-item"),d.TgZ(4,"ion-label",10),d.TgZ(5,"ion-text",11),d.TgZ(6,"h3"),d._uU(7),d.ALo(8,"date"),d.ALo(9,"translate"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(10,"ion-text",12),d._uU(11),d.ALo(12,"number"),d.qZA(),d._UZ(13,"ion-icon",13),d.qZA(),d.YNc(14,G,5,3,"ion-item",14),d.qZA(),d.qZA(),d.qZA()}if(2&t){const t=e.$implicit;d.xp6(7),d.Oqu(d.xi3(8,3,t.date,d.lcZ(9,6,"FORMAT_DATE"))),d.xp6(4),d.hij("",d.xi3(12,8,t.tongtien,"1.0-0")," \u0111"),d.xp6(3),d.Q6J("ngForOf",t.listProduct)}}function j(t,e){1&t&&(d.TgZ(0,"ion-list",16),d.TgZ(1,"ion-item"),d.TgZ(2,"ion-label"),d.TgZ(3,"p"),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&t&&(d.xp6(4),d.Oqu(d.lcZ(5,1,"WAREHOUSE_MOD.NO_HISTORY")))}function V(t,e){if(1&t&&(d.TgZ(0,"ion-content"),d.YNc(1,B,2,0,"div",3),d.YNc(2,$,15,11,"ion-card",4),d.YNc(3,j,6,3,"ion-list",5),d.qZA()),2&t){const t=d.oxw();d.xp6(1),d.Q6J("ngIf",t.loadingFlag.pending),d.xp6(1),d.Q6J("ngForOf",t.bills),d.xp6(1),d.Q6J("ngIf",0==t.bills.length&&t.loadingFlag.result)}}let z=(()=>{class t{constructor(t,e,i,o,n,s){this.modalCtrl=t,this.actionSheetController=e,this.toastService=i,this.storeService=o,this.alertController=n,this.translate=s,this.loadingFlag=new h.E,this.bills=[],this.view=!1}ngOnInit(){this.getStoreBill()}ionViewDidEnter(){this.view=!0}getStoreBill(){this.loadingFlag.setPending(!0),this.storeService.getApiStore("bill-list").pipe((0,Z.P)()).subscribe(t=>{0===t.status?this.toastService.warning(t.error):(this.bills=[],t.data.forEach(t=>{let e=t;e.listProduct=[],e.products.split(",").forEach(t=>{e.listProduct.push({name:t.split("-")[0],quantity:t.split("-")[1],unit:t.split("-")[2]})}),this.bills.push(e)}),console.log(this.bills)),this.loadingFlag.setResult(!0)},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loadingFlag.setResult(!1)})}presentMenu(t,e){return(0,a.mG)(this,void 0,void 0,function*(){yield(yield this.actionSheetController.create({header:this.translate.instant("WAREHOUSE_MOD.MENU"),buttons:[{text:this.translate.instant("WAREHOUSE_MOD.DELETE"),role:"destructive",icon:"trash",handler:()=>{this.presentDeleteConfirm(t,e)}},{text:this.translate.instant("WAREHOUSE_MOD.EDIT"),icon:"create",handler:()=>{this.presentBillEdit(t,e)}},{text:this.translate.instant("WAREHOUSE_MOD.DETAIL"),icon:"reader",handler:()=>{this.presentBillDetail(t)}},{text:this.translate.instant("WAREHOUSE_MOD.NO"),icon:"close",role:"cancel"}]})).present()})}presentBillDetail(t){return(0,a.mG)(this,void 0,void 0,function*(){return yield(yield this.modalCtrl.create({component:Q,componentProps:{bill:t}})).present()})}presentBillEdit(t,e){return(0,a.mG)(this,void 0,void 0,function*(){const i=yield this.modalCtrl.create({component:Y,componentProps:{bill:t}});return i.onDidDismiss().then(t=>{t.data&&(this.bills[e].date=A(1e3*t.data.date).format("YYYY-MM-DD"),this.bills[e].tongtien=t.data.tongtien)}),yield i.present()})}presentDeleteConfirm(t,e){return(0,a.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("WAREHOUSE_MOD.CONFIRM"),message:this.translate.instant("WAREHOUSE_MOD.DELETE_IMPORT")+" <strong>"+t.date+"</strong> "+this.translate.instant("WAREHOUSE_MOD.VAL")+" "+t.tongtien+"?",buttons:[{text:this.translate.instant("WAREHOUSE_MOD.NO"),role:"cancel",cssClass:"secondary"},{text:this.translate.instant("WAREHOUSE_MOD.DELETE"),handler:()=>{this.storeService.getApiStore("delete-import",`&id=${t.id}`).subscribe(t=>{1==t.status?(this.bills.splice(e,1),this.toastService.success(this.translate.instant("DEVICE_MOD.REMOVE_DATA_SUCCESS"))):this.toastService.success(t.error)},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}}]})).present()})}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(r.IN),d.Y36(r.BX),d.Y36(x.k),d.Y36(c.d),d.Y36(r.Br),d.Y36(g.sK))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-store-imported"]],decls:8,vars:4,consts:[["slot","start"],["text","","defaultHref","tabs/management"],[4,"ngIf"],["class","spiner-loading",4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],["lines","none","lines","none",4,"ngIf"],[1,"spiner-loading"],["name","dots"],[3,"click"],["lines","none"],[1,"ion-text-wrap"],["color","primary"],["slot","end","color","success"],["name","chevron-forward-outline","slot","end",1,"icon-detail"],[4,"ngFor","ngForOf"],["slot","end"],["lines","none","lines","none"]],template:function(t,e){1&t&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-buttons",0),d._UZ(3,"ion-back-button",1),d.qZA(),d.TgZ(4,"ion-title"),d._uU(5),d.ALo(6,"translate"),d.qZA(),d.qZA(),d.qZA(),d.YNc(7,V,4,3,"ion-content",2)),2&t&&(d.xp6(5),d.Oqu(d.lcZ(6,2,"WAREHOUSE_MOD.IMPORTED")),d.xp6(2),d.Q6J("ngIf",e.view))},directives:[r.Gu,r.sr,r.Sm,r.oU,r.cs,r.wd,o.O5,r.W2,o.sg,r.PQ,r.PM,r.FN,r.q_,r.Ie,r.Q$,r.yW,r.gu],pipes:[g.X$,o.uU,o.JJ],styles:[""]}),t})();var X=i(13819);function K(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"ion-item",16),d.TgZ(1,"ion-label",17),d._uU(2),d.ALo(3,"translate"),d.TgZ(4,"ion-text",18),d._uU(5),d.ALo(6,"translate"),d.ALo(7,"number"),d.ALo(8,"translate"),d.qZA(),d.qZA(),d.TgZ(9,"ion-input",19),d.NdJ("ionFocus",function(){return d.CHM(t),d.oxw().setAmountPayed()})("ionChange",function(e){return d.CHM(t),d.oxw().numberFormatPayed.setValue(e.detail.value)}),d.qZA(),d.qZA()}if(2&t){const t=d.oxw();d.xp6(2),d.Oqu(d.lcZ(3,5,"MONEY_MOD.PAYED")),d.xp6(3),d.lnq("(",d.lcZ(6,7,"WAREHOUSE_MOD.TOTAL_COST")," ",d.xi3(7,9,t.totalCost,"1.0-1"),"",d.lcZ(8,12,"CURRENCY_S"),")"),d.xp6(4),d.Q6J("value",t.numberFormatPayed.fakeView)}}function tt(t,e){1&t&&(d.TgZ(0,"ion-item",16),d.TgZ(1,"ion-text",18),d._uU(2," Chi ph\xed \u0111\xe3 tr\u1ea3 lu\xf4n nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng chi ph\xed "),d.qZA(),d.qZA())}function et(t,e){1&t&&(d.TgZ(0,"ion-item",16),d.TgZ(1,"ion-label",17),d._uU(2),d.ALo(3,"translate"),d.qZA(),d._UZ(4,"ion-input",20),d.qZA()),2&t&&(d.xp6(2),d.Oqu(d.lcZ(3,1,"MONEY_MOD.CUSTOMER")))}function it(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"ion-item"),d.TgZ(1,"ion-text"),d._uU(2),d.qZA(),d.TgZ(3,"ion-button",23),d.NdJ("click",function(){const e=d.CHM(t).$implicit;return d.oxw(2).setCustomerName(e.customer_name)}),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.qZA()}if(2&t){const t=e.$implicit;d.xp6(2),d.hij(" ",t.customer_name," "),d.xp6(2),d.hij(" ",d.lcZ(5,2,"SELECT")," ")}}function ot(t,e){if(1&t&&(d.TgZ(0,"ion-list",21),d.YNc(1,it,6,4,"ion-item",22),d.qZA()),2&t){const t=d.oxw();d.xp6(1),d.Q6J("ngForOf",t.listCustomer)}}function nt(t,e){if(1&t&&(d.TgZ(0,"ion-select-option",38),d._uU(1),d.qZA()),2&t){const t=e.$implicit;d.Q6J("value",t.product_id),d.xp6(1),d.AsE("",t.name," - ",t.manufacturer_name,"")}}function st(t,e){if(1&t&&(d.TgZ(0,"small"),d._uU(1),d.qZA()),2&t){const t=d.oxw().index,e=d.oxw();d.xp6(1),d.hij("(",e.rowsImplement[t],")")}}function rt(t,e){if(1&t&&(d.TgZ(0,"small"),d._uU(1),d.qZA()),2&t){const t=d.oxw().index,e=d.oxw();d.xp6(1),d.hij("/",e.rowsImplement[t],"")}}function at(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"ion-row",24),d.TgZ(1,"ion-col",25),d.TgZ(2,"ion-button",26),d.NdJ("click",function(){const e=d.CHM(t).index;return d.oxw().removeRow(e)}),d._UZ(3,"ion-icon",27),d.qZA(),d.qZA(),d.TgZ(4,"ion-col",28),d.TgZ(5,"ion-item"),d.TgZ(6,"ion-label",17),d._uU(7),d.ALo(8,"translate"),d.qZA(),d.TgZ(9,"ion-select",29),d.NdJ("ionChange",function(e){const i=d.CHM(t).index;return d.oxw().productChange(e,i)}),d.YNc(10,nt,2,3,"ion-select-option",30),d.qZA(),d.qZA(),d.qZA(),d.TgZ(11,"ion-col",31),d.TgZ(12,"ion-item"),d.TgZ(13,"ion-label",17),d._uU(14),d.ALo(15,"translate"),d.YNc(16,st,2,1,"small",32),d.qZA(),d._UZ(17,"ion-input",33),d.qZA(),d.qZA(),d.TgZ(18,"ion-col",34),d.TgZ(19,"ion-item"),d.TgZ(20,"ion-label",17),d._uU(21),d.ALo(22,"translate"),d.YNc(23,rt,2,1,"small",32),d.qZA(),d._UZ(24,"ion-input",35),d.qZA(),d.qZA(),d.TgZ(25,"ion-col",36),d.TgZ(26,"ion-item"),d.TgZ(27,"ion-label",37),d._uU(28),d.ALo(29,"translate"),d.qZA(),d.TgZ(30,"span"),d.TgZ(31,"ion-text",18),d._uU(32),d.ALo(33,"number"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA()}if(2&t){const t=e.$implicit,i=e.index,o=d.oxw();d.s9C("formGroupName",i),d.xp6(7),d.Oqu(d.lcZ(8,9,"WAREHOUSE_MOD.PRODUCT")),d.xp6(3),d.Q6J("ngForOf",o.products),d.xp6(4),d.hij("",d.lcZ(15,11,"WAREHOUSE_MOD.QUANTITY")," "),d.xp6(2),d.Q6J("ngIf",o.rowsImplement[i]),d.xp6(5),d.hij("",d.lcZ(22,13,"WAREHOUSE_MOD.PRICE")," "),d.xp6(2),d.Q6J("ngIf",o.rowsImplement[i]),d.xp6(5),d.Oqu(d.lcZ(29,15,"WAREHOUSE_MOD.VALUE")),d.xp6(4),d.Oqu(d.xi3(33,17,o.calculatorCost(t.value.quantity,t.value.price),"1.0-0"))}}let lt=(()=>{class t{constructor(t,e,i,o,s,r,a){this.modalController=t,this.storeService=e,this._fb=i,this.toastService=o,this.translate=s,this.moneyService=r,this.settingService=a,this.products=[],this.totalCost=0,this.saveLoading=new h.E,this.maxDate=A(),this.minDate=A().subtract(5,"days"),this.billForm=this._fb.group({detail:this._fb.group({bill_code:[""],date:[A().format("YYYY-MM-DD"),n.kI.required],vendor:[""],transporter:[""],amounts_payed:[""],customer:[""]}),rows:this._fb.array([this._fb.group({id:["",n.kI.required],date:[""],pack:[1],quantity:["",[n.kI.required,n.kI.min(0)]],price:["",[n.kI.required,n.kI.min(0)]]})])}),this.rowsImplement=[""],this.dataUpload={path:"",name:"",base:"",file:null},this.listCustomer=[],this.numberFormatPayed=new T.y("")}ngOnInit(){this.storeService.getStore()?this.products=this.storeService.getStore():this.storeService.getApiStore("productAllForWeb").subscribe(t=>{1==t.status&&(this.storeService.setStore(t.data.products),this.products=this.storeService.getStore())}),this.billForm.controls.detail.get("customer").valueChanges.pipe((0,f.b)(300),(0,q.x)()).subscribe(t=>{this.getListCustomer()}),this.fcode=this.storeService.getFarmCode(),this.moneyService.setCode(this.fcode.toString()),this.rows.valueChanges.subscribe(()=>{this.rows.invalid||(this.totalCost=0,this.rows.value.forEach(t=>{this.totalCost+=this.calculatorCost(t.quantity,t.price)}),this.numberFormatPayed.setValue(this.totalCost))})}getListCustomer(){this.listCustomer=[],this.moneyService.searchCustomer(this.billForm.value.detail.customer,"").subscribe(t=>{1==t.status&&(this.listCustomer=t.data.filter(t=>t.customer_name!=this.billForm.value.detail.customer),console.log(this.listCustomer))},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT"))})}setCustomerName(t){this.billForm.controls.detail.patchValue({customer:t})}setAmountPayed(){this.numberFormatPayed.setValue(this.totalCost)}get rows(){return this.billForm.get("rows")}buildRow(){let t=this._fb.group({id:["",n.kI.required],date:[""],pack:[1],quantity:["",[n.kI.required,n.kI.min(0)]],price:["",[n.kI.required,n.kI.min(0)]]});this.rows.push(t)}removeRow(t){this.rows.removeAt(t),this.rowsImplement.splice(t,1)}submitImportProduct(){this.saveLoading.setPending(!0),console.log(A(this.billForm.value.detail.date));let t={bill_code:this.billForm.value.detail.bill_code,date:A(this.billForm.value.detail.date).valueOf()/1e3,vendor:this.billForm.value.detail.vendor,transporter:this.billForm.value.detail.transporter,customer:this.billForm.value.detail.customer,amounts_payed:this.numberFormatPayed.realValue,is_debt:this.settingService.showDebt?1:0},e=new FormData;for(let i in t)e.append(i,t[i]);this.dataUpload.file&&e.append("image",this.dataUpload.file),this.billForm.valid&&(Object.assign(t,{row:this.billForm.value.rows}),this.billForm.value.rows.forEach(function(t,i){e.append("row["+i+"][id]",t.id),e.append("row["+i+"][pack]",t.pack),e.append("row["+i+"][price]",t.price),e.append("row["+i+"][quantity]",t.quantity)}),this.storeService.sendPostWithFile("import",e).pipe((0,Z.P)()).subscribe(t=>{t.error||"1"!=t.status?this.toastService.warning(t.error):(this.toastService.success(t.message),this.modalController.dismiss(!0)),this.saveLoading.setResult(!0)},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.saveLoading.setResult(!1)}))}productChange(t,e){let i=this.products[this.products.findIndex(e=>e.product_id==t.target.value)];this.rowsImplement[e]=null==i?void 0:i.unit}calculatorCost(t,e){return t=t.toString().replace(",","."),parseFloat(t)*parseInt(e)}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(r.IN),d.Y36(c.d),d.Y36(n.qu),d.Y36(x.k),d.Y36(g.sK),d.Y36(b.r),d.Y36(v.R))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-store-import"]],decls:34,vars:26,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","close"],["slot","end"],[3,"disabled","click"],[3,"formGroup"],[3,"data","toUpload"],["formGroupName","detail"],["formControlName","date",3,"displayFormat","min","max"],["lines","inset",4,"ngIf"],["lines","none",4,"ngIf"],["formGroupName","rows"],["class","align-items-center",3,"formGroupName",4,"ngFor","ngForOf"],[1,"ion-text-center"],["shape","round","fill","outline","size","small","color","primary",3,"disabled","click"],["name","add","slot","start"],["lines","inset"],["position","floating"],["color","danger"],["formControlName","amounts_payed","type","tel","inputmode","numeric",3,"value","ionFocus","ionChange"],["formControlName","customer"],["lines","none"],[4,"ngFor","ngForOf"],["slot","end",3,"click"],[1,"align-items-center",3,"formGroupName"],["size","2"],["fill","clear","color","medium",3,"click"],["name","remove-circle-outline","slot","icon-only"],["size","10"],["formControlName","id",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["size","5","offset","2"],[4,"ngIf"],["type","tel","inputmode","decimal","formControlName","quantity"],["size","5"],["type","tel","inputmode","decimal","formControlName","price"],["size","10","offset","2"],["position","stacked"],[3,"value"]],template:function(t,e){1&t&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-buttons",0),d.TgZ(3,"ion-button",1),d.NdJ("click",function(){return e.modalController.dismiss()}),d._UZ(4,"ion-icon",2),d.qZA(),d.qZA(),d.TgZ(5,"ion-title"),d._uU(6),d.ALo(7,"translate"),d.qZA(),d.TgZ(8,"ion-buttons",3),d.TgZ(9,"ion-button",4),d.NdJ("click",function(){return e.submitImportProduct()}),d._uU(10),d.ALo(11,"translate"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(12,"ion-content",5),d.TgZ(13,"app-image-picker",6),d.NdJ("toUpload",function(t){return e.dataUpload=t}),d.qZA(),d.TgZ(14,"ion-grid"),d.TgZ(15,"div",7),d.TgZ(16,"ion-item"),d.TgZ(17,"ion-label"),d._uU(18),d.ALo(19,"translate"),d.qZA(),d._UZ(20,"ion-datetime",8),d.ALo(21,"translate"),d.qZA(),d.YNc(22,K,10,14,"ion-item",9),d.YNc(23,tt,3,0,"ion-item",9),d.YNc(24,et,5,3,"ion-item",9),d.qZA(),d.YNc(25,ot,2,1,"ion-list",10),d.TgZ(26,"div",11),d.YNc(27,at,34,20,"ion-row",12),d.TgZ(28,"ion-row"),d.TgZ(29,"ion-col",13),d.TgZ(30,"ion-button",14),d.NdJ("click",function(){return e.buildRow()}),d._UZ(31,"ion-icon",15),d._uU(32),d.ALo(33,"translate"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&t&&(d.xp6(6),d.Oqu(d.lcZ(7,16,"WAREHOUSE_MOD.IMPORT")),d.xp6(3),d.Q6J("disabled",e.billForm.invalid||e.saveLoading.pending||e.totalCost<e.numberFormatPayed.realValue),d.xp6(1),d.hij(" ",d.lcZ(11,18,"WAREHOUSE_MOD.SAVE")," "),d.xp6(2),d.Q6J("formGroup",e.billForm),d.xp6(1),d.Q6J("data",e.dataUpload),d.xp6(5),d.Oqu(d.lcZ(19,20,"WAREHOUSE_MOD.IMPORT_DATE")),d.xp6(2),d.Q6J("displayFormat",d.lcZ(21,22,"FORMAT_DATE_MOMENT"))("min",e.minDate.format("YYYY-MM-DD"))("max",e.maxDate.format("YYYY-MM-DD")),d.xp6(2),d.Q6J("ngIf",e.settingService.showDebt),d.xp6(1),d.Q6J("ngIf",e.totalCost<e.numberFormatPayed.realValue&&e.settingService.showDebt),d.xp6(1),d.Q6J("ngIf",e.settingService.showDebt),d.xp6(1),d.Q6J("ngIf",e.settingService.showDebt),d.xp6(2),d.Q6J("ngForOf",e.rows.controls),d.xp6(3),d.Q6J("disabled",e.rows.length>=5),d.xp6(2),d.hij(" ",d.lcZ(33,24,"WAREHOUSE_MOD.ADD_ROW")," "))},directives:[r.Gu,r.sr,r.Sm,r.YG,r.gu,r.wd,r.W2,n.JL,n.sg,O.k,r.jY,n.x0,r.Ie,r.Q$,r.x4,r.QI,n.JJ,n.u,o.O5,o.sg,r.Nd,r.wI,r.yW,r.pK,r.j9,r.q_,r.t9,r.n0],pipes:[g.X$,o.JJ],styles:[""]}),t})();var ct=i(93152),ut=i(23211),dt=i(71239),pt=i(63771),gt=i(18409);function mt(t,e){1&t&&(d.TgZ(0,"div",16),d._UZ(1,"ion-spinner",17),d.qZA())}function ht(t,e){if(1&t&&(d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label",22),d.TgZ(2,"p"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA(),d.TgZ(5,"span",2),d._uU(6),d.ALo(7,"countNumerPipe"),d.ALo(8,"translate"),d.ALo(9,"translate"),d.qZA(),d.qZA()),2&t){const t=d.oxw(2);d.xp6(3),d.Oqu(d.lcZ(4,3,"WAREHOUSE_MOD.TOTAL_COST")),d.xp6(3),d.AsE("",d.xi3(7,5,t.total_value,d.lcZ(8,8,"FORMAT_COUNTER_KMB"))," ",d.lcZ(9,10,"CURRENCY_S"),"")}}function Zt(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"ion-item",23),d.NdJ("click",function(){const e=d.CHM(t).$implicit;return d.oxw(2).presentDetail(e)}),d.TgZ(1,"ion-label",22),d.TgZ(2,"ion-text",24),d._uU(3),d.qZA(),d._uU(4),d.TgZ(5,"p"),d._uU(6),d.qZA(),d.qZA(),d.TgZ(7,"span",2),d._uU(8),d.ALo(9,"number"),d.qZA(),d.qZA()}if(2&t){const t=e.$implicit;d.xp6(3),d.hij("",t.name_prefix,"-"),d.xp6(1),d.hij("",t.name," "),d.xp6(2),d.Oqu(t.manufacturer_name),d.xp6(2),d.Oqu(d.xi3(9,4,t.quantity_current,"1.0-3"))}}function At(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"ion-item",23),d.NdJ("click",function(){const e=d.CHM(t).$implicit;return d.oxw(2).presentDetail(e)}),d.TgZ(1,"ion-label",22),d.TgZ(2,"ion-text",24),d._uU(3),d.qZA(),d._uU(4),d.TgZ(5,"p"),d._uU(6),d.qZA(),d.qZA(),d.TgZ(7,"span",2),d._uU(8),d.ALo(9,"number"),d.qZA(),d.qZA()}if(2&t){const t=e.$implicit;d.xp6(3),d.hij("",t.name_prefix,"-"),d.xp6(1),d.hij("",t.name," "),d.xp6(2),d.Oqu(t.manufacturer_name),d.xp6(2),d.Oqu(d.xi3(9,4,t.quantity_current,"1.0-3"))}}function ft(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"ion-item",23),d.NdJ("click",function(){const e=d.CHM(t).$implicit;return d.oxw(2).presentDetail(e)}),d.TgZ(1,"ion-label",22),d.TgZ(2,"ion-text",24),d._uU(3),d.qZA(),d._uU(4),d.TgZ(5,"p"),d._uU(6),d.qZA(),d.qZA(),d.TgZ(7,"span",2),d._uU(8),d.ALo(9,"number"),d.qZA(),d.qZA()}if(2&t){const t=e.$implicit;d.xp6(3),d.hij("",t.name_prefix,"-"),d.xp6(1),d.hij("",t.name," "),d.xp6(2),d.Oqu(t.manufacturer_name),d.xp6(2),d.Oqu(d.xi3(9,4,t.quantity_current,"1.0-3"))}}function qt(t,e){if(1&t&&(d.TgZ(0,"ion-list",18),d.YNc(1,ht,10,12,"ion-item",19),d.TgZ(2,"ion-item-group"),d.TgZ(3,"ion-list-header",20),d.TgZ(4,"ion-label"),d._uU(5),d.ALo(6,"translate"),d.qZA(),d.qZA(),d.YNc(7,Zt,10,7,"ion-item",21),d.ALo(8,"productTypeFilter"),d.qZA(),d.TgZ(9,"ion-item-group"),d.TgZ(10,"ion-list-header",20),d.TgZ(11,"ion-label"),d._uU(12),d.ALo(13,"translate"),d.qZA(),d.qZA(),d.YNc(14,At,10,7,"ion-item",21),d.ALo(15,"productTypeFilter"),d.qZA(),d.TgZ(16,"ion-item-group"),d.TgZ(17,"ion-list-header",20),d.TgZ(18,"ion-label"),d._uU(19),d.ALo(20,"translate"),d.qZA(),d.qZA(),d.YNc(21,ft,10,7,"ion-item",21),d.ALo(22,"productTypeFilter"),d.qZA(),d.qZA()),2&t){const t=d.oxw();d.xp6(1),d.Q6J("ngIf","company_manager"==(null==t.farmService?null:t.farmService.permission)),d.xp6(4),d.Oqu(d.lcZ(6,7,"WAREHOUSE_MOD.FEED")),d.xp6(2),d.Q6J("ngForOf",d.xi3(8,9,t.products,1)),d.xp6(5),d.Oqu(d.lcZ(13,12,"WAREHOUSE_MOD.FEED_SUPPLEMENT")),d.xp6(2),d.Q6J("ngForOf",d.xi3(15,14,t.products,2)),d.xp6(5),d.Oqu(d.lcZ(20,17,"WAREHOUSE_MOD.TREATMENT")),d.xp6(2),d.Q6J("ngForOf",d.xi3(22,19,t.products,3))}}function Tt(t,e){1&t&&(d.TgZ(0,"div",25),d.TgZ(1,"ion-card",18),d.TgZ(2,"ion-card-content",26),d.TgZ(3,"p",25),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&t&&(d.xp6(4),d.Oqu(d.lcZ(5,1,"WAREHOUSE_MOD.NO_PRODUCT")))}let bt=(()=>{class t{constructor(t,e,i,o,n,s,r,a){this.modalController=t,this.toastService=e,this.storeService=i,this.farmService=o,this.translate=n,this.tour=s,this.dbLocalService=r,this.route=a,this.loadingFlag=new h.E,this.total_value=0,this.products=[],this.reload=!0}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");this.storeService.setStoreCode(t),this.getStoreByApi(),this.storeIndexSeleted=this.dbLocalService.stores.findIndex(e=>e.infor.code==t)}presentDetail(t){return(0,a.mG)(this,void 0,void 0,function*(){const e=yield this.modalController.create({component:X.m,componentProps:{item:t,from:"store"}});return e.onDidDismiss().then(e=>{e.data&&e.data.delete&&(this.products.splice(this.findProductIndexById(t),1),this.reload=!1,setTimeout(()=>{this.reload=!0},30))}),yield e.present()})}findProductIndexById(t){return this.products.findIndex(e=>e.id==t.id)}getStoreByApi(){this.loadingFlag.setPending(!0),this.storeService.getApiStore("get").subscribe(t=>{if(1==t.status&&t.data){const e=t.data.list;this.products=e,this.total_value=this.getTotalCost(e),-1==this.storeIndexSeleted?this.dbLocalService.stores.push({infor:t.data.infor,store:this.products}):this.dbLocalService.stores[this.storeIndexSeleted]={infor:t.data.infor,store:this.products},this.dbLocalService.setLocalData("stores",this.dbLocalService.stores),this.storeService.setStore(this.products)}else this.toastService.warning(t.error);this.loadingFlag.setResult(!0)},t=>{this.toastService.danger(this.translate.instant("ERROR_CONNECT")),this.loadingFlag.setResult(!1)})}doRefresh(t){this.getStoreByApi(),t.target.complete()}getTotalCost(t){return t.reduce((t,e)=>t+e.quantity_current*e.price,0)}presentImport(){return(0,a.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:lt});return t.onDidDismiss().then(t=>{console.log(t),1==t.data&&this.getStoreByApi()}),yield t.present()})}presentSetting(){return(0,a.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:ct.T})).present()})}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(r.IN),d.Y36(x.k),d.Y36(c.d),d.Y36(l.D),d.Y36(g.sK),d.Y36(ut.M),d.Y36(dt.T),d.Y36(s.gz))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-store-inventory"]],decls:31,vars:12,consts:[["slot","start"],["text","","defaultHref","tabs/management"],["slot","end"],[3,"click"],["slot","icon-only","name","cog-outline"],["slot","fixed",3,"ionRefresh"],[1,"menu-icon-square","ion-text-center","ion-align-self-center"],["fill","outline","color","light","size","large",3,"click"],["color","primary","src","assets/icon/import.svg",1,"icon-large"],["routerLink","imported",1,"menu-icon-square","ion-text-center","ion-align-self-center"],["fill","outline","color","light","size","large"],["color","primary","name","time-outline",1,"icon-large"],["id","line"],["class","spiner-loading",4,"ngIf"],["mode","ios",4,"ngIf"],["class","ion-padding",4,"ngIf"],[1,"spiner-loading"],["name","dots"],["mode","ios"],[4,"ngIf"],["lines","inset"],["detail","",3,"click",4,"ngFor","ngForOf"],[1,"ion-text-wrap"],["detail","",3,"click"],["color","medium"],[1,"ion-padding"],[1,"ion-text-center"]],template:function(t,e){1&t&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-buttons",0),d._UZ(3,"ion-back-button",1),d.qZA(),d.TgZ(4,"ion-title"),d._uU(5),d.ALo(6,"translate"),d.qZA(),d.TgZ(7,"ion-buttons",2),d.TgZ(8,"ion-button",3),d.NdJ("click",function(){return e.presentSetting()}),d._UZ(9,"ion-icon",4),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(10,"ion-content"),d.TgZ(11,"ion-refresher",5),d.NdJ("ionRefresh",function(t){return e.doRefresh(t)}),d._UZ(12,"ion-refresher-content"),d.qZA(),d.TgZ(13,"ion-grid"),d.TgZ(14,"ion-row"),d.TgZ(15,"ion-col",6),d.TgZ(16,"ion-button",7),d.NdJ("click",function(){return e.presentImport()}),d._UZ(17,"ion-icon",8),d.qZA(),d._UZ(18,"br"),d._uU(19),d.ALo(20,"translate"),d.qZA(),d.TgZ(21,"ion-col",9),d.TgZ(22,"ion-button",10),d._UZ(23,"ion-icon",11),d.qZA(),d._UZ(24,"br"),d._uU(25),d.ALo(26,"translate"),d.qZA(),d.qZA(),d.qZA(),d._UZ(27,"div",12),d.YNc(28,mt,2,0,"div",13),d.YNc(29,qt,23,22,"ion-list",14),d.YNc(30,Tt,6,3,"div",15),d.qZA()),2&t&&(d.xp6(5),d.Oqu(d.lcZ(6,6,"WAREHOUSE_MOD.TITLE")),d.xp6(14),d.hij(" ",d.lcZ(20,8,"WAREHOUSE_MOD.IMPORT")," "),d.xp6(6),d.hij(" ",d.lcZ(26,10,"WAREHOUSE_MOD.IMPORTED")," "),d.xp6(3),d.Q6J("ngIf",e.loadingFlag.pending),d.xp6(1),d.Q6J("ngIf",e.products.length>0&&e.reload),d.xp6(1),d.Q6J("ngIf",0===e.products.length&&e.loadingFlag.result))},directives:[r.Gu,r.sr,r.Sm,r.oU,r.cs,r.wd,r.YG,r.gu,r.W2,r.nJ,r.Wo,r.jY,r.Nd,r.wI,r.YI,s.rH,o.O5,r.PQ,r.q_,r.Ub,r.yh,r.Q$,o.sg,r.Ie,r.yW,r.PM,r.FN],pipes:[g.X$,pt.g,gt.u,o.JJ],styles:[""]}),t})();var _t=i(24023),xt=i(5264),vt=i(66341),Ot=i(56209),St=i(98373),Et=i(84267),Ut=i(59865);const wt=[{path:":id/list",component:m},{path:":id/items",component:xt.E},{path:":id/logs",component:St.B},{path:":id/imported",component:z},{path:":id",component:bt,children:[{path:"imported"}]}];let yt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({providers:[vt.n,x.k,Et.V1,Ut.y],imports:[[o.ez,n.u5,r.Pc,n.UX,s.Bz.forChild(wt),g.aw.forChild(),_t.E,Ot.Ns]]}),t})()}}]);